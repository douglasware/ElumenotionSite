<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Multitenant organizations documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Multitenant organizations documentation ">
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../styles/docfx.min.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      
      

      <script>
        MathJax = {
          options: {
            processHtmlClass: ['tex2jax_process', 'math']
          }
        };
      </script>

      <script type="text/javascript" src="../../styles/docfx.min.js"></script>
      <script type="text/javascript" src="../../styles/main.js"></script>
  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="png" src="../../logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h2 id="multitenant-organizations-documentation">Multitenant organizations documentation</h2>

<p>A multitenant organization is an organization that has more than one instance of Microsoft Entra ID. Describes ways that users can have a seamless experience accessing resources and collaborating across multiple tenants.</p>
<h3 id="about-multitenant-organizations">About multitenant organizations</h3>
<h4 id="overview">OVERVIEW</h4>
<ul>
<li>Multitenant organization capabilities</li>
<li>Compare multitenant capabilities</li>
</ul>
<h3 id="configure-a-multitenant-organization">Configure a multitenant organization</h3>
<h4 id="overview-1">OVERVIEW</h4>
<p>What is a multitenant organization?</p>
<h4 id="how-to-guide">HOW-TO GUIDE</h4>
<ul>
<li>Microsoft 365 admin center</li>
<li>PowerShell or Microsoft Graph API</li>
</ul>
<h3 id="configure-cross-tenant-synchronization">Configure cross-tenant synchronization</h3>
<h4 id="overview-2">OVERVIEW</h4>
<p>What is cross-tenant synchronization?</p>
<h4 id="how-to-guide-1">HOW-TO GUIDE</h4>
<ul>
<li>Microsoft Entra admin center</li>
<li>PowerShell or Microsoft Graph API</li>
</ul>
<h2 id="collaborate-in-microsoft-365">Collaborate in Microsoft 365</h2>
<h3 id="concept">CONCEPT</h3>
<ul>
<li>Identity provisioning for Microsoft 365</li>
<li>Microsoft 365 multitenant people search</li>
<li>Plan for multitenant organizations in Microsoft 365</li>
</ul>
<h2 id="multitenant-organization-capabilities-in-microsoft-entra-id">Multitenant organization capabilities in Microsoft Entra ID</h2>
<h3 id="article--04232024">Article • 04/23/2024</h3>
<p>This article provides an overview of the multitenant organization scenario and the related capabilities in Microsoft Entra ID.</p>
<h3 id="what-is-a-tenant">What is a tenant?</h3>
<p>A tenant is an instance of Microsoft Entra ID in which information about a single organization resides including organizational objects such as users, groups, and devices and also application registrations, such as Microsoft 365 and third-party applications. A tenant also contains access and compliance policies for resources, such as applications registered in the directory. The primary functions served by a tenant include identity authentication as well as resource access management.</p>
<p>From a Microsoft Entra perspective, a tenant forms an identity and access management scope. For example, a tenant administrator makes an application available to some or all the users in the tenant and enforces access policies on that application for users in that tenant. In addition, a tenant contains organizational branding data that drives end-user experiences, such as the organizations email domains and SharePoint URLs used by employees in that organization. From a Microsoft 365 perspective, a tenant forms the default collaboration and licensing boundary. For example, users in Microsoft Teams or Microsoft Outlook can easily find and collaborate with other users in their tenant, but don&#39;t have the ability to find or see users in other tenants.</p>
<p>Tenants contain privileged organizational data and are securely isolated from other tenants. In addition, tenants can be configured to have data persisted and processed in a specific region or cloud, which enables organizations to use tenants as a mechanism to meet data residency and handling compliance requirements.</p>
<h3 id="what-is-a-multitenant-organization">What is a multitenant organization?</h3>
<p>A multitenant organization is an organization that has more than one instance of Microsoft Entra ID. Here are the primary reasons why an organization might have multiple tenants:</p>
<ul>
<li>Conglomerates: Organizations with multiple subsidiaries or business units that operate independently.</li>
</ul>
<h2 id="reasons-for-multiple-tenants-in-organizations">Reasons for Multiple Tenants in Organizations</h2>
<ul>
<li><strong>Mergers and acquisitions:</strong> Organizations that merge or acquire companies.</li>
<li><strong>Divestiture activity:</strong> In a divestiture, one organization splits off part of its business to form a new organization or sell it to an existing organization.</li>
<li><strong>Multiple clouds:</strong> Organizations that have compliance or regulatory needs to exist in multiple cloud environments.</li>
<li><strong>Multiple geographical boundaries:</strong> Organizations that operate in multiple geographic locations with various residency regulations.</li>
<li><strong>Test or staging tenants:</strong> Organizations that need multiple tenants for testing or staging purposes before deploying more broadly to primary tenants.</li>
<li><strong>Department or employee-created tenants:</strong> Organizations where departments or employees have created tenants for development, testing, or separate control.</li>
</ul>
<h2 id="multitenant-challenges">Multitenant Challenges</h2>
<p>Your organization may have recently acquired a new company, merged with another company, or restructured based on newly formed business units. If you have disparate identity management systems, it might be challenging for users in different tenants to access resources and collaborate.</p>
<h3 id="diagram-description">Diagram Description</h3>
<p>The following diagram shows how users in other tenants might not be able to access applications across tenants in your organization:</p>
<ul>
<li>Diagram illustrates connections between a &quot;Primary tenant&quot; and other &quot;Tenant&quot; entities showing successful and failed accesses with arrows and cross symbols.</li>
</ul>
<p>As your organization evolves, your IT team must adapt to meet the changing needs. This often includes integrating with an existing tenant or forming a new one. Regardless of how the identity infrastructure is managed, it&#39;s critical that users have a seamless experience accessing resources and collaborating. Today, you may be using custom scripts or on-premises solutions to bring the tenants together to provide a seamless experience across tenants.</p>
<h2 id="b2b-direct-connect">B2B Direct Connect</h2>
<p>To enable users across tenants to collaborate in Teams Connect shared channels, you can use <strong>Microsoft Entra B2B direct connect</strong>. B2B direct connect is a feature of External Identities that lets you set up a mutual trust relationship with another Microsoft Entra organization for seamless collaboration in Teams. When the trust is established, the B2B direct connect user has single sign-on access using credentials from their home tenant.</p>
<h2 id="b2b-direct-connect-constraint">B2B Direct Connect Constraint</h2>
<p>Currently, B2B direct connect works only with Teams Connect shared channels.</p>
<pre><code class="lang-mermaid">graph LR
    B2B_Direct_Connect_Users(&quot;B2B direct connect users&quot;) --&gt;|connects to| Primary_Tenant(&quot;Primary tenant&quot;)
    Primary_Tenant --&gt;|connects back to| Tenant(&quot;Tenant&quot;)
    Tenant --&gt;|connection| B2B_Direct_Connect_Users
</code></pre><p>For more information, see <a href="https://example.com">B2B direct connect overview</a>.</p>
<h2 id="b2b-collaboration">B2B Collaboration</h2>
<p>To enable users across tenants to collaborate, you can use <a href="https://example.com">Microsoft Entra B2B collaboration</a>. B2B collaboration is a feature within External Identities that lets you invite guest users to collaborate with your organization. Once the external user has redeemed their invitation or completed sign-up, they&#39;re represented in your tenant as a user object. With B2B collaboration, you can securely share your company&#39;s applications and services with external users, while maintaining control over your own corporate data.</p>
<h3 id="primary-constraints-with-b2b-collaboration">Primary Constraints with B2B Collaboration</h3>
<ul>
<li>Administrators must invite users using the B2B invitation process or build an onboarding experience using the <a href="https://example.com">B2B collaboration invitation manager</a>.</li>
<li>Administrators might have to synchronize users using custom scripts.</li>
<li>Depending on automatic redemption settings, users might need to accept a consent prompt and follow a redemption process in each tenant.</li>
<li>By default, users are of type external guest, which has different permissions than external member and might not be the desired user experience.</li>
</ul>
<pre><code class="lang-mermaid">graph LR
    Tenant(&quot;Tenant&quot;) --&gt;|invites| Primary_Tenant(&quot;Primary tenant&quot;)
    Primary_Tenant --&gt;|controls| B2B_Collab_Users(&quot;B2B collab users&quot;)
    B2B_Collab_Users --&gt;|access| Microsoft_Apps(&quot;Microsoft apps&quot;)
    Microsoft_Apps --&gt;|provides service to| Non_Microsoft_Apps(&quot;Non-Microsoft apps&quot;)
    Non_Microsoft_Apps --&gt;|receives services from| Tenant
</code></pre><h2 id="cross-tenant-synchronization">Cross-tenant synchronization</h2>
<p>If you want users to have a more seamless collaboration experience across tenants, you can use <a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/cross-tenant-access">cross-tenant synchronization</a>. Cross-tenant synchronization is a one-way synchronization service in Microsoft Entra ID that automates creating, updating, and deleting B2B collaboration users across tenants in an organization. Cross-tenant synchronization builds on the B2B collaboration functionality and utilizes existing B2B cross-tenant access settings. Users are represented in the target tenant as a B2B collaboration user object.</p>
<h3 id="benefits">Benefits</h3>
<ul>
<li>Automatically create B2B collaboration users within your organization and provide them access to the applications they need, without creating and maintaining custom scripts.</li>
<li>Improve the user experience and ensure that users can access resources, without receiving an invitation email and having to accept a consent prompt in each tenant.</li>
<li>Automatically update users and remove them when they leave the organization.</li>
</ul>
<h3 id="constraints">Constraints</h3>
<ul>
<li>Doesn&#39;t enhance the current Teams or Microsoft 365 experiences. Synchronized users will have the same cross-tenant Teams and Microsoft 365 experiences available to any other B2B collaboration user.</li>
<li>Doesn&#39;t synchronize groups, devices, or contacts.</li>
</ul>
<h3 id="diagram-description-1">Diagram Description</h3>
<pre><code class="lang-mermaid">flowchart LR
    A[Source tenant] --&gt;|B2B collab users (External members)| B[Cross-tenant sync]
    B --&gt;|B2B collab users (External members)| C[Target tenant]
    B --&gt;|Sync| D[Microsoft apps]
    C --&gt;|Sync| E[Non-Microsoft apps]
</code></pre><p>For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/what-is-b2b">What is cross-tenant synchronization?</a>.</p>
<h2 id="multitenant-organization">Multitenant organization</h2>
<p>Multitenant organization is a feature in Microsoft Entra ID and Microsoft 365 that enables you to form a tenant group within your organization. Each pair of tenants in the group is governed by cross-tenant access settings that you can use to configure B2B or cross-tenant synchronization.</p>
<p>Here are the primary benefits of a multitenant organization:</p>
<ul>
<li>Differentiate in-organization and out-of-organization external users</li>
<li>Improved collaborative experience in new Microsoft Teams</li>
<li>Improved people search experience across tenants</li>
</ul>
<h3 id="diagram-description-2">Diagram Description</h3>
<p>The diagram illustrates the multitenant organization, showing an owner tenant (C) and member tenants (A) and (B) connected via cross-tenant access settings.</p>
<h2 id="compare-multitenant-capabilities">Compare multitenant capabilities</h2>
<p>Depending on the needs of your organization, you can use any combination of B2B direct connect, B2B collaboration, cross-tenant synchronization, and multitenant organization capabilities. B2B direct connect and B2B collaboration are independent capabilities, while cross-tenant synchronization and multitenant organization capabilities are independent of each other, though both rely on underlying B2B collaboration.</p>
<p>The following table compares the capabilities of each feature.</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>B2B Direct Connect</th>
<th>B2B Collaboration</th>
<th>Cross-tenant Synchronization</th>
<th>Multitenant Organization</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Support for External IDs</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Access Management</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Custom Configurations</strong></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Automation Tools</strong></td>
<td>No</td>
<td>Limited</td>
<td>Extensive</td>
<td>Extensive</td>
</tr>
</tbody>
</table>
<h2 id="comparison-of-collaboration-types">Comparison of Collaboration Types</h2>
<h3 id="b2b-direct-connect-org-to-org-external-or-internal">B2B Direct Connect (Org-to-org external or internal)</h3>
<ul>
<li><strong>Purpose</strong>: Users can access Teams Connect shared channels hosted in external tenants.</li>
<li><strong>Value</strong>: Enables external collaboration within Teams Connect shared channels only. More convenient for administrators because they don&#39;t have to manage B2B users.</li>
<li><strong>Primary Administrator Workflow</strong>: Configure cross-tenant access to provide external users inbound access to tenant credentials for their home tenant.</li>
</ul>
<h3 id="b2b-collaboration-org-to-org-external-or-internal">B2B Collaboration (Org-to-org external or internal)</h3>
<ul>
<li><strong>Purpose</strong>: Users can access apps/resources hosted in external tenants, usually with limited guest privileges. Depending on automatic redemption settings, users might need to accept a consent prompt in each tenant.</li>
<li><strong>Value</strong>: Enables external collaboration. More control and monitoring for administrators by managing the B2B collaboration users. Administrators can limit the access that these external users have to their apps/resources.</li>
<li><strong>Primary Administrator Workflow</strong>: Add external users to resource tenant by using the B2B invitation process or build your own onboarding experience using the B2B collaboration.</li>
</ul>
<h3 id="cross-tenant-synchronization-org-internal">Cross-tenant Synchronization (Org internal)</h3>
<ul>
<li><strong>Purpose</strong>: Users can seamlessly access apps/resources across the same organization, even if they&#39;re hosted in different tenants.</li>
<li><strong>Value</strong>: Enables collaboration across organizational tenants. Administrators don&#39;t have to manually invite and synchronize users between tenants to ensure continuous access to apps/resources within the organization.</li>
<li><strong>Primary Administrator Workflow</strong>: Configure the cross-tenant synchronization engine to synchronize users between multiple tenants as B2B collaboration users.</li>
</ul>
<h3 id="multitenant-organization-org-internal">Multitenant Organization (Org internal)</h3>
<ul>
<li><strong>Purpose</strong>: Users can more seamlessly collaborate across a multitenant organization in new Teams and people search.</li>
<li><strong>Value</strong>: Enables collaboration across organizational tenants. Administrators have full configuration ability via cross-tenant access settings. Optional cross-tenant access templates allow pre-configuration of cross-tenant access settings.</li>
<li><strong>Primary Administrator Workflow</strong>: Create a multitenant organization, add (invite) tenants, join a multitenant organization. Leverage existing B2B collaboration users or use cross-tenant synchronization to enhance collaboration.</li>
</ul>
<h2 id="collaboration-models-comparison">Collaboration Models Comparison</h2>
<table>
<thead>
<tr>
<th>Type</th>
<th>B2B direct connect (Org-to-org external or internal)</th>
<th>B2B collaboration (Org-to-org external or internal)</th>
<th>Cross-tenant synchronization (Org internal)</th>
<th>Multitenant organization (Org internal)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Trust level</strong></td>
<td>Mid trust. B2B direct connect users are less easy to track, mandating a certain level of trust with the external organization.</td>
<td>Low to mid trust. User objects can be tracked easily and managed with granular controls.</td>
<td>High trust. All tenants are part of the same organization, and users are typically granted member access to all apps/resources.</td>
<td>High trust. All tenants are part of the same organization, and users are typically granted member access to all apps/resources.</td>
</tr>
<tr>
<td><strong>Effect on users</strong></td>
<td>Users access the resource tenant using the credentials for their home tenant. User objects aren&#39;t created in the resource tenant.</td>
<td>External users are added to a tenant as B2B collaboration users.</td>
<td>Within the same organization, users are synchronized from their home tenant to the resource tenant as B2B collaboration users.</td>
<td>Within the same multitenant organization, B2B collaboration users, particularly member users, benefit from enhanced, seamless collaboration across Microsoft 365.</td>
</tr>
<tr>
<td><strong>User type</strong></td>
<td>B2B direct connect user - N/A</td>
<td>B2B collaboration user - External member - External guest (default)</td>
<td>B2B collaboration user - External member (default) - External guest</td>
<td>B2B collaboration user - External member (default) - External guest</td>
</tr>
</tbody>
</table>
<h3 id="diagram-description-3">Diagram Description</h3>
<p>The following diagram shows how B2B direct connect, B2B collaboration, and cross-tenant synchronization capabilities could be used together.</p>
<h2 id="org-to-org-external">Org-to-org external</h2>
<ul>
<li><strong>Org internal</strong><ul>
<li>B2B collaboration users (External members)<ul>
<li>Fabrikam (Acquired)</li>
<li>Cross-tenant sync → Contoso (Primary tenant)</li>
</ul>
</li>
</ul>
</li>
<li><strong>B2B collaboration</strong><ul>
<li>B2B collaboration users (External guests)</li>
<li>B2B direct connect → Adatum Corporation (External collaborator)<ul>
<li>Trey Research (External collaborator)</li>
<li>B2B direct connect users</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="terminology">Terminology</h2>
<p>To better understand multitenant organization scenario related Microsoft Entra capabilities, refer to the following list of terms.</p>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>tenant</td>
<td>An instance of Microsoft Entra ID.</td>
</tr>
<tr>
<td>organization</td>
<td>The top level of a business hierarchy.</td>
</tr>
<tr>
<td>multitenant organization</td>
<td>An organization that has more than one instance of Microsoft Entra ID, as well as a capability to group those instances in Microsoft Entra ID.</td>
</tr>
<tr>
<td>creator tenant</td>
<td>The tenant that created the multitenant organization.</td>
</tr>
<tr>
<td>owner tenant</td>
<td>A tenant with the owner role. Initially, the creator tenant.</td>
</tr>
<tr>
<td>added tenant</td>
<td>A tenant that was added by an owner tenant.</td>
</tr>
<tr>
<td>joiner tenant</td>
<td>A tenant that is joining the multitenant organization.</td>
</tr>
<tr>
<td>join request</td>
<td>A joiner or added tenant submits a join request to join the multitenant organization.</td>
</tr>
<tr>
<td>pending tenant</td>
<td>A tenant that was added by an owner but hasn&#39;t yet joined.</td>
</tr>
<tr>
<td>active tenant</td>
<td>A tenant that created or joined the multitenant organization.</td>
</tr>
</tbody>
</table>
<h2 id="glossary">Glossary</h2>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>member tenant</td>
<td>A tenant with the member role. Most joiner tenants start as members.</td>
</tr>
<tr>
<td>multitenant organization tenant</td>
<td>An active tenant of the multitenant organization, not pending.</td>
</tr>
<tr>
<td>cross-tenant synchronization</td>
<td>A one-way synchronization service in Microsoft Entra ID that automates creating, updating, and deleting B2B collaboration users across tenants in an organization.</td>
</tr>
<tr>
<td>cross-tenant access settings</td>
<td>Settings to manage collaboration for specific Microsoft Entra organizations.</td>
</tr>
<tr>
<td>cross-tenant access settings template</td>
<td>An optional template to preconfigure cross-tenant access settings that are applied to any partner tenant newly joining the multitenant organization.</td>
</tr>
<tr>
<td>organizational settings</td>
<td>Cross-tenant access settings for specific Microsoft Entra organizations.</td>
</tr>
<tr>
<td>configuration</td>
<td>An application and underlying service principal in Microsoft Entra ID that includes the settings (such as target tenant, user scope, and attribute mappings) needed for cross-tenant synchronization.</td>
</tr>
<tr>
<td>provisioning</td>
<td>The process of automatically creating or synchronizing objects across a boundary.</td>
</tr>
<tr>
<td>automatic redemption</td>
<td>A B2B setting to automatically redeem invitations so newly created users don’t receive an invitation email or have to accept a consent prompt when added to a target tenant.</td>
</tr>
</tbody>
</table>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>What is a multitenant organization in Microsoft Entra ID?</li>
<li>What is cross-tenant synchronization?</li>
</ul>
<h2 id="what-is-a-multitenant-organization-in-microsoft-entra-id">What is a multitenant organization in Microsoft Entra ID?</h2>
<p>Multitenant organization is a feature in Microsoft Entra ID and Microsoft 365 that enables you to form a tenant group within your organization. Each pair of tenants in the group is governed by cross-tenant access settings that you can use to configure B2B or cross-tenant synchronization.</p>
<h2 id="why-use-multitenant-organization">Why use multitenant organization?</h2>
<p>Here are the primary goals of multitenant organization:</p>
<ul>
<li>Define a group of tenants belonging to your organization</li>
<li>Collaborate across your tenants in new Microsoft Teams</li>
<li>Enable search and discovery of user profiles across your tenants through Microsoft 365 people search</li>
</ul>
<h2 id="who-should-use-it">Who should use it?</h2>
<p>Organizations that own multiple Microsoft Entra tenants and want to streamline intra-organization cross-tenant collaboration in Microsoft 365.</p>
<p>The multitenant organization capability is built on the assumption of reciprocal provisioning of B2B member users across multitenant organization tenants.</p>
<p>As such, the multitenant organization capability assumes the simultaneous use of Microsoft Entra cross-tenant synchronization or an alternative bulk provisioning engine for external identities.</p>
<h2 id="benefits-1">Benefits</h2>
<p>Here are the primary benefits of a multitenant organization:</p>
<ul>
<li>Differentiate in-organization and out-of-organization external users</li>
</ul>
<p>In Microsoft Entra ID, external users originating from within a multitenant organization can be differentiated from external users originating from outside the multitenant organization. This differentiation facilitates the application of different policies for in-organization and out-of-organization external users.</p>
<h2 id="improved-collaborative-experience-in-microsoft-teams">Improved Collaborative Experience in Microsoft Teams</h2>
<p>In new Microsoft Teams, multitenant organization users can expect an improved collaborative experience across tenants with chat, calling, and meeting start notifications from all connected tenants across the multitenant organization. Tenant switching is more seamless and faster. For more information, see <a href="url">Announcing more seamless collaboration in Microsoft Teams for multitenant organizations</a> and <a href="url">Microsoft Teams: Advantages of the new architecture</a>.</p>
<h2 id="improved-people-search-experience-across-tenants">Improved People Search Experience Across Tenants</h2>
<p>Across Microsoft 365 services, the multitenant organization people search experience is a collaboration feature that enables search and discovery of people across multiple tenants. Once enabled, users are able to search and discover synced user profiles in a tenant&#39;s global address list and view their corresponding people cards. For more information, see <a href="url">Microsoft 365 multitenant organization people search</a>.</p>
<h2 id="how-does-a-multitenant-organization-work">How Does a Multitenant Organization Work?</h2>
<p>The multitenant organization capability enables you to form a tenant group within your organization. The following list describes the basic lifecycle of a multitenant organization.</p>
<ul>
<li><p><strong>Define a multitenant organization</strong>
One tenant administrator defines a multitenant organization as a grouping of tenants. The grouping of tenants isn&#39;t reciprocal until each listed tenant takes action to join the multitenant organization. The objective is a reciprocal agreement between all listed tenants.</p>
</li>
<li><p><strong>Join a multitenant organization</strong>
Tenant administrators of listed tenants take action to join the multitenant organization. After joining, the multitenant organization relationship is reciprocal between each and every tenant that joined the multitenant organization.</p>
</li>
<li><p><strong>Leave a multitenant organization</strong>
Tenant administrators of listed tenants can leave a multitenant organization at any time. While a tenant administrator who defined the multitenant organization can add and remove listed tenants they don&#39;t control the other tenants.</p>
</li>
</ul>
<h2 id="multitenant-organization-collaboration">Multitenant Organization Collaboration</h2>
<p>A multitenant organization is established as a collaboration of equals. Each tenant administrator stays in control of their tenant and their membership in the multitenant organization.</p>
<h3 id="cross-tenant-access-settings">Cross-tenant Access Settings</h3>
<p>Administrators staying in control of their resources is a guiding principle for multitenant organization collaboration. Cross-tenant access settings are required for each tenant-to-tenant relationship. Tenant administrators explicitly configure, as needed, the following policies:</p>
<ul>
<li><p><strong>Cross-tenant access partner configurations</strong></p>
<p>For more information, see Configure cross-tenant access settings for B2B collaboration and crossTenantAccessPolicyConfigurationPartner resource type.</p>
</li>
<li><p><strong>Cross-tenant access identity synchronization</strong></p>
<p>For more information, see Configure cross-tenant synchronization and crossTenantIdentitySyncPolicyPartner resource type.</p>
</li>
</ul>
<h3 id="multitenant-organization-example">Multitenant Organization Example</h3>
<p>The following diagram shows three tenants A, B, and C that form a multitenant organization.</p>
<pre><code class="lang-mermaid">graph TD;
    A[Member tenant (A)] --&gt;|Cross-tenant access settings| C[Owner tenant (C)];
    B[Member tenant (B)] --&gt;|Cross-tenant access settings| C;
    C --&gt;|Cross-tenant access settings| A;
    C --&gt;|Cross-tenant access settings| B;
</code></pre><h2 id="tenant-description-table">Tenant Description Table</h2>
<table>
<thead>
<tr>
<th>Tenant</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>Administrators see a multitenant organization consisting of A, B, C. They also see cross-tenant access settings for B and C.</td>
</tr>
<tr>
<td>B</td>
<td>Administrators see a multitenant organization consisting of A, B, C. They also see cross-tenant access settings for A and C.</td>
</tr>
<tr>
<td>C</td>
<td>Administrators see a multitenant organization consisting of A, B, C. They also see cross-tenant access settings for A and B.</td>
</tr>
</tbody>
</table>
<h2 id="templates-for-cross-tenant-access-settings">Templates for cross-tenant access settings</h2>
<p>To ease the setup of homogenous cross-tenant access settings applied to partner tenants in the multitenant organization, the administrator of each multitenant organization tenant can configure optional cross-tenant access settings templates dedicated to the multitenant organization. These templates can be used to preconfigure cross-tenant access settings that are applied to any partner tenant newly joining the multitenant organization.</p>
<h2 id="tenant-role-and-state">Tenant role and state</h2>
<p>To facilitate the management of a multitenant organization, any given multitenant organization tenant has an associated role and state.</p>
<h3 id="tenant-role-description-table">Tenant Role Description Table</h3>
<table>
<thead>
<tr>
<th>Tenant role</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Owner</td>
<td>One tenant creates the multitenant organization. The multitenant organization creating tenant receives the role of owner. The privilege of the owner tenant is to add tenants into a pending state as well as to remove tenants from the multitenant organization. Also, an owner tenant can change the role of other multitenant organization tenants.</td>
</tr>
<tr>
<td>Member</td>
<td>Following the addition of pending tenants to the multitenant organization, pending tenants need to join the multitenant organization to turn their state from pending to active. Joined tenants typically start in the member role. Any member tenant has the privilege to leave the multitenant organization.</td>
</tr>
</tbody>
</table>
<h2 id="tenant-state">Tenant State</h2>
<table>
<thead>
<tr>
<th>Tenant state</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pending</td>
<td>A pending tenant has yet to join a multitenant organization. While listed in an administrator&#39;s view of the multitenant organization, a pending tenant isn&#39;t yet part of the multitenant organization, and as such is hidden from an end user&#39;s view of a multitenant organization.</td>
</tr>
<tr>
<td>Active</td>
<td>Following the addition of pending tenants to the multitenant organization, pending tenants need to join the multitenant organization to turn their state from pending to active. Joined tenants typically start in the member role. Any member tenant has the privilege to leave the multitenant organization.</td>
</tr>
</tbody>
</table>
<h2 id="constraints-1">Constraints</h2>
<p>The multitenant organization capability has been designed with the following constraints:</p>
<ul>
<li>Any given tenant can only create or join a single multitenant organization.</li>
<li>Any multitenant organization must have at least one active owner tenant.</li>
<li>Each active tenant must have cross-tenant access settings for all active tenants.</li>
<li>Any active tenant may leave a multitenant organization by removing themselves from it.</li>
<li>A multitenant organization is deleted when the only remaining active (owner) tenant leaves.</li>
</ul>
<h2 id="limits">Limits</h2>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Limit</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Maximum number of active tenants, including the owner tenant</td>
<td>100</td>
<td>The owner tenant can add more than 100 pending tenants, but they won&#39;t be able to join the multitenant organization if the limit is exceeded. This limit is applied at the time a pending tenant joins a multitenant organization. This limit is specific to the number of tenants in a multitenant organization. It does not apply to cross-tenant synchronization by itself. To increase this limit, submit a support request in the Microsoft Entra or Microsoft 365 admin center. In the Microsoft Graph APIs, the default limit of 100 tenants is only enforced at the time of joining. In Microsoft 365 admin center, the default limit is enforced at multitenant organization creation time and at time of joining.</td>
</tr>
</tbody>
</table>
<h2 id="external-user-segmentation">External User Segmentation</h2>
<p>By defining a multitenant organization, as well as pivoting on the Microsoft Entra user property of userType, external identities are segmented as follows:</p>
<ul>
<li>External members originating from within a multitenant organization</li>
<li>External guests originating from within a multitenant organization</li>
<li>External members originating from outside of your organization</li>
<li>External guests originating from outside of your organization</li>
</ul>
<p>This segmentation of external users, due to the definition of a multitenant organization, enables administrators to better differentiate in-organization from out-of-organization external users.</p>
<p>External members originating from within a multitenant organization are called multitenant organization members.</p>
<p>Multitenant collaboration capabilities in Microsoft 365 aim to provide a seamless collaboration experience across tenant boundaries when collaborating with multitenant organization member users.</p>
<h2 id="choosing-between-microsoft-365-admin-center-and-cross-tenant-synchronization">Choosing between Microsoft 365 admin center and cross-tenant synchronization</h2>
<ul>
<li><p>If you haven&#39;t previously used Microsoft Entra cross-tenant synchronization, and you intend to establish a collaborating user set topology where the same set of users is shared to all multitenant organization tenants, you might want to use the Microsoft 365 admin center share users functionality.</p>
</li>
<li><p>If you&#39;re already using Microsoft Entra cross-tenant synchronization, for various multi-hub multi-spoke topologies, you don&#39;t need to use the Microsoft 365 admin center share users functionality. Instead, you might want to continue using your existing Microsoft Entra cross-tenant synchronization jobs.</p>
</li>
</ul>
<h2 id="get-started">Get started</h2>
<p>Here are the basic steps to get started using multitenant organization.</p>
<h3 id="step-1-plan-your-deployment">Step 1: Plan your deployment</h3>
<p>For more information, see <a href="#">Plan for multitenant organizations in Microsoft 365</a>.</p>
<h2 id="step-2-create-your-multitenant-organization">Step 2: Create your multitenant organization</h2>
<p>Create your multitenant organization using Microsoft 365 admin center, Microsoft Graph PowerShell, or Microsoft Graph API:</p>
<ul>
<li>First tenant, soon-to-be owner tenant, creates a multitenant organization.</li>
<li>Owner tenant adds one or more joiner tenants.</li>
</ul>
<h2 id="step-3-join-a-multitenant-organization">Step 3: Join a multitenant organization</h2>
<p>Join a multitenant organization using Microsoft 365 admin center or Microsoft Graph PowerShell, or Microsoft Graph API:</p>
<ul>
<li>Joiner tenants submit a join request to join the multitenant organization of owner tenant.</li>
<li>To allow for asynchronous processing, wait up to 2 hours.</li>
</ul>
<p>Your multitenant organization is formed.</p>
<h2 id="step-4-synchronize-users">Step 4: Synchronize users</h2>
<p>Depending on your use case, you may want to synchronize users using one of the following methods:</p>
<ul>
<li>Synchronize users in multitenant organizations in Microsoft 365</li>
<li>Configure cross-tenant synchronization</li>
<li>Configure cross-tenant synchronization using PowerShell or Microsoft Graph API</li>
<li>Your alternative bulk provisioning engine</li>
</ul>
<h2 id="license-requirements">License requirements</h2>
<p>The multitenant organization capability requires Microsoft Entra ID P1 licenses. Only one Microsoft Entra ID P1 license is required per employee per multitenant organization. Also, you must have at least one Microsoft Entra ID P1 license per tenant. To find the right license for your requirements, see <a href="#">Compare generally available features of Microsoft Entra ID</a>.</p>
<h2 id="next-steps-1">Next steps</h2>
<ul>
<li>Plan for multitenant organizations in Microsoft 365</li>
<li>What is cross-tenant synchronization?</li>
</ul>
<h2 id="what-is-cross-tenant-synchronization">What is cross-tenant synchronization?</h2>
<p>Article • 01/03/2024</p>
<p><strong>Cross-tenant synchronization</strong> automates creating, updating, and deleting <a href="https://www.microsoft.com/security">Microsoft Entra B2B collaboration</a> users across tenants in an organization. It enables users to access applications and collaborate across tenants, while still allowing the organization to evolve.</p>
<p>Here are the primary goals of cross-tenant synchronization:</p>
<ul>
<li>Seamless collaboration for a multitenant organization</li>
<li>Automate lifecycle management of B2B collaboration users in a multitenant organization</li>
<li>Automatically remove B2B accounts when a user leaves the organization</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=7B-PQwNfGBc">Video Link</a></p>
<h2 id="why-use-cross-tenant-synchronization">Why use cross-tenant synchronization?</h2>
<p>Cross-tenant synchronization automates creating, updating, and deleting B2B collaboration users. Users created with cross-tenant synchronization are able to access both Microsoft applications (such as Teams and SharePoint) and non-Microsoft applications (such as <a href="https://www.servicenow.com">ServiceNow</a>, <a href="https://www.adobe.com">Adobe</a>, and many more), regardless of which tenant the apps are integrated with. These users continue to benefit from the security capabilities in Microsoft Entra ID, such as <a href="https://www.microsoft.com/security">Microsoft Entra Conditional Access</a> and <a href="https://www.microsoft.com/security">cross-tenant access settings</a>, and can be governed through features such as <a href="https://www.microsoft.com/security">Microsoft Entra entitlement management</a>.</p>
<p>The following diagram shows how you can use cross-tenant synchronization to enable users to access applications across tenants in your organization.</p>
<h2 id="who-should-use">Who should use?</h2>
<ul>
<li>Organizations that own multiple Microsoft Entra tenants and want to streamline intra-organization cross-tenant application access.</li>
<li>Cross-tenant synchronization is not currently suitable for use across organizational boundaries.</li>
</ul>
<h2 id="benefits-2">Benefits</h2>
<p>With cross-tenant synchronization, you can do the following:</p>
<ul>
<li>Automatically create B2B collaboration users within your organization and provide them access to the applications they need, without creating and maintaining custom scripts.</li>
<li>Improve the user experience and ensure that users can access resources, without receiving an invitation email and having to accept a consent prompt in each tenant.</li>
<li>Automatically update users and remove them when they leave the organization.</li>
</ul>
<h2 id="teams-and-microsoft-365">Teams and Microsoft 365</h2>
<p>Users created by cross-tenant synchronization will have the same experience when accessing Microsoft Teams and other Microsoft 365 services as B2B collaboration users created through a manual invitation. If your organization uses shared channels, please see the known issues document for additional details. Over time, the <code>member</code> userType will be used by the various Microsoft 365 services to provide differentiated end user experiences for users in a multitenant organization.</p>
<h2 id="properties">Properties</h2>
<p>When you configure cross-tenant synchronization, you define a trust relationship between a source tenant and a target tenant. Cross-tenant synchronization has the following properties:</p>
<ul>
<li>Based on the Microsoft Entra provisioning engine.</li>
<li>Is a push process from the source tenant, not a pull process from the target tenant.</li>
<li>Supports pushing only internal members from the source tenant. It doesn&#39;t support syncing external users from the source tenant.</li>
<li>Users in scope for synchronization are configured in the source tenant.</li>
<li>Attribute mapping is configured in the source tenant.</li>
<li>Extension attributes are supported.</li>
<li>Target tenant administrators can stop a synchronization at any time.</li>
</ul>
<p>The following table shows the parts of cross-tenant synchronization and which tenant they&#39;re configured.</p>
<table>
<thead>
<tr>
<th>Tenant</th>
<th>Cross-tenant access settings</th>
<th>Automatic redemption</th>
<th>Sync settings configuration</th>
<th>Users in scope</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source tenant</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>Target tenant</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="cross-tenant-synchronization-setting">Cross-tenant synchronization setting</h2>
<p>The cross-tenant synchronization setting is an inbound only organizational setting to allow the administrator of a source tenant to synchronize users into a target tenant. This setting is a check box with the name Allow users sync into this tenant that is specified in the target tenant. This setting doesn&#39;t impact B2B invitations created through other processes such as manual invitation or Microsoft Entra entitlement management.</p>
<h2 id="inbound-access-settings---contoso">Inbound Access Settings - Contoso</h2>
<h3 id="b2b-collaboration--b2b-direct-connect--trust-settings--cross-tenant-sync">B2B Collaboration | B2B Direct Connect | Trust Settings | Cross-tenant Sync</h3>
<p>Enabling this will allow the admin of the specified (source) tenant to sync objects into this (target) tenant.</p>
<p>Disabling this will block admins of the source tenant from syncing objects into the target tenant but will not remove currently synced objects. We recommend that this setting should only be used between tenants that are part of the same organization.</p>
<ul>
<li>[ ] Allow users sync into this tenant</li>
</ul>
<h3 id="configuration-instructions">Configuration Instructions</h3>
<p>To configure this setting using Microsoft Graph, see the Update crossTenantIdentitySyncPolicyPartner API. For more information, see Configure cross-tenant synchronization.</p>
<h3 id="automatic-redemption-setting">Automatic Redemption Setting</h3>
<p>The automatic redemption setting is an inbound and outbound organizational trust setting to automatically redeem invitations so users don&#39;t have to accept the consent prompt the first time they access the resource/target tenant. This setting is a check box with the following name:</p>
<ul>
<li>Automatically redeem invitations with the tenant <code>&lt;tenant&gt;</code></li>
</ul>
<pre><code>[ ] Check this setting if you want to automatically redeem invitations. If so, users from the specified tenant won&#39;t have to accept the consent prompt the first time they access this tenant using cross-tenant synchronization, B2B collaboration, or B2B direct connect. This setting will only suppress the consent prompt if the specified tenant checks this setting for outbound access as well. 
</code></pre><h3 id="compare-setting-for-different-scenarios">Compare Setting for Different Scenarios</h3>
<p>The automatic redemption setting applies to cross-tenant synchronization, B2B collaboration, and B2B direct connect in the following situations:</p>
<h2 id="contextual-settings-overview">Contextual Settings Overview</h2>
<ul>
<li>When users are created in a target tenant using cross-tenant synchronization.</li>
<li>When users are added to a resource tenant using B2B collaboration.</li>
<li>When users access resources in a resource tenant using B2B direct connect.</li>
</ul>
<p>The following table shows how this setting compares when enabled for these scenarios:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Cross-tenant synchronization</th>
<th>B2B collaboration</th>
<th>B2B direct connect</th>
</tr>
</thead>
<tbody>
<tr>
<td>Automatic redemption setting</td>
<td>Required</td>
<td>Optional</td>
<td>Optional</td>
</tr>
<tr>
<td>Users receive a B2B collaboration invitation email</td>
<td>No</td>
<td>No</td>
<td>N/A</td>
</tr>
<tr>
<td>Users must accept a consent prompt</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>Users receive a B2B collaboration notification email</td>
<td>No</td>
<td>Yes</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<p>This setting doesn&#39;t impact application consent experiences. For more information, see <a href="https://microsoft.com">Consent experience for applications in Microsoft Entra ID</a>. This setting isn&#39;t supported for organizations across different Microsoft cloud environments, such as Azure commercial and Azure Government.</p>
<h3 id="when-is-consent-prompt-suppressed">When is consent prompt suppressed?</h3>
<p>The automatic redemption setting will only suppress the consent prompt and invitation email if both the home/source tenant (outbound) and resource/target tenant (inbound) checks this setting.</p>
<h4 id="process-flow">Process Flow</h4>
<pre><code class="lang-mermaid">flowchart LR
    A[Source tenant] --&gt;|Outbound access settings| B(Target tenant)
    A --&gt;|Automatically redeem invitations| B
    B --&gt;|Inbound access settings| A
    B --&gt;|Automatically redeem invitations| A
</code></pre><p>The following table shows the consent prompt behavior for source tenant users when the automatic redemption setting is checked for different cross-tenant access setting combinations.</p>
<h2 id="consent-prompt-behavior-for-cross-tenant-synchronization">Consent Prompt Behavior for Cross-tenant Synchronization</h2>
<table>
<thead>
<tr>
<th>Home/source tenant</th>
<th>Resource/target tenant</th>
<th>Consent prompt behavior for source tenant users</th>
</tr>
</thead>
<tbody>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Suppressed</td>
</tr>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
</tbody>
</table>
<p>To configure this setting using Microsoft Graph, see the <a href="">Update crossTenantAccessPolicyConfigurationPartner API</a>.</p>
<h3 id="how-do-users-know-what-tenants-they-belong-to">How do users know what tenants they belong to?</h3>
<p>For cross-tenant synchronization, users don&#39;t receive an email or have to accept a consent prompt. If users want to see what tenants they belong to, they can open their <a href="">My Account</a> page and select Organizations. In the Microsoft Entra admin center, users can open their <a href="">Portal settings</a>, view their Directories + subscriptions, and switch directories.</p>
<h3 id="get-started-1">Get started</h3>
<p>Here are the basic steps to get started using cross-tenant synchronization.</p>
<h2 id="step-1-define-how-to-structure-the-tenants-in-your-organization">Step 1: Define how to structure the tenants in your organization</h2>
<p>Cross-tenant synchronization provides a flexible solution to enable collaboration, but every organization is different. For example, you might have a central tenant, satellite tenants, or sort of a mesh of tenants. Cross-tenant synchronization supports any of these topologies. For more information, see <a href="#">Topologies for cross-tenant synchronization</a>.</p>
<h3 id="diagram-description-4">Diagram Description</h3>
<p>The diagram illustrates different tenant structures: a central tenant with multiple satellite tenants, all of which are interconnected through various synchronization paths.</p>
<h2 id="step-2-enable-cross-tenant-synchronization-in-the-target-tenants">Step 2: Enable cross-tenant synchronization in the target tenants</h2>
<p>In the target tenant where users are created, navigate to the Cross-tenant access settings page. Here you enable cross-tenant synchronization and the B2B automatic redemption settings by selecting the respective check boxes. For more information, see <a href="#">Configure cross-tenant synchronization</a>.</p>
<h3 id="settings-screenshot-description">Settings Screenshot Description</h3>
<p>The screenshot shows a settings interface where you can enable user synchronization into this tenant and automate invitation redemption through checkbox selections.</p>
<h2 id="step-3-enable-cross-tenant-synchronization-in-the-source-tenants">Step 3: Enable cross-tenant synchronization in the source tenants</h2>
<p>In any source tenant, navigate to the Cross-tenant access settings page and enable the B2B automatic redemption feature. Next, you use the Cross-tenant synchronization page to set up a cross-tenant synchronization job and specify:</p>
<ul>
<li>Which users you want to synchronize</li>
<li>What attributes you want to include</li>
<li>Any transformations</li>
</ul>
<p>For anyone that has used Microsoft Entra ID to provision identities into a SaaS application, this experience will be familiar. Once you have synchronization configured,</p>
<h2 id="license-requirements-1">License requirements</h2>
<p>In the source tenant: Using this feature requires Microsoft Entra ID P1 licenses. Each user who is synchronized with cross-tenant synchronization must have a P1 license in their home/source tenant. To find the right license for your requirements, see <a href="https://docs.microsoft.com">Compare generally available features of Microsoft Entra ID</a>.</p>
<p>In the target tenant: Cross-tenant sync relies on the Microsoft Entra External ID billing model. To understand the external identities licensing model, see <a href="https://docs.microsoft.com">MAU billing model for Microsoft Entra External ID</a>. You will also need at least one Microsoft Entra ID P1 license in the target tenant to enable auto-redemption.</p>
<h2 id="frequently-asked-questions">Frequently asked questions</h2>
<h3 id="clouds">Clouds</h3>
<p>Which clouds can cross-tenant synchronization be used in?</p>
<ul>
<li>Cross-tenant synchronization is supported within the commercial cloud and Azure Government.</li>
<li>Cross-tenant synchronization isn&#39;t supported within the Microsoft Azure operated by 21Vianet cloud.</li>
<li>Synchronization is only supported between two tenants in the same cloud.</li>
<li>Cross-cloud (such as public cloud to Azure Government) isn&#39;t currently supported.</li>
</ul>
<h3 id="existing-b2b-users">Existing B2B users</h3>
<p>Will cross-tenant synchronization manage existing B2B users?</p>
<h3 id="synchronization-features">Synchronization Features</h3>
<ul>
<li>Cross-tenant synchronization can update existing B2B users, ensuring each has only one account.</li>
<li>It does not match an internal user in the source tenant with an internal user in the target tenant.</li>
</ul>
<h3 id="synchronization-frequency">Synchronization Frequency</h3>
<p><strong>How often does cross-tenant synchronization run?</strong></p>
<ul>
<li>The sync interval is set at 40-minute intervals.</li>
<li>Duration varies by the number of in-scope users.</li>
<li>The initial sync cycle takes longer than subsequent cycles.</li>
</ul>
<h3 id="scope">Scope</h3>
<p><strong>How do I control what is synchronized into the target tenant?</strong></p>
<ul>
<li>Control which users are provisioned using configuration or attribute-based filters.</li>
<li>Control which attributes on the user object are synchronized.</li>
<li>For more info, see <a href="#">Scoping users or groups to be provisioned with scoping filters</a>.</li>
</ul>
<p><strong>What happens if a user is removed from the scope of sync in a source tenant?</strong></p>
<ul>
<li>If removed, cross-tenant synchronization will soft delete them in the target tenant.</li>
</ul>
<h3 id="object-and-user-types">Object and User Types</h3>
<p><strong>What object types can be synchronized?</strong></p>
<ul>
<li>Microsoft Entra users can be synchronized between tenants.</li>
</ul>
<p><strong>What user types can be synchronized?</strong></p>
<ul>
<li>Internal members from source tenants.</li>
<li>Users from source tenants can be synchronized to target tenants as external members or external guests.</li>
</ul>
<h2 id="existing-b2b-collaboration-users">Existing B2B Collaboration Users</h2>
<p>Cross-tenant synchronization will match the user and make any necessary updates to the user, such as update the display name. By default, the UserType won&#39;t be updated from guest to member, but you can configure this in the attribute mappings.</p>
<h2 id="attributes">Attributes</h2>
<h3 id="what-user-attributes-can-be-synchronized">What user attributes can be synchronized?</h3>
<ul>
<li><p><strong>Common Attributes</strong>: Cross-tenant synchronization will sync commonly used attributes on the user object in Microsoft Entra ID, including displayName, userPrincipalName, and directory extension attributes.</p>
</li>
<li><p><strong>Manager Provisioning</strong>: </p>
<ul>
<li>Supports provisioning the manager attribute. Both the user and their manager must be in scope for provisioning.</li>
<li>Configurations created before January 2024:<ul>
<li>The manager attribute will automatically be added to the mappings.</li>
<li>Manager updates apply on the incremental cycle for users undergoing changes (e.g., manager change). The synchronization engine doesn&#39;t automatically update previously provisioned users but can update the manager for existing users in scope.</li>
<li>For specific or restart provisioning, you can manually initiate provisioning for the manager attribute.</li>
</ul>
</li>
<li>Configurations with a custom schema:<ul>
<li>You must manually add the manager attribute to your attribute mappings when they are changed from the default, which will trigger updates of all users in scope.</li>
</ul>
</li>
<li>If a user’s manager is removed in the source tenant and no new manager is assigned, the manager attribute will not be updated in the target tenant.</li>
</ul>
</li>
</ul>
<h3 id="what-attributes-cant-be-synchronized">What attributes can&#39;t be synchronized?</h3>
<p>(The PDF does not provide specifics on attributes that cannot be synchronized; only those that can are listed.)</p>
<h2 id="user-attributes-in-cross-tenant-synchronization">User Attributes in Cross-Tenant Synchronization</h2>
<h3 id="overview-3">Overview</h3>
<ul>
<li>Attributes including photos, custom security attributes, and user attributes outside of the directory can&#39;t be synchronized by cross-tenant synchronization.</li>
</ul>
<h3 id="source-and-management-of-user-attributes">Source and Management of User Attributes</h3>
<ul>
<li>Cross-tenant synchronization does not offer direct control over the source of authority. Attributes are authoritative at the source tenant and may reflect multiple underlying sources. For the tenant-to-tenant process, this is handled as the source tenant&#39;s values being authoritative for the sync process. No support for reversing the sync process&#39;s source of authority is currently available.</li>
</ul>
<h3 id="attribute-changes-impact">Attribute Changes Impact</h3>
<ul>
<li>If changes to a synced user&#39;s attributes occur in the target tenant, those changes will persist unless the user in the source tenant is updated. Subsequent syncs will then update the target tenant to match the source tenant&#39;s updates.</li>
</ul>
<h3 id="blocking-user-sign-in">Blocking User Sign-in</h3>
<ul>
<li>If no changes occur to the synced user in the source tenant, any manual blocks on sign-in settings in the target tenant will continue to be effective. If the user is updated in the source tenant, cross-tenant synchronization will address the blocking status based on the source tenant&#39;s settings.</li>
</ul>
<h2 id="structure-of-cross-tenant-synchronization">Structure of Cross-Tenant Synchronization</h2>
<h3 id="mesh-synchronization-across-multiple-tenants">Mesh Synchronization Across Multiple Tenants</h3>
<ul>
<li>Cross-tenant synchronization is typically configured as a single-direction peer-to-peer sync between one source and one target tenant. However, it&#39;s possible to configure multiple instances to sync from a single source to various target tenants.</li>
</ul>
<h2 id="cross-tenant-synchronization-1">Cross-Tenant Synchronization</h2>
<ul>
<li>One sync instance can exist between a source and a target.</li>
<li>Cross-tenant synchronization only synchronizes users that are internal to the home/source tenant, ensuring that you can&#39;t end up with a loop where a user is written back to the same tenant.</li>
<li>Multiple topologies are supported. For more information, see <a href="#">Topologies for cross-tenant synchronization</a>.</li>
</ul>
<h3 id="faq">FAQ</h3>
<h4 id="can-i-use-cross-tenant-synchronization-across-organizations-outside-my-multitenant-organization">Can I use cross-tenant synchronization across organizations (outside my multitenant organization)?</h4>
<ul>
<li>For privacy reasons, cross-tenant synchronization is intended for use within an organization. We recommend using <a href="#">entitlement management</a> for inviting B2B collaboration users across organizations.</li>
</ul>
<h4 id="can-cross-tenant-synchronization-be-used-to-migrate-users-from-one-tenant-to-another-tenant">Can cross-tenant synchronization be used to migrate users from one tenant to another tenant?</h4>
<ul>
<li>No. Cross-tenant synchronization isn&#39;t a migration tool because the source tenant is required for synchronized users to authenticate. In addition, tenant migrations would require migrating user data such as SharePoint and OneDrive.</li>
</ul>
<h2 id="b2b-collaboration-1">B2B Collaboration</h2>
<h3 id="does-cross-tenant-synchronization-resolve-any-present-b2b-collaboration-limitations">Does cross-tenant synchronization resolve any present B2B collaboration limitations?</h3>
<ul>
<li>Since cross-tenant synchronization is built on existing B2B collaboration technology, existing limitations apply. Examples include (but aren&#39;t limited to):</li>
</ul>
<table>
<thead>
<tr>
<th>App or service</th>
<th>Limitations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Power BI</td>
<td>Support for UserType Member in Power BI is currently in preview. For more information, see <a href="#">Distribute Power BI content to external guest users with Microsoft Entra B2B</a>.</td>
</tr>
<tr>
<td>Azure Virtual Desktop</td>
<td>External member and external guest aren&#39;t supported in Azure Virtual Desktop.</td>
</tr>
</tbody>
</table>
<h2 id="b2b-direct-connect-1">B2B Direct Connect</h2>
<h3 id="how-does-cross-tenant-synchronization-relate-to-b2b-direct-connect">How does cross-tenant synchronization relate to B2B direct connect?</h3>
<h2 id="b2b-direct-connect-and-cross-tenant-synchronization">B2B Direct Connect and Cross-Tenant Synchronization</h2>
<ul>
<li>B2B direct connect is the underlying identity technology required for Teams Connect shared channels.</li>
<li>We recommend B2B collaboration for all other cross-tenant application access scenarios, including both Microsoft and non-Microsoft applications.</li>
<li>B2B direct connect and cross-tenant synchronization are designed to co-exist, and you can enable them both for broad coverage of cross-tenant scenarios.</li>
</ul>
<p><strong>We&#39;re trying to determine the extent to which we&#39;ll need to utilize cross-tenant synchronization in our multitenant organization. Do you plan to extend support for B2B direct connect beyond Teams Connect?</strong></p>
<ul>
<li>There&#39;s no plan to extend support for B2B direct connect beyond Teams Connect shared channels.</li>
</ul>
<h2 id="microsoft-365">Microsoft 365</h2>
<h3 id="does-cross-tenant-synchronization-enhance-any-cross-tenant-microsoft-365-app-access-user-experiences">Does cross-tenant synchronization enhance any cross-tenant Microsoft 365 app access user experiences?</h3>
<ul>
<li>Cross-tenant synchronization utilizes a feature that improves the user experience by suppressing the first-time B2B consent prompt and redemption process in each tenant.</li>
<li>Synchronized users will have the same cross-tenant Microsoft 365 experiences available to any other B2B collaboration user.</li>
</ul>
<h3 id="can-cross-tenant-synchronization-enable-people-search-scenarios-where-synchronized-users-appear-in-the-global-address-list-of-the-target-tenant">Can cross-tenant synchronization enable people search scenarios where synchronized users appear in the global address list of the target tenant?</h3>
<ul>
<li>Yes, but you must set the value for the shownInAddressList attribute of synchronized users to True, which is not set by default. If you want to create a unified address list, you&#39;ll need to set up a mesh peer-to-peer topology. For more information, see Step 9: Review attribute mappings.</li>
<li>Cross-tenant synchronization creates B2B collaboration users and doesn&#39;t create contacts.</li>
</ul>
<h2 id="teams">Teams</h2>
<h3 id="does-cross-tenant-synchronization-enhance-any-current-teams-experiences">Does cross-tenant synchronization enhance any current Teams experiences?</h3>
<ul>
<li>Synchronized users will have the same cross-tenant Microsoft 365 experiences available to any other B2B collaboration user.</li>
</ul>
<h2 id="integration">Integration</h2>
<h3 id="federation-options">Federation Options</h3>
<ul>
<li>For each internal user in the source tenant, cross-tenant synchronization creates a federated external user in the target tenant, commonly used in B2B environments. It supports syncing:<ul>
<li>Internal users federated to other identity systems (including Active Directory Federation Services). It does not support syncing external users.</li>
</ul>
</li>
</ul>
<h3 id="scim-support">SCIM Support</h3>
<ul>
<li>Microsoft Entra ID supports a SCIM client but not a SCIM server. For more information, visit <a href="https://docs.microsoft.com/en-us/microsoft-identity-manager/scim">SCIM synchronization with Microsoft Entra ID</a>.</li>
</ul>
<h2 id="deprovisioning">Deprovisioning</h2>
<h3 id="support-for-deprovisioning-users">Support for Deprovisioning Users</h3>
<ul>
<li><p>Cross-tenant synchronization supports deprovisioning users when:</p>
<ul>
<li>A user is deleted in the source tenant; they are soft deleted in the target tenant.</li>
<li>A user is unassigned from the cross-tenant synchronization configuration.</li>
<li>A user is removed from a group associated with the cross-tenant synchronization configuration.</li>
<li>An attribute on the user changes making them non-compliant with the scoping filter of the cross-tenant synchronization configuration.</li>
</ul>
</li>
<li><p>If a user in the source tenant has their <code>accountEnabled</code> set to false, they will be blocked from signing in but not deleted in the target tenant. Their <code>accountEnabled</code> property in the target tenant gets updated.</p>
</li>
<li><p>Actions that do not result in soft deletion from the target tenant:</p>
<ol>
<li>Add the user to a group linked to the cross-tenant configuration in the source tenant.</li>
<li>Provision the user on-demand or through the incremental cycle.</li>
<li>Set <code>accountEnabled</code> to false in the source tenant.</li>
<li>Reprovision the user so the same change applies in the target tenant.</li>
<li>Remove the user from the group in the source tenant.</li>
</ol>
</li>
</ul>
<h2 id="does-cross-tenant-synchronization-support-restoring-users">Does cross-tenant synchronization support restoring users?</h2>
<ul>
<li>If the user in the source tenant is restored, reassigned to the app, and meets the scoping condition again within 30 days of soft deletion, they will be restored in the target tenant.</li>
<li>IT admins can also manually restore the user directly in the target tenant.</li>
</ul>
<h2 id="how-can-i-deprovision-all-the-users-that-are-currently-in-scope-of-cross-tenant-synchronization">How can I deprovision all the users that are currently in scope of cross-tenant synchronization?</h2>
<ul>
<li>Unassign all users and/or groups from the cross-tenant synchronization configuration. This will trigger the deprovisioning of all users that were unassigned, either directly or through group membership, in subsequent sync cycles. Please note that the target tenant will need to keep the inbound policy for sync enabled until deprovisioning is complete. If the scope is set to <strong>Sync all users and groups</strong>, you will also need to change it to <strong>Sync only assigned users and groups</strong>. The scheduled users to be deleted will be automatically soft deleted by cross-tenant synchronization and can be selected for hard deletion by the target tenant. You can choose to hard delete the users directly from the target tenant or wait 30 days for them to be automatically hard deleted.</li>
</ul>
<h2 id="if-the-sync-relationship-is-severed-are-external-users-previously-managed-by-cross-tenant-synchronization-deleted-in-the-target-tenant">If the sync relationship is severed, are external users previously managed by cross-tenant synchronization deleted in the target tenant?</h2>
<ul>
<li>No. No changes are made to the external users previously managed by cross-tenant synchronization if the relationship is severed (for example, if the cross-tenant synchronization policy is deleted).</li>
</ul>
<h2 id="next-steps-2">Next steps</h2>
<ul>
<li>Topologies for cross-tenant synchronization</li>
<li>Configure cross-tenant synchronization</li>
</ul>
<h2 id="multitenant-organization-identity-provisioning-for-microsoft-365">Multitenant organization identity provisioning for Microsoft 365</h2>
<p>Article • 04/24/2024</p>
<p>The multitenant organization capability is designed for organizations that own multiple Microsoft Entra tenants and want to streamline intra-organization cross-tenant collaboration in Microsoft 365. It&#39;s built on the premise of reciprocal provisioning of B2B member users across multitenant organization tenants.</p>
<h3 id="microsoft-365-people-search">Microsoft 365 people search</h3>
<p>Teams external access and Teams shared channels excluded, Microsoft 365 people search is typically scoped to within local tenant boundaries. In multitenant organizations with increased need for cross-tenant coworker collaboration, it&#39;s recommended to reciprocally provision users from their home tenants into the resource tenants of collaborating coworkers.</p>
<h3 id="new-microsoft-teams">New Microsoft Teams</h3>
<p>The new Microsoft Teams experience improves upon Microsoft 365 people search and Teams external access for a unified seamless collaboration experience. For this improved experience to light up, the multitenant organization representation in Microsoft Entra ID is required and collaborating users shall be provisioned as B2B members.</p>
<h3 id="collaborating-user-set">Collaborating user set</h3>
<p>Collaboration in Microsoft 365 is built on the premise of reciprocal provisioning of B2B identities across multitenant organization tenants.</p>
<p>For example, say Annie in tenant A, Bob and Barbara in tenant B, and Charlie in tenant C want to collaborate. Conceptually, these four users represent a collaborating user set of four internal identities across three tenants.</p>
<h2 id="collaborating-across-multiple-tenants">Collaborating Across Multiple Tenants</h2>
<p>For people search to succeed, while scoped to local tenant boundaries, the entire collaborating user set must be represented within the scope of each multitenant organization tenant A, B, and C, in the form of either internal or B2B identities.</p>
<pre><code class="lang-mermaid">flowchart TD
  subgraph Tenant_A[&quot;Tenant A&quot;]
    Annie_Internal(Internal&lt;br&gt;Annie)
    Bob_External1(External&lt;br&gt;Bob)
    Barbara_External1(External&lt;br&gt;Barbara)
  end
  subgraph Tenant_B[&quot;Tenant B&quot;]
    Bob_Internal(Internal&lt;br&gt;Bob)
    Barbara_Internal(Internal&lt;br&gt;Barbara)
    Charles_External1(External&lt;br&gt;Charles)
    Annie_External1(External&lt;br&gt;Annie)
  end
  subgraph Tenant_C[&quot;Tenant C&quot;]
    Charles_Internal(Internal&lt;br&gt;Charles)
    Annie_External2(External&lt;br&gt;Annie)
    Bob_External2(External&lt;br&gt;Bob)
    Barbara_External2(External&lt;br&gt;Barbara)
  end
</code></pre><h3 id="example-of-individual-users-in-each-tenant">Example of Individual Users in Each Tenant</h3>
<p>Depending on your organization’s needs, the collaborating user set may contain a subset of collaborating employees, or eventually all employees.</p>
<h2 id="sharing-your-users">Sharing your users</h2>
<p>One of the simpler ways to achieve a collaborating user set in each multitenant organization tenant is for each tenant administrator to define their user contribution and synchronization them outbound. Tenant administrators on the receiving end should accept the shared users inbound.</p>
<ul>
<li>Administrator A contributes or shares Annie</li>
<li>Administrator B contributes or shares Bob and Barbara</li>
<li>Administrator C contributes or shares Charles</li>
</ul>
<h2 id="microsoft-365-admin-center">Microsoft 365 Admin Center</h2>
<p>![Tenant Collaboration Diagram](image url)</p>
<p>Microsoft 365 admin center facilitates orchestration of such a collaborating user set across multitenant organization tenants.</p>
<p>Alternatively, pair-wise configuration of inbound and outbound cross-tenant synchronization can be used to orchestrate such collating user set across multitenant organization tenants.</p>
<h2 id="b2b-member-users">B2B Member Users</h2>
<p>To ensure a seamless collaboration experience across the multitenant organization in new Microsoft Teams, B2B identities are provisioned as B2B users of Member userType.</p>
<h3 id="user-synchronization-methods">User Synchronization Methods</h3>
<table>
<thead>
<tr>
<th>User synchronization method</th>
<th>Default userType property</th>
</tr>
</thead>
<tbody>
<tr>
<td>Synchronize users in multitenant organizations in Microsoft 365</td>
<td>Member</td>
</tr>
<tr>
<td></td>
<td>Remains Guest, if the B2B identity already existed as Guest</td>
</tr>
<tr>
<td>Cross-tenant synchronization in Microsoft Entra ID</td>
<td>Member</td>
</tr>
<tr>
<td></td>
<td>Remains Guest, if the B2B identity already existed as Guest</td>
</tr>
</tbody>
</table>
<h2 id="security-permissions-review">Security Permissions Review</h2>
<p>From a security perspective, you should review the default permissions granted to B2B member users. For more information, see Compare member and guest default permissions.</p>
<h2 id="changing-usertype">Changing UserType</h2>
<p>To change the userType from <strong>Guest to Member</strong> (or vice versa), a source tenant administrator can amend the attribute mappings, or a target tenant administrator can change the userType if the property is not recurrently synchronized.</p>
<h2 id="unsharing-your-users">Unsharing Your Users</h2>
<p>To unshare users, you deprovision users by using the user deprovisioning capabilities available in Microsoft Entra cross-tenant synchronization. By default, when provisioning scope is reduced while a synchronization job is running, users fall out of scope and are soft deleted, unless Target Object Actions for Delete is disabled. For more information, see Deprovisioning and Define who is in scope for provisioning.</p>
<h2 id="next-steps-3">Next Steps</h2>
<ul>
<li>Plan for multitenant organizations in Microsoft 365</li>
<li>Set up a multitenant org in Microsoft 365</li>
</ul>
<h2 id="multitenant-organization-optional-policy-templates">Multitenant organization optional policy templates</h2>
<p>Article • 04/23/2024</p>
<p>Administrators staying in control of their resources is a guiding principle for multitenant organization collaboration. Cross-tenant access settings are required for each tenant-to-tenant relationship. Tenant administrators explicitly configure cross-tenant access partner configurations and identity synchronization settings for partner tenants inside the multitenant organization.</p>
<p>To help apply homogenous cross-tenant access settings to partner tenants in the multitenant organization, the administrator of each tenant can configure optional cross-tenant access settings templates dedicated to the multitenant organization. This article describes how to use templates to preconfigure cross-tenant access settings that are applied to any partner tenant newly joining the multitenant organization.</p>
<h3 id="autogeneration-of-cross-tenant-access-settings">Autogeneration of cross-tenant access settings</h3>
<p>Within a multitenant organization, each pair of tenants must have bi-directional <a href="https://example.com/cross-tenant-access">cross-tenant access settings</a>, for both, partner configuration and identity synchronization. These settings provide the underlying policy framework for enabling trust and for sharing users and applications.</p>
<p>When your tenant joins a new multitenant organization, or when a partner tenant joins your existing multitenant organization, cross-tenant access settings to other partner tenants in the enlarged multitenant organization, if they don&#39;t already exist, are automatically generated in an unconfigured state. In an unconfigured state, these cross-tenant access settings pass through the default settings.</p>
<p>Default cross-tenant access settings apply to all external tenants for which you haven&#39;t created organization-specific customized settings. Typically, these settings are configured to be nontrusting. For example, cross-tenant trusts for multifactor authentication and compliant device claims might be disabled and user and group sharing in B2B direct connect or B2B collaboration might be disallowed.</p>
<p>In multitenant organizations, on the other hand, cross-tenant access settings are typically expected to be trusting. For example, cross-tenant trusts for multifactor authentication and compliant device claims might be enabled and user and group sharing in B2B direct connect or B2B collaboration might be allowed.</p>
<h2 id="policy-templates-at-multitenant-organization-formation">Policy templates at multitenant organization formation</h2>
<p>While the autogeneration of cross-tenant access settings for multitenant organization partner tenants in and of itself doesn&#39;t change any authentication or authorization policy behavior, it allows your organization to easily customize the cross-tenant access settings for partner tenants in the multitenant organization on a per-tenant basis.</p>
<p>As previously described, in multitenant organizations, cross-tenant access settings are typically expected to be trusting. For example, cross-tenant trusts for multifactor authentication and compliant device claims might be enabled and user and group sharing in B2B direct connect or B2B collaboration might be allowed.</p>
<p>While autogeneration of cross-tenant access settings, per previous section, guarantees the existence of cross-tenant access settings for every multitenant organization partner tenant, further maintenance of the cross-tenant access settings for multitenant organization partner tenants is conducted individually, on a per-tenant basis.</p>
<p>To reduce the workload for administrators at the time of multitenant organization formation, you can optionally use policy templates for preemptive configuration of cross-tenant access settings. These template settings are applied at the time of your tenant joins a multitenant organization to all external multitenant organization partner tenants as well as at the time of any partner tenant joins your existing multitenant organization to such new partner tenant.</p>
<p>Enablement or configuration of the optional policy templates, at the time of a partner tenant joins a multitenant organization, preemptively amend the corresponding cross-tenant access settings, for both partner configuration and identity synchronization.</p>
<p>As an example, consider the actions of the administrators for an anticipated multitenant organization with three tenants, A, B, and C.</p>
<ul>
<li>The administrators of all three tenants enable and configure their respective optional policy templates to enable cross-tenant trusts for multifactor authentication and compliant device claims and to allow user and group sharing in B2B direct connect and B2B collaboration.</li>
<li>Administrator A creates the multitenant organization and adds tenants B and C as pending tenants to the multitenant organization.</li>
<li>Administrator B joins the multitenant organization. Cross-tenant access settings in tenant A for partner tenant B are amended, according to tenant A policy template settings. Vice versa, cross-tenant access settings in tenant B for partner tenant A are amended, according to tenant B policy template settings.</li>
</ul>
<h2 id="policy-management-and-coordination">Policy Management and Coordination</h2>
<ul>
<li>Administrator C joins the multitenant organization. Cross-tenant access settings in tenants A (and B) for partner tenant C are amended, according to tenant A (and B) policy template settings. Similarly, cross-tenant access settings in tenant C for partner tenants A and B are amended, according to tenant C policy template settings.</li>
<li>Following the formation of this multitenant organization of three tenants, the cross-tenant access settings of all tenant pairs in the multitenant organization have preemptively been configured.</li>
</ul>
<p>In summary, configuration of the optional policy templates enable you to homogeneously initialize cross-tenant access settings across your multitenant organization, while maintaining maximum flexibility to customize your cross-tenant access settings as needed on a per-tenant basis.</p>
<p>To stop using the policy templates, you can reset them to their default state. For more information, see <a href="#">Configure multitenant organization templates</a>.</p>
<h3 id="policy-template-scoping-and-additional-properties">Policy template scoping and additional properties</h3>
<p>To provide administrators with further configurability, you can choose when cross-tenant access settings are to be amended according to the policy templates. For example, you can choose to apply the policy templates for the following tenants when a tenant joins a multitenant organization:</p>
<table>
<thead>
<tr>
<th>Tenant</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Only new partner tenants</td>
<td>Tenants whose cross-tenant access settings are autogenerated</td>
</tr>
<tr>
<td>Only existing partner tenants</td>
<td>Tenants who already have cross-tenant access settings</td>
</tr>
<tr>
<td>All partner tenants</td>
<td>Both new partner tenants and existing partner tenants</td>
</tr>
<tr>
<td>No partner tenants</td>
<td>Policy templates are effectively disabled</td>
</tr>
</tbody>
</table>
<p>In this context, <em>new partners</em> refer to tenants for which you haven&#39;t yet configured cross-tenant access settings, while <em>existing partners</em> refer to tenants for which you have already configured cross-tenant access settings. This scoping is specified with the <code>templateApplicationLevel</code> property on the cross-tenant access <a href="#">partner configuration template</a> and the <code>templateApplicationLevel</code> property on the cross-tenant access <a href="#">identity synchronization template</a>.</p>
<h2 id="interpretation-of-template-property-values">Interpretation of Template Property Values</h2>
<p>Finally, in terms of interpretation of template property values, any template property value of <code>null</code> has no effect on the corresponding property value in the targeted cross-tenant access settings, while a defined template property value causes the corresponding property value in the targeted cross-tenant access settings to be amended in accordance with the template. The following table illustrates how template property values are being applied to corresponding cross-tenant access setting values.</p>
<table>
<thead>
<tr>
<th>Template Value</th>
<th>Initial Partner Settings Value (Before joining multitenant org)</th>
<th>Final Partner Settings Value (After joining multitenant org)</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
<td><code>&lt;Partner Settings Value&gt;</code></td>
<td><code>&lt;Partner Settings Value&gt;</code></td>
</tr>
<tr>
<td><code>&lt;Template Value&gt;</code></td>
<td><code>&lt;any value&gt;</code></td>
<td><code>&lt;Template Value&gt;</code></td>
</tr>
</tbody>
</table>
<h2 id="policy-templates-used-by-microsoft-365-admin-center">Policy Templates used by Microsoft 365 Admin Center</h2>
<p>When a multitenant organization is formed in Microsoft 365 admin center, an administrator agrees to the following multitenant organization template settings:</p>
<ul>
<li>Identity synchronization is set to allow users to synchronize into this tenant</li>
<li>Cross-tenant access is set to automatically redeem user invitations for both inbound and outbound</li>
</ul>
<p>This is achieved by setting the corresponding three template property values to <code>true</code>:</p>
<ul>
<li><code>automaticUserConsentSettings.inboundAllowed</code></li>
<li><code>automaticUserConsentSettings.outboundAllowed</code></li>
<li><code>userSyncInbound</code></li>
</ul>
<p>For more information, see <a href="#">Join or leave a multitenant organization in Microsoft 365</a>.</p>
<h2 id="cross-tenant-access-settings-at-time-of-multitenant-organization-disassembly">Cross-tenant Access Settings at Time of Multitenant Organization Disassembly</h2>
<p>Currently, there&#39;s no equivalent policy template feature supporting the disassembly of a multitenant organization. When a partner tenant leaves the multitenant organization, each tenant administrator must re-examine and amend accordingly the cross-tenant access settings for the partner tenant that left the multitenant organization.</p>
<p>The partner tenant that left the multitenant organization must re-examine and amend accordingly the cross-tenant access settings for all former multitenant organization partner tenants as well as consider resetting the two policy templates for cross-tenant access settings.</p>
<h2 id="next-steps-4">Next steps</h2>
<ul>
<li>Configure multitenant organization templates using the Microsoft Graph API</li>
</ul>
<h2 id="limitations-in-multitenant-organizations">Limitations in multitenant organizations</h2>
<p>Article Date: 04/24/2024</p>
<p>This article describes limitations to be aware of when you work with multitenant organization functionality across Microsoft Entra ID and Microsoft 365. To provide feedback about the multitenant organization functionality on UserVoice, see <a href="https://feedback.microsoft.com">Microsoft Entra UserVoice</a>.</p>
<h3 id="scope-1">Scope</h3>
<p>The limitations described in this article have the following scope.</p>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>In scope</td>
<td>- Microsoft Entra administrator limitations related to multitenant organizations to support seamless collaboration experiences in new Teams, with reciprocally provisioned B2B members</td>
</tr>
<tr>
<td>Related scope</td>
<td>- Microsoft 365 admin center limitations related to multitenant organizations<br>- Microsoft 365 multitenant organization people search experiences<br>- Cross-tenant synchronization limitations related to Microsoft 365</td>
</tr>
<tr>
<td>Out of scope</td>
<td>- Cross-tenant synchronization unrelated to Microsoft 365<br>- End user experiences in new Teams<br>- End user experiences in Power BI<br>- Tenant migration or consolidation</td>
</tr>
<tr>
<td>Unsupported scenarios</td>
<td>- Seamless collaboration experience across multitenant organizations in classic Teams<br>- Self-service for multitenant organizations larger than 100 tenants<br>- Multitenant organizations in Azure Government or Microsoft Azure operated by 21Vianet<br>- Cross-cloud multitenant organizations</td>
</tr>
</tbody>
</table>
<h2 id="microsoft-365-admin-center-versus-cross-tenant-synchronization">Microsoft 365 admin center versus cross-tenant synchronization</h2>
<ul>
<li>Whether you use the Microsoft 365 admin center share users functionality or Microsoft Entra cross-tenant synchronization, the following items apply:<ul>
<li>In the identity platform, both methods are represented as Microsoft Entra cross-tenant synchronization jobs.</li>
</ul>
</li>
</ul>
<h2 id="synchronization-job-details">Synchronization Job Details</h2>
<ul>
<li>Synchronization jobs created with Microsoft Entra ID will not appear in the Microsoft 365 admin center.</li>
<li>If you created your synchronization job in the Microsoft 365 admin center, do not modify the synchronization job name using Microsoft Entra ID, otherwise it will no longer appear in the admin center.</li>
<li>You might adjust the attribute mappings to match your organizations&#39; needs.</li>
<li>By default, new B2B users are provisioned as B2B members, while existing B2B guests remain B2B guests.</li>
<li>You can opt to convert B2B guests into B2B members by setting <a href="mapping-to-always">Apply this mapping to Always</a>.</li>
</ul>
<h3 id="provisioning-users-with-entra-cross-tenant-synchronization">Provisioning Users with Entra Cross-Tenant Synchronization</h3>
<ul>
<li>If you&#39;re using Microsoft Entra cross-tenant synchronization to provision your users, rather than the Microsoft 365 admin center share users functionality, Microsoft 365 admin center indicates an <strong>Outbound sync status of Not configured</strong>. This is expected behavior. Currently, Microsoft 365 admin center only shows the status of Microsoft Entra cross-tenant synchronization jobs created and managed by Microsoft 365 admin center and doesn&#39;t display Microsoft Entra cross-tenant synchronizations created and managed in Microsoft Entra ID.</li>
<li>If you view Microsoft Entra cross-tenant synchronization in Microsoft Entra admin center, after adding tenants or after joining a multitenant organization in Microsoft 365 admin center, you&#39;ll see a cross-tenant synchronization configuration with the name <code>MT0_Sync_&lt;TenantID&gt;</code>. Refrain from editing or changing the name if you want Microsoft 365 admin center to recognize the configuration as created and managed by Microsoft 365 admin center.</li>
</ul>
<h3 id="limitations-and-usage-patterns">Limitations and Usage Patterns</h3>
<ul>
<li>Microsoft Entra cross-tenant synchronization doesn&#39;t support establishing a cross-tenant synchronization configuration before the tenant in question allows inbound synchronization in their cross-tenant access settings for identity synchronization. Hence the usage of the cross-tenant access settings template for identity synchronization is encouraged, with <code>userSyncInbound</code> set to true, as facilitated by Microsoft 365 admin center.</li>
<li>There&#39;s no established or supported pattern for Microsoft 365 admin center to take control of pre-existing Microsoft Entra cross-tenant synchronization configurations and jobs.</li>
</ul>
<h2 id="join-requests">Join Requests</h2>
<ul>
<li>There are multiple reasons why a join request might fail. If the Microsoft 365 admin center doesn&#39;t indicate why a join request isn&#39;t succeeding, try examining the join request response by using the Microsoft Graph APIs or Microsoft Graph Explorer.</li>
</ul>
<h2 id="microsoft-apps">Microsoft apps</h2>
<h3 id="sharepoint-onedrive">SharePoint OneDrive</h3>
<ul>
<li><p>Promotion of B2B guests to B2B members might not happen automatically. If there&#39;s a user type mismatch between Microsoft Entra ID and SharePoint OneDrive, try <code>Set-SPUser -SyncFromAD</code>.</p>
</li>
<li><p>In user interfaces, sharing a file with <strong>People in Fabrikam</strong>, the current interfaces might be counterintuitive, because B2B members in Fabrikam from Contoso count towards <strong>People in Fabrikam</strong>.</p>
</li>
</ul>
<h3 id="microsoft-forms">Microsoft Forms</h3>
<ul>
<li>B2B member users might not be able to access forms.</li>
</ul>
<h3 id="microsoft-power-bi">Microsoft Power BI</h3>
<ul>
<li>B2B member users are not yet supported. B2B guest users can continue to access Power BI dashboards.</li>
</ul>
<h3 id="microsoft-power-apps-microsoft-dynamics-365-and-related-workloads">Microsoft Power Apps, Microsoft Dynamics 365, and related workloads</h3>
<ul>
<li>B2B member users may have restricted functionality. For more information, see Invite users with Microsoft Entra B2B collaboration.</li>
</ul>
<h2 id="b2b-users-or-b2b-members">B2B users or B2B members</h2>
<ul>
<li><p>The promotion of B2B guests to B2B members represents a strategic decision by multitenant organizations to consider B2B members as trusted users of the organization. Review the <a href="#">default permissions</a> for B2B members.</p>
</li>
<li><p>To promote B2B guests to B2B members, a source tenant administrator can amend the <a href="#">attribute mappings</a>, or a target tenant administrator can <a href="#">change the userType</a> if the property is not recurringly synchronized.</p>
</li>
<li><p>As organizations roll out the multitenant organization functionality including provisioning of B2B users across multitenant organization tenants, you might want to provision some users as B2B guests, while provision others as B2B members. To achieve this, you might want to establish two Microsoft Entra cross-tenant synchronization configurations in the source tenant, one with userType attribute mappings configured to B2B guest, and another with userType attribute mappings configured to B2B member, each with <a href="#">Apply this mapping set to</a>.</p>
</li>
</ul>
<h2 id="always">Always</h2>
<p>By moving a user from one configuration&#39;s scope to the other, you can easily control who will be a B2B guest or a B2B member in the target tenant.</p>
<ul>
<li>As part of a multitenant organization, reset redemption for an already redeemed B2B user is currently disabled.</li>
<li>The at-scale provisioning of B2B users might collide with contact objects. The handling or conversion of contact objects is currently not supported.</li>
<li>Using Microsoft Entra cross-tenant synchronization to target hybrid identities that have been converted to B2B users has not been tested in source of authority conflicts and is not supported.</li>
</ul>
<h2 id="cross-tenant-synchronization-deprovisioning">Cross-tenant synchronization deprovisioning</h2>
<p>By default, when provisioning scope is reduced while a synchronization job is running, users fall out of scope and are soft deleted, unless Target Object Actions for Delete is disabled. For more information, see Deprovisioning and Define who is in scope for provisioning.</p>
<ul>
<li>Currently, SkipOutOfScopeDeletions works for application provisioning jobs, but not for Microsoft Entra cross-tenant synchronization. To avoid soft deletion of users taken out of scope of cross-tenant synchronization, set Target Object Actions for Delete to disabled.</li>
</ul>
<h2 id="next-steps-5">Next steps</h2>
<ul>
<li>Known issues for provisioning in Microsoft Entra ID</li>
</ul>
<h2 id="topologies-for-cross-tenant-collaboration">Topologies for cross-tenant collaboration</h2>
<p><strong>Article</strong> • 11/03/2023</p>
<p>Organizations often find themselves managing multiple tenants due to mergers and acquisitions, regulatory requirements, or administrative boundaries. Regardless of your scenario, Microsoft Entra offers a flexible and ready-to-use solution for provisioning accounts across tenants and facilitating seamless collaboration. Microsoft Entra accommodates the following three models and can adapt to your evolving organizational needs.</p>
<ul>
<li>Hub and spoke</li>
<li>Mesh</li>
<li>Just-in-time</li>
</ul>
<h3 id="hub-and-spoke">Hub and spoke</h3>
<p>The hub and spoke topology presents two common patterns:</p>
<ul>
<li><p><strong>Option 1 (application hub):</strong> In this option, you can integrate commonly used applications into a central hub tenant that users from across the organization can access.</p>
</li>
<li><p><strong>Option 2 (user hub):</strong> Alternatively, option 2 centralizes all your users in a single tenant and provisions them into spoke tenants where resources are managed.</p>
</li>
</ul>
<p>Let&#39;s examine a few real-world scenarios and see how they align with each of these models.</p>
<h3 id="mergers-and-acquisitions-application-hub">Mergers and acquisitions (application hub)</h3>
<p>During mergers and acquisitions, the ability to quickly enable collaboration is crucial, allowing businesses to function cohesively while complex IT decisions are being made. For instance, when a newly acquired company&#39;s employees need immediate access to applications such as the internal help desk ticketing system or benefits application, cross-tenant synchronization proves invaluable. This synchronization process allows users from the acquired company to be provisioned into the application hub from day one, granting them access to SaaS apps, on-premises applications, and other cloud resources. Within the target tenant, admins can set up access packages to grant time limited access to additional applications such as Salesforce and Amazon Web Services.</p>
<h2 id="diagram-overview">Diagram Overview</h2>
<p>The diagram illustrates the integration process of recently acquired tenants into a parent company&#39;s systems, showing different types of applications and their relationship with HR and Active Directory.</p>
<h3 id="flowchart-description">Flowchart Description</h3>
<ul>
<li><strong>HR</strong>: Serves as the starting point.</li>
<li><strong>Active Directory</strong>: Central management for user authentication.</li>
<li><strong>Applications Covered</strong>:<ul>
<li><strong>SaaS apps</strong>: Includes third-party services such as Salesforce and AWS.</li>
<li><strong>Microsoft apps</strong>: Involves typical Microsoft suite applications.</li>
<li><strong>On-premises apps</strong>: Covers internally hosted applications like internal SQL databases.</li>
</ul>
</li>
</ul>
<h2 id="separate-collaboration-and-resource-tenants-user-hub">Separate collaboration and resource tenants (user hub)</h2>
<p>As organizations scale their usage of Azure, they often create dedicated tenants for managing critical Azure resources. Meanwhile, they rely on a central hub tenant for user provisioning. This model empowers administrators in the hub tenant to establish central security and governance policies while granting development teams greater autonomy and agility to deploy required Azure resources. Cross-tenant synchronization supports this topology by enabling administrators to provision a subset of users into the spoke tenants and manage the lifecycle of those users.</p>
<h2 id="hr">HR</h2>
<h3 id="active-directory-architecture">Active Directory Architecture</h3>
<h4 id="mesh">Mesh</h4>
<p>While some companies centralize their users within a single tenant, others have a more decentralized structure with applications, HR systems, and Active Directory domains integrated into each tenant. Cross-tenant synchronization offers the flexibility to choose which users are provisioned into each tenant.</p>
<h4 id="collaborate-within-a-portfolio-company-partial-mesh">Collaborate within a portfolio company (partial-mesh)</h4>
<p>In this scenario, each tenant represents a different company within the same parent organization. Administrators in each tenant choose a subset of users to provision into the target tenant. This solution provides flexibility for each tenant to operate independently, while facilitating collaboration when users need access to critical resources.</p>
<h2 id="cross-tenant-synchronization-2">Cross-tenant Synchronization</h2>
<p>Cross-tenant synchronization is one way. An internal member user can be synchronized into multiple tenants as an external user. When the topology shows a synchronization going in both directions, it&#39;s a distinct set of users in each direction, and each arrow is a separate configuration.</p>
<h3 id="diagram-description-5">Diagram Description</h3>
<p>The diagram illustrates a topology with three entities, designated by logos labeled &quot;Microsoft Teams,&quot; &quot;AWS,&quot; and &quot;Salesforce,&quot; all connected in a triangular layout with bi-directional arrows indicating synchronization between them.</p>
<h2 id="collaborate-across-business-units-full-mesh">Collaborate across business units (full-mesh)</h2>
<p>In this scenario, the organization has designated different tenants for each business unit. The business units work closely together, in particular using Microsoft Teams. As a result, each tenant has chosen to provision all users across the four tenants in the organization. As new users join the company or leave, the provisioning service takes care of creating and deleting users. The organization has also configured a multitenant organization that includes all four tenants. Now when users need to collaborate in Teams, they&#39;re able to easily find users across the company and start chats and meetings with those users.</p>
<h2 id="just-in-time">Just-in-time</h2>
<p>While the scenarios discussed so far cover collaboration within an organization, there are cases where cross-organization collaboration is vital. This could be in the context of joint ventures or organizations of independent legal entities. By employing connected organizations and entitlement management, you can define policies for accessing resources across connected organizations and enable users to request access to the resources they need.</p>
<h2 id="joint-ventures">Joint ventures</h2>
<p>Consider Contoso and Litware, separate organizations engaged in a multi-year joint venture. They need to collaborate closely. Administrators at Contoso have defined access packages containing the resources required by Litware users. When a new Litware employee needs access to Contoso&#39;s resources, they can request access to the access package. Upon approval, they are provisioned with the necessary resources. Access can be time-limited and subject to periodic review to ensure compliance with Contoso&#39;s governance requirements.</p>
<pre><code class="lang-mermaid">flowchart TB
    A(&quot;Litware&quot;) --&gt;|request access| B(&quot;Contoso&quot;)
    B --&gt;|provision resources| A
    A --&gt;|periodic review| B
    B --&gt;|compliance check| A
</code></pre><p>The diagram above shows how two organizations can collaborate in a just-in-time manner using connected organizations and entitlement management.</p>
<h2 id="contoso">Contoso</h2>
<h3 id="resources">Resources</h3>
<p><strong>Marketing Group</strong><br>![User Icons of three users](description of the image)  </p>
<ul>
<li>Marketing catalog</li>
<li>Sales catalog</li>
<li>Sales team group<ul>
<li>Sales app</li>
<li>Sales site</li>
<li>Salesperson access package</li>
<li>Sales support access package</li>
<li>Sales team group member</li>
<li>Sales app contributor</li>
<li>Sales site member</li>
<li>Employees can request</li>
<li>Outside sales reps can request  </li>
</ul>
</li>
</ul>
<p><strong>Connected Organization - Litware</strong><br>![User Icons of three users, same as the first image just different organization](description of the image)<br>Policies for access request, approval, review, lifecycle, separation of duties (SOD)</p>
<h2 id="next-steps-6">Next steps</h2>
<ul>
<li>What is cross-tenant synchronization?</li>
<li>Configure cross-tenant synchronization</li>
</ul>
<h2 id="feedback">Feedback</h2>
<p>Was this page helpful? <a href="#">Yes</a> <a href="#">No</a></p>
<p><a href="#">Provide product feedback</a> | <a href="#">Get help at Microsoft Q&amp;A</a></p>
<h2 id="governance-and-cross-tenant-synchronization">Governance and cross-tenant synchronization</h2>
<p>Article • 03/21/2024</p>
<p>Cross-tenant synchronization is a flexible and ready-to-use solution to provision accounts and facilitate seamless collaboration across tenants in an organization. Cross-tenant synchronization automatically manages user identity lifecycle across tenants. It provisions, synchronizes, and deprovisions users in the scope of synchronization from source tenants.</p>
<p>This article describes how Microsoft Entra ID Governance customers can use cross-tenant synchronization to manage identity and access lifecycles across multitenant organizations.</p>
<h3 id="deployment-example">Deployment example</h3>
<p>In this example, Contoso is a multitenant organization with three production Microsoft Entra tenants. Contoso is deploying cross-tenant synchronization and Microsoft Entra ID Governance features to address the following scenarios:</p>
<ul>
<li>Manage employee identity lifecycles across multiple tenants</li>
<li>Use workflows to automate lifecycle processes for employees that originate in other tenants</li>
<li>Assign resource access automatically to employees that originate in other tenants</li>
<li>Allow employees to request access to resources in multiple tenants</li>
<li>Review the access of synchronized users</li>
</ul>
<p>From a cross-tenant synchronization perspective, Contoso Europe, Middle East, and Africa (Contoso EMEA) and Contoso United States (Contoso US) are source tenants and Contoso is a target tenant. The following diagram illustrates the topology.</p>
<pre><code class="lang-mermaid">graph LR
    ContosoEMEA[Contoso EMEA] --&gt; Contoso
    ContosoUS[Contoso US] --&gt; Contoso
</code></pre><h2 id="cross-tenant-synchronization-3">Cross-Tenant Synchronization</h2>
<h3 id="overview-4">Overview</h3>
<p>This supported topology for cross-tenant synchronization is one of many in Microsoft Entra ID. Tenants can be a source tenant, a target tenant, or both. In the following sections, learn how cross-tenant synchronization and Microsoft Entra ID Governance features address several scenarios.</p>
<h3 id="diagram-explanation">Diagram Explanation</h3>
<pre><code class="lang-mermaid">flowchart TB
    admin1[Hybrid Identity Administrator] --&gt;|Cross-tenant sync| contoso_emea[Contoso EMEA]
    admin2[Hybrid Identity Administrator] --&gt;|Cross-tenant sync| contoso_us[Contoso US]
    contoso_emea --&gt;|Access Packages| contoso[Contoso]
    contoso_us --&gt;|Access Packages| contoso
    contoso --&gt; lifecycle[Lifecycle Workflows]
    subgraph access_packages [Access Packages]
        identity_catalog[Identity catalog]
        policies[Automatic assignment policy]
        reviews[Access Reviews]
        lifecycle --&gt;|Properties include:| identity_catalog
        lifecycle --&gt;|Properties include:| policies
        lifecycle --&gt;|Properties include:| reviews
    end
</code></pre><h3 id="manage-employee-lifecycles-across-tenants">Manage Employee Lifecycles Across Tenants</h3>
<p><strong>Cross-tenant synchronization in Microsoft Entra ID</strong> automates creating, updating, and deleting B2B collaboration users.</p>
<p>When organizations create, or provision, a B2B collaboration user in a tenant, user access depends partly on how the organization provisioned them: Guest or Member user type. When you select user type, consider the various <a href="#">properties of a Microsoft Entra B2B collaboration user</a>. The Member user type is suitable if users are part of the larger multitenant organization and need member-level access to resources in the organizational tenants. Microsoft Teams requires the Member user type in <a href="#">multitenant organizations</a>.</p>
<p>By default, cross-tenant synchronization includes commonly used attributes on the user object in Microsoft Entra ID. The following diagram illustrates this scenario.</p>
<h3 id="cross-tenant-synchronization-and-b2b-collaboration">Cross-Tenant Synchronization and B2B Collaboration</h3>
<p>Organizations use the attributes to help create dynamic membership of groups and access packages in the source and target tenant. Some Microsoft Entra ID features have user attributes to target, such as lifecycle workflow user scoping.</p>
<p>To remove, or deprovision, a B2B collaboration user from a tenant automatically stops access to resources in that tenant. This configuration is relevant when employees leave an organization.</p>
<h3 id="automate-lifecycle-processes-with-workflows">Automate lifecycle processes with workflows</h3>
<p>Microsoft Entra ID lifecycle workflows are an identity governance feature to manage Microsoft Entra users. Organizations can automate joiner, mover, and leaver processes.</p>
<p>With cross-tenant synchronization, multitenant organizations can configure lifecycle workflows to run automatically for B2B collaboration users it manages. For example, configure a user onboarding workflow, triggered by the <code>createdDateTime</code> event user attribute, to request access package assignment for new B2B collaboration users. Use attributes such as <code>userType</code> and <code>userPrincipalName</code> to scope lifecycle workflows for users homed in other tenants the organization owns.</p>
<h3 id="govern-synchronized-user-access-with-access-packages">Govern synchronized user access with access packages</h3>
<p>Multitenant organizations can ensure B2B collaboration users have access to shared resources in a target tenant. Users can request access, where needed. In the following scenarios, see how the identity governance feature, entitlement management access packages govern resource access.</p>
<h3 id="automatically-assign-access-in-target-tenants-to-employees-from-source-tenants">Automatically assign access in target tenants to employees from source tenants</h3>
<h2 id="birthright-assignment">Birthright Assignment</h2>
<p>The term birthright assignment refers to automatically granting resource access based on one or more user properties. To configure birthright assignment, create <a href="https://example.com">automatic assignment policies for access packages</a> in entitlement management and configure resource roles to grant shared resource access.</p>
<h2 id="cross-tenant-synchronization-4">Cross-Tenant Synchronization</h2>
<p>Organizations manage cross-tenant synchronization configuration in the source tenant. Therefore, organizations can delegate resource access management to other source tenant administrators for synchronized B2B collaboration users:</p>
<ul>
<li>In the source tenant, administrators configure cross-tenant synchronization attribute mappings for the users that require cross-tenant resource access.</li>
<li>In the target tenant, administrators use attributes in automatic assignment policies to determine access package membership for synchronized B2B collaboration users.</li>
</ul>
<p>To drive automatic assignment policies in the target tenant, synchronize default attribute mappings, such as department or map directory extensions, in the source tenant.</p>
<h2 id="enable-source-tenant-employees-to-request-access-to-target-tenant-shared-resources">Enable Source-Tenant Employees to Request Access to Target-Tenant Shared Resources</h2>
<p>With identity governance access package policies, multitenant organizations can allow B2B collaboration users, created by cross-tenant synchronization, to request access to shared resources in a target tenant. This process is useful if employees need just-in-time (JIT) access to a resource that another tenant owns.</p>
<h2 id="review-synchronized-user-access">Review Synchronized-User Access</h2>
<p>Access reviews in Microsoft Entra ID enable organizations to manage group memberships, access to enterprise applications, and role assignments. Regularly review user access to ensure the right people have access.</p>
<p>When resource access configuration doesn’t automatically assign access, such as with dynamic groups or access packages, configure access reviews to apply the results to resources upon completion. The following sections describe how multitenant organizations can configure access reviews for users across tenants in source and target tenants.</p>
<h3 id="review-source-tenant-user-access">Review Source-Tenant User Access</h3>
<h2 id="multitenant-organizations-and-internal-users">Multitenant Organizations and Internal Users</h2>
<p>Multitenant organizations can include internal users in access reviews. This action enables access recertification in source tenants that synchronizes users. Use this approach for regular review of security groups assigned to cross-tenant synchronization. Therefore, ongoing B2B collaboration access to other tenants has approval in the user home tenant.</p>
<p>Use access reviews of users in source tenants to avoid potential conflicts between cross-tenant synchronization and access reviews that remove denied users upon completion.</p>
<h3 id="review-target-tenant-user-access">Review Target-Tenant User Access</h3>
<p>Organizations can include B2B collaboration users in access reviews, including users provisioned by cross-tenant synchronization in target tenants. This option enables access recertification of resources in target tenants. Although organizations can target all users in access reviews, guest users can be explicitly targeted if necessary.</p>
<p>For organizations that synchronize B2B collaboration users, typically Microsoft doesn’t recommend removing denied guest users automatically from access reviews. Cross-tenant synchronization reprovisions the users if they&#39;re in the synchronization scope.</p>
<h2 id="next-steps-7">Next Steps</h2>
<ul>
<li>Multitenant organizations and Microsoft 365</li>
<li>Multitenant organization templates</li>
<li>Topologies for cross-tenant synchronization</li>
</ul>
<h2 id="govern-access-for-security-operations-center-soc-teams-in-a-multitenant-environment">Govern access for security operations center (SOC) teams in a multitenant environment</h2>
<p>Managing multitenant environments can add another layer of complexity when it comes to keeping up with the ever-evolving security threats facing your enterprise. Navigating across multiple tenants can be time consuming and reduce the overall efficiency of security operation center (SOC) teams. Multitenant management in Microsoft Defender XDR provides security operation teams with a single, unified view of all the tenants they manage. This view enables teams to quickly investigate incidents and perform advanced hunting across data from multiple tenants, improving their security operations.</p>
<p>Microsoft Entra ID Governance enables you to govern the access and lifecycle of the users who are members of the SOC teams and threat hunter teams. This document explores:</p>
<ul>
<li>The controls you can put in place for SOC teams to securely access resources across tenants.</li>
<li>Example topologies for how you can implement your lifecycle and access controls.</li>
<li>Deployment considerations (roles, monitoring, APIs).</li>
</ul>
<h3 id="manage-the-lifecycle-and-access-of-a-soc-user">Manage the lifecycle and access of a SOC user</h3>
<p>Microsoft Entra provides the controls needed to govern the lifecycle of a SOC user and to securely provide access to the resources they need. In this document, the term source tenant refers to where the SOC users originate and authenticate against. Target tenant refers to the tenant that they&#39;re investigating when there&#39;s an incident. Organizations have multiple target tenants due to mergers and acquisitions, aligning tenants with business units, and aligning tenants with geos.</p>
<h4 id="lifecycle-control">Lifecycle control</h4>
<p>Entitlement management, through access packages and connected organizations allows the target tenant administrator to define collections of resources (ex: app roles, directory roles, and groups) that users from the source tenant can request access to. If the user is approved for the resources they need, but don’t yet have a B2B account, entitlement management will automatically create a B2B account for the user in the target tenant.</p>
<h2 id="cross-tenant-synchronization-5">Cross-tenant synchronization</h2>
<p>Cross-tenant synchronization allows the source tenant to automate creating, updating, and deleting B2B users across tenants in an organization.</p>
<h2 id="comparing-entitlement-management-and-cross-tenant-synchronization">Comparing entitlement management and cross-tenant synchronization</h2>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Entitlement management</th>
<th>Cross-tenant synchronization</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create users in the target tenant</td>
<td>•</td>
<td>•</td>
</tr>
<tr>
<td>Update users in the target tenant when their attributes change in the source tenant</td>
<td>•</td>
<td>•</td>
</tr>
<tr>
<td>Delete users</td>
<td>•</td>
<td>•</td>
</tr>
<tr>
<td>Assign users to groups, directory roles, app roles</td>
<td>•</td>
<td></td>
</tr>
<tr>
<td>Attributes of the user in the target tenant</td>
<td>Minimal, supplied by user themself at request time</td>
<td>Synchronized from the source tenant</td>
</tr>
</tbody>
</table>
<h2 id="access-control">Access control</h2>
<p>You can use entitlement management and cross-tenant access policies to control access to resources across tenants. Entitlement management will assign the right users to the right resources, while cross-tenant access policies and conditional access together perform the necessary run-time checks to ensure the right users are accessing the right resources.</p>
<h3 id="entitlement-management">Entitlement management</h3>
<p>Assigning Microsoft Entra roles through entitlement management access packages helps to efficiently manage role assignments at scale and improves the role assignment lifecycle. It provides a flexible request and approval process for gaining access to directory roles, app roles, and groups while also enabling automatic assignment to resources based on user attributes.</p>
<h2 id="cross-tenant-access-policies">Cross-tenant access policies</h2>
<p>External identities cross-tenant access settings manage how you collaborate with other Microsoft Entra organizations through B2B collaboration. These settings determine both the level of inbound access users in external Microsoft Entra organizations have to your resources, and the level of outbound access your users have to external organizations.</p>
<h2 id="deployment-topologies">Deployment topologies</h2>
<p>This section describes how you can use tools such as cross-tenant synchronization, entitlement management, cross-tenant access policies, and conditional access together. In both topologies, the target tenant admin has full control over access to resources in the target tenant. They differ in who initiates provisioning and deprovisioning.</p>
<h3 id="topology-1">Topology 1</h3>
<p>In topology 1, the source tenant configures entitlement management and cross-tenant synchronization to provision users into the target tenant. Then, the administrator of the target tenant configures access packages to provide access to the necessary directory roles, group, and app roles in the target tenant.</p>
<pre><code class="lang-mermaid">flowchart LR
    A[Source tenant] --&gt;|1. SoC users&#39; governance| B((CROSS-TENANT SYNC))
    B --&gt;|2. Guest accounts provisioning| D[Target tenant]
    D --&gt;|3. Access packages assignment| E[Security Roles]
    B -.-&gt; C(IMPACT)

    A &amp; E -.-&gt; F[ORGANIZATION TRUST]
    C -.-&gt; D
    C --&gt;|Approval Node| A
    subgraph &quot; &quot;
    F
    end
</code></pre><h4 id="steps-to-configure-topology-1">Steps to configure topology 1</h4>
<p>Step 1: Source tenant admin configures entitlement management and sync settings.
Step 2: Synchronize user accounts to the target tenant.
Step 3: Target tenant admin assigns access packages to provisioned users.</p>
<h2 id="cross-tenant-synchronization-and-access-management">Cross-Tenant Synchronization and Access Management</h2>
<h3 id="step-by-step-configuration-guide">Step-by-Step Configuration Guide</h3>
<h4 id="step-1-configure-cross-tenant-synchronization"><strong>Step 1: Configure Cross-Tenant Synchronization</strong></h4>
<p>In the source tenant, configure cross-tenant synchronization to provision internal accounts in the source tenant as external accounts in the target tenant.</p>
<p>When users are assigned to the cross-tenant synchronization service principal, they are automatically provisioned into the target tenant. As they are removed from the configuration, their accounts are automatically deprovisioned. Utilize attribute mappings to add directory extension attributes to users indicating their roles, such as SOC administrators. This attribute helps in skipping additional configuration steps by providing automatic access to necessary roles in the target tenant.</p>
<h4 id="step-2-create-access-packages-in-the-source-tenant"><strong>Step 2: Create Access Packages in the Source Tenant</strong></h4>
<p>Create an access package in the source tenant that includes the cross-tenant synchronization service principal as a resource.</p>
<p>This enables the users who are granted access to the package to also be assigned to the cross-tenant synchronization service principal. Regularly review and time-limit these assignments to ensure only necessary users have continued access.</p>
<h4 id="step-3-create-access-packages-in-the-target-tenant"><strong>Step 3: Create Access Packages in the Target Tenant</strong></h4>
<p>Create access packages in the target tenant specifically tailored for roles involved in incident investigations.</p>
<ul>
<li><strong>Autoassigned Access Package:</strong> Ideal for users needing the Security Reader role.</li>
<li><strong>Request-Based Access Package:</strong> For users requiring Security Operator or Security Administrator roles.</li>
</ul>
<p>Following setup, SOC users can navigate to a specific URL (myaccess.microsoft.com) to request access. This access, once granted, ensures users are provisioned roles in the target tenant(s) necessary for their responsibilities. Users can request additional access as needed and are deprovisioned from roles they no longer require after an access review.</p>
<h3 id="topology-2">Topology 2</h3>
<p>In this topology, the target tenant&#39;s administrator defines the access packages and resources that source users can request access to. If there is a need to restrict access selectively within the source tenant&#39;s user base, a cross-tenant access policy supplemented by an access package can effectively block all access except for designated groups included in specific access packages. This setup ensures stringent access control tailored to organizational needs.</p>
<h2 id="steps-to-configure-topology-2">Steps to configure topology 2</h2>
<ol>
<li><p>In the target tenant, add the source tenant as a connected organization.</p>
<p>This setting allows the target tenant administrator to make access packages available to the source tenant.</p>
</li>
<li><p>In the target tenant, create an access package that provides the Security Reader, Security Administrator, and Security Operator roles.</p>
</li>
<li><p>Users from the source tenant can now request access packages in the target tenant.</p>
</li>
</ol>
<p>Once you have completed the setup, SOC users can navigate to myaccess.microsoft.com to request time-limited access to the necessary roles in each tenant.</p>
<h2 id="topologies-compared">Topologies compared</h2>
<p>In both topologies, the target tenant can control what resources users have access to. This can be accomplished using a mix of cross-tenant access policies, conditional access, and assignment of apps and roles to users. They differ in who configures and initiates provisioning. In topology 1, the source tenant configures provisioning and pushes users into the target tenants. In topology 2, the target tenant defines which users are eligible to access their tenant.</p>
<p>If a user needs access to several tenants at one time, topology 1 makes it easy for them to request access to an access package in one tenant and automatically get provisioned into several tenants. If the target tenant wants to ensure full control over who is</p>
<h2 id="deployment-considerations">Deployment considerations</h2>
<h3 id="monitoring">Monitoring</h3>
<p>Actions performed by a SOC analyst in Microsoft Entra are audited in the Microsoft Entra tenant that they&#39;re working in. Organizations can maintain an audit trail of actions performed, generate alerts when specific actions are performed, and analyze actions performed by pushing audit logs into Azure Monitor.</p>
<h3 id="scaling-deployment-with-powershell--apis">Scaling deployment with PowerShell / APIs</h3>
<p>Every step that is configured through the user interface in Microsoft Entra has accompanying Microsoft Graph APIs and PowerShell commandlets, enabling you to deploy your desired policies/configuration across the tenants in your organization.</p>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Microsoft Graph API</th>
<th>PowerShell</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cross-tenant synchronization</td>
<td>Link</td>
<td>Link</td>
</tr>
<tr>
<td>Entitlement management</td>
<td>Link</td>
<td>Link</td>
</tr>
<tr>
<td>Cross-tenant access policies</td>
<td>Link</td>
<td>Link</td>
</tr>
</tbody>
</table>
<h3 id="role-based-access-control">Role-based access control</h3>
<p>Configuring the capabilities described in topology 1 and topology 2 require the following roles:</p>
<ul>
<li>Configuring cross-tenant access settings - Security Administrator</li>
<li>Configuring cross-tenant synchronization - Hybrid Identity Administrator</li>
<li>Configuring entitlement management - Identity Governance Administrator</li>
<li>Microsoft Defender supports both built-in roles such as Security Reader, Security Administrator, and Security Operator and custom roles.</li>
</ul>
<h2 id="next-steps-8">Next steps</h2>
<ul>
<li>What is cross-tenant synchronization?</li>
<li>What is entitlement management?</li>
<li>Multitenant management in Defender XDR</li>
</ul>
<h2 id="known-issues-for-provisioning-in-microsoft-entra-id">Known issues for provisioning in Microsoft Entra ID</h2>
<p>This article discusses known issues to be aware of when you work with app provisioning or cross-tenant synchronization. To provide feedback about the application provisioning service on UserVoice, see <a href="https://feedback.microsoft.com/forums/12345678-microsoft-entra-application-provision">Microsoft Entra application provision UserVoice</a>. We watch UserVoice closely so that we can improve the service.</p>
<blockquote><p><strong>Note</strong></p>
<p>This article isn&#39;t a comprehensive list of known issues. If you know of an issue that isn&#39;t listed, provide feedback at the bottom of the page.</p>
</blockquote>
<h3 id="authorization">Authorization</h3>
<h4 id="unable-to-change-provisioning-mode-back-to-manual">Unable to change provisioning mode back to manual</h4>
<p>After you&#39;ve configured provisioning for the first time, you&#39;ll notice that the provisioning mode has switched from manual to automatic. You can&#39;t change it back to manual. But you can turn off provisioning through the UI. Turning off provisioning in the UI effectively does the same as setting the dropdown to manual.</p>
<h3 id="attribute-mappings">Attribute mappings</h3>
<h4 id="attribute-samaccountname-or-usertype-not-available-as-a-source-attribute">Attribute SamAccountName or userType not available as a source attribute</h4>
<p>The attributes SamAccountName and userType aren&#39;t available as a source attribute by default. Extend your schema to add the attributes. You can add the attributes to the list of available source attributes by extending your schema. To learn more, see <a href="https://help.microsoft.com/schema/missing-source-attribute">Missing source attribute</a>.</p>
<h4 id="source-attribute-dropdown-missing-for-schema-extension">Source attribute dropdown missing for schema extension</h4>
<p>Extensions to your schema can sometimes be missing from the source attribute dropdown in the UI. Go into the advanced settings of your attribute mappings and check if the dropdown is configured properly.</p>
<h2 id="null-attribute-cant-be-provisioned">Null attribute can&#39;t be provisioned</h2>
<p>Microsoft Entra ID currently can&#39;t provision null attributes. If an attribute is null on the user object, it will be skipped.</p>
<h2 id="maximum-characters-for-attribute-mapping-expressions">Maximum characters for attribute-mapping expressions</h2>
<p>Attribute-mapping expressions can have a maximum of 10,000 characters.</p>
<h2 id="unsupported-scoping-filters">Unsupported scoping filters</h2>
<p>The appRoleAssignments, userType, and accountExpires attributes aren&#39;t supported as scoping filters.</p>
<h2 id="multivalue-directory-extensions">Multivalue directory extensions</h2>
<p>Multivalue directory extensions can&#39;t be used in attribute mappings or scoping filters.</p>
<h2 id="service-issues">Service issues</h2>
<h3 id="unsupported-scenarios">Unsupported scenarios</h3>
<ul>
<li>Provisioning passwords isn&#39;t supported.</li>
<li>Provisioning nested groups isn&#39;t supported.</li>
<li>Provisioning to B2C tenants isn&#39;t supported because of the size of the tenants.</li>
<li>Not all provisioning apps are available in all clouds. For example, Atlassian isn&#39;t yet available in the Government cloud. We&#39;re working with app developers to onboard their apps to all clouds.</li>
</ul>
<h3 id="automatic-provisioning-isnt-available-on-my-oidc-based-application">Automatic provisioning isn&#39;t available on my OIDC-based application</h3>
<p>If you create an app registration, the corresponding service principal in enterprise apps won&#39;t be enabled for automatic user provisioning. You&#39;ll need to either request the app be added to the gallery, if intended for use by multiple organizations, or create a second non-gallery app for provisioning.</p>
<h2 id="manager-isnt-provisioned">Manager isn&#39;t provisioned</h2>
<p>If a user and their manager are both in scope for provisioning, the service provisions the user and then updates the manager. If on day one the user is in scope and the manager is out of scope, we&#39;ll provision the user without the manager reference. When the manager comes into scope, the manager reference won&#39;t be updated until you restart provisioning and cause the service to reevaluate all the users again.</p>
<h2 id="the-provisioning-interval-is-fixed">The provisioning interval is fixed</h2>
<p>The time between provisioning cycles is currently not configurable.</p>
<h2 id="changes-not-moving-from-target-app-to-microsoft-entra-id">Changes not moving from target app to Microsoft Entra ID</h2>
<p>The app provisioning service isn&#39;t aware of changes made in external apps. So, no action is taken to roll back. The app provisioning service relies on changes made in Microsoft Entra ID.</p>
<h2 id="switching-from-sync-all-to-sync-assigned-not-working">Switching from Sync All to Sync Assigned not working</h2>
<p>After you change scope from Sync All to Sync Assigned, make sure to also perform a restart to ensure that the change takes effect. You can do the restart from the UI.</p>
<h2 id="provisioning-cycle-continues-until-completion">Provisioning cycle continues until completion</h2>
<p>When you set provisioning to <code>enabled = off</code> or select Stop, the current provisioning cycle continues running until completion. The service stops executing any future cycles until you turn provisioning on again.</p>
<h2 id="member-of-group-not-provisioned">Member of group not provisioned</h2>
<p>When a group is in scope and a member is out of scope, the group will be provisioned. The out-of-scope user won&#39;t be provisioned. If the member comes back into scope, the service won&#39;t immediately detect the change. Restarting provisioning addresses the issue. Periodically restart the service to ensure that all users are properly provisioned.</p>
<h2 id="global-reader">Global Reader</h2>
<p>The Global Reader role is unable to read the provisioning configuration. Create a custom role with the <code>microsoft.directory/applications/synchronization/standard/read</code> permission.</p>
<h2 id="microsoft-azure-government-cloud">Microsoft Azure Government Cloud</h2>
<p>Credentials, including the secret token, notification email, and SSO certificate notification emails together have a 1KB limit in the Microsoft Azure Government Cloud.</p>
<h2 id="on-premises-application-provisioning">On-premises application provisioning</h2>
<p>The following information is a current list of known limitations with the Microsoft Entra ECMA Connector Host and on-premises application provisioning.</p>
<h3 id="application-and-directories">Application and directories</h3>
<p>The following applications and directories aren&#39;t yet supported.</p>
<h3 id="active-directory-domain-services-user-or-group-writeback-from-microsoft-entra-id-by-using-the-on-premises-provisioning-preview">Active Directory Domain Services (user or group writeback from Microsoft Entra ID by using the on-premises provisioning preview)</h3>
<ul>
<li>When a user is managed by Microsoft Entra Connect, the source of authority is on-premises Active Directory Domain Services. So, user attributes can&#39;t be changed in Microsoft Entra ID. This preview doesn&#39;t change the source of authority for users managed by Microsoft Entra Connect.</li>
<li>Attempting to use Microsoft Entra Connect and the on-premises provisioning to provision groups or users into Active Directory Domain Services can lead to creation of a loop, where Microsoft Entra Connect can overwrite a change that was made by the provisioning service in the cloud. Microsoft is working on a dedicated capability for group or user writeback. Upvote the UserVoice feedback on this website to track the status of the preview. Alternatively, you can use Microsoft Identity Manager for user or group writeback from Microsoft Entra ID to Active Directory.</li>
</ul>
<h2 id="microsoft-entra-id">Microsoft Entra ID</h2>
<p>By using on-premises provisioning, you can take a user already in Microsoft Entra ID and provision them into a third-party application. You can&#39;t bring a user into the directory from a third-party application. Customers will need to rely on our native HR integrations, Microsoft Entra Connect, Microsoft Identity Manager, or Microsoft Graph, to bring users into the directory.</p>
<h2 id="attributes-and-objects">Attributes and objects</h2>
<p>The following attributes and objects aren&#39;t supported:</p>
<ul>
<li>Multivalued attributes.</li>
<li>Reference attributes (for example, manager).</li>
<li>Groups.</li>
<li>Complex anchors (for example, ObjectTypeName+UserName).</li>
<li>Attributes that have characters such as &quot;.&quot; or &quot;|&quot;</li>
<li>Binary attributes.</li>
<li>On-premises applications are sometimes not federated with Microsoft Entra ID and require local passwords. The on-premises provisioning preview doesn&#39;t support password synchronization. Provisioning initial one-time passwords is supported. Ensure that you&#39;re using the Redact function to redact the passwords from the logs. In the SQL and LDAP connectors, the passwords aren&#39;t exported on the initial call to the application, but rather a second call with set password.</li>
</ul>
<h2 id="ssl-certificates">SSL certificates</h2>
<p>The Microsoft Entra ECMA Connector Host currently requires either an SSL certificate to be trusted by Azure or the provisioning agent to be used. The certificate subject must match the host name the Microsoft Entra ECMA Connector Host is installed on.</p>
<h2 id="anchor-attributes">Anchor attributes</h2>
<p>The Microsoft Entra ECMA Connector Host currently doesn&#39;t support anchor attribute changes (renames) or target systems, which require multiple attributes to form an anchor.</p>
<h2 id="attribute-discovery-and-mapping">Attribute discovery and mapping</h2>
<p>The attributes that the target application supports are discovered and surfaced in the Microsoft Entra admin center in Attribute Mappings. Newly added attributes will continue to be discovered. If an attribute type has changed, for example, string to Boolean, and the attribute is part of the mappings, the type won&#39;t change automatically in the Microsoft Entra admin center. Customers will need to go into advanced settings in mappings and manually update the attribute type.</p>
<h2 id="provisioning-agent">Provisioning agent</h2>
<ul>
<li>The agent doesn&#39;t currently support auto update for the on-premises application provisioning scenario. We&#39;re actively working to close this gap and ensure that auto update is enabled by default and required for all customers.</li>
<li>The same provisioning agent can&#39;t be used for on-premises app provisioning and cloud sync / HR- driven provisioning.</li>
</ul>
<h2 id="next-steps-9">Next steps</h2>
<p>How provisioning works</p>
<h2 id="configure-a-multitenant-organization-using-powershell-or-microsoft-graph-api">Configure a multitenant organization using PowerShell or Microsoft Graph API</h2>
<p>Article • 04/24/2024</p>
<p>This article describes the key steps to configure a multitenant organization using Microsoft Graph PowerShell or Microsoft Graph API. This article uses an example owner tenant named <strong>Cairo</strong> and two member tenants named <strong>Berlin</strong> and <strong>Athens</strong>.</p>
<p>If you instead want to use the Microsoft 365 admin center to configure a multitenant organization, see <a href="https://example.com/set-up-multi-tenant-org">Set up a multitenant org in Microsoft 365</a> and <a href="https://example.com/join-leave-multi-tenant-org">Join or leave a multitenant organization in Microsoft 365</a>. To learn how to configure Microsoft Teams for your multitenant organization, see <a href="https://example.com/new-teams-client">The new Microsoft Teams desktop client</a>.</p>
<h3 id="organizational-structure">Organizational Structure</h3>
<pre><code class="lang-mermaid">graph TD;
    Cairo --&gt;|Cross-tenant access settings| Athens;
    Cairo --&gt;|Cross-tenant access settings| Berlin;
</code></pre><h2 id="prerequisites">Prerequisites</h2>
<p><strong>Owner tenant</strong></p>
<ul>
<li>For license information, see <a href="https://example.com/license-requirements">License requirements</a>.</li>
<li><strong>Security Administrator</strong> role to configure cross-tenant access settings and templates for the multitenant organization.</li>
<li><strong>Global Administrator</strong> role to consent to required permissions.</li>
</ul>
<h2 id="member-tenant">Member tenant</h2>
<ul>
<li>For license information, see <a href="https://example.com/license">License requirements</a>.</li>
<li>Security Administrator role to configure cross-tenant access settings and templates for the multitenant organization.</li>
<li>Global Administrator role to consent to required permissions.</li>
</ul>
<h2 id="step-1-sign-in-to-the-owner-tenant">Step 1: Sign in to the owner tenant</h2>
<h3 id="owner-tenant">Owner tenant</h3>
<pre><code class="lang-PowerShell"># Start PowerShell.
Start PowerShell.

# If necessary, install the Microsoft Graph PowerShell SDK.
Install the Microsoft Graph PowerShell SDK.

# Get the tenant ID of the owner and member tenants and initialize variables.
$ownerTenantId = &quot;OwnerTenantId&quot;
$memberTenantIdB = &quot;MemberTenantIdB&quot;
$memberTenantIdA = &quot;MemberTenantIdA&quot;

# Use the Connect-MgGraph command to sign in to the owner tenant and consent to the following required permissions.
Connect-MgGraph -TenantId $ownerTenantId -Scopes &quot;MultiTenantOrganization.ReadWrite.All&quot;, &quot;Policy.Read.All&quot;, &quot;Policy.ReadWrite.CrossTenantAccess&quot;, &quot;Application.ReadWrite.All&quot;, &quot;Directory.ReadWrite.All&quot;
</code></pre><ul>
<li>MultiTenantOrganization.ReadWrite.All</li>
<li>Policy.Read.All</li>
<li>Policy.ReadWrite.CrossTenantAccess</li>
<li>Application.ReadWrite.All</li>
<li>Directory.ReadWrite.All</li>
</ul>
<h2 id="step-2-create-a-multitenant-organization">Step 2: Create a multitenant organization</h2>
<h3 id="owner-tenant-1">Owner tenant</h3>
<pre><code class="lang-PowerShell"># In the owner tenant, use the following command to create your multitenant organization. This operation can take a few minutes.
Update-MgBetaTenantRelationshipMultiTenantOrganization -DisplayName &quot;Cairo&quot;

# Use the following command to check that the operation has completed before proceeding.
Get-MgBetaTenantRelationshipMultiTenantOrganization | Format-List

# Output example
CreatedDateTime    : 1/8/2024 7:47:45 PM
Description        :
DisplayName        : Cairo
Id                 : &lt;MtoIdC&gt;
JoinRequest        :
Microsoft.Graph.Beta.PowerShell.Models.MicrosoftGraphMultiTenantOrg
anizationJoinRequestRecord
State              : active
Tenants            :
AdditionalProperties : {[@odata.context, https://graph.microsoft.com/beta/$metadata#tenantRelationships/mult
iTenantOrganization/$entity]}
</code></pre><h2 id="step-3-add-tenants">Step 3: Add tenants</h2>
<h3 id="owner-tenant-2">Owner tenant</h3>
<h4 id="powershell">PowerShell</h4>
<ol>
<li>In the owner tenant, use the <code>New-MgBetaTenantRelationshipMultiTenantOrganizationTenant</code> command to add tenants to your multitenant organization.</li>
</ol>
<pre><code class="lang-PowerShell">New-MgBetaTenantRelationshipMultiTenantOrganizationTenant -TenantID $MemberTenantID -DisplayName &quot;Berlin&quot; | Format-List

New-MgBetaTenantRelationshipMultiTenantOrganizationTenant -TenantID $MemberTenantID -DisplayName &quot;Athens&quot; | Format-List
</code></pre><ol>
<li>Use the <code>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant</code> command to verify that the operation has completed before proceeding.</li>
</ol>
<pre><code class="lang-PowerShell">Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant | Format-List
</code></pre><h4 id="output">Output</h4>
<pre><code>AddedByTenantId       : &lt;OwnerTenantId&gt;
AddedDateTime         : 1/8/2024 7:47:45 PM
DeletedDateTime       : 
DisplayName           : Cairo
Id                    : &lt;MtoIdC&gt;
JoinedDateTime        : 
Role                  : owner
State                 : active
TenantId              : &lt;OwnerTenantId&gt;
TransitionDetails     : Microsoft.Graph.Beta.PowerShell.Models.MicrosoftGraphMultiTenantOrganizationMemberTransitionDetails
AdditionalProperties : {[multiTenantOrgLabelType, none]}
</code></pre><h2 id="tenant-information">Tenant Information</h2>
<h3 id="berlin-tenant">Berlin Tenant</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>AddedByTenantId</td>
<td><code>&lt;OwnerTenantId&gt;</code></td>
</tr>
<tr>
<td>AddedDateTime</td>
<td>1/8/2024 8:05:25 PM</td>
</tr>
<tr>
<td>DeletedDateTime</td>
<td></td>
</tr>
<tr>
<td>DisplayName</td>
<td>Berlin</td>
</tr>
<tr>
<td>Id</td>
<td><code>&lt;MtoIdB&gt;</code></td>
</tr>
<tr>
<td>JoinedDateTime</td>
<td></td>
</tr>
<tr>
<td>Role</td>
<td>member</td>
</tr>
<tr>
<td>State</td>
<td>pending</td>
</tr>
<tr>
<td>TenantId</td>
<td><code>&lt;MemberTenantIdB&gt;</code></td>
</tr>
<tr>
<td>TransitionDetails</td>
<td></td>
</tr>
<tr>
<td>AdditionalProperties</td>
<td><code>{[multiTenantOrgLabelType, none]}</code></td>
</tr>
</tbody>
</table>
<h3 id="athens-tenant">Athens Tenant</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>AddedByTenantId</td>
<td><code>&lt;OwnerTenantId&gt;</code></td>
</tr>
<tr>
<td>AddedDateTime</td>
<td>1/8/2024 8:08:47 PM</td>
</tr>
<tr>
<td>DeletedDateTime</td>
<td></td>
</tr>
<tr>
<td>DisplayName</td>
<td>Athens</td>
</tr>
<tr>
<td>Id</td>
<td><code>&lt;MtoIdA&gt;</code></td>
</tr>
<tr>
<td>JoinedDateTime</td>
<td></td>
</tr>
<tr>
<td>Role</td>
<td>member</td>
</tr>
<tr>
<td>State</td>
<td>pending</td>
</tr>
<tr>
<td>TenantId</td>
<td><code>&lt;MemberTenantIdA&gt;</code></td>
</tr>
<tr>
<td>TransitionDetails</td>
<td></td>
</tr>
<tr>
<td>AdditionalProperties</td>
<td><code>{[multiTenantOrgLabelType, none]}</code></td>
</tr>
</tbody>
</table>
<h2 id="step-4-optional-change-the-role-of-a-tenant">Step 4: (Optional) Change the role of a tenant</h2>
<h3 id="owner-tenant-3">Owner Tenant</h3>
<p>By default, tenants added to the multitenant organization are member tenants. Optionally, you can change them to owner tenants, which allow them to add other tenants to the multitenant organization. You can also change an owner tenant to a member tenant.</p>
<pre><code class="lang-PowerShell"># In the owner tenant, use the following command to change a member tenant to an owner tenant:
Update-MgBetaTenantRelationshipMultiTenantOrganizationTenant
</code></pre><h2 id="update-command">Update Command</h2>
<pre><code class="lang-plaintext">Update-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId $MemberTenantIdB -Role &quot;Owner&quot; | Format-List
</code></pre><h2 id="verification-command">Verification Command</h2>
<pre><code class="lang-plaintext">Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId $MemberTenantIdB | Format-List
</code></pre><h3 id="output-1">Output</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>AddedByTenantId</td>
<td>&lt;OwnerTenantId></td>
</tr>
<tr>
<td>AddedDateTime</td>
<td>1/8/2024 8:05:25 PM</td>
</tr>
<tr>
<td>DeletedDateTime</td>
<td></td>
</tr>
<tr>
<td>DisplayName</td>
<td>Berlin</td>
</tr>
<tr>
<td>Id</td>
<td>&lt;MtoIdB></td>
</tr>
<tr>
<td>JoinedDateTime</td>
<td></td>
</tr>
<tr>
<td>Role</td>
<td>owner</td>
</tr>
<tr>
<td>State</td>
<td>pending</td>
</tr>
<tr>
<td>TenantId</td>
<td>&lt;MemberTenantIdB></td>
</tr>
<tr>
<td>TransitionDetails</td>
<td>See TransitionDetails below</td>
</tr>
</tbody>
</table>
<h3 id="transitiondetails">TransitionDetails</h3>
<p>Microsoft.Graph.Beta.PowerShell.Models.MicrosoftGraphMultiTenantOrganizationMemberTransitionDetails
<strong>AdditionalProperties:</strong>  </p>
<ul>
<li><a href="https://graph.microsoft.com/beta/$metadata#tenantRelationships/multiTenantOrganization/tenants/$entity">odata.context</a><ul>
<li>multiTenantOrgLabelType, none</li>
</ul>
</li>
</ul>
<h2 id="step-5-optional-remove-a-member-tenant">Step 5: (Optional) Remove a member tenant</h2>
<h3 id="owner-tenant-instructions">Owner Tenant Instructions</h3>
<p>You can remove any member tenant, including your own. You can&#39;t remove owner tenants. Also, you can&#39;t remove the original creator tenant, even if it has been changed from owner to member.</p>
<pre><code class="lang-plaintext">&lt;Insert Remove Command Here&gt;
</code></pre><h2 id="step-1-remove-a-member-tenant">Step 1: Remove a Member Tenant</h2>
<p>In the owner tenant, use the <strong>Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant</strong> command to remove a member tenant. This operation takes a few minutes.</p>
<pre><code>Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId &lt;MemberTenantId&gt;
</code></pre><h2 id="step-2-verify-the-change">Step 2: Verify the Change</h2>
<p>Use the <strong>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant</strong> command to verify the change.</p>
<pre><code>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId &lt;MemberTenantId&gt;
</code></pre><p>After the remove command completes, the output is similar to the following. This is an expected error message. It indicates that the tenant has been removed from the multitenant organization.</p>
<p><strong>Output:</strong></p>
<pre><code>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant_Get:
Unable to read the company information from the directory.

Status: 404 (NotFound)
ErrorCode: Directory_ObjectNotFound
Date: 2024-01-08T20:35:11
</code></pre><h2 id="step-6-sign-in-to-a-member-tenant">Step 6: Sign in to a Member Tenant</h2>
<h3 id="member-tenant-1">Member Tenant</h3>
<p>The Cairo tenant created a multitenant organization and added the Berlin and Athens tenants. In these steps, you sign in to the Berlin tenant and join the multitenant organization created by Cairo.</p>
<h2 id="powershell-instructions">PowerShell Instructions</h2>
<h3 id="start-powershell">Start PowerShell</h3>
<ol>
<li><p>Start PowerShell.</p>
</li>
<li><p>Use the Connect-MgGraph command to sign in to the member tenant and consent to the following required permissions.</p>
<ul>
<li>MultiTenantOrganization.ReadWrite.All</li>
<li>Policy.Read.All</li>
<li>Policy.ReadWrite.CrossTenantAccess</li>
<li>Application.ReadWrite.All</li>
<li>Directory.ReadWrite.All</li>
</ul>
</li>
</ol>
<pre><code class="lang-powershell">Connect-MgGraph -TenantId $MemberTenantId -Scopes &quot;MultiTenantOrganization.ReadWrite.All&quot;, &quot;Policy.Read.All&quot;, &quot;Policy.ReadWrite.CrossTenantAccess&quot;, &quot;Application.ReadWrite.All&quot;, &quot;Directory.ReadWrite.All&quot;
</code></pre><h3 id="step-7-join-the-multitenant-organization">Step 7: Join the multitenant organization</h3>
<h4 id="member-tenant-2">Member tenant</h4>
<ol>
<li>In the member tenant, use the Update-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest command to join the multitenant organization.</li>
</ol>
<pre><code class="lang-powershell">Update-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest -AddedByTenantId $OwnerTenantId | Format-List
</code></pre><ol>
<li>Use the Get-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest command to verify the join.</li>
</ol>
<pre><code class="lang-powershell">Get-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest
</code></pre><h2 id="powershell-commands-and-outputs">PowerShell Commands and Outputs</h2>
<h3 id="1-command-to-get-multi-tenant-organization-join-request">1. Command to get multi-tenant organization join request</h3>
<pre><code>Get-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest | Format-List
</code></pre><h4 id="output-2">Output</h4>
<pre><code>AddedByTenantId      : &lt;OwnerTenantId&gt;
Id                   : &lt;MtoJoinRequestIdB&gt;
MemberState          : active
Role                 : member
TransitionDetails    : Microsoft.Graph.Beta.PowerShell.Models.MicrosoftGraphMultiTenantOrg
                        anizationJoinRequestTransitionDetails
AdditionalProperties : {[@odata.context,
                        https://graph.microsoft.com/beta/$metadata#tenantRelationships/mult
                        iTenantOrganization/joinRequest/$entity]}
</code></pre><h3 id="2-command-to-get-multitenant-organization-tenant-details">2. Command to get multitenant organization tenant details</h3>
<pre><code>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant | Format-List
</code></pre><h4 id="output-1-1">Output 1</h4>
<pre><code>AddedByTenantId      : &lt;OwnerTenantId&gt;
AddedDateTime        : 1/8/2024 8:05:25 PM
DeletedDateTime      :
DisplayName          : Berlin
Id                   : &lt;MtoJoinRequestIdB&gt;
JoinedDateTime       : 1/8/2024 9:53:55 PM
Role                 : member
State                : active
TenantId             : &lt;MemberTenantIdB&gt;
TransitionDetails    : Microsoft.Graph.Beta.PowerShell.Models.MicrosoftGraphMultiTenantOrg
                        anizationMemberTransitionDetails
AdditionalProperties : {[@multiTenantOrgLabelType, none]}
</code></pre><h4 id="output-2-1">Output 2</h4>
<pre><code>AddedByTenantId      : &lt;OwnerTenantId&gt;
AddedDateTime        : 1/8/2024 7:47:45 PM
DeletedDateTime      :
DisplayName          : Cairo
Id                   : &lt;Id&gt;
JoinedDateTime       :
</code></pre><h2 id="step-8-optional-leave-the-multitenant-organization">Step 8: (Optional) Leave the multitenant organization</h2>
<h3 id="member-tenant-3">Member tenant</h3>
<p>You can leave a multitenant organization that you have joined. The process for removing your own tenant from the multitenant organization is the same as the process for removing another tenant from the multitenant organization.</p>
<p>If your tenant is the only multitenant organization owner, you must designate a new tenant to be the multitenant organization owner. For steps, see Step 4: (Optional) Change the role of a tenant.</p>
<pre><code class="lang-powershell">Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId &lt;MemberTenantId&gt;
</code></pre><h2 id="step-9-optional-delete-the-multitenant-organization">Step 9: (Optional) Delete the multitenant organization</h2>
<table>
<thead>
<tr>
<th>Role</th>
<th>State</th>
<th>TenantId</th>
<th>TransitionDetails</th>
<th>AdditionalProperties</th>
</tr>
</thead>
<tbody>
<tr>
<td>owner</td>
<td>active</td>
<td><ownertenantid></ownertenantid></td>
<td>Microsoft.Graph.Beta.PowerShell.Models.MicrosoftGraphMultiTenantOrg anizationMemberTransitionDetails</td>
<td>[{multiTenantOrgLabelType, none}]</td>
</tr>
</tbody>
</table>
<p>To allow for asynchronous processing, wait up to 2 hours before joining a multitenant organization is completed.</p>
<h2 id="owner-tenant-4">Owner tenant</h2>
<p>You delete a multitenant organization by removing all tenants. The process for removing the final owner tenant is the same as the process for removing all other member tenants.</p>
<pre><code class="lang-PowerShell">In the final owner tenant, use the Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant command to remove the tenant. This operation takes a few minutes.

Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId $OwnerTenantId
</code></pre><h2 id="next-steps-10">Next steps</h2>
<ul>
<li>Set up a multitenant org in Microsoft 365</li>
<li>Synchronize users in multitenant organizations in Microsoft 365</li>
<li>The new Microsoft Teams desktop client</li>
<li>Configure multitenant organization templates using the Microsoft Graph API</li>
</ul>
<h2 id="configure-multitenant-organization-policy-templates-using-the-microsoft-graph-api">Configure multitenant organization policy templates using the Microsoft Graph API</h2>
<p><strong>Article Date:</strong> 04/24/2024</p>
<p>This article describes how to configure a policy template for your multitenant organization.</p>
<h3 id="prerequisites-1">Prerequisites</h3>
<ul>
<li>For license information, see License requirements.</li>
<li>Security Administrator role to configure cross-tenant access settings and templates for the multitenant organization.</li>
<li>Global Administrator role to consent to required permissions.</li>
</ul>
<h3 id="cross-tenant-access-policy-partner-template">Cross-tenant access policy partner template</h3>
<p>The cross-tenant access partner configuration handles trust settings and automatic user consent settings between partner tenants. For example, you can use these settings to trust multifactor authentication claims for inbound users from the target partner tenant. With the template in an unconfigured state, partner configurations for partner tenants in the multitenant organization won&#39;t be amended, with all trust settings passed through from default settings. However, if you configure the template, then partner configurations will be amended corresponding to the policy template.</p>
<h3 id="configure-inbound-and-outbound-automatic-redemption">Configure inbound and outbound automatic redemption</h3>
<p>To specify which trust settings and automatic user consent settings to apply to your policy template, use the Update multiTenantOrganizationPartnerConfigurationTemplate API. If you create or join a multitenant organization using the Microsoft 365 admin center, this configuration is handled automatically.</p>
<p><strong>Request</strong></p>
<pre><code class="lang-plaintext">PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration
</code></pre><h2 id="disable-the-template-for-existing-partners">Disable the template for existing partners</h2>
<p>To apply this template only to new multitenant organization members and exclude existing partners, set the <code>templateApplicationLevel</code> parameter to new partners only.</p>
<h3 id="request">Request</h3>
<pre><code class="lang-HTTP">PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration

{
  &quot;inboundTrust&quot;: {
    &quot;isMfaAccepted&quot;: true,
    &quot;isCompliantDeviceAccepted&quot;: true,
    &quot;isHybridAzureADJoinedDeviceAccepted&quot;: true
  },
  &quot;automaticUserConsentSettings&quot;: {
    &quot;inboundAllowed&quot;: true,
    &quot;outboundAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: &quot;newPartners&quot;
}
</code></pre><h2 id="disable-the-template-completely">Disable the template completely</h2>
<p>To disable the template completely, set the <code>templateApplicationLevel</code> parameter to null.</p>
<h3 id="request-1">Request</h3>
<pre><code class="lang-HTTP">PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration

{
  &quot;templateApplicationLevel&quot;: null
}
</code></pre><h2 id="patch-configuration">Patch Configuration</h2>
<pre><code>PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration

{
  &quot;inboundTrust&quot;: {
    &quot;isMfaAccepted&quot;: true,
    &quot;isCompliantDeviceAccepted&quot;: true,
    &quot;isHybridAzureADJoinedDeviceAccepted&quot;: true
  },
  &quot;automaticUserConsentSettings&quot;: {
    &quot;inboundAllowed&quot;: true,
    &quot;outboundAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: &quot;&quot;
}
</code></pre><h2 id="reset-the-template">Reset the template</h2>
<p>To reset the template to its default state (decline all trust and automatic user consent), use the following API.</p>
<pre><code>POST https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration/resetToDefaultSettings
</code></pre><h2 id="cross-tenant-synchronization-template">Cross-tenant synchronization template</h2>
<p>The identity synchronization policy governs cross-tenant synchronization, which allows you to share users and groups across tenants in your organization. You can use these settings to allow inbound user synchronization. With the template in an unconfigured state, the identity synchronization policy for partner tenants in the multitenant organization won&#39;t be amended. However, if you configure the template, then the identity synchronization policy will be amended corresponding to the policy template.</p>
<h2 id="configure-inbound-user-synchronization">Configure inbound user synchronization</h2>
<p>To allow inbound user synchronization in the policy template, use the Update multiTenantOrganizationIdentitySyncPolicyTemplate API. If you create or join a multi-tenant organization without specifically configuring this policy template, default synchronization settings will apply.</p>
<h2 id="request-2">Request</h2>
<pre><code class="lang-HTTP">PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization
{
  &quot;userSyncInbound&quot;: {
    &quot;isSyncAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: &quot;newPartners,existingPartners&quot;
}
</code></pre><h2 id="disable-the-template-for-existing-partners-1">Disable the template for existing partners</h2>
<p>To apply this template only to new multitenant organization members and exclude existing partners, set the <code>templateApplicationLevel</code> parameter to new partners only.</p>
<h3 id="request-3">Request</h3>
<pre><code class="lang-HTTP">PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization
{
  &quot;userSyncInbound&quot;: {
    &quot;isSyncAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: &quot;newPartners&quot;
}
</code></pre><h2 id="disable-the-template-completely-1">Disable the template completely</h2>
<p>To disable the template completely, set the <code>templateApplicationLevel</code> parameter to null.</p>
<h3 id="request-4">Request</h3>
<pre><code class="lang-HTTP">PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization
{
  &quot;userSyncInbound&quot;: {
    &quot;isSyncAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: null
}
</code></pre><h2 id="patch-request-for-template-update">PATCH Request for Template Update</h2>
<pre><code>PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization
{
  &quot;userSyncInbound&quot;: {
    &quot;isSyncAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: &quot;&quot;
}
</code></pre><h2 id="reset-the-template-1">Reset the template</h2>
<p>To reset the template to its default state (decline inbound synchronization), use the <code>multiTenantOrganizationIdentitySyncPolicyTemplate: resetToDefaultSettings</code> API.</p>
<h3 id="request-5">Request</h3>
<pre><code>POST https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization/resetToDefaultSettings
</code></pre><h2 id="next-steps-11">Next steps</h2>
<ul>
<li>Configure cross-tenant synchronization</li>
</ul>
<h2 id="configure-cross-tenant-synchronization-1">Configure cross-tenant synchronization</h2>
<p>Article • 03/11/2024</p>
<p>This article describes the steps to configure cross-tenant synchronization using the Microsoft Entra admin center. When configured, Microsoft Entra ID automatically provisions and de-provisions B2B users in your target tenant. For important details on what this service does, how it works, and frequently asked questions, see Automate user provisioning and deprovisioning to SaaS applications with Microsoft Entra ID.</p>
<pre><code class="lang-mermaid">flowchart LR
    Source([Source tenant]) --&gt;|Cross-tenant synchronization| Target([Target tenant])
    Source --&gt;|Outbound access settings| Conf([Configuration])
    Conf --&gt;|Scoping filters&lt;br/&gt;Attribute mappings| Scope([Scope])

    subgraph Source
      US1([UserS1])
      US2([UserS2])
      US3([UserS3])
    end

    subgraph Target
      UT1([UserT1])
      UT2([UserT2])
      UT3([UserT3])
      GT1([GroupT1])
    end

    subgraph Conf
      SF([Scoping filters&lt;br/&gt;UserS1, UserS3&lt;br/&gt;department EQUALS Marketing])
      AM([Attribute mappings&lt;br/&gt;accountEnabled&lt;br/&gt;employeed&lt;br/&gt;userPrincipalName&lt;br/&gt;extensionName])
    end

    subgraph Scope 
      OS([UserS1, UserS3])
    end
</code></pre><h3 id="learning-objectives">Learning objectives</h3>
<p>By the end of this article, you&#39;ll be able to:</p>
<ul>
<li>Create B2B users in your target tenant</li>
<li>Remove B2B users in your target tenant</li>
<li>Keep user attributes synchronized between your source and target tenants</li>
</ul>
<h3 id="prerequisites-2">Prerequisites</h3>
<p>Source tenant</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Microsoft Entra ID P1 or P2 License. For more information, see License requirements.</li>
<li>Security Administrator role to configure cross-tenant access settings.</li>
<li>Hybrid Identity Administrator role to configure cross-tenant synchronization.</li>
<li>Cloud Application Administrator or Application Administrator role to assign users to a configuration and to delete a configuration.</li>
</ul>
<h2 id="target-tenant">Target tenant</h2>
<ul>
<li>Microsoft Entra ID P1 or P2 License. For more information, see License requirements.</li>
<li>Security Administrator role to configure cross-tenant access settings.</li>
</ul>
<h2 id="step-1-plan-your-provisioning-deployment">Step 1: Plan your provisioning deployment</h2>
<ol>
<li>Define how you would like to structure the tenants in your organization.</li>
<li>Learn about how the provisioning service works.</li>
<li>Determine who will be in scope for provisioning.</li>
<li>Determine what data to map between tenants.</li>
</ol>
<h2 id="step-2-enable-user-synchronization-in-the-target-tenant">Step 2: Enable user synchronization in the target tenant</h2>
<blockquote><p>Tip: Steps in this article might vary slightly based on the portal you start from.</p>
</blockquote>
<h3 id="target-tenant-1">Target tenant</h3>
<ol>
<li>Sign in to the Microsoft Entra admin center of the target tenant.</li>
<li>Browse to Identity &gt; External Identities &gt; Cross-tenant access settings.</li>
<li>On the Organization settings tab, select Add organization.</li>
<li>Add the source tenant by typing the tenant ID or domain name and selecting Add.</li>
</ol>
<h2 id="external-identities--cross-tenant-access-settings">External Identities | Cross-tenant access settings</h2>
<h3 id="overview-5">Overview</h3>
<ul>
<li><strong>Cross-tenant access settings</strong></li>
<li>Organizational settings</li>
<li>Default settings</li>
<li>Microsoft cloud settings<ul>
<li>Add organization</li>
<li>Refresh</li>
<li>Columns</li>
</ul>
</li>
</ul>
<h4 id="inbound-access-settings">Inbound access settings</h4>
<ul>
<li><strong>External collaboration settings</strong></li>
<li>Diagnose and solve problems</li>
<li>Self-service sign up</li>
<li>Custom user attributes</li>
<li>AI API connectors</li>
<li>User flows</li>
<li>Linked subscriptions</li>
</ul>
<p><strong>Search by domain name or tenant ID</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Inbound Access</th>
</tr>
</thead>
<tbody>
<tr>
<td><no organizations="" found=""></no></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="steps-to-manage-access">Steps to Manage Access</h3>
<ol>
<li><p><strong>Inbound Access</strong></p>
<ul>
<li>Under Inbound access of the added organization, select <code>Inherited from default</code>.</li>
</ul>
</li>
<li><p><strong>Cross-tenant Sync Tab</strong></p>
<ul>
<li>Select the Cross-tenant sync tab.</li>
</ul>
</li>
<li><p><strong>User Sync Settings</strong></p>
<ul>
<li>Check the <code>Allow users sync into this tenant</code> checkbox.</li>
</ul>
<p><img src="image-link-here" alt="Inbound access settings - Fabrikam">  </p>
<ul>
<li><em>Note: Enabling will allow the admin of the specified (source) tenant to sync objects into this (target) tenant. Disabling will block admins of the source tenant from syncing objects into the target tenant but will not remove currently synced objects. This setting should only be used between tenants that are part of the same organization.</em></li>
</ul>
</li>
<li><p><strong>Save Settings</strong></p>
<ul>
<li>Select Save.</li>
</ul>
</li>
<li><p><strong>Enable Cross-tenant Sync and Auto-redemption</strong></p>
<ul>
<li>If you see an Enable cross-tenant sync and auto-redemption dialog box asking if you want to enable auto-redemption, select <code>Yes</code>.<ul>
<li>Selecting Yes will automatically redeem invitations in the target tenant.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="inbound-access-settings---fabrikam">Inbound Access Settings - Fabrikam</h2>
<h3 id="enable-cross-tenant-sync-and-auto-redemption">Enable Cross-Tenant Sync and Auto-Redemption</h3>
<p>To enable this setting:</p>
<ul>
<li><strong>Target Tenant</strong>: Automatically redeem invitations so users from the source tenant don&#39;t have to accept the consent prompt.</li>
</ul>
<h4 id="step-by-step-instructions">Step-by-Step Instructions:</h4>
<ol>
<li>On the <strong>Inbound access settings</strong> page, navigate to the <strong>Trust settings</strong> tab.</li>
<li><p>Enable the <strong>Automatically redeem invitations with the tenant <tenant></tenant></strong> checkbox. (Note that if you previously enabled cross-tenant sync and auto-redemption, this might already be selected.)</p>
<pre><code>|  | Setting |
|---|---------|
| ![checkbox](checked) | Automatically redeem invitations with the tenant Fabrikam |
</code></pre></li>
<li><p>Confirm by clicking <strong>Save</strong>.</p>
</li>
</ol>
<h3 id="important-notes">Important Notes</h3>
<ul>
<li>This setting must be enabled in both the source (outbound) and target (inbound) tenants.</li>
<li>For more details on how to configure these settings effectively, refer to the <a href="#">Automatic redemption setting</a> documentation.</li>
</ul>
<h2 id="step-4-automatically-redeem-invitations-in-the-source-tenant">Step 4: Automatically redeem invitations in the source tenant</h2>
<h3 id="source-tenant">Source tenant</h3>
<p>In this step, you automatically redeem invitations in the source tenant.</p>
<ol>
<li>Sign in to the Microsoft Entra admin center of the source tenant.</li>
<li>Browse to Identity &gt; External Identities &gt; Cross-tenant access settings.</li>
<li>On the Organization settings tab, select Add organization.</li>
<li>Add the target tenant by typing the tenant ID or domain name and selecting Add.</li>
</ol>
<h3 id="screenshot-description">Screenshot Description</h3>
<p>The image illustrates the user interface of the Microsoft Entra admin center where you can manage External Identities and Cross-tenant access settings. Specifically, it shows the Add organization window where a user can type the tenant ID or domain name to add an external Microsoft Entra tenant.</p>
<ol>
<li>Under Outbound access for the target organization, select Inherited from default.</li>
<li>Select the Trust settings tab.</li>
<li>Check the Automatically redeem invitations with the tenant <tenant> checkbox.</tenant></li>
</ol>
<h2 id="outbound-access-settings---contoso">Outbound access settings - Contoso</h2>
<h3 id="b2b-collaboration-2">B2B collaboration</h3>
<h3 id="b2b-direct-connect-2">B2B direct connect</h3>
<h3 id="trust-settings">Trust settings</h3>
<ul>
<li><strong>Automatic redemption</strong><ul>
<li>Check this setting if you want to automatically redeem invitations. If so, users from this tenant don&#39;t have to accept the consent prompt the first time they access the specified tenant using cross-tenant synchronization, B2B collaboration, or B2B direct connect. This setting will only suppress the consent prompt if the specified tenant checks this setting for inbound access as well.</li>
<li>Automatically redeem invitations with the tenant Contoso.</li>
</ul>
</li>
</ul>
<ol>
<li>Select <strong>Save</strong>.</li>
</ol>
<h2 id="step-5-create-a-configuration-in-the-source-tenant">Step 5: Create a configuration in the source tenant</h2>
<h3 id="source-tenant-1">Source tenant</h3>
<ol>
<li>In the source tenant, browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</li>
<li>Select <strong>Configurations</strong>.</li>
<li>At the top of the page, select <strong>New configuration</strong>.</li>
<li><p>Provide a name for the configuration and select <strong>Create</strong>.</p>
<p>It can take up to 15 seconds for the configuration that you just created to appear in the list.</p>
</li>
</ol>
<h2 id="step-6-test-the-connection-to-the-target-tenant">Step 6: Test the connection to the target tenant</h2>
<h3 id="source-tenant-2">Source tenant</h3>
<ol>
<li>In the source tenant, you should see your new configuration. If not, in the configuration list, select your configuration.</li>
</ol>
<h2 id="fabrikam-to-contoso--overview">Fabrikam to Contoso | Overview</h2>
<h3 id="overview-6">Overview</h3>
<ul>
<li>Provision on demand</li>
</ul>
<h3 id="manage">Manage</h3>
<ul>
<li>Users and groups</li>
<li>Provisioning</li>
<li>Expression builder</li>
</ul>
<h3 id="activity">Activity</h3>
<ul>
<li>Audit logs</li>
<li>Provisioning logs</li>
<li>Insights</li>
</ul>
<h3 id="troubleshooting--support">Troubleshooting &amp; Support</h3>
<ul>
<li>New support request</li>
</ul>
<p><strong>Automate identity lifecycle management with Microsoft Entra</strong><br>Automatically create, update, and delete accounts when users join, leave, and move within your organization.</p>
<h3 id="instructions">Instructions</h3>
<ol>
<li>Select <strong>Get started</strong>.</li>
<li>Set the Provisioning Mode to Automatic.</li>
<li>Under the <strong>Admin Credentials</strong> section, change the Authentication Method to <strong>Cross Tenant Synchronization Policy</strong>.</li>
</ol>
<h4 id="provisioning-configuration">Provisioning Configuration</h4>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td>Provisioning Mode</td>
<td>Automatic</td>
</tr>
<tr>
<td>Authentication Method</td>
<td>Cross Tenant Synchronization Policy</td>
</tr>
</tbody>
</table>
<h3 id="admin-credentials">Admin Credentials</h3>
<ul>
<li>Microsoft Entra needs the following information to connect to Fabrikam to Contoso&#39;s API and synchronize user data:<ul>
<li><strong>Tenant Id</strong></li>
</ul>
</li>
</ul>
<h2 id="step-6-test-connection">Step 6: Test Connection</h2>
<ol>
<li>In the <strong>Tenant Id</strong> box, enter the tenant ID of the target tenant.</li>
<li>Select <strong>Test Connection</strong> to test the connection.</li>
</ol>
<p>You should see a message that the supplied credentials are authorized to enable provisioning. If the test connection fails, see <a href="#">Troubleshooting tips</a> later in this article.</p>
<h3 id="notifications">Notifications</h3>
<pre><code>Testing connection to Fabrikam to Contoso
The supplied credentials are authorized to enable provisioning
</code></pre><ol>
<li>Select <strong>Save</strong>.</li>
</ol>
<p>Mappings and Settings sections appear.</p>
<ol>
<li>Close the Provisioning page.</li>
</ol>
<h2 id="step-7-define-who-is-in-scope-for-provisioning">Step 7: Define who is in scope for provisioning</h2>
<h3 id="source-tenant-3">Source tenant</h3>
<p>The Microsoft Entra provisioning service allows you to define who will be provisioned in one or both of the following ways:</p>
<ul>
<li>Based on assignment to the configuration</li>
<li>Based on attributes of the user</li>
</ul>
<p>Start small. Test with a small set of users before rolling out to everyone. When the scope for provisioning is set to assigned users and groups, you can control it by assigning one or two users to the configuration. You can further refine who is in scope for provisioning by creating attribute-based scoping filters, described in the next step.</p>
<ol>
<li>In the source tenant, select <strong>Provisioning</strong> and expand the <strong>Settings</strong> section.</li>
</ol>
<h2 id="fabricam-to-contoso--provisioning">Fabricam to Contoso | Provisioning</h2>
<h3 id="overview-7">Overview</h3>
<p>This screen provides a series of options and settings for provisioning users and groups from Fabricam to Contoso. Here is a description of the key parts visible in the screenshot:</p>
<ul>
<li><strong>Admin Credentials</strong></li>
<li><strong>Mappings</strong></li>
<li><strong>Settings</strong> includes options such as:<ul>
<li>Send an email notification when a failure occurs</li>
<li>Prevent accidental deletion (<code>Accidental deletion threshold</code> set to <code>500</code>)</li>
<li>Scope with options to <code>Sync only assigned users and groups</code></li>
</ul>
</li>
<li><strong>Provisioning Status</strong> with toggles for <code>On</code> and <code>Off</code></li>
</ul>
<h3 id="configuration-steps">Configuration Steps</h3>
<ol>
<li><p><strong>Scope Selection:</strong> </p>
<ul>
<li>Decide whether to synchronize all users in the source tenant or only those assigned to the configuration. </li>
<li>It is advisable to select <strong>Sync only assigned users and groups</strong> for efficiency and better performance.</li>
</ul>
</li>
<li><p><strong>Saving Changes:</strong></p>
<ul>
<li>Click <code>Save</code> after making any modifications to ensure they are applied.</li>
</ul>
</li>
<li><p><strong>Specifying Users and Groups:</strong></p>
<ul>
<li>Navigate to <code>Users and groups</code> on the configuration page.</li>
<li>To enable cross-tenant synchronization, at least one internal user must be included in the configuration.</li>
</ul>
</li>
<li><p><strong>Adding Users/Groups:</strong></p>
<ul>
<li>Choose <code>Add user/group</code>.</li>
<li>Use the <code>Users and groups</code> selection dialog to include specific users or groups in the configuration. Ensure to select from internal users or groups as required.</li>
<li>Note: Only direct members of a selected group are in scope for provisioning. The scope does not extend to nested groups.</li>
</ul>
</li>
<li><p><strong>Finalizing Selection:</strong></p>
<ul>
<li>Complete the process by selecting <code>Select</code>.</li>
</ul>
</li>
</ol>
<h2 id="select-assign">Select Assign</h2>
<h3 id="screenshot-description-1">Screenshot Description:</h3>
<p>The screenshot displays the interface for assigning users and groups to an application. Under &quot;Fabrikam to Contoso | Users and groups&quot;, various options like Overview, Provisioning, and Users and groups are visible. A user interface element allows the addition of a user/group, editing assignment, and removal. The application visibility setting can be toggled to be not visible in &quot;My Apps&quot;. Below, a sub-panel lists users and groups with columns for Display Name, Object Type, and Role assigned, along with checkboxes to select the entities.</p>
<h3 id="step-8-optional-define-who-is-in-scope-for-provisioning-with-scoping-filters">Step 8: (Optional) Define who is in scope for provisioning with scoping filters</h3>
<h4 id="source-tenant-4">Source tenant</h4>
<p>Regardless of the value you selected for <strong>Scope</strong> in the previous step, you can further limit which users are synchronized by creating attribute-based scoping filters.</p>
<ol>
<li>In the source tenant, select <strong>Provisioning</strong> and expand the <strong>Mappings</strong> section.</li>
</ol>
<h2 id="fabricam-to-contoso--provisioning-1">Fabricam to Contoso | Provisioning</h2>
<h3 id="step-by-step-guide">Step-by-Step Guide</h3>
<h4 id="1-overview">1. Overview</h4>
<p>In the <strong>Fabricam - Microsoft Entra ID</strong> configuration, set up the provisioning to Contoso by following the instructions below.</p>
<h4 id="2-admin-credentials">2. Admin Credentials</h4>
<p>Ensure the appropriate admin credentials are set to manage the mappings between Fabricam and Contoso.</p>
<h4 id="3-attribute-mapping">3. Attribute Mapping</h4>
<p>Navigate to the <strong>Provision Microsoft Entra ID Users</strong> setting under the <strong>Mappings</strong> section to adjust how data should flow between Microsoft Entra ID and Azure Active Directory.</p>
<ul>
<li><strong>Enabled</strong>: Yes</li>
<li><strong>Restore default mappings</strong>: Unchecked</li>
</ul>
<h4 id="4-provisioning-settings">4. Provisioning Settings</h4>
<p>Make sure the provisioning status is set to <strong>On</strong> for continuous synchronization.</p>
<h4 id="5-source-object-scope">5. Source Object Scope</h4>
<p>Select <strong>All records</strong> under the <strong>Source Object Scope</strong> to ensure all user records are included in the synchronization process.</p>
<h4 id="6-target-object-actions">6. Target Object Actions</h4>
<p>Specify actions for target objects:</p>
<ul>
<li><strong>Create</strong></li>
<li><strong>Update</strong></li>
<li><strong>Delete</strong></li>
</ul>
<p>Choose these options based on the desired outcome for records that do not match between source and target systems.</p>
<h4 id="7-adding-scoping-filters">7. Adding Scoping Filters</h4>
<p>On the <strong>Source Object Scope</strong> page, select <strong>Add scoping filter</strong> to apply filters that define which users are included in the provisioning process.</p>
<h2 id="configure-scoping-filters">Configure Scoping Filters</h2>
<p>To configure scoping filters, refer to the instructions provided in Scoping users or groups to be provisioned with scoping filters.</p>
<h3 id="add-scoping-filter">Add Scoping Filter</h3>
<table>
<thead>
<tr>
<th>Target Attribute</th>
<th>Operator</th>
<th>Value</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>department</td>
<td>EQUALS</td>
<td>Marketing</td>
<td>Add New Scoping Clause</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> If multiple scoping clauses are present, they are evaluated using &quot;AND&quot; logic.</p>
<ul>
<li>Select <strong>Ok</strong> and <strong>Save</strong> to save any changes.</li>
</ul>
<p>If you added a filter, you&#39;ll see a message that saving your changes will result in all assigned users and groups being resynchronized. This may take a long time depending on the size of your directory.</p>
<ul>
<li>Select <strong>Yes</strong> and close the Attribute Mapping page.</li>
</ul>
<h2 id="review-attribute-mappings">Review Attribute Mappings</h2>
<h3 id="source-tenant-5">Source Tenant</h3>
<p>Attribute mappings allow you to define how data should flow between the source tenant and target tenant. For information on how to customize the default attribute mappings, see <a href="#">Tutorial - Customize user provisioning attribute-mappings for SaaS applications in Microsoft Entra ID</a>.</p>
<ol>
<li>In the source tenant, select <strong>Provisioning</strong> and expand the <strong>Mappings</strong> section.</li>
<li>Select <strong>Provision Microsoft Entra ID Users</strong>.</li>
<li>On the <strong>Attribute Mapping</strong> page, scroll down to review the user attributes that are synchronized between tenants in the <strong>Attribute Mappings</strong> section.</li>
</ol>
<h2 id="attribute-mapping">Attribute Mapping</h2>
<p>The first attribute, <code>alternativeSecurityIdentifier</code>, is an internal attribute used to uniquely identify the user across tenants, match users in the source tenant with existing users in the target tenant, and ensure that each user only has one account. The matching attribute cannot be changed. Attempting to change the matching attribute or adding additional matching attributes will result in a <code>schemaInvalid</code> error.</p>
<table>
<thead>
<tr>
<th>Azure Active Directory Attribute</th>
<th>Azure Active Directory (target tenant) Attribute</th>
<th>Matching precedence</th>
</tr>
</thead>
<tbody>
<tr>
<td>AltSecIdFromNetId(netId)</td>
<td>alternativeSecurityIds</td>
<td>1</td>
</tr>
<tr>
<td>isSoftDeleted</td>
<td>isSoftDeleted</td>
<td></td>
</tr>
<tr>
<td>accountEnabled</td>
<td>accountEnabled</td>
<td></td>
</tr>
<tr>
<td>streetAddress</td>
<td>streetAddress</td>
<td></td>
</tr>
<tr>
<td>city</td>
<td>city</td>
<td></td>
</tr>
<tr>
<td>state</td>
<td>state</td>
<td></td>
</tr>
<tr>
<td>postalCode</td>
<td>postalCode</td>
<td></td>
</tr>
<tr>
<td>country</td>
<td>country</td>
<td></td>
</tr>
<tr>
<td>department</td>
<td>department</td>
<td></td>
</tr>
<tr>
<td>employeeId</td>
<td>employeeId</td>
<td></td>
</tr>
<tr>
<td>displayName</td>
<td>displayName</td>
<td></td>
</tr>
<tr>
<td>givenName</td>
<td>givenName</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="user-type-selection-and-settings">User Type Selection and Settings</h2>
<h3 id="member-usertype-attribute">Member (userType) Attribute</h3>
<p>Select the <code>Member (userType)</code> attribute to open the Edit Attribute page.</p>
<h3 id="constant-value-setting-for-usertype">Constant Value Setting for userType</h3>
<p>Review the <strong>Constant Value</strong> setting for the userType attribute. This setting defines the type of user that will be created in the target tenant and can be one of the values in the following table. By default, users will be created as external member (B2B collaboration users). For more information, see <a href="#">Properties of a Microsoft Entra B2B collaboration user</a>.</p>
<table>
<thead>
<tr>
<th>Constant Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Member</td>
<td>Default. Users will be created as external members (B2B collaboration users) in the target tenant. Users will be able to function as any internal member of the target tenant.</td>
</tr>
<tr>
<td>Guest</td>
<td>Users will be created as external guests (B2B collaboration users) in the target tenant.</td>
</tr>
</tbody>
</table>
<h2 id="note">Note</h2>
<p>If the B2B user already exists in the target tenant then Member (userType) will not changed to Member, unless the Apply this mapping setting is set to Always.</p>
<h3 id="user-type-limitations">User Type Limitations</h3>
<p>The user type you choose has the following limitations for apps or services:</p>
<table>
<thead>
<tr>
<th>App or service</th>
<th>Limitations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Power BI</td>
<td>Support for UserType Member in Power BI is currently in preview. For more information, see <a href="https://linktopowerbi.com">Distribute Power BI content to external guest users with Microsoft Entra B2B.</a></td>
</tr>
<tr>
<td>Azure Virtual Desktop</td>
<td>External member and external guest aren&#39;t supported in Azure Virtual Desktop.</td>
</tr>
</tbody>
</table>
<h3 id="edit-attribute">Edit Attribute</h3>
<p>A mapping lets you define how the attributes in one class of Microsoft Entra object (e.g., Users) should flow to and from this application.</p>
<ul>
<li>Mapping type: Constant</li>
<li>Constant Value: Member</li>
<li>Target attribute: userType</li>
<li>Match objects using this attribute: No</li>
<li>Matching precedence: 0</li>
<li>Apply this mapping: Only during object creation</li>
</ul>
<h3 id="attribute-transformations">Attribute Transformations</h3>
<p>If you want to define any transformations, on the <strong>Attribute Mapping</strong> page, select the attribute you want to transform, such as displayName.</p>
<h2 id="step-7-set-the-mapping-type">Step 7: Set the Mapping Type</h2>
<p>Set the Mapping type to <strong>Expression</strong>.</p>
<h2 id="step-8-define-the-transformation-expression">Step 8: Define the Transformation Expression</h2>
<p>In the Expression box, enter the transformation expression. For example, with the display name, you can:</p>
<ul>
<li>Flip the first name and last name and add a comma in between.</li>
<li>Add the domain name in parentheses at the end of the display name.</li>
</ul>
<p>For examples, refer to Reference for writing expressions for attribute mappings in Microsoft Entra ID.</p>
<h3 id="edit-attribute-interface">Edit Attribute Interface</h3>
<ul>
<li><strong>Mapping type:</strong> Expression</li>
<li><strong>Expression:</strong> [displayName]</li>
<li><em>The expression was correctly parsed.</em></li>
<li><strong>Target attribute:</strong> displayName</li>
</ul>
<p><img src="#" alt="Expression Interface">  <!-- Image described as interface window for Edit Attribute --></p>
<blockquote><p><strong>Tip</strong></p>
<p>You can map directory extensions by updating the schema of the cross-tenant synchronization. For more information, see <a href="#">Map directory extensions in cross-tenant synchronization</a>.</p>
</blockquote>
<h2 id="step-10-specify-additional-provisioning-settings">Step 10: Specify Additional Provisioning Settings</h2>
<p><strong>Source tenant</strong></p>
<h2 id="step-10-configure-advanced-settings">Step 10: Configure advanced settings</h2>
<h3 id="1-in-the-source-tenant-select-provisioning-and-expand-the-settings-section">1. In the source tenant, select Provisioning and expand the Settings section.</h3>
<h3 id="2-check-the-send-an-email-notification-when-a-failure-occurs-check-box">2. Check the Send an email notification when a failure occurs check box.</h3>
<h3 id="3-in-the-notification-email-box-enter-the-email-address-of-a-person-or-group-who-should-receive-provisioning-error-notifications">3. In the Notification Email box, enter the email address of a person or group who should receive provisioning error notifications.</h3>
<p>Email notifications are sent within 24 hours of the job entering quarantine state.
For custom alerts, see <a href="https://docs.microsoft.com">Understand how provisioning integrates with Azure Monitor logs</a>.</p>
<h3 id="4-to-prevent-accidental-deletion-select-prevent-accidental-deletion-and-specify-a-threshold-value-by-default-the-threshold-is-set-to-500">4. To prevent accidental deletion, select Prevent accidental deletion and specify a threshold value. By default, the threshold is set to 500.</h3>
<p>For more information, see <a href="https://docs.microsoft.com">Enable accidental deletions prevention in the Microsoft Entra provisioning service</a>.</p>
<h3 id="5-select-save-to-save-any-changes">5. Select Save to save any changes.</h3>
<h2 id="step-11-test-provision-on-demand">Step 11: Test provision on demand</h2>
<p><img src="https://example.com/provision_on_demand.png" alt="Provision on Demand"></p>
<h2 id="on-demand-provisioning-test-instructions">On-Demand Provisioning Test Instructions</h2>
<p>Now that you have a configuration, you can test on-demand provisioning with one of your users.</p>
<h3 id="steps">Steps</h3>
<ol>
<li>In the source tenant, browse to <strong>Identity &gt; External Identities &gt; Cross-tenant synchronization</strong>.</li>
<li>Select <strong>Configurations</strong> and then select your configuration.</li>
<li>Select <strong>Provision on demand</strong>.</li>
<li>In the <strong>Select a user or group</strong> box, search for and select one of your test users.</li>
<li>Select <strong>Provision</strong>.</li>
</ol>
<p>After a few moments, the <strong>Perform action</strong> page appears with information about the provisioning of the test user in the target tenant.</p>
<h2 id="perform-action">Perform Action</h2>
<p><strong>Modified Attributes (successful)</strong> - User <code>User1@fictiban.com</code> was created in Azure Active Directory (target tenant).</p>
<h3 id="data-flow">Data Flow</h3>
<table>
<thead>
<tr>
<th>Source Attribute Name</th>
<th>Source Attribute Value</th>
<th>Expression</th>
<th>Original Target Attribute Value</th>
<th>Modified Target Attribute Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>isSoftDeleted</td>
<td>False</td>
<td>[isSoftDeleted]</td>
<td>False</td>
<td>False</td>
</tr>
<tr>
<td>accountEnabled</td>
<td>True</td>
<td></td>
<td></td>
<td>True</td>
</tr>
<tr>
<td>displayName</td>
<td>User1</td>
<td>[displayName]</td>
<td></td>
<td>User1</td>
</tr>
<tr>
<td>mailNickname</td>
<td>user1</td>
<td>[mailNickname]</td>
<td></td>
<td>user1</td>
</tr>
<tr>
<td>alternativeSecurityIds</td>
<td>AIdSceFromId(nt:103...</td>
<td></td>
<td>(1 values)</td>
<td></td>
</tr>
<tr>
<td>showInAddressList</td>
<td>&quot;True&quot;</td>
<td></td>
<td>True</td>
<td>True</td>
</tr>
<tr>
<td>userType</td>
<td>&quot;Member&quot;</td>
<td></td>
<td>&quot;Member&quot;</td>
<td>Member</td>
</tr>
<tr>
<td>preferredLanguage</td>
<td>undefined</td>
<td>[preferredLanguage]</td>
<td></td>
<td>en-US</td>
</tr>
</tbody>
</table>
<h2 id="user-scope-check">User Scope Check</h2>
<h3 id="determine-if-user-is-in-scope">Determine if user is in scope</h3>
<p><em>The user <code>alice@fictiban.com</code> will be skipped due to the following reasons: This object is not assigned to the application.</em></p>
<h4 id="reason-details">Reason Details:</h4>
<ol>
<li><strong>Attribute:</strong> SkipReason<br><strong>Attribute Value:</strong> NotEffectivelyEntitled</li>
<li><strong>Attribute:</strong> IsActive<br><strong>Attribute Value:</strong> True</li>
<li><strong>Attribute:</strong> Assigned to the application<br><strong>Attribute Value:</strong> False</li>
<li><strong>Attribute:</strong> isInProvisioningScope<br><strong>Attribute Value:</strong> True</li>
</ol>
<h2 id="provision-on-demand">Provision on Demand</h2>
<p>On the Provision on demand page, you can view details about the provision and have the option to retry.</p>
<h2 id="fabrikam-to-contoso--provision-on-demand">Fabrikam to Contoso | Provision on Demand</h2>
<h3 id="overview-8">Overview</h3>
<ul>
<li><strong>Provision on demand</strong></li>
<li><strong>Manage</strong><ul>
<li>Users and groups</li>
<li>Provisioning</li>
<li>Expression builder</li>
</ul>
</li>
<li><strong>Activity</strong><ul>
<li>Audit logs</li>
<li>Provisioning logs</li>
<li>Insights</li>
</ul>
</li>
<li><strong>Troubleshooting + Support</strong><ul>
<li>New support request</li>
</ul>
</li>
</ul>
<h3 id="provision-steps">Provision Steps</h3>
<ol>
<li><strong>Import user</strong><ul>
<li>This step shows the user retrieved from the source system and the properties of the user in the source system.</li>
<li>Status: Success</li>
</ul>
</li>
<li><strong>Determine if user is in scope</strong><ul>
<li>This step shows the scoping conditions that were evaluated and which ones the user passed or failed.</li>
<li>Status: Success</li>
</ul>
</li>
<li><strong>Match user between source and target system</strong><ul>
<li>This step shows whether the user was found in the target system as well as the properties of the user in the target system.</li>
<li>Status: Success</li>
</ul>
</li>
<li><strong>Perform action</strong><ul>
<li>This step shows the action that was performed in the target application, such as creating a user or updating a user.</li>
<li>Status: Success</li>
</ul>
</li>
</ol>
<h3 id="actions">Actions</h3>
<ul>
<li><strong>Retry</strong></li>
<li><strong>Provision another object</strong></li>
</ul>
<h3 id="verification-in-the-target-tenant">Verification in the target tenant</h3>
<ul>
<li><strong>Contoso Users</strong><ul>
<li>Azure Active Directory as ID provider</li>
<li>Details of provisioned user:<ul>
<li>Display name: User1</li>
<li>User principal name: user1@fabrikam.com-EXT@Contoso.ID</li>
<li>User type: Member</li>
<li>On-premises: No</li>
<li>Identities: ExternalAzureAD</li>
<li>Company name: -</li>
<li>Creation type: Invitation</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="additional-configuration">Additional Configuration</h3>
<ul>
<li>If all is working as expected, additional users can be assigned to the configuration.</li>
</ul>
<h3 id="documentation-reference">Documentation Reference</h3>
<ul>
<li>For more details, refer to the documentation on On-demand provisioning in Microsoft Entra ID.</li>
</ul>
<h2 id="step-12-start-the-provisioning-job">Step 12: Start the Provisioning Job</h2>
<h2 id="source-tenant-6">Source tenant</h2>
<p>The provisioning job starts the initial synchronization cycle of all users defined in Scope of the Settings section. The initial cycle takes longer to perform than subsequent cycles, which occur approximately every 40 minutes as long as the Microsoft Entra provisioning service is running.</p>
<ol>
<li>In the source tenant, browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</li>
<li>Select Configurations and then select your configuration.</li>
<li>On the Overview page, review the provisioning details.</li>
<li>Select Start provisioning to start the provisioning job.</li>
</ol>
<h3 id="step-13-monitor-provisioning">Step 13: Monitor provisioning</h3>
<h4 id="source-and-target-tenants">Source and target tenants</h4>
<p>Once you&#39;ve started a provisioning job, you can monitor the status.</p>
<ol>
<li>In the source tenant, on the Overview page, check the progress bar to see the status of the provisioning cycle and how close it&#39;s to completion. For more information, see Check the status of user provisioning.</li>
</ol>
<h2 id="application-provisioning-in-quarantine-status">Application Provisioning in Quarantine Status</h2>
<p>If provisioning seems to be in an unhealthy state, the configuration will go into quarantine. For more information, see <a href="#">Application provisioning in quarantine status</a>.</p>
<h3 id="overview-tab">Overview Tab</h3>
<ul>
<li><strong>Current cycle status</strong><ul>
<li>Initial cycle completed: <strong>100% complete</strong></li>
</ul>
</li>
<li><strong>Users</strong><ul>
<li>Total Users: <strong>2</strong></li>
</ul>
</li>
<li><strong>View provisioning logs</strong></li>
</ul>
<h3 id="statistics-to-date">Statistics to Date</h3>
<ul>
<li>View provisioning details</li>
<li>View technical information</li>
</ul>
<h3 id="select-provisioning-logs">Select Provisioning Logs</h3>
<p>Select <strong>Provisioning logs</strong> to determine which users have been provisioned successfully or unsuccessfully. By default, the logs are filtered by the service principal ID of the configuration. For more information, see <a href="#">Provisioning logs in Microsoft Entra ID</a>.</p>
<pre><code class="lang-plaintext">| Date       | Identity Name     | Source System      | Action | Target System         | Status |
|------------|-------------------|--------------------|--------|-----------------------|--------|
| 1/22/2024  | Display Name Here | Azure Active Directory | Update | Azure Active Directory | Success|
| 1/22/2024  | Display Name Here | Azure Active Directory | Create | Azure Active Directory | Success|
| 1/22/2024  | Display Name Here | Azure Active Directory | Other  | Azure Active Directory | Skipped|
</code></pre><h3 id="select-audit-logs">Select Audit Logs</h3>
<p>Select <strong>Audit logs</strong> to view all logged events in Microsoft Entra ID. For more information, see <a href="#">Audit logs in Microsoft Entra ID</a>.</p>
<h2 id="fabricam-to-contoso-audit-logs">Fabricam to Contoso: Audit Logs</h2>
<h3 id="viewing-audit-logs">Viewing Audit Logs</h3>
<p>You can also view audit logs in the target tenant.</p>
<ol>
<li>In the target tenant, select <strong>Users &gt; Audit logs</strong> to view logged events for user management.</li>
</ol>
<h2 id="step-14-configure-leave-settings">Step 14: Configure Leave Settings</h2>
<h3 id="target-tenant-2">Target Tenant</h3>
<p>Even though users are being provisioned in the target tenant, they still might be able to remove themselves. If users remove themselves and they are in scope, they&#39;ll be provisioned again during the next provisioning cycle. If you want to disallow the ability for users to remove themselves from your organization, you must configure the External user leave settings.</p>
<ol>
<li>In the target tenant, browse to <strong>Identity &gt; External Identities &gt; External collaboration settings</strong>.</li>
<li>Under <strong>External user leave settings</strong>, choose whether to allow external users to leave your organization themselves.</li>
</ol>
<h2 id="troubleshooting-tips">Troubleshooting tips</h2>
<h3 id="delete-a-configuration">Delete a configuration</h3>
<p>Follows these steps to delete a configuration on the Configurations page.</p>
<ol>
<li>In the source tenant, browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</li>
<li>On the Configurations page, add a check mark next to the configuration you want to delete.</li>
<li>Select Delete and then OK to delete the configuration.</li>
</ol>
<h3 id="symptom---test-connection-fails-with-azuredirectoryb2bmanagementpolicycheckfailure">Symptom - Test connection fails with AzureDirectoryB2BManagementPolicyCheckFailure</h3>
<p>When configuring cross-tenant synchronization in the source tenant and you test the connection, it fails with the following error message:</p>
<p>&quot;You appear to have entered invalid credentials. Please confirm you are using the correct information for an administrative account.&quot;</p>
<h2 id="error-details">Error Details</h2>
<pre><code>Error code: AzureDirectoryB2BManagementPolicyCheckFailure
Details: Policy permitting auto-redemption of invitations not configured.
</code></pre><h2 id="notifications-1">Notifications</h2>
<h3 id="testing-connection-to-fabrikam">Testing Connection to Fabrikam</h3>
<ul>
<li><strong>Error</strong>: You appear to have entered invalid credentials. Please confirm you are using the correct information for an administrative account.</li>
<li><strong>Error Code</strong>: AzureDirectoryB2BManagementPolicyCheckFailure</li>
<li><strong>Details</strong>: Policy permitting auto-redemption of invitations not configured.</li>
<li><strong>Request ID</strong>: </li>
</ul>
<h2 id="cause">Cause</h2>
<p>This error indicates the policy to automatically redeem invitations in both the source and target tenants wasn&#39;t set up.</p>
<h2 id="solution">Solution</h2>
<p>Follow the steps in:</p>
<ul>
<li><strong>Step 3</strong>: Automatically redeem invitations in the target tenant</li>
<li><strong>Step 4</strong>: Automatically redeem invitations in the source tenant.</li>
</ul>
<h2 id="symptom---automatic-redemption-check-box-is-disabled">Symptom - Automatic Redemption Check Box is Disabled</h2>
<p>When configuring cross-tenant synchronization, the Automatic redemption check box is disabled.</p>
<h2 id="outbound-access-settings---contoso-1">Outbound Access Settings - Contoso</h2>
<p><strong>Note:</strong> You need Azure AD Premium to configure trust settings and target select users, groups, and applications in cross-tenant access settings.</p>
<h3 id="tabs">Tabs:</h3>
<ul>
<li>B2B collaboration</li>
<li>B2B direct connect</li>
<li>Trust settings</li>
</ul>
<h3 id="automatic-redemption">Automatic redemption</h3>
<ul>
<li><strong>[ ]</strong> Check this setting if you want to automatically redeem invitations. If so, users from this tenant don&#39;t have to accept the consent prompt the first time they access the specified tenant using cross-tenant synchronization, B2B collaboration, or B2B direct connect. This setting will only suppress the consent prompt if the specified tenant checks this setting for inbound access as well. <a href="#">Learn more</a></li>
<li><strong>[x]</strong> Automatically redeem invitations with the tenant aea5fea3-ecc3-49f6-aaf8-e50a26e228de.</li>
</ul>
<hr>
<h3 id="cause-1">Cause</h3>
<p>Your tenant doesn&#39;t have a Microsoft Entra ID P1 or P2 license.</p>
<h3 id="solution-1">Solution</h3>
<p>You must have Microsoft Entra ID P1 or P2 to configure trust settings.</p>
<hr>
<h3 id="symptom---recently-deleted-user-in-the-target-tenant-is-not-restored">Symptom - Recently Deleted User in the Target Tenant is Not Restored</h3>
<p><strong>Issue</strong>: After soft deleting a synchronized user in the target tenant, the user isn&#39;t restored during the next synchronization cycle. If you try to soft delete a user with on-demand provisioning and then restore the user, it can result in duplicate users.</p>
<h4 id="cause-2">Cause</h4>
<p>Restoring a previously soft-deleted user in the target tenant isn&#39;t supported.</p>
<h4 id="solution-2">Solution</h4>
<p>Manually restore the soft-deleted user in the target tenant. For more information, see Restore or remove a recently deleted user using Microsoft Entra ID.</p>
<hr>
<h3 id="symptom---users-are-skipped-because-sms-sign-in-is-enabled-on-the-user">Symptom - Users are Skipped Because SMS Sign-in is Enabled on the User</h3>
<p>[Explanation and solutions for the symptom would be described here, but content is not visible in the image provided.]</p>
<h2 id="users-and-synchronization">Users and Synchronization</h2>
<p>Users are skipped from synchronization. The scoping step includes the following filter with status false: &quot;Filter external users.alternativeSecurityIds EQUALS &#39;None&#39;&quot;</p>
<h3 id="cause-3">Cause</h3>
<p>If SMS sign-in is enabled for a user, they will be skipped by the provisioning service.</p>
<h3 id="solution-3">Solution</h3>
<p>Disable SMS Sign-in for the users. The script below shows how you can disable SMS Sign-in using PowerShell.</p>
<pre><code class="lang-PowerShell">##### Disable SMS Sign-in options for the users

##### Import module
Install-Module Microsoft.Graph.Users.Actions
Install-Module Microsoft.Graph.Identity.SignIns
Import-Module Microsoft.Graph.Users.Actions

Connect-MgGraph -Scopes &quot;User.Read.All&quot;, &quot;Group.ReadWrite.All&quot;, &quot;UserAuthenticationMethod.Read.All&quot;, &quot;UserAuthenticationMethod.ReadWrite&quot;, &quot;UserAuthenticationMethod.ReadWrite.All&quot;

##### The value for phoneAuthenticationMethodId is 3179e48a-750b-4051-897c-8b79702928f7
$phoneAuthenticationMethodId = &quot;3179e48a-750b-4051-897c-8b79702928f7&quot;

##### Get the User Details
$userId = &quot;objectid_of_the_user_in_Azure_AD&quot;

##### validate the value for SmsSignInState
$smsSignIn = Get-MgUserAuthenticationPhoneMethod -UserId $userId

{
    if($smsSignIn.SmsSignInState -eq &quot;ready&quot;){
        ##### Disable Sms Sign-In for the user is set to ready
        Disable-MgUserAuthenticationPhoneMethodSmsSignIn -UserId $userId -PhoneAuthenticationMethodId $phoneAuthenticationMethodId
        Write-Host &quot;SMS sign-in disabled for the user&quot; -ForegroundColor Green
    }
    else{
        Write-Host &quot;SMS sign-in status not set or found for the user&quot; -ForegroundColor Yellow
    }
}
</code></pre><h2 id="symptom---users-fail-to-provision-with-error-azureactivedirectoryforbidden">Symptom - Users fail to provision with error &quot;AzureActiveDirectoryForbidden&quot;</h2>
<p>Users in scope fail to provision. The provisioning logs details include the following error message:</p>
<pre><code>Guest invitations not allowed for your company. Contact your company administrator for more details.
</code></pre><h3 id="cause-4">Cause</h3>
<p>This error indicates the Guest invite settings in the target tenant are configured with the most restrictive setting: &quot;No one in the organization can invite guest users including admins (most restrictive)&quot;.</p>
<h3 id="solution-4">Solution</h3>
<p>Change the Guest invite settings in the target tenant to a less restrictive setting. For more information, see Configure external collaboration settings.</p>
<h2 id="next-steps-12">Next steps</h2>
<ul>
<li>Tutorial: Reporting on automatic user account provisioning</li>
<li>Managing user account provisioning for enterprise apps in the Azure portal</li>
<li>What is single sign-on in Microsoft Entra ID?</li>
</ul>
<h2 id="configure-cross-tenant-synchronization-using-powershell-or-microsoft-graph-api">Configure cross-tenant synchronization using PowerShell or Microsoft Graph API</h2>
<p>Article • 04/23/2024</p>
<p>This article describes the key steps to configure cross-tenant synchronization using Microsoft Graph PowerShell or Microsoft Graph API. When configured, Microsoft Entra ID automatically provisions and de-provisions B2B users in your target tenant. For detailed steps using the Microsoft Entra admin center, see <a href="#">Configure cross-tenant synchronization</a>.</p>
<h3 id="diagram-overview-1">Diagram Overview</h3>
<pre><code class="lang-mermaid">graph LR
    A[Source Tenant] --&gt;|Cross-tenant synchronization| B[Target Tenant]
    A --&gt;|Outbound access settings| A1[UserS1, UserS2, UserS3]
    A1 -.-&gt;|Automatically redeem invitations| A
    A --&gt; C[Configuration]
    C -.-&gt;|Scoping filters: department EQUALS Marketing| C
    C --&gt;|Attribute mappings| C1{accountEnabled, employed, userPrincipalName, companyName}
    B -.-&gt;|Inbound access settings| B1[Allow users sync into this tenant]
    B1 -.-&gt;|Automatically redeem invitations| B
    B --&gt; D[Internal User1, User2, User3, GroupT1]
    D --&gt; E[External UserS1, UserS3]
</code></pre><h3 id="prerequisites-3">Prerequisites</h3>
<p>Source tenant</p>
<ul>
<li>Microsoft Entra ID P1 or P2 license. For more information, see <a href="#">License</a></li>
<li>Security Administrator role to configure cross-tenant access settings.</li>
<li>Hybrid Identity Administrator role to configure cross-tenant synchronization.</li>
</ul>
<h2 id="roles-and-permissions">Roles and Permissions</h2>
<ul>
<li>Cloud Application Administrator or Application Administrator role to assign users to a configuration and to delete a configuration.</li>
<li>Global Administrator role to consent to required permissions.</li>
</ul>
<h3 id="target-tenant-3">Target tenant</h3>
<ul>
<li>Microsoft Entra ID P1 or P2 license.</li>
<li>Security Administrator role to configure cross-tenant access settings.</li>
<li>Global Administrator role to consent to required permissions.</li>
</ul>
<h2 id="step-1-sign-in-to-the-target-tenant">Step 1: Sign in to the target tenant</h2>
<h3 id="instructions-1">Instructions</h3>
<ol>
<li>Start PowerShell.</li>
<li>If necessary, install the Microsoft Graph PowerShell SDK.</li>
<li><p>Get the tenant ID of the source and target tenants and initialize variables.</p>
<pre><code class="lang-PowerShell">$SourceTenantId = &quot;SourceTenantId&quot;
$TargetTenantId = &quot;TargetTenantId&quot;
</code></pre></li>
<li><p>Use the Connect-MgGraph command to sign in to the target tenant and consent to the following required permissions.</p>
<pre><code class="lang-PowerShell">Connect-MgGraph -TenantId $TargetTenantId -Scopes &quot;Policy.Read.All&quot;,&quot;Policy.ReadWrite.CrossTenantAccess&quot;
</code></pre></li>
</ol>
<h2 id="step-2-enable-user-synchronization-in-the-target-tenant-1">Step 2: Enable user synchronization in the target tenant</h2>
<h3 id="target-tenant-4">Target tenant</h3>
<pre><code class="lang-PowerShell">In the target tenant, use the New-MgPolicyCrossTenantAccessPolicyPartner command to create a new partner configuration in a cross-tenant access policy between the target tenant and the source tenant. Use the source tenant ID in the request.

If you get the error New-MgPolicyCrossTenantAccessPolicyPartner_Create:
Another object with the same value for property tenantId already exists, you might already have an existing configuration. For more information, see Symptom - New-MgPolicyCrossTenantAccessPolicyPartner_Create error.

$Params = @{
    TenantId = $SourceTenantId
}
New-MgPolicyCrossTenantAccessPolicyPartner -BodyParameter $Params | Format-List
</code></pre><h3 id="output-3">Output</h3>
<pre><code>AutomaticUserConsentSettings : Microsoft.Graph.PowerShell.Models.MicrosoftGraphInboundOutboundPolicyConfiguration
B2BCollaborationInbound : Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
B2BCollaborationOutbound : Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
B2BDirectConnectInbound : Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
B2BDirectConnectOutbound : Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
IdentitySynchronization : Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantIdentitySettings
</code></pre><h2 id="syncpolicypartner">SyncPolicyPartner</h2>
<p><strong>InboundTrust:</strong> Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyInboundTrust<br><strong>IsServiceProvider:</strong> :<br><strong>TenantId:</strong> <code>&lt;SourceTenantId&gt;</code><br><strong>TenantRestrictions:</strong> Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyTenantRestrictions<br><strong>AdditionalProperties:</strong> <code>{[@odata.context, https://graph.microsoft.com/v1.0/$metadata#policies/crossTenantAccessPolicy/partners/$entity], [crossCloudMeetingConfiguration, System.Collections.Generic.Dictionary\</code>2[System.String,System.Object]], [protectedContentSharing, System.Collections.Generic.Dictionary`2[System.String,System.Object]]}`</p>
<h3 id="2-enable-user-synchronization">2. Enable User Synchronization</h3>
<p>Use the <code>Invoke-MgGraphRequest</code> command to enable user synchronization in the target tenant.</p>
<p>If you encounter an <code>Request_MultipleObjectsWithSameKeyValue</code> error, you might already have an existing policy. For more details, refer to Symptom - <code>Request_MultipleObjectsWithSameKeyValue</code> error.</p>
<pre><code class="lang-plaintext">$Params = @{
    userSyncInbound = @{
        isSyncAllowed = $true
    }
}
Invoke-MgGraphRequest -Method PUT -Uri &quot;https://graph.microsoft.com/v1.0/policies/crossTenantAccessPolicy/partners/$SourceTenantId/identitySynchronization&quot; -Body $Params
</code></pre><h3 id="3-verify-user-synchronization-setting">3. Verify User Synchronization Setting</h3>
<p>Use the <code>Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization</code> command to confirm <code>IsSyncAllowed</code> is set to True.</p>
<pre><code class="lang-plaintext">(Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization -CrossTenantAccessPolicyConfigurationPartnerTenantId $SourceTenantId).UserSyncInbound
</code></pre><table>
<thead>
<tr>
<th>IsSyncAllowed</th>
</tr>
</thead>
<tbody>
<tr>
<td>True</td>
</tr>
</tbody>
</table>
<h2 id="step-3-automatically-redeem-invitations-in-the-target-tenant">Step 3: Automatically redeem invitations in the target tenant</h2>
<h3 id="target-tenant-5">Target tenant</h3>
<pre><code class="lang-PowerShell"># In the target tenant, use the following command to automatically redeem invitations and suppress consent prompts for inbound access:
$AutomaticUserConsentSettings = @{
    &quot;InboundAllowed&quot;=&quot;True&quot;
}
Update-MgPolicyCrossTenantAccessPolicyPartner -CrossTenantAccessPolicyConfigurationPartnerTenantId $sourceTenantId -AutomaticUserConsentSettings $AutomaticUserConsentSettings
</code></pre><h2 id="step-4-sign-in-to-the-source-tenant">Step 4: Sign in to the source tenant</h2>
<h3 id="source-tenant-7">Source tenant</h3>
<pre><code class="lang-PowerShell"># Start an instance of PowerShell.
# Get the tenant ID of the source and target tenants and initialize variables.
</code></pre><h2 id="powershell-scripts-and-permissions">PowerShell Scripts and Permissions</h2>
<pre><code class="lang-powershell">$SourceTenantId = &quot;&lt;SourceTenantId&gt;&quot;
$TargetTenantId = &quot;&lt;TargetTenantId&gt;&quot;
</code></pre><h3 id="connect-mggraph-command-usage">Connect-MgGraph Command Usage</h3>
<p>Use the <code>Connect-MgGraph</code> command to sign in to the source tenant and consent to the following required permissions:</p>
<ul>
<li>Policy.Read.All</li>
<li>Policy.ReadWrite.CrossTenantAccess</li>
<li>Application.ReadWrite.All</li>
<li>Directory.ReadWrite.All</li>
<li>AuditLog.Read.All</li>
</ul>
<pre><code class="lang-powershell">Connect-MgGraph -TenantId $SourceTenantId -Scopes &quot;Policy.Read.All&quot;, &quot;Policy.ReadWrite.CrossTenantAccess&quot;, &quot;Application.ReadWrite.All&quot;, &quot;Directory.ReadWrite.All&quot;, &quot;AuditLog.Read.All&quot;
</code></pre><h2 id="step-5-automatically-redeem-invitations-in-the-source-tenant">Step 5: Automatically redeem invitations in the source tenant</h2>
<h3 id="powershell-script-for-source-tenant">PowerShell Script for Source Tenant</h3>
<p>In the source tenant, use the <code>New-MgPolicyCrossTenantAccessPolicyPartner</code> command to create a new partner configuration in a cross-tenant access policy between the source tenant and the target tenant. Use the target tenant ID in the request.</p>
<pre><code class="lang-powershell">New-MgPolicyCrossTenantAccessPolicyPartner -TenantId $SourceTenantId -Properties @{TargetTenantId = $TargetTenantId}
</code></pre><p><strong>Error Handling:</strong></p>
<p>If you get the error <code>New-MgPolicyCrossTenantAccessPolicyPartner_Create: Another object with the same value for property tenantId already exists</code>, you might already have an existing configuration. For more information, see <code>Symptom - New-MgPolicyCrossTenantAccessPolicyPartner_Create error</code>.</p>
<h2 id="tenant-access-policy-script-execution">Tenant Access Policy Script Execution</h2>
<h3 id="commands-and-outputs">Commands and Outputs</h3>
<p>Run PowerShell command with parameters:</p>
<pre><code>$Params = @{
    TenantId = $TargetTenantId
}
New-MgPolicyCrossTenantAccessPolicyPartner -BodyParameter $Params | Format-List
</code></pre><p>Output display structure:</p>
<pre><code>AutomaticUserConsentSettings :
    Microsoft.Graph.PowerShell.Models.MicrosoftGraphInboundOutboundPolicyConfiguration
    B2BCollaborationInbound :
        Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
    B2BCollaborationOutbound :
        Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
    B2BDirectConnectInbound :
        Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
    B2BDirectConnectOutbound :
        Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
    IdentitySynchronization :
        Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantIdentity
    SyncPolicyPartner
    InboundTrust
        Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyInboundTrust
    IsServiceProvider : 
    TenantId : &lt;TargetTenantId&gt;
    TenantRestrictions :
        Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyTenantRestrictions
    AdditionalProperties :
        [{@odata.context, https://graph.microsoft.com/v1.0/$metadata#policies/crossTenantAccessPolicy/partners/$entity},
         {crossCloudMeetingConfiguration, System.Collections.Generic.Dictionary`2[System.String,System.Object]},
         {protectedContentSharing, System.Collections.Generic.Dictionary`2[System.String,System.Object]}]
</code></pre><h3 id="redeem-invitations-command">Redeem Invitations Command</h3>
<p>Use this command to automatically redeem invitations and suppress consent prompts for outbound access:</p>
<pre><code>Update-MgPolicyCrossTenantAccessPolicyPartner
</code></pre><h2 id="step-6-create-a-configuration-application-in-the-source-tenant">Step 6: Create a configuration application in the source tenant</h2>
<h3 id="source-tenant-8">Source tenant</h3>
<pre><code class="lang-PowerShell">$AutomaticUserConsentSettings = @{
    &quot;OutboundAllowed&quot;=&quot;True&quot;
}
Update-MgPolicyCrossTenantAccessPolicyPartner -CrossTenantAccessPolicyConfigurationPartnerTenantId $TargetTenantId -AutomaticUserConsentSettings $AutomaticUserConsentSettings
</code></pre><ol>
<li><p>In the source tenant, use the Invoke-MgInstantiateApplicationTemplate command to add an instance of a configuration application from the Microsoft Entra application gallery into your tenant.</p>
<pre><code class="lang-PowerShell">Invoke-MgInstantiateApplicationTemplate -ApplicationTemplateId &quot;518e5f48-1fc8-4c48-9387-9fdf28b0def7&quot; -DisplayName &quot;Fabrikam&quot;
</code></pre></li>
<li><p>Use the Get-MgServicePrincipal command to get the service principal ID and app role ID.</p>
<pre><code class="lang-PowerShell">Get-MgServicePrincipal -Filter &quot;DisplayName eq &#39;Fabrikam&#39;&quot; | Format-List
</code></pre><p> <strong>Output</strong></p>
<pre><code>AccountEnabled: True
AddIns: {}
AlternativeNames: {}
AppDescription: 
AppDisplayName: Fabrikam
</code></pre></li>
</ol>
<h2 id="application-properties">Application Properties</h2>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppId</td>
<td><code>&lt;AppId&gt;</code></td>
</tr>
<tr>
<td>AppManagementPolicies</td>
<td><code>&lt;AppManagementPolicies&gt;</code></td>
</tr>
<tr>
<td>AppOwnerOrganizationId</td>
<td><code>&lt;AppOwnerOrganizationId&gt;</code></td>
</tr>
<tr>
<td>AppRoleAssignedTo</td>
<td></td>
</tr>
<tr>
<td>AppRoleAssignmentRequired</td>
<td>True</td>
</tr>
<tr>
<td>AppRoleAssignments</td>
<td><code>{}</code></td>
</tr>
<tr>
<td>AppRoles</td>
<td><code>{&lt;AppRoleId&gt;}</code></td>
</tr>
<tr>
<td>ApplicationTemplateId</td>
<td><code>518e5f48-1fc8-4c48-9387-9fddf2b80def</code></td>
</tr>
<tr>
<td>ClaimsMappingPolicies</td>
<td></td>
</tr>
<tr>
<td>CreatedObjects</td>
<td></td>
</tr>
<tr>
<td>CustomSecurityAttributes</td>
<td><code>Microsoft.Graph.PowerShell.Models.MicrosoftGraphCustomSecurityAttribute...</code></td>
</tr>
<tr>
<td>DelegatedPermissionClassifications</td>
<td></td>
</tr>
<tr>
<td>DeletedDateTime</td>
<td></td>
</tr>
<tr>
<td>Description</td>
<td></td>
</tr>
<tr>
<td>DisabledByMicrosoftStatus</td>
<td></td>
</tr>
<tr>
<td>DisplayName</td>
<td>Fabrikam</td>
</tr>
<tr>
<td>Endpoints</td>
<td></td>
</tr>
<tr>
<td>ErrorUrl</td>
<td></td>
</tr>
<tr>
<td>FederatedIdentityCredentials</td>
<td></td>
</tr>
<tr>
<td>HomeRealmDiscovery policies</td>
<td></td>
</tr>
<tr>
<td>Homepage</td>
<td><code>https://account.activedirectory.windowsazure.com:444/applications/...</code></td>
</tr>
<tr>
<td>Id</td>
<td><code>&lt;ServicePrincipalId&gt;</code></td>
</tr>
<tr>
<td>Info</td>
<td></td>
</tr>
<tr>
<td>KeyCredentials</td>
<td><code>{}</code></td>
</tr>
<tr>
<td>LicenseDetails</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="powershell-script-initialization">PowerShell Script Initialization</h3>
<pre><code class="lang-plaintext">$ServicePrincipalId = &quot;&lt;ServicePrincipalId&gt;&quot;
</code></pre><hr>
<pre><code class="lang-plaintext">$AppRoleId = &quot;&lt;AppRoleId&gt;&quot;
</code></pre><h2 id="step-7-test-the-connection-to-the-target-tenant">Step 7: Test the connection to the target tenant</h2>
<h3 id="source-tenant-9">Source tenant</h3>
<pre><code class="lang-PowerShell">$Params = @{
    &quot;useSavedCredentials&quot; = $false
    &quot;templateId&quot; = &quot;Azure2Azure&quot;
    &quot;credentials&quot; = @(
        @{
            &quot;key&quot; = &quot;CompanyId&quot;
            &quot;value&quot; = $TargetTenantId
        }
        @{
            &quot;key&quot; = &quot;AuthenticationType&quot;
            &quot;value&quot; = &quot;SyncPolicy&quot;
        }
    )
}
Invoke-MgGraphRequest -Method POST -Uri &quot;https://graph.microsoft.com/v1.0/servicePrincipals/$ServicePrincipalId/synchronization/jobs/validateCredentials&quot; -Body $Params
</code></pre><h2 id="step-8-create-a-provisioning-job-in-the-source-tenant">Step 8: Create a provisioning job in the source tenant</h2>
<h3 id="source-tenant-10">Source tenant</h3>
<p>In the source tenant, to enable provisioning, create a provisioning job.</p>
<pre><code class="lang-PowerShell"># Determine the synchronization template to use, such as Azure2Azure.
</code></pre><h2 id="step-9-save-your-credentials">Step 9: Save your credentials</h2>
<h3 id="source-tenant-11">Source tenant</h3>
<pre><code class="lang-PowerShell"># The PowerShell command to initiate provisioning job with pre-configured synchronization settings
New-MgServicePrincipalSynchronizationJob -ServicePrincipalId $ServicePrincipalId -TemplateId &quot;Azure2Azure&quot; | Format-List
</code></pre><h3 id="output-information">Output Information</h3>
<pre><code>Id                           : &lt;JobId&gt;
Schedule                     :
Schema                       : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSynchronizationSchema
Status                       :
SynchronizationJobSettings   : {AzureIngestionAttributeOptimization, LookaheadQueryEnabled}
TemplateId                   : Azure2Azure
AdditionalProperties         : {[@odata.context, https://graph.microsoft.com/v1.0/$metadata#servicePrincipals(&#39;ServicePrincipalId&#39;)/synchronization/jobs/$entity]}
</code></pre><h3 id="initialize-job-id">Initialize job ID</h3>
<pre><code class="lang-PowerShell">$JobId = &quot;&lt;JobId&gt;&quot;
</code></pre><h2 id="step-10-assign-a-user-to-the-configuration">Step 10: Assign a user to the configuration</h2>
<h3 id="source-tenant-12">Source tenant</h3>
<p>For cross-tenant synchronization to work, at least one internal user must be assigned to the configuration.</p>
<pre><code class="lang-PowerShell">$Params = @{
    &quot;PrincipalId&quot; = &quot;&lt;PrincipalId&gt;&quot;
    &quot;ResourceId&quot; = &quot;&lt;ServicePrincipalId&gt;&quot;
    &quot;AppRoleId&quot; = &quot;&lt;AppRoleId&gt;&quot;
}
Invoke-MgGraphRequest -Method PUT -Uri &quot;https://graph.microsoft.com/v1.0/servicePrincipals/&lt;ServicePrincipalId&gt;/appRoleAssignments&quot; -Body $Params
</code></pre><h2 id="new-mgserviceprincipalapproleassignedto-command">New-MgServicePrincipalAppRoleAssignedTo Command</h2>
<pre><code class="lang-plaintext">New-MgServicePrincipalAppRoleAssignedTo -ServicePrincipalId $ServicePrincipalId -BodyParameter $Params | Format-List
</code></pre><h3 id="output-4">Output</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppRoleId</td>
<td>&lt;AppRoleId></td>
</tr>
<tr>
<td>CreatedDateTime</td>
<td>7/31/2023 10:27:12 PM</td>
</tr>
<tr>
<td>DeletedDateTime</td>
<td></td>
</tr>
<tr>
<td>Id</td>
<td>&lt;Id></td>
</tr>
<tr>
<td>PrincipalDisplayName</td>
<td>User1</td>
</tr>
<tr>
<td>PrincipalId</td>
<td>&lt;PrincipalId></td>
</tr>
<tr>
<td>PrincipalType</td>
<td>User</td>
</tr>
<tr>
<td>ResourceDisplayName</td>
<td>Fabrikam</td>
</tr>
<tr>
<td>ResourceId</td>
<td>&lt;ServicePrincipalId></td>
</tr>
<tr>
<td>AdditionalProperties</td>
<td>{ [[odata.context], [<a href="https://graph.microsoft.com/v1.0/metadata#appRoleAssignments/$entity">https://graph.microsoft.com/v1.0/metadata#appRoleAssignments/$entity</a>]] }</td>
</tr>
</tbody>
</table>
<h2 id="step-11-test-provision-on-demand-1">Step 11: Test Provision on Demand</h2>
<h3 id="source-tenant-13">Source Tenant</h3>
<p>Now that you have a configuration, you can test on-demand provisioning with one of your users.</p>
<pre><code class="lang-plaintext">In the source tenant, use the Get-MgServicePrincipalSynchronizationJobSchema command to get the schema rule ID.
</code></pre><pre><code class="lang-plaintext">$SynchronizationSchema = Get-MgServicePrincipalSynchronizationJobSchema -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId
$SynchronizationSchema.SynchronizationRules | Format-List
</code></pre><h3 id="output-5">Output</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>ContainerFilter</td>
<td>Microsoft.Graph.PowerShell.Models.MicrosoftGraphContainerFilter</td>
</tr>
</tbody>
</table>
<h2 id="editable-configuration-details">Editable Configuration Details</h2>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Editable</td>
<td>True</td>
</tr>
<tr>
<td>GroupFilter</td>
<td></td>
</tr>
<tr>
<td>Id</td>
<td><code>&lt;RuleId&gt;</code></td>
</tr>
<tr>
<td>Metadata</td>
<td>{defaultSourceObjectMappings, supportsProvisionOnDemand}</td>
</tr>
<tr>
<td>Name</td>
<td>USER_INBOUND_USER</td>
</tr>
<tr>
<td>ObjectMappings</td>
<td>{Provision Azure Active Directory Users, , , ...}</td>
</tr>
<tr>
<td>Priority</td>
<td>1</td>
</tr>
<tr>
<td>SourceDirectoryName</td>
<td>Azure Active Directory</td>
</tr>
<tr>
<td>TargetDirectoryName</td>
<td>Azure Active Directory (target tenant)</td>
</tr>
<tr>
<td>AdditionalProperties</td>
<td>{}</td>
</tr>
</tbody>
</table>
<h2 id="powershell-commands">PowerShell Commands</h2>
<h3 id="initialize-a-variable-for-the-rule-id">Initialize a variable for the rule ID</h3>
<pre><code class="lang-powershell">$RuleId = &quot;RuleId&quot;
</code></pre><h3 id="provision-a-user-on-demand">Provision a User on Demand</h3>
<pre><code class="lang-powershell">$Params = @{
    Parameters = @(
        @{
            Subjects = @(
                @{
                    ObjectId = &quot;UserObjectId&quot;
                    ObjectTypeName = &quot;User&quot;
                }
            )
            RuleId = $RuleId
        }
    )
}
New-MgServicePrincipalSynchronizationJobOnDemand -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId -BodyParameter $Params | Format-List
</code></pre><h3 id="command-output">Command Output</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Key</td>
<td>Microsoft.Identity.Health.CPP.Common.DataContracts.SyncFabric.StatusInfo</td>
</tr>
<tr>
<td>Value</td>
<td>[{&quot;name&quot;:&quot;EntryImport&quot;,&quot;type&quot;:&quot;Import&quot;,&quot;status&quot;:&quot;Success&quot;,&quot;description&quot;:&quot;Retrieved User&quot;}]</td>
</tr>
</tbody>
</table>
<p>&quot;user1@fabrikam.com&quot; from Azure Active Directory,&quot;timestamp&quot;: &quot;2023-07-31T22:31:15.911659Z&quot;, &quot;details&quot;:<br>{&quot;objectId&quot;:<br>  <userobjectid>&quot;, &quot;accountEnabled&quot;: &quot;True&quot;, &quot;displayName&quot;: &quot;User1&quot;, &quot;mailNickname&quot;: &quot;user1&quot;, &quot;userPrincipalName&quot;: &quot;use<br>  AdditionalProperties : [{@odata.context, https://graph.microsoft.com/v1.0/$metadata#microsoft.graph.stringKeyStringValuePair}]<p>
<h2 id="step-12-start-the-provisioning-job-1">Step 12: Start the provisioning job</h2>
<h3 id="source-tenant-14">Source tenant</h3>
<pre><code class="lang-PowerShell">1. Now that the provisioning job is configured, in the source tenant, use the Start-MgServicePrincipalSynchronizationJob command to start the provisioning job.

    Start-MgServicePrincipalSynchronizationJob -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId
</code></pre><h2 id="step-13-monitor-provisioning-1">Step 13: Monitor provisioning</h2>
<h3 id="source-tenant-15">Source tenant</h3>
<pre><code class="lang-PowerShell">1. Now that the provisioning job is running, in the source tenant, use the Get-MgServicePrincipalSynchronizationJob command to monitor the progress of the current provisioning cycle as well as statistics to date such as the number of users and groups that have been created in the target system.
</code></pre><h2 id="powershell-1">PowerShell</h2>
<h3 id="get-mgserviceprincipalsynchronizationjob">Get-MgServicePrincipalSynchronizationJob</h3>
<pre><code class="lang-powershell">Get-MgServicePrincipalSynchronizationJob -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId | Format-List
</code></pre><h4 id="output-6">Output</h4>
<pre><code>Id                          : &lt;JobId&gt;
Schedule                    : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSynchronizationSchedule
Schema                      : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSynchronizationSchema
Status                      : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSynchronizationStatus
SynchronizationJobSettings  : {AzureIngestionAttributeOptimization, LookaheadQueryEnabled}
TemplateId                  : Azure2Azure
AdditionalProperties        : {{@odata.context, https://graph.microsoft.com/v1.0/$metadata#servicePrincipals(&#39;&lt;ServicePrincipalId&gt;&#39;)/synchronization/jobs/&lt;entityId&gt;}}
</code></pre><h3 id="monitoring-status-of-provisioning">Monitoring Status of Provisioning</h3>
<h4 id="get-mgauditlogprovisioning">Get-MgAuditLogProvisioning</h4>
<pre><code class="lang-powershell">Get-MgAuditLogDirectoryAudit | Select -First 10 | Format-List
</code></pre><h4 id="output-7">Output</h4>
<pre><code>ActivityDateTime       : 7/31/2023 12:08:17 AM
ActivityDisplayName    : Export
AdditionalDetails      : {Details, ErrorCode, EventName, ipaddr...}
Category               : ProvisioningManagement
CorrelationId          : cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec
Id                     : Sync_cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec_LSBFV_161778479
InitiatedBy            : Microsoft.Graph.PowerShell.Models.MicrosoftGraphAuditActivityInitiator1
LoggedByService        : Account Provisioning
OperationType          : Account Provisioning
Result                 : success
</code></pre><h2 id="result-details">Result Details</h2>
<h3 id="entry-1">Entry 1:</h3>
<ul>
<li><strong>ResultReason:</strong> User &#39;user2@fabrikam.com&#39; was created in Azure Active Directory (target tenant)</li>
<li><strong>TargetResources:</strong> {<serviceprincipalid>, }</serviceprincipalid></li>
<li><strong>AdditionalProperties:</strong> {}</li>
</ul>
<p><strong>Activity Details:</strong></p>
<ul>
<li><strong>DateTime:</strong> 7/31/2023 12:08:17 AM</li>
<li><strong>DisplayName:</strong> Export</li>
<li><strong>Details:</strong> {Details, ErrorCode, EventName, ipaddr...}</li>
<li><strong>Category:</strong> ProvisioningManagement</li>
<li><strong>CorrelationId:</strong> cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec</li>
<li><strong>Id:</strong> Sync_cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec_L5BFV_161778264</li>
<li><strong>InitiatedBy:</strong> Microsoft.Graph.PowerShell.Models.MicrosoftGraphAuditActivityInitiator1</li>
<li><strong>LoggedByService:</strong> Account Provisioning</li>
<li><strong>OperationType:</strong> Account Provisioning</li>
<li><strong>Result:</strong> success</li>
</ul>
<h3 id="entry-2">Entry 2:</h3>
<ul>
<li><strong>ResultReason:</strong> User &#39;user2@fabrikam.com&#39; was updated in Azure Active Directory (target tenant)</li>
<li><strong>TargetResources:</strong> {<serviceprincipalid>, }</serviceprincipalid></li>
<li><strong>AdditionalProperties:</strong> {}</li>
</ul>
<p><strong>Activity Details:</strong></p>
<ul>
<li><strong>DateTime:</strong> 7/31/2023 12:08:14 AM</li>
<li><strong>DisplayName:</strong> Synchronization rule action</li>
<li><strong>Details:</strong> {Details, ErrorCode, EventName, ipaddr...}</li>
<li><strong>Category:</strong> ProvisioningManagement</li>
<li><strong>CorrelationId:</strong> cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec</li>
<li><strong>Id:</strong> Sync_cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec_L5BFV_161778395</li>
<li><strong>InitiatedBy:</strong> Microsoft.Graph.PowerShell.Models.MicrosoftGraphAuditActivityInitiator1</li>
<li><strong>LoggedByService:</strong> Account Provisioning</li>
<li><strong>OperationType:</strong> Account Provisioning</li>
<li><strong>Result:</strong> success</li>
<li><strong>ResultReason:</strong> User &#39;user2@fabrikam.com&#39; will be created in Azure Active Directory (target tenant) (User is active and assigned in Azure Active Directory, but no matching user was found in Azure Active Directory (target tenant).)</li>
</ul>
<h2 id="troubleshooting-tips-1">Troubleshooting tips</h2>
<ul>
<li>Use PowerShell for further analysis and troubleshooting.</li>
</ul>
<h2 id="symptom---insufficient-privileges-error">Symptom - Insufficient privileges error</h2>
<p>When you try to perform an action, you receive an error message similar to the following:</p>
<pre><code>code: Authorization_RequestDenied
message: Insufficient privileges to complete the operation.
</code></pre><h3 id="cause-5">Cause</h3>
<p>Either the signed-in user doesn&#39;t have sufficient privileges, or you need to consent to one of the required permissions.</p>
<h3 id="solution-5">Solution</h3>
<ol>
<li>Make sure you&#39;re assigned the required roles. See Prerequisites earlier in this article.</li>
<li>When you sign in with Connect-MgGraph, make sure you specify the required scopes. See Step 1: Sign in to the target tenant and Step 4: Sign in to the source tenant earlier in this article.</li>
</ol>
<h2 id="symptom---new-mgpolicycrosstenantaccesspolicypartnercreate-error">Symptom - New-MgPolicyCrossTenantAccessPolicyPartner_Create error</h2>
<p>When you try to create a new partner configuration, you receive an error message similar to the following:</p>
<pre><code>New-MgPolicyCrossTenantAccessPolicyPartner_Create: Another object with the same value for property tenantId already exists.
</code></pre><h3 id="cause-6">Cause</h3>
<p>You are likely trying to create a configuration or object that already exists, possibly from a previous configuration.</p>
<h3 id="solution-6">Solution</h3>
<ol>
<li>Verify your syntax and that you are using the correct tenant ID.</li>
</ol>
<h2 id="symptom---requestmultipleobjectswithsamekeyvalue-error">Symptom - Request_MultipleObjectsWithSameKeyValue error</h2>
<p>When you try to enable user synchronization, you receive an error message similar to the following:</p>
<pre><code>Invoke-MgGraphRequest: PUT
https://graph.microsoft.com/v1.0/policies/crossTenantAccessPolicy/partners/&lt;SourceTenantId&gt;/identitySynchronization
HTTP/1.1 409 Conflict
{
  &quot;error&quot;:{
    &quot;code&quot;:&quot;Request_MultipleObjectsWithSameKeyValue&quot;,
    &quot;message&quot;:&quot;A conflicting object with one or more of the specified property values is present in the directory.&quot;,
    &quot;details&quot;:[
      {
        &quot;code&quot;:&quot;ConflictingObjects&quot;,
        &quot;message&quot;:&quot;A conflicting object with one more of the specified property values is present in the directory.&quot;
      }
    ]
  }
}
</code></pre><h3 id="cause-7">Cause</h3>
<p>You are likely trying to create a policy that already exists, possibly from a previous configuration.</p>
<h3 id="solution-7">Solution</h3>
<ol>
<li><p>Verify your syntax and that you are using the correct tenant ID.</p>
</li>
<li><p>Use the <code>Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization</code> command to list the <code>IsSyncAllowed</code> setting.</p>
<pre><code class="lang-PowerShell">Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization -CrossTenantAccessPolicyConfigurationPartnerTenantId $SourceTenantId.UserSyncInbound
</code></pre></li>
<li><p>If you have an existing policy, you might need to make an update using <code>Set-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization</code> command to enable user synchronization.</p>
</li>
</ol>
<h2 id="powershell-2">PowerShell</h2>
<pre><code class="lang-powershell">$Params = @{
    userSyncInbound = @{
        isSyncAllowed = $true
    }
}
Set-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization -CrossTenantAccessPolicyConfigurationPartnerTenantId $SourceTenantId -BodyParameter $Params
</code></pre><h2 id="next-steps-13">Next steps</h2>
<ul>
<li>Microsoft Entra synchronization API overview</li>
<li>Tutorial: Develop and plan provisioning for a SCIM endpoint in Microsoft Entra ID</li>
</ul>
<h2 id="scoping-users-or-groups-to-be-provisioned-with-scoping-filters">Scoping users or groups to be provisioned with scoping filters</h2>
<p>Article • 01/18/2024</p>
<p>Learn how to use scoping filters in the Microsoft Entra provisioning service to define attribute based rules. The rules are used to determine which users or groups are provisioned.</p>
<h3 id="scoping-filter-use-cases">Scoping filter use cases</h3>
<p>You use scoping filters to prevent objects in applications that support automated user provisioning from being provisioned if an object doesn&#39;t satisfy your business requirements. A scoping filter allows you to include or exclude any users who have an attribute that matches a specific value. For example, when provisioning users from Microsoft Entra ID to a SaaS application used by a sales team, you can specify that only users with a &quot;Department&quot; attribute of &quot;Sales&quot; should be in scope for provisioning.</p>
<p>Scoping filters can be used differently depending on the type of provisioning connector:</p>
<ul>
<li><p><strong>Outbound provisioning from Microsoft Entra ID to SaaS applications.</strong> When Microsoft Entra ID is the source system, user and group assignments are the most common method for determining which users are in scope for provisioning. These assignments also are used for enabling single sign-on and provide a single method to manage access and provisioning. Scoping filters can be used optionally, in addition to assignments or instead of them, to filter users based on attribute values.</p>
<blockquote><p><strong>Tip</strong></p>
<p>The more users and groups in scope for provisioning, the longer the synchronization process can take. Setting the scope to sync assigned users and groups, limiting the number of groups assigned to the app, and limiting the size of the groups will reduce the time it takes to synchronize everyone that is in scope.</p>
</blockquote>
</li>
<li><p><strong>Inbound provisioning from HCM applications to Microsoft Entra ID and Active Directory.</strong> When an HCM application such as Workday is the source system, scoping filters are the primary method for determining which users should be provisioned from the HCM application to Active Directory or Microsoft Entra ID.</p>
</li>
</ul>
<h2 id="scoping-filter-construction">Scoping filter construction</h2>
<p>A scoping filter consists of one or more <strong>clauses</strong>. Clauses determine which users are allowed to pass through the scoping filter by evaluating each user&#39;s attributes. For example, you might have one clause that requires that a user&#39;s &quot;State&quot; attribute equals &quot;New York&quot;, so only New York users are provisioned into the application.</p>
<p>A single clause defines a single condition for a single attribute value. If multiple clauses are created in a single scoping filter, they&#39;re evaluated together using &quot;AND&quot; logic. The &quot;AND&quot; logic means all clauses must evaluate to &quot;true&quot; in order for a user to be provisioned.</p>
<p>Finally, multiple scoping filters can be created for a single application. If multiple scoping filters are present, they&#39;re evaluated together by using &quot;OR&quot; logic. The &quot;OR&quot; logic means that if all the clauses in any of the configured scoping filters evaluate to &quot;true&quot;, the user is provisioned.</p>
<p>Each user or group processed by the Microsoft Entra provisioning service is always evaluated individually against each scoping filter.</p>
<h3 id="example-of-a-scoping-filter-configuration">Example of a scoping filter configuration:</h3>
<pre><code class="lang-mermaid">flowchart TD
    A([New York Engineering]) --&gt;|city EQUALS New York| B((Department EQUALS Engineering))
    B --&gt; C{employeeId extension RESEARCH MATCH}
    C --&gt;|jobTitle IS NOT NULL| D[Provisioned]
</code></pre><p>According to this scoping filter, users must satisfy the following criteria to be provisioned:</p>
<ul>
<li>They must be in New York.</li>
</ul>
<h2 id="create-scoping-filters">Create scoping filters</h2>
<p>Scoping filters are configured as part of the attribute mappings for each Microsoft Entra user provisioning connector. The following procedure assumes that you already set up automatic provisioning for one of the supported applications and are adding a scoping filter to it.</p>
<h3 id="create-a-scoping-filter">Create a scoping filter</h3>
<h4 id="tip">Tip</h4>
<p>Steps in this article might vary slightly based on the portal you start from.</p>
<ol>
<li>Sign in to the Microsoft Entra admin center as at least a Application Administrator.</li>
<li>Browse to Identity &gt; Applications &gt; Enterprise applications &gt; All applications.</li>
<li>Select the application for which you have configured automatic provisioning: for example, &quot;ServiceNow&quot;.</li>
<li>Select the Provisioning tab.</li>
<li>In the Mappings section, select the mapping that you want to configure a scoping filter for: for example, &quot;Synchronize Microsoft Entra users to ServiceNow&quot;.</li>
<li>Select the Source object scope menu.</li>
<li>Select Add scoping filter.</li>
<li>Define a clause by selecting a source Attribute Name, an Operator, and an Attribute Value to match against. The following operators are supported:<ul>
<li><code>&amp;</code> Clause returns &quot;true&quot; if the evaluated attribute exists in the input string value.</li>
<li><code>!&amp;</code> Clause returns &quot;true&quot; if the evaluated attribute does not exist in the input string value.</li>
</ul>
</li>
</ol>
<h3 id="criteria-for-scope-filter-application">Criteria for Scope Filter Application</h3>
<ul>
<li>They must work in the Engineering department.</li>
<li>Their company employee ID must be between 1,000,000 and 2,000,000.</li>
<li>Their job title must not be null or empty.</li>
</ul>
<h3 id="c-endswith">C. ENDS_WITH</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute ends with the input string value.</p>
<h3 id="d-equals">D. EQUALS</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute matches the input string value exactly (case sensitive).</p>
<h3 id="e-greaterthan">E. Greater_Than</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute is greater than the value. The value specified on the scoping filter must be an integer and the attribute on the user must be an integer [0,1,2,...].</p>
<h3 id="f-greaterthanorequals">F. Greater_Than_OR_EQUALS</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute is greater than or equal to the value. The value specified on the scoping filter must be an integer and the attribute on the user must be an integer [0,1,2,...].</p>
<h3 id="g-includes">G. Includes</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute contains the string value (case sensitive) as described here.</p>
<h3 id="h-isfalse">H. IS_FALSE</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute contains a Boolean value of false.</p>
<h3 id="i-isnotnull">I. IS_NOT_NULL</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute isn&#39;t empty.</p>
<h3 id="j-isnull">J. IS_NULL</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute is empty.</p>
<h3 id="k-istrue">K. IS_TRUE</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute contains a Boolean value of true.</p>
<h3 id="l-notequals">L. NOT_EQUALS</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute doesn&#39;t match the input string value (case sensitive).</p>
<h3 id="m-notregexmatch">M. NOT_REGEX_MATCH</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute doesn&#39;t match a regular expression pattern. It returns &quot;false&quot; if the attribute is null / empty.</p>
<h3 id="n-regexmatch">N. REGEX_MATCH</h3>
<p>Clause returns &quot;true&quot; if the evaluated attribute matches a regular expression pattern. For example: <code>([1-9][0-9])</code> matches any number between 10 and 99 (case sensitive).</p>
<h3 id="important">Important</h3>
<ul>
<li>The IsMemberOf filter is not supported currently.</li>
<li>The members attribute on a group is not supported currently.</li>
<li>Filtering is not supported for multi-valued attributes.</li>
<li>Scoping filters will return &quot;false&quot; if the value is null / empty.</li>
</ul>
<h2 id="steps-for-configuring-scoping-filters">Steps for Configuring Scoping Filters</h2>
<ol>
<li><p>Optionally, repeat steps 7-8 to add more scoping clauses.</p>
</li>
<li><p>In <strong>Scoping Filter Title</strong>, add a name for your scoping filter.</p>
</li>
<li><p>Select OK.</p>
</li>
<li><p>Select OK again on the <strong>Scoping Filters</strong> screen. Optionally, repeat steps 6-11 to add another scoping filter.</p>
</li>
<li><p>Select Save on the <strong>Attribute Mapping</strong> screen.</p>
</li>
</ol>
<h3 id="important-note">Important Note</h3>
<p>Saving a new scoping filter triggers a new full sync for the application, where all users in the source system are evaluated again against the new scoping filter. If a user in the application was previously in scope for provisioning, but falls out of scope, their account is disabled or deprovisioned in the application. To override this default behavior, refer to <a href="#">Skip deletion for user accounts that go out of scope</a>.</p>
<h2 id="common-scoping-filters">Common Scoping Filters</h2>
<table>
<thead>
<tr>
<th>Target Attribute</th>
<th>Operator</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>userPrincipalName</td>
<td>REGEX MATCH</td>
<td><code>.*@domain.com</code></td>
<td>All users with <code>userPrincipalName</code> that have the domain <code>@domain.com</code> are in scope for provisioning.</td>
</tr>
<tr>
<td>userPrincipalName</td>
<td>NOT REGEX MATCH</td>
<td><code>.*@domain.com</code></td>
<td>All users with <code>userPrincipalName</code> that has the domain <code>@domain.com</code> are out of scope for provisioning.</td>
</tr>
<tr>
<td>department</td>
<td>EQUALS</td>
<td><code>sales</code></td>
<td>All users from the sales department are in scope for provisioning.</td>
</tr>
<tr>
<td>workerID</td>
<td>REGEX MATCH</td>
<td><code>([1-9][0-9][0-9][0-9][0-9][0-9])-([0-9][0-9][0-9][0-9])</code></td>
<td>All employees with <code>workerID</code> between 100000 and 200000 are in scope for provisioning.</td>
</tr>
</tbody>
</table>
<h2 id="related-articles">Related articles</h2>
<ul>
<li>Automate user provisioning and deprovisioning to SaaS applications</li>
</ul>
<h2 id="user-provisioning-guide">User Provisioning Guide</h2>
<ul>
<li>Customize attribute mappings for user provisioning</li>
<li>Write expressions for attribute mappings</li>
<li>Account provisioning notifications</li>
<li>Use SCIM to enable automatic provisioning of users and groups from Microsoft Entra ID to applications</li>
<li>List of tutorials on how to integrate SaaS apps</li>
</ul>
<h2 id="enable-accidental-deletions-prevention-in-the-microsoft-entra-provisioning-service">Enable accidental deletions prevention in the Microsoft Entra provisioning service</h2>
<p><strong>Article • 10/23/2023</strong></p>
<p>The Microsoft Entra provisioning service includes a feature to help avoid accidental deletions. This feature ensures that users aren&#39;t disabled or deleted in an application unexpectedly.</p>
<p>You use accidental deletions to specify a deletion threshold. Anything above the threshold that you set requires an admin to explicitly allow the processing of the deletions.</p>
<h3 id="configure-accidental-deletion-prevention">Configure accidental deletion prevention</h3>
<p>To enable accidental deletion prevention:</p>
<ol>
<li>Sign in to the Microsoft Entra admin center as at least a <strong>Application Administrator</strong>.</li>
<li>Browse to <strong>Identity &gt; Applications &gt; Enterprise applications</strong>.</li>
<li>Select your application.</li>
<li>Select <strong>Provisioning</strong> and then on the provisioning page select <strong>Edit provisioning</strong>.<ol>
<li>Under <strong>Settings</strong>, select the <strong>Prevent accidental deletions</strong> check box and specify a deletion threshold.</li>
<li>Ensure the <strong>Notification Email</strong> address is completed. If the deletion threshold is met, an email is sent.</li>
<li>Select <strong>Save</strong> to save the changes.</li>
</ol>
</li>
</ol>
<p>When the deletion threshold is met, the job goes into quarantine, and a notification email is sent. The quarantined job can then be allowed or rejected. To learn more about quarantine behavior, see <a href="#">Application provisioning in quarantine status</a>.</p>
<h3 id="recovering-from-an-accidental-deletion">Recovering from an accidental deletion</h3>
<p>When you encounter an accidental deletion, you see it on the provisioning status page. It says <strong>Provisioning has been quarantined</strong>. See <a href="#">quarantine details for more information</a>.</p>
<h2 id="allowing-deletions">Allowing deletions</h2>
<p>The <strong>Allow deletes</strong> action deletes the objects that triggered the accidental delete threshold. Use the procedure to accept the deletions.</p>
<ol>
<li>Select <strong>Allow deletes</strong>.</li>
<li>Click <strong>Yes</strong> on the confirmation to allow the deletions.</li>
<li>View the confirmation that the deletions were accepted. The status returns to healthy with the next cycle.</li>
</ol>
<h2 id="rejecting-deletions">Rejecting deletions</h2>
<p>Investigate and reject deletions as necessary:</p>
<ul>
<li>Investigate the source of the deletions. You can use the provisioning logs for details.</li>
<li>Prevent the deletion by assigning the user / group to the application (or configuration) again, restoring the user / group, or updating your provisioning configuration.</li>
<li>Once you&#39;ve made the necessary changes to prevent the user / group from being deleted, restart provisioning. Don&#39;t restart provisioning until you&#39;ve made the necessary changes to prevent the users / groups from being deleted.</li>
</ul>
<h2 id="test-deletion-prevention">Test deletion prevention</h2>
<p>You can test the feature by triggering disable / deletion events by setting the threshold to a low number, for example, 3, and then changing scoping filters, unassigning users, and deleting users from the directory (see common scenarios in next section).</p>
<p>Let the provisioning job run (20 – 40 mins) and navigate back to the provisioning page. Check the provisioning job in quarantine and choose to allow the deletions or review the provisioning logs to understand why the deletions occurred.</p>
<h2 id="common-deprovisioning-scenarios-to-test">Common deprovisioning scenarios to test</h2>
<ul>
<li>Delete a user / put them into the recycle bin.</li>
<li>Block sign in for a user.</li>
<li>Unassign a user or group from the application (or configuration).</li>
</ul>
<h2 id="frequently-asked-questions-1">Frequently Asked Questions</h2>
<h3 id="what-scenarios-count-toward-the-deletion-threshold">What scenarios count toward the deletion threshold?</h3>
<p>When a user is set for removal from the target application (or target tenant), it&#39;s counted against the deletion threshold. Scenarios that could lead to a user being removed from the target application (or target tenant) could include: unassigning the user from the application (or configuration) and soft / hard deleting a user in the directory. Groups evaluated for deletion count towards the deletion threshold. In addition to deletions, the same functionality also works for disables.</p>
<h3 id="what-is-the-interval-that-the-deletion-threshold-is-evaluated-on">What is the interval that the deletion threshold is evaluated on?</h3>
<p>It&#39;s evaluated each cycle. If the number of deletions doesn&#39;t exceed the threshold during a single cycle, the “circuit breaker” isn&#39;t triggered. If multiple cycles are needed to reach a steady state, the deletion threshold is evaluated per cycle.</p>
<h3 id="how-are-these-deletion-events-logged">How are these deletion events logged?</h3>
<p>You can find users that should be disabled / deleted but haven’t due to the deletion threshold. Navigation to Provisioning logs and then filter Action with StagedAction or StagedDelete.</p>
<h2 id="next-steps-14">Next steps</h2>
<ul>
<li>How application provisioning works</li>
<li>Plan an application provisioning deployment</li>
</ul>
<h2 id="feedback-1">Feedback</h2>
<p>Was this page helpful?<br><a href="">Yes</a> <a href="">No</a></p>
<h2 id="provide-product-feedback">Provide Product Feedback</h2>
<p>Visit <em>Microsoft Q&amp;A</em> for support and to give feedback.</p>
<h2 id="on-demand-provisioning-in-microsoft-entra-id">On-demand provisioning in Microsoft Entra ID</h2>
<p>Article • 10/23/2023</p>
<p>Use on-demand provisioning to provision a user or group in seconds. Among other things, you can use this capability to:</p>
<ul>
<li>Troubleshoot configuration issues quickly.</li>
<li>Validate expressions that you&#39;ve defined.</li>
<li>Test scoping filters.</li>
</ul>
<h3 id="how-to-use-on-demand-provisioning">How to use on-demand provisioning</h3>
<blockquote><p><strong>Tip</strong><br>Steps in this article may vary slightly based on the portal you start from.</p>
</blockquote>
<ol>
<li>Sign in to the <a href="https://portal.microsoft.com">Microsoft Entra admin center</a> as at least a Application Administrator.</li>
<li>Browse to Identity &gt; Applications &gt; Enterprise applications &gt; select your application.</li>
<li>Select Provisioning.</li>
<li>Configure provisioning by providing your admin credentials.</li>
<li>Select <strong>Provision on demand</strong>.</li>
<li>Search for a user by first name, last name, display name, user principal name, or email address. Alternatively, you can search for a group and pick up to five users.</li>
</ol>
<blockquote><p><strong>Note</strong><br>For Cloud HR provisioning app (Workday / SuccessFactors to Active Directory / Microsoft Entra ID), the input value is different. For Workday scenario, please provide &quot;WorkerID&quot; or &quot;WID&quot; of the user in Workday. For SuccessFactors scenario, please provide &quot;personIdExternal&quot; of the user in SuccessFactors.</p>
</blockquote>
<ol>
<li>Select <strong>Provision</strong> at the bottom of the page.</li>
</ol>
<h2 id="understand-the-provisioning-steps">Understand the provisioning steps</h2>
<p>The on-demand provisioning process attempts to show the steps that the provisioning service takes when provisioning a user. There are typically five steps to provision a user. One or more of those steps, explained in the following sections, are shown during the on-demand provisioning experience.</p>
<h3 id="step-1-test-connection">Step 1: Test connection</h3>
<p>The provisioning service attempts to authorize access to the target system by making a request for a &quot;test user&quot;. The provisioning service expects a response that indicates that the service authorized to continue with the provisioning steps. This step is shown only when it fails. It&#39;s not shown during the on-demand provisioning experience when the step is successful.</p>
<h4 id="troubleshooting-tips-2">Troubleshooting tips</h4>
<ul>
<li>Ensure that you&#39;ve provided valid credentials, such as the secret token and tenant URL, to the target system. The required credentials vary by application. For detailed configuration tutorials, see the <a href="link">tutorial list</a>.</li>
<li>Make sure that the target system supports filtering on the matching attributes defined in the Attribute mappings pane. You might need to check the API documentation provided by the application developer to understand the supported filters.</li>
<li>For System for Cross-domain Identity Management (SCIM) applications, you can use a tool like Postman. Such tools help you ensure that the application responds appropriately.</li>
</ul>
<h2 id="step-2-import-user">Step 2: Import user</h2>
<p>Next, the provisioning service retrieves the user from the source system. The user attributes that the service retrieves are used later to:</p>
<ul>
<li>Evaluate whether the user is in scope for provisioning.</li>
<li>Check the target system for an existing user.</li>
<li>Determine what user attributes to export to the target system.</li>
</ul>
<h3 id="view-details">View details</h3>
<p>The View details section shows the properties of the user that were imported from the source system (for example, Microsoft Entra ID).</p>
<h2 id="troubleshooting-tips-3">Troubleshooting tips</h2>
<ul>
<li>Importing the user can fail when the matching attribute is missing on the user object in the source system. To resolve this failure, try one of these approaches:<ul>
<li>Update the user object with a value for the matching attribute.</li>
<li>Change the matching attribute in your provisioning configuration.</li>
</ul>
</li>
<li>If an attribute that you expected is missing from the imported list, ensure that the attribute has a value on the user object in the source system. The provisioning service currently doesn&#39;t support provisioning null attributes.</li>
<li>Make sure that the Attribute mapping page of your provisioning configuration contains the attribute that you expect.</li>
</ul>
<h2 id="step-3-determine-if-user-is-in-scope">Step 3: Determine if user is in scope</h2>
<p>Next, the provisioning service determines whether the user is in scope for provisioning. The service considers aspects such as:</p>
<ul>
<li>Whether the user is assigned to the application.</li>
<li>Whether scope is set to Sync assigned or Sync all.</li>
<li>The scoping filters defined in your provisioning configuration.</li>
</ul>
<h3 id="view-details-1">View details</h3>
<h2 id="view-details-2">View details</h2>
<p>The View details section shows the scoping conditions that were evaluated. You might see one or more of the following properties:</p>
<ul>
<li><strong>Active in source system</strong> indicates that the user has the property <code>IsActive</code> set to true in Microsoft Entra ID.</li>
<li><strong>Assigned to application</strong> indicates that the user is assigned to the application in Microsoft Entra ID.</li>
<li><strong>Scope sync all</strong> indicates that the scope setting allows all users and groups in the tenant.</li>
<li><strong>User has required role</strong> indicates that the user has the necessary roles to be provisioned into the application.</li>
<li>Scoping filters are also shown if you have defined scoping filters for your application. The filter is displayed with the following format: {scoping filter title} {scoping filter attribute} {scoping filter operator} {scoping filter value}.</li>
</ul>
<h3 id="troubleshooting-tips-4">Troubleshooting tips</h3>
<ul>
<li>Make sure that you&#39;ve defined a valid scoping role. For example, avoid using the Greater_Than operator with a noninteger value.</li>
<li>If the user doesn&#39;t have the necessary role, review the tips for provisioning users assigned to the default access role.</li>
</ul>
<h2 id="step-4-match-user-between-source-and-target">Step 4: Match user between source and target</h2>
<p>In this step, the service attempts to match the user that was retrieved in the import step with a user in the target system.</p>
<h3 id="view-details-3">View details</h3>
<p>The View details page shows the properties of the users that were matched in the target system. The context pane changes as follows:</p>
<ul>
<li>If no users are matched in the target system, no properties are shown.</li>
<li>If one user matches in the target system, the properties of that user are shown.</li>
<li>If multiple users match, the properties of both users are shown.</li>
<li>If multiple matching attributes are part of your attribute mappings, each matching attribute is evaluated sequentially and the matched users for that attribute are shown.</li>
</ul>
<h3 id="troubleshooting-tips-5">Troubleshooting tips</h3>
<ul>
<li>Ensure all matching attributes are accurately configured.</li>
<li>Verify that attribute mappings are correctly set up to prevent mismatches.</li>
<li>Regularly update the attribute mappings to reflect any changes in the source or target systems.</li>
</ul>
<h2 id="step-5-perform-action">Step 5: Perform action</h2>
<p>Finally, the provisioning service takes an action, such as creating, updating, deleting, or skipping the user.</p>
<p>Here&#39;s an example of what you might see after the successful on-demand provisioning of a user:</p>
<ul>
<li>Screenshot description: Provision on demand window in a browser showing a group&#39;s details after an action has been taken. Includes elements like operation status, user list and their respective statuses among other details.</li>
</ul>
<h2 id="view-details-4">View details</h2>
<p>The View details section displays the attributes that were modified in the target system. This display represents the final output of the provisioning service activity and the attributes that were exported. If this step fails, the attributes displayed represent the attributes that the provisioning service attempted to modify.</p>
<h2 id="troubleshooting-tips-6">Troubleshooting tips</h2>
<ul>
<li>Failures for exporting changes can vary greatly. Check the documentation for provisioning logs for common failures.</li>
<li>On-demand provisioning says the group or user can&#39;t be provisioned because they&#39;re not assigned to the application. There&#39;s a replication delay of up to a few minutes.</li>
</ul>
<h2 id="frequently-asked-questions-2">Frequently Asked Questions</h2>
<h3 id="do-you-need-to-turn-provisioning-off-to-use-on-demand-provisioning">Do you need to turn provisioning off to use on-demand provisioning?</h3>
<p>For applications that use a long-lived bearer token or a user name and password for authorization, no more steps are required. Applications that use OAuth for authorization currently require the provisioning job to be stopped before using on-demand provisioning. Applications such as G Suite, Box, Workplace by Facebook, and Slack fall into this category. Work is in progress to support on-demand provisioning for all applications without having to stop provisioning jobs.</p>
<h3 id="how-long-does-on-demand-provisioning-take">How long does on-demand provisioning take?</h3>
<p>On-demand provisioning typically takes less than 30 seconds.</p>
<h2 id="known-limitations">Known Limitations</h2>
<p>There are currently a few known limitations to on-demand provisioning. Post your suggestions and feedback so we can better determine what improvements to make next.</p>
<blockquote><p><strong>Note</strong>
The following limitations are specific to the on-demand provisioning capability. For information about whether an application supports provisioning groups, deletions, or other capabilities, check the tutorial for that application.</p>
</blockquote>
<ul>
<li>On-demand provisioning of groups supports updating up to five members at a time. Connectors for cross-tenant synchronization, Workday, etc. do not support group provisioning and as a result do not support on-demand provisioning of groups.</li>
<li>On-demand provisioning supports provisioning one user at a time through the Microsoft Entra admin center.</li>
<li>Restoring a previously soft-deleted user in the target tenant with on-demand provisioning isn&#39;t supported. If you try to soft-delete a user with on-demand provisioning and then restore the user, it can result in duplicate users.</li>
<li>On-demand provisioning of roles isn&#39;t supported.</li>
</ul>
<h2 id="limitations">Limitations</h2>
<ul>
<li>On-demand provisioning supports disabling users that have been unassigned from the application. However, it doesn&#39;t support disabling or deleting users that have been disabled or deleted from Microsoft Entra ID. Those users don&#39;t appear when you search for a user.</li>
<li>On-demand provisioning doesn&#39;t support nested groups that aren&#39;t directly assigned to the application.</li>
<li>The on-demand provisioning request API can only accept a single group with up to 5 members at a time.</li>
</ul>
<h2 id="next-steps-15">Next steps</h2>
<ul>
<li>Troubleshooting provisioning</li>
</ul>
<h2 id="feedback-2">Feedback</h2>
<p>Was this page helpful?</p>
<p><a href="">Yes</a> <a href="">No</a> </p>
<p><a href="">Provide product feedback</a> | <a href="">Get help at Microsoft Q&amp;A</a></p>
<h2 id="what-are-the-microsoft-entra-user-provisioning-logs">What are the Microsoft Entra user provisioning logs?</h2>
<p>Article • 01/25/2024</p>
<p>Microsoft Entra ID integrates with several third party services to provision users into your tenant. If you need to troubleshoot an issue with a provisioned user, you can use the information captured in the Microsoft Entra provisioning logs to help find a solution.</p>
<p>Two other activity logs are also available to help monitor the health of your tenant:</p>
<ul>
<li><strong>Sign-ins</strong> – Information about sign-ins and how your resources are used by your users.</li>
<li><strong>Audit</strong> – Information about changes applied to your tenant such as users and group management or updates applied to your tenant’s resources.</li>
</ul>
<p>This article gives you an overview of the user provisioning logs.</p>
<h2 id="license-and-role-requirements">License and role requirements</h2>
<p>The required roles and licenses might vary based on the report. Global Administrator can access all reports, but we recommend using a role with least privilege access to align with the Zero Trust guidance.</p>
<h3 id="log--report">Log / Report</h3>
<table>
<thead>
<tr>
<th>Log / Report</th>
<th>Roles</th>
<th>Licenses</th>
</tr>
</thead>
<tbody>
<tr>
<td>Audit</td>
<td>Report Reader<br>Security Reader<br>Security Administrator<br>Global Reader<br>A custom role with AuditLogsRead or CustomSecAuditLogsRead permission</td>
<td>All editions of Microsoft Entra ID</td>
</tr>
<tr>
<td>Sign-ins</td>
<td>Report Reader<br>Security Reader<br>Security Administrator<br>Global Reader<br>A custom role with SignInLogsRead permission</td>
<td>All editions of Microsoft Entra ID</td>
</tr>
<tr>
<td>Provisioning</td>
<td>Same as audit and sign-ins, plus<br>Security Operator<br>Application Administrator<br>Cloud App Administrator</td>
<td>Microsoft Entra ID P1/P2</td>
</tr>
</tbody>
</table>
<h2 id="log--report-access">Log / Report Access</h2>
<h3 id="roles-and-licenses">Roles and Licenses</h3>
<table>
<thead>
<tr>
<th>Log / Report</th>
<th>Roles</th>
<th>Licenses</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Log / Report</strong></td>
<td><strong>Roles</strong></td>
<td><strong>Licenses</strong></td>
</tr>
<tr>
<td>A custom role with <code>ProvisioningLogsRead</code> permission</td>
<td>Security Reader<br>Reports Reader<br>Security Administrator</td>
<td>Microsoft Entra ID P1/P2</td>
</tr>
<tr>
<td>Identity Protection*</td>
<td>Security Administrator<br>Security Operator<br>Security Reader<br>Global Reader<br>A custom role with <code>IdentityRiskEventReadWrite</code> permission</td>
<td>Microsoft Entra ID Free<br>Microsoft 365 Apps<br>Microsoft Entra ID P1/P2</td>
</tr>
<tr>
<td>Microsoft Graph activity logs</td>
<td>Security Administrator<br>A custom role with <code>ListKeys</code> permission</td>
<td>Microsoft Entra ID P1/P2</td>
</tr>
</tbody>
</table>
<blockquote><p>*The level of access and capabilities for Identity Protection varies with the role and license. For more information, see the <a href="#">license requirements for Identity Protection</a>.</p>
</blockquote>
<h2 id="what-can-you-do-with-the-provisioning-logs">What can you do with the provisioning logs?</h2>
<p>You can use the provisioning logs to find answers to questions like:</p>
<ul>
<li>What groups were successfully created in ServiceNow?</li>
<li>What users were successfully removed from Adobe?</li>
<li>What users from Workday were successfully created in Active Directory?</li>
</ul>
<blockquote><p><strong>Note:</strong> Entries in the provisioning logs are system generated and can&#39;t be changed or deleted.</p>
</blockquote>
<h2 id="what-do-the-logs-show">What do the logs show?</h2>
<p>When you select an item in the provisioning list view, you get more details about this item, such as the steps taken to provision the user and tips for troubleshooting issues. The details are grouped into four tabs.</p>
<ul>
<li><strong>Steps:</strong> This tab outlines the steps taken to provision an object. Provisioning an object can include the following steps, but not all steps are applicable to all provisioning events.</li>
</ul>
<h2 id="object-synchronization-steps">Object Synchronization Steps</h2>
<ul>
<li>Import the object.</li>
<li>Match the object between source and target.</li>
<li>Determine if the object is in scope.</li>
<li>Evaluate the object before synchronization.</li>
<li>Provision the object (create, update, delete, or disable).</li>
</ul>
<h3 id="summary">Summary</h3>
<p>Provides an overview of what happened and identifiers for the object in the source and target systems.</p>
<h3 id="troubleshooting--recommendations">Troubleshooting &amp; Recommendations</h3>
<p>If there was an error, this tab provides the error code and reason.</p>
<h3 id="modified-properties">Modified Properties</h3>
<p>If there were changes, this tab shows the old value and the new value.</p>
<h3 id="example-of-provisioning-user-in-box">Example of Provisioning User in Box</h3>
<table>
<thead>
<tr>
<th>EntryExportAdd</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Result</td>
<td>Success</td>
</tr>
<tr>
<td>Description</td>
<td>User &#39;cheryl@f12.info&#39; was created in Box</td>
</tr>
<tr>
<td>ReportableIdentifier</td>
<td>cheryl@f12.info</td>
</tr>
</tbody>
</table>
<h2 id="map-directory-extensions-in-cross-tenant-synchronization">Map directory extensions in cross-tenant synchronization</h2>
<p>Article · 01/30/2024</p>
<p>Directory extensions enable you to extend the schema in Microsoft Entra ID with your own attributes. You can map these directory extensions when provisioning users in cross-tenant synchronization. Custom security attributes are different and aren&#39;t supported in cross-tenant synchronization.</p>
<p>This article describes how to map directory extensions in cross-tenant synchronization.</p>
<h3 id="prerequisites-4">Prerequisites</h3>
<ul>
<li>Hybrid Identity Administrator role to configure cross-tenant synchronization.</li>
<li>Cloud Application Administrator or Application Administrator role to assign users to a configuration and to delete a configuration.</li>
</ul>
<h3 id="create-directory-extensions">Create directory extensions</h3>
<p>If you don&#39;t already have directory extensions, you must create one or more directory extensions in the source or target tenant. You can create extensions using Microsoft Entra Connect or Microsoft Graph API. For information on how to create directory extensions, see Syncing extension attributes for Microsoft Entra Application Provisioning.</p>
<h3 id="map-directory-extensions">Map directory extensions</h3>
<h4 id="source-tenant-16">Source tenant</h4>
<p>Once you have one or more directory extensions, you can use them when mapping attributes in cross-tenant synchronization.</p>
<ol>
<li>Sign in to the Microsoft Entra admin center of the source tenant.</li>
<li>Browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</li>
<li>Select Configurations and then select your configuration.</li>
<li>Select Provisioning and expand the Mappings section.</li>
</ol>
<h2 id="fabrikam-to-contoso--provisioning">Fabrikam to Contoso | Provisioning</h2>
<h3 id="overview-9">Overview</h3>
<p><strong>Manage</strong></p>
<ul>
<li>Users and groups<ul>
<li>Provision on demand</li>
</ul>
</li>
<li>Mappings<ul>
<li>Allow data flow between Microsoft Entra ID and Azure Active Directory (target tenant).
<code>markdown
Name: Provision Microsoft Entra ID Users
Enabled: Yes</code></li>
</ul>
</li>
</ul>
<p><strong>Activity</strong></p>
<ul>
<li>Audit logs</li>
<li>Provisioning logs</li>
<li>Insights</li>
</ul>
<p><strong>Troubleshooting + Support</strong></p>
<ul>
<li>New support request</li>
</ul>
<p><strong>Settings</strong></p>
<ul>
<li>Provisioning Status: On / Off</li>
</ul>
<h3 id="instructions-2">Instructions</h3>
<ol>
<li><p><strong>Select <code>Provision Microsoft Entra ID Users</code> to open the Attribute Mapping page.</strong></p>
</li>
<li><p><strong>Scroll to the bottom of the page and select <code>Add new mapping</code>.</strong></p>
</li>
</ol>
<h3 id="attribute-mapping-1">Attribute Mapping</h3>
<table>
<thead>
<tr>
<th>Source Attribute</th>
<th>Mapping</th>
</tr>
</thead>
<tbody>
<tr>
<td>preferredlanguage</td>
<td>preferredlanguage</td>
</tr>
<tr>
<td>surname</td>
<td>surname</td>
</tr>
<tr>
<td>telephoneNumber</td>
<td>telephoneNumber</td>
</tr>
<tr>
<td>userPrincipalName</td>
<td>userPrincipalName</td>
</tr>
<tr>
<td>true</td>
<td>showinAddressList</td>
</tr>
<tr>
<td>mail</td>
<td>mail</td>
</tr>
<tr>
<td>Member</td>
<td>userType</td>
</tr>
</tbody>
</table>
<ol>
<li><strong>In the Source attribute drop-down list, select a source attribute.</strong><ul>
<li>If a directory extension exists in the source tenant, select the directory extension.</li>
</ul>
</li>
</ol>
<h2 id="edit-attribute-1">Edit Attribute</h2>
<p>A mapping lets you define how the attributes in one class of Microsoft Entra object (e.g. Users) should flow to and from this application.</p>
<p><strong>Mapping Type:</strong> <em>Direct</em></p>
<p><strong>Source Attribute:</strong></p>
<ul>
<li>employeeHireDate</li>
<li>employeeId</li>
<li>employeeLeaveDateTime</li>
<li>employeeOrgData.costCenter</li>
<li>employeeOrgData.division</li>
<li>employeeType</li>
<li>testExtension (extension_c44d2dc1add4fd32f924e8de5c3937_testExtension)</li>
<li>extensionAttribute1</li>
<li>extensionAttribute10</li>
</ul>
<p>If the directory extension isn&#39;t listed, make sure that the directory extension was created successfully. You can also try to manually add the directory extension to the attribute list as described in the next section.</p>
<ol>
<li>In the <strong>Target attribute</strong> drop-down list, select a target attribute.</li>
<li>If you created a directory extension in the target tenant, select the directory extension.</li>
<li>Select <strong>Ok</strong> to save the mapping.</li>
</ol>
<h3 id="manually-add-directory-extensions-to-the-attribute-list">Manually add directory extensions to the attribute list</h3>
<p><strong>Source tenant</strong></p>
<p>If your directory extension wasn&#39;t automatically discovered, you can try the following steps to manually add the directory extension to the attribute list.</p>
<ol>
<li>Sign in to the Microsoft Entra admin center of the source tenant using the following link:</li>
</ol>
<h2 id="configuring-microsoft-entra-identity-synchronization">Configuring Microsoft Entra Identity Synchronization</h2>
<ol>
<li><p>Visit the Microsoft Entra admin page:</p>
<pre><code>https://entra.microsoft.com/?Microsoft_AAD_Connect_Provisioning_forceSchemaEditorEnabled=true
</code></pre></li>
<li><p>Navigate through the following path:</p>
<ul>
<li><strong>Identity &gt; External Identities &gt; Cross-tenant synchronization</strong></li>
</ul>
</li>
<li><p>Choose <strong>Configurations</strong> and then select your configuration.</p>
</li>
<li><p>Go to <strong>Provisioning</strong> and click on the <strong>Mappings</strong> section to expand it.</p>
</li>
<li><p>Click on <strong>Provision Microsoft Entra ID Users</strong> to open the <strong>Attribute Mapping</strong> page.</p>
</li>
<li><p>At the bottom of the page, select the <strong>Show advanced settings</strong> checkbox.</p>
</li>
</ol>
<h3 id="attribute-mapping-2">Attribute Mapping</h3>
<pre><code>| Source Attribute  | Target Attribute  | Action   |
|-------------------|-------------------|----------|
| userPrincipalName | userPrincipalName | Delete   |
| true              | showinAddresslist | Delete   |
| mail              | mail              | Delete   |
| Member            | userType          | Delete   |
</code></pre><h3 id="additional-information">Additional Information</h3>
<ul>
<li><strong>Supported Attributes</strong>: Edit and view the list of attributes for Microsoft Entra ID and for Azure Active Directory (target tenant) using the expression builder.</li>
<li>You can review, download, and edit the JSON representation of your schema here.</li>
</ul>
<h4 id="tip-1">Tip</h4>
<blockquote><p>Ensure you&#39;re signed into Microsoft Entra admin center to access the <strong>Edit attribute list</strong> links.</p>
</blockquote>
<ol>
<li><p>If a directory extension was created in the source tenant, select the <strong>Edit attribute list for Microsoft Entra ID</strong> link.</p>
</li>
<li><p>If an extension was established in the target tenant, access the <strong>Edit attribute list for Azure Active Directory (target tenant)</strong> link.</p>
</li>
<li><p>Proceed to add the directory extension and select the required options.</p>
</li>
</ol>
<h2 id="edit-attribute-list">Edit Attribute List</h2>
<h3 id="steps-1">Steps:</h3>
<ol>
<li><strong>Save</strong>: Click the save button to keep your changes.</li>
<li><strong>Discard</strong>: Click the discard button to ignore any changes made.</li>
</ol>
<h3 id="tips">Tips:</h3>
<ul>
<li>Editing the attribute list informs the provisioning service what attributes exist in your system(s).</li>
<li>Leave &quot;Metadata&quot; blank for new attributes unless instructed by documentation. Requires a JSON-encoded object.</li>
<li>Leave &quot;Reference Object Attribute&quot; blank unless the &quot;Type&quot; is set to &quot;Reference&quot;. Enter referenced attribute in the form of <code>objectName.attributeName</code> or just <code>objectName</code>.</li>
<li>See the online documentation on attribute editing.</li>
</ul>
<h3 id="procedure">Procedure:</h3>
<ol>
<li>Select <strong>Save</strong>.</li>
<li>Refresh the browser.</li>
<li>Navigate to the <strong>Attribute mappings</strong> page and attempt to map the directory extension as described earlier in this article.</li>
</ol>
<h2 id="manually-add-directory-extensions-by-editing-the-schema">Manually add directory extensions by editing the schema</h2>
<h3 id="source-tenant-17">Source tenant</h3>
<p>Follow these steps to manually add directory extensions to the schema via the schema editor.</p>
<ol>
<li>Sign in to the <a href="#">Microsoft Entra admin center</a> of the source tenant.</li>
<li>Navigate to <strong>Identity &gt; External Identities &gt; Cross-tenant synchronization</strong>.</li>
<li>Select <strong>Configurations</strong> and then choose your configuration.</li>
<li>Click on <strong>Provisioning</strong> and expand the <strong>Mappings</strong> section.</li>
<li>Select <strong>Provision Microsoft Entra ID Users</strong> to open the <strong>Attribute Mapping</strong> page.</li>
</ol>
<h2 id="step-by-step-configuration-guide-1">Step-by-Step Configuration Guide</h2>
<h3 id="6-enable-advanced-settings">6. Enable Advanced Settings</h3>
<p>Scroll to the bottom of the screen and select the <strong>Show advanced settings</strong> checkbox under the Attribute Mapping section. This will enable you to access and configure more complex settings.</p>
<h4 id="attribute-mapping-table">Attribute Mapping Table:</h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Mapped Attribute</th>
<th>Options</th>
</tr>
</thead>
<tbody>
<tr>
<td>userPrincipalName</td>
<td>userPrincipalName</td>
<td>Delete</td>
</tr>
<tr>
<td>showInAddressList</td>
<td>true</td>
<td>Delete</td>
</tr>
<tr>
<td>mail</td>
<td>mail</td>
<td>Delete</td>
</tr>
<tr>
<td>userType</td>
<td>Member</td>
<td>Delete</td>
</tr>
</tbody>
</table>
<h3 id="7-schema-review-and-editing">7. Schema Review and Editing</h3>
<p>Select the <strong>Review your schema here</strong> link to open the Schema editor page for advanced configuration. This page allows you to adjust and define the synchronization rules and object mappings through a JSON formatted schema.</p>
<h4 id="json-schema-example">JSON Schema Example:</h4>
<pre><code class="lang-json">{
  &quot;@odata.context&quot;: &quot;https://graph.microsoft.com/beta/$metadata#servicePrincipals&quot;,
  &quot;id&quot;: &quot;Azure2...&quot;,
  &quot;version&quot;: &quot;v1.2&quot;,
  &quot;synchronizationRules&quot;: [
    {
      &quot;containerFilter&quot;: null,
      &quot;editable&quot;: true,
      &quot;id&quot;: &quot;f0f8ff81-9e60-4ed3-b8df-09bbb40d2b7e&quot;,
      &quot;name&quot;: &quot;USER_INBOUND_USER&quot;,
      &quot;priority&quot;: 1,
      &quot;sourceDirectoryName&quot;: &quot;Microsoft Entra ID&quot;,
    }
  ]
}
</code></pre><h3 id="8-schema-backup">8. Schema Backup</h3>
<p>Download an original copy of the schema as a backup to ensure you have a recoverable point in case changes need to be rolled back.</p>
<h3 id="9-modify-the-schema">9. Modify the Schema</h3>
<p>Modify the schema following the specific configurations required for your setup. This step involves changing values or adding new attributes and rules within the JSON structure provided.</p>
<h3 id="10-save-your-changes">10. Save Your Changes</h3>
<p>After finalizing changes in the schema editor, select <strong>Save</strong> to apply all changes made to the attribute mappings and synchronization rules.</p>
<ol>
<li><p>Refresh the browser.</p>
</li>
<li><p>Browse to the Attribute mappings page and try to map the directory extension as described earlier in this article.</p>
</li>
</ol>
<h2 id="next-steps-16">Next steps</h2>
<ul>
<li>Syncing extension attributes for Microsoft Entra Application Provisioning</li>
<li>Configure cross-tenant synchronization</li>
</ul>
<h2 id="reference-for-writing-expressions-for-attribute-mappings-in-microsoft-entra-id">Reference for writing expressions for attribute mappings in Microsoft Entra ID</h2>
<p>Article • 01/26/2024</p>
<p>When you configure provisioning to a SaaS application, one of the types of attribute mappings that you can specify is an expression mapping. For these mappings, you must write a script-like expression that allows you to transform your users&#39; data into formats that are more acceptable for the SaaS application.</p>
<h3 id="syntax-overview">Syntax overview</h3>
<p>The syntax for Expressions for Attribute Mappings is reminiscent of Visual Basic for Applications (VBA) functions.</p>
<ul>
<li><p>The entire expression must be defined in terms of functions, which consist of a name followed by arguments in parentheses: <code>FunctionName(&lt;argument 1&gt;, &lt;argument N&gt;)</code></p>
</li>
<li><p>You can nest functions within each other. For example:
<code>FunctionOne(FunctionTwo(&lt;argument1&gt;))</code></p>
</li>
<li><p>You can pass three different types of arguments into functions:</p>
<ol>
<li>Attributes, which must be enclosed in square brackets. For example:
<code>[attributeName]</code></li>
<li>String constants, which must be enclosed in double quotes. For example:
<code>&quot;United States&quot;</code></li>
<li>Other Functions. For example: <code>FunctionOne(&lt;argument1&gt;), FunctionTwo(&lt;argument2&gt;)</code></li>
</ol>
</li>
<li><p>For string constants, if you need a backslash (<code>\</code>) or quotation mark (<code>&quot;</code>) in the string, it must be escaped with the backslash (<code>\</code>) symbol. For example: <code>&quot;Company name: \&quot;Contoso\&quot;&quot;</code></p>
</li>
<li><p>The syntax is case-sensitive, which must be considered while typing them as strings in a function vs copy pasting them directly from here.</p>
</li>
</ul>
<h3 id="list-of-functions">List of Functions</h3>
<p>[Insert detailed function list and descriptions here, formatted appropriately]</p>
<h2 id="append">Append</h2>
<h3 id="function">Function</h3>
<p>Append(source, suffix)</p>
<h3 id="description">Description</h3>
<p>Takes a source string value and appends the suffix to the end of it.</p>
<h3 id="parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>suffix</td>
<td>Required</td>
<td>String</td>
<td>The string that you want to append to the end of the source value.</td>
</tr>
</tbody>
</table>
<h3 id="append-constant-suffix-to-user-name">Append constant suffix to user name</h3>
<p><strong>Example:</strong> If you&#39;re using a Salesforce Sandbox, you might need to append another suffix to all your user names before synchronizing them.</p>
<p><strong>Expression:</strong> <code>Append([userPrincipalName], &quot;.test&quot;)</code></p>
<p><strong>Sample input/output:</strong></p>
<ul>
<li><strong>INPUT:</strong> (userPrincipalName): &quot;John.Doe@contoso.com&quot;</li>
<li><strong>OUTPUT:</strong> &quot;John.Doe@contoso.com.test&quot;</li>
</ul>
<h2 id="approleassignmentscomplex">AppRoleAssignmentsComplex</h2>
<h3 id="function-1">Function</h3>
<p>AppRoleAssignmentsComplex([appRoleAssignments])</p>
<h2 id="description-1">Description</h2>
<p>Used to configure multiple roles for a user. For detailed usage, see Tutorial - Customize user provisioning attribute-mappings for SaaS applications in Microsoft Entra ID.</p>
<h3 id="parameters-1">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>appRoleAssignments</td>
<td>Required</td>
<td>String</td>
<td>appRoleAssignments object.</td>
</tr>
</tbody>
</table>
<h2 id="bitand">BitAnd</h2>
<h3 id="function-2">Function</h3>
<p>BitAnd(value1, value2)</p>
<h3 id="description-2">Description</h3>
<p>This function converts both parameters to the binary representation and sets a bit to:</p>
<ul>
<li>0 - if one or both of the corresponding bits in value1 and value2 are 0</li>
<li>1 - if both of the corresponding bits are 1.</li>
</ul>
<p>In other words, it returns 0 in all cases except when the corresponding bits of both parameters are 1.</p>
<h3 id="parameters-2">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value1</td>
<td>Required</td>
<td>Num</td>
<td>Numeric value that should be AND&#39;ed with value2</td>
</tr>
<tr>
<td>value2</td>
<td>Required</td>
<td>Num</td>
<td>Numeric value that should be AND&#39;ed with value1</td>
</tr>
</tbody>
</table>
<h3 id="example">Example</h3>
<p>BitAnd(8#F, 8#F7)</p>
<p>11110111 AND 00000111 = 00000111 so BitAnd returns 7, the binary value of 00000111.</p>
<h2 id="cbool">CBool</h2>
<h3 id="function-3">Function</h3>
<p>CBool(Expression)</p>
<h2 id="cbool-1">CBool</h2>
<p><strong>Description</strong>: <code>CBool</code> returns a boolean based on the evaluated expression. If the expression evaluates to a non-zero value, then <code>CBool</code> returns <code>True</code>, else it returns <code>False</code>.</p>
<p><strong>Parameters</strong>:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>expression</td>
<td>Any valid expression</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: <code>CBool([attribute1] = [attribute2])</code></p>
<p>Returns True if both attributes have the same value.</p>
<h2 id="cdate">CDate</h2>
<p><strong>Function</strong>: <code>CDate(expression)</code></p>
<p><strong>Description</strong>: The CDate function returns a UTC DateTime from a string. DateTime isn&#39;t a native attribute type but it can be used within date functions such as <code>FormatDateTime</code> and <code>DateAdd</code>.</p>
<p><strong>Parameters</strong>:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Any valid string that represents a date/time. For supported formats, refer to .NET custom date and time format strings.</td>
</tr>
</tbody>
</table>
<p><strong>Remarks</strong>: The returned string is always in UTC and follows the format <code>M/d/yyyy h:mm:ss tt</code>.</p>
<p><strong>Example 1</strong>: <code>CDate([StatusHireDate])</code></p>
<p><strong>Sample input/output</strong>:</p>
<ul>
<li>INPUT (StatusHireDate): &quot;2020-03-16-07:00&quot;</li>
</ul>
<h2 id="example-1">Example 1</h2>
<ul>
<li><strong>OUTPUT:</strong> &quot;3/16/2020 7:00:00 AM&quot; &lt;-- Note the UTC equivalent of the above DateTime is returned</li>
</ul>
<h2 id="example-2">Example 2</h2>
<p>CDate(&quot;2021-06-30+08:00&quot;)</p>
<h3 id="sample-inputoutput">Sample input/output:</h3>
<ul>
<li><strong>INPUT:</strong> &quot;2021-06-30+08:00&quot;</li>
<li><strong>OUTPUT:</strong> &quot;6/29/2021 4:00:00 PM&quot; &lt;-- Note the UTC equivalent of the above DateTime is returned</li>
</ul>
<h2 id="example-3">Example 3</h2>
<p>CDate(&quot;2009-06-15T01:45:30-07:00&quot;)</p>
<h3 id="sample-inputoutput-1">Sample input/output:</h3>
<ul>
<li><strong>INPUT:</strong> &quot;2009-06-15T01:45:30-07:00&quot;</li>
<li><strong>OUTPUT:</strong> &quot;6/15/2009 8:45:30 AM&quot; &lt;-- Note the UTC equivalent of the above DateTime is returned</li>
</ul>
<h2 id="coalesce">Coalesce</h2>
<h3 id="function-coalescesource1-source2--defaultvalue">Function: Coalesce(source1, source2, ..., defaultValue)</h3>
<h3 id="description-3">Description:</h3>
<p>Returns the first source value that isn&#39;t NULL. If all arguments are NULL and defaultValue is present, the defaultValue is returned. If all arguments are NULL and defaultValue isn&#39;t present, Coalesce returns NULL.</p>
<h3 id="parameters-3">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source1 ... sourceN</td>
<td>Required</td>
<td>String</td>
<td>Required, variable-number of times. Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>defaultValue</td>
<td>Optional</td>
<td>String</td>
<td>Default value to be used when all source values are NULL. Can be empty string (&quot;&quot;).</td>
</tr>
</tbody>
</table>
<h3 id="flow">Flow</h3>
<p>Flow mail value if not NULL, otherwise flow userPrincipalName</p>
<h2 id="expression-coalesce">Expression: Coalesce</h2>
<p>Example: You wish to flow the mail attribute if it is present. If it isn&#39;t, you wish to flow the value of userPrincipalName instead.</p>
<h3 id="expression">Expression</h3>
<p><code>Coalesce([mail],[userPrincipalName])</code></p>
<h3 id="sample-inputoutput-2">Sample Input/Output</h3>
<ul>
<li>INPUT (mail): NULL</li>
<li>INPUT (userPrincipalName): &quot;John.Doe@contoso.com&quot;</li>
<li>OUTPUT: &quot;John.Doe@contoso.com&quot;</li>
</ul>
<h2 id="converttobase64">ConvertToBase64</h2>
<h3 id="function-4">Function</h3>
<p><code>ConvertToBase64(source)</code></p>
<h3 id="description-4">Description</h3>
<p>The ConvertToBase64 function converts a string to a Unicode base64 string.</p>
<h3 id="parameters-4">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>String to be converted to base 64</td>
</tr>
</tbody>
</table>
<h3 id="example-1-1">Example</h3>
<p><code>ConvertToBase64(&quot;Hello world!&quot;)</code></p>
<p>Returns &quot;SABlAGwAbABvACAAcwBvAHIAbABkACEA&quot;</p>
<h2 id="converttoutf8hex">ConvertToUTF8Hex</h2>
<h3 id="function-5">Function</h3>
<p><code>ConvertToUTF8Hex(source)</code></p>
<h3 id="description-5">Description</h3>
<p>The ConvertToUTF8Hex function converts a string to a UTF8 Hex encoded value.</p>
<h3 id="parameters-5">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>String to be converted to UTF8 Hex</td>
</tr>
</tbody>
</table>
<h2 id="example-converttoutf8hexhello-world">Example: ConvertToUTF8Hex(&quot;Hello world!&quot;)</h2>
<p>Returns 48656C6C6F20776F726C6421</p>
<h2 id="count">Count</h2>
<h3 id="function-countattribute">Function: Count(attribute)</h3>
<h3 id="description-6">Description</h3>
<p>The Count function returns the number of elements in a multi-valued attribute.</p>
<h3 id="parameters-6">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute</td>
<td>Required</td>
<td>attribute</td>
<td>Multi-valued attribute that will have elements counted</td>
</tr>
</tbody>
</table>
<h2 id="cstr">CStr</h2>
<h3 id="function-cstrvalue">Function: CStr(value)</h3>
<h3 id="description-7">Description</h3>
<p>The CStr function converts a value to a string data type.</p>
<h3 id="parameters-7">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Required</td>
<td>numeric, reference, or boolean</td>
<td>Can be a numeric value, reference attribute, or Boolean.</td>
</tr>
</tbody>
</table>
<h3 id="example-cstrdn">Example: CStr([dn])</h3>
<p>Returns &quot;cn=Joe,dc=contoso,dc=com&quot;</p>
<h2 id="dateadd">DateAdd</h2>
<h2 id="function-6">Function:</h2>
<h3 id="dateaddinterval-value-datetime"><code>DateAdd(interval, value, dateTime)</code></h3>
<h2 id="description-8">Description:</h2>
<p>Returns a date/time string representing a date to which a specified time interval has been added. The returned date is in the format: M/d/yyyy h:mm:ss tt.</p>
<h2 id="parameters-8">Parameters:</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>interval</td>
<td>Required</td>
<td>String</td>
<td>Interval of time you want to add. See accepted values below this table.</td>
</tr>
<tr>
<td>value</td>
<td>Required</td>
<td>Number</td>
<td>The number of units you want to add. It can be positive (to get dates in the future) or negative (to get dates in the past).</td>
</tr>
<tr>
<td>dateTime</td>
<td>Required</td>
<td>DateTime</td>
<td>DateTime representing date to which the interval is added.</td>
</tr>
</tbody>
</table>
<p>When passing a date string as input, use CDate function to wrap the datetime string. To get system time in UTC, use the Now function.</p>
<p>The interval string must have one of the following values:</p>
<ul>
<li>yyyy Year</li>
<li>m Month</li>
<li>d Day</li>
<li>ww Week</li>
<li>h Hour</li>
<li>n Minute</li>
<li>s Second</li>
</ul>
<h2 id="example-2-1">Example:</h2>
<h3 id="generate-a-date-value-based-on-incoming-statushiredate-from-workday">Generate a date value based on incoming StatusHireDate from Workday</h3>
<p><code>DateAdd(&quot;d&quot;, 7, CDate([StatusHireDate]))</code></p>
<h2 id="example-modifications-using-date-functions">Example Modifications using Date Functions</h2>
<table>
<thead>
<tr>
<th>Example</th>
<th>interval</th>
<th>value</th>
<th>dateTime (value of variable StatusHireDate)</th>
<th>output</th>
</tr>
</thead>
<tbody>
<tr>
<td>Add 7 days to hire date</td>
<td>&quot;d&quot;</td>
<td>7</td>
<td>2012-03-16-07:00</td>
<td>3/23/2012 7:00 AM</td>
</tr>
<tr>
<td>Get a date ten days prior to hire date</td>
<td>&quot;d&quot;</td>
<td>-10</td>
<td>2012-03-16-07:00</td>
<td>3/6/2012 7:00 AM</td>
</tr>
<tr>
<td>Add two weeks to hire date</td>
<td>&quot;ww&quot;</td>
<td>2</td>
<td>2012-03-16-07:00</td>
<td>3/30/2012 7:00 AM</td>
</tr>
<tr>
<td>Add ten months to hire date</td>
<td>&quot;m&quot;</td>
<td>10</td>
<td>2012-03-16-07:00</td>
<td>1/16/2013 7:00 AM</td>
</tr>
<tr>
<td>Add two years to hire date</td>
<td>&quot;yyyy&quot;</td>
<td>2</td>
<td>2012-03-16-07:00</td>
<td>3/16/2014 7:00 AM</td>
</tr>
</tbody>
</table>
<h2 id="datediff-function-documentation">DateDiff Function Documentation</h2>
<h3 id="function-7">Function:</h3>
<pre><code>DateDiff(interval, date1, date2)
</code></pre><h3 id="description-9">Description:</h3>
<p>This function uses the <code>interval</code> parameter to return a number that indicates the difference between the two input dates. It returns</p>
<ul>
<li>a positive number if date2 &gt; date1,</li>
<li>a negative number if date2 &lt; date1,</li>
<li>0 if date2 == date1</li>
</ul>
<h3 id="parameters-9">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Optional</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>interval</td>
<td>Required</td>
<td>String</td>
<td>Interval of time to use for calculating the difference.</td>
</tr>
<tr>
<td>date1</td>
<td>Required</td>
<td>DateTime</td>
<td>DateTime representing a valid date.</td>
</tr>
<tr>
<td>date2</td>
<td>Required</td>
<td>DateTime</td>
<td>DateTime representing a valid date.</td>
</tr>
</tbody>
</table>
<p>Note: When passing a date string as input, use <code>CDate</code> function to wrap the datetime string. To get system time in UTC, use the <code>Now</code> function.</p>
<p>The interval string must have one of the following values:</p>
<ul>
<li><strong>Expandable detailed values in documentation</strong></li>
</ul>
<h2 id="date-and-time-unit-descriptions">Date and Time Unit Descriptions</h2>
<ul>
<li>yyyy Year</li>
<li>m Month</li>
<li>d Day</li>
<li>ww Week</li>
<li>h Hour</li>
<li>n Minute</li>
<li>s Second</li>
</ul>
<h2 id="example-1-compare-current-date-with-hire-date-from-workday-with-different-intervals">Example 1: Compare current date with hire date from Workday with different intervals</h2>
<pre><code>DateDiff(&quot;d&quot;, Now(), CDate([StatusHireDate]))
</code></pre><h3 id="table-of-differences-in-date-intervals">Table of Differences in Date Intervals</h3>
<table>
<thead>
<tr>
<th>Example</th>
<th>interval</th>
<th>date1</th>
<th>date2</th>
<th>output</th>
</tr>
</thead>
<tbody>
<tr>
<td>Positive difference in days between dates</td>
<td>d</td>
<td>2021-08-18+08:00</td>
<td>2021-08-31+08:00</td>
<td>13</td>
</tr>
<tr>
<td>Negative difference in days between dates</td>
<td>d</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16-07:00</td>
<td>-3449</td>
</tr>
<tr>
<td>Difference in weeks between two dates</td>
<td>ww</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16-07:00</td>
<td>-493</td>
</tr>
<tr>
<td>Difference in months between two dates</td>
<td>m</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16-07:00</td>
<td>-113</td>
</tr>
<tr>
<td>Difference in years between two dates</td>
<td>yyyy</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16-07:00</td>
<td>-9</td>
</tr>
<tr>
<td>Difference when both dates are same</td>
<td>d</td>
<td>2021-08-31+08:00</td>
<td>2021-08-31+08:00</td>
<td>0</td>
</tr>
<tr>
<td>Difference in hours between two dates</td>
<td>h</td>
<td>2021-08-24</td>
<td>2021-08-25</td>
<td>24</td>
</tr>
<tr>
<td>Difference in minutes between two dates</td>
<td>n</td>
<td>2021-08-24</td>
<td>2021-08-25</td>
<td>1440</td>
</tr>
<tr>
<td>Difference in seconds between two dates</td>
<td>s</td>
<td>2021-08-24</td>
<td>2021-08-25</td>
<td>86400</td>
</tr>
</tbody>
</table>
<h2 id="example-2-combine-datediff-with-iif-function-to-set-attribute-value">Example 2: Combine DateDiff with IIF function to set attribute value</h2>
<p>If an account is Active in Workday, set the <code>accountEnabled</code> attribute of the user to True only if hire date is within the next five days.</p>
<h2 id="datefromnum">DateFromNum</h2>
<h3 id="function-datefromnumvalue">Function: DateFromNum(value)</h3>
<h3 id="description-10">Description:</h3>
<p>The DateFromNum function converts a value in AD&#39;s date format to a DateTime type.</p>
<h3 id="parameters-10">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Required</td>
<td>Date</td>
<td>AD Date to be converted to DateTime type</td>
</tr>
</tbody>
</table>
<h3 id="example-3-1">Example:</h3>
<p>DateFromNum([LastLogonTimestamp])</p>
<p><code>DateFromNum(129699324000000000)</code></p>
<p>Returns a DateTime representing January 1, 2012 at 11:00PM.</p>
<h2 id="formatdatetime">FormatDateTime</h2>
<h3 id="function-formatdatetimesource-datetimestyles-inputformat-outputformat">Function: FormatDateTime(source, dateTimeStyles, inputFormat, outputFormat)</h3>
<h3 id="description-11">Description:</h3>
<p>Takes a date string from one format and converts it into a different format.</p>
<h3 id="parameters-11">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>dateTimeStyles</td>
<td>Optional</td>
<td>String</td>
<td>Use this parameter to specify the formatting options that customize string parsing for some date and time parsing methods. For supported values, see DateTimeStyles doc. If left empty, the default value used is</td>
</tr>
</tbody>
</table>
<h2 id="parameters-12">Parameters</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>inputFormat</td>
<td>Required</td>
<td>String</td>
<td>Expected format of the source value. For supported formats, see <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/custom-date-and-time-format-strings">.NET custom date and time format strings</a>.</td>
</tr>
<tr>
<td>outputFormat</td>
<td>Required</td>
<td>String</td>
<td>Format of the output date.</td>
</tr>
</tbody>
</table>
<h3 id="output-date-as-a-string-in-a-certain-format">Output date as a string in a certain format</h3>
<p><strong>Example:</strong> You want to send dates to a SaaS application like ServiceNow in a certain format. You can consider using the following expression.</p>
<p><strong>Expression:</strong></p>
<pre><code>FormatDateTime([extensionAttribute1], &quot;yyyyMMddHHmmss.fZ&quot;, &quot;yyyy-MM-dd&quot;)
</code></pre><p><strong>Sample input/output:</strong></p>
<ul>
<li><strong>INPUT</strong> (extensionAttribute1): &quot;20150123105347.1Z&quot;</li>
<li><strong>OUTPUT</strong>: &quot;2015-01-23&quot;</li>
</ul>
<h3 id="guid">Guid</h3>
<p><strong>Function:</strong> Guid()</p>
<p><strong>Description:</strong> The function Guid generates a new random GUID</p>
<p><strong>Example:</strong></p>
<pre><code>Guid()
</code></pre><p><strong>Sample output:</strong> &quot;1088051a-cd4b-4288-84f8-e02042ca72bc&quot;</p>
<h3 id="ignoreflowifnullorempty">IgnoreFlowIfNullOrEmpty</h3>
<p><strong>Function:</strong> IgnoreFlowIfNullOrEmpty(expression)</p>
<p><strong>Description:</strong> The IgnoreFlowIfNullOrEmpty function instructs the provisioning service to ignore the attribute and drop it from the flow if the enclosed function or attribute is NULL or empty.</p>
<h2 id="parameters-13">Parameters</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<h3 id="example-1-dont-flow-an-attribute-if-it-is-null">Example 1: Don&#39;t flow an attribute if it is null</h3>
<p><code>IgnoreFlowIfNullorEmpty([department])</code></p>
<p>The above expression will drop the department attribute from the provisioning flow if it is null or empty.</p>
<h3 id="example-2-dont-flow-an-attribute-if-the-expression-mapping-evaluates-to-empty-string-or-null">Example 2: Don&#39;t flow an attribute if the expression mapping evaluates to empty string or null</h3>
<p>Let&#39;s say the SuccessFactors attribute prefix is mapped to the on-premises Active Directory attribute personalTitle using the following expression mapping:</p>
<p><code>IgnoreFlowIfNullorEmpty(Switch([prefix], &quot;&quot;, &quot;3443&quot;, &quot;Dr.&quot;, &quot;3444&quot;, &quot;Prof.&quot;, &quot;3445&quot;, &quot;Prof. Dr.&quot;))</code></p>
<p>The above expression first evaluates the Switch function. If the prefix attribute doesn&#39;t have any of the values listed within the Switch function, then Switch will return an empty string and the attribute personalTitle will not be included in the provisioning flow to on-premises Active Directory.</p>
<h2 id="iif">IIF</h2>
<p><strong>Function:</strong> IIF(condition,valueIfTrue,valueIfFalse)</p>
<p><strong>Description:</strong> The IIF function returns one of a set of possible values based on a specified condition.</p>
<h2 id="parameters-14">Parameters</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>condition</td>
<td>Required</td>
<td>Variable or Expression</td>
<td>Any value or expression that can be evaluated to true or false.</td>
</tr>
<tr>
<td>valueIfTrue</td>
<td>Required</td>
<td>Variable or String</td>
<td>If the condition evaluates to true, the returned value.</td>
</tr>
</tbody>
</table>
<h2 id="function-definitions-and-comparison-operators">Function Definitions and Comparison Operators</h2>
<h3 id="valueiffalse">valueIfFalse</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>valueIfFalse</td>
<td>Required</td>
<td>Variable or String</td>
<td>If the condition evaluates to false, the returned value.</td>
</tr>
</tbody>
</table>
<p>Comparison operators for condition:</p>
<ul>
<li>Equal to (=) and not equal to (&lt;&gt;)</li>
<li>Greater than (&gt;) and greater than equal to (&gt;=)</li>
<li>Less than (&lt;) and less than equal to (&lt;=)</li>
</ul>
<p>Example:</p>
<pre><code>Set the target attribute value to source country attribute if country=&quot;USA&quot;, else set target attribute value to source department attribute. IIF([country]=&quot;USA&quot;, [country], [department])
</code></pre><h2 id="known-limitations-1">Known Limitations</h2>
<h3 id="issues-and-workarounds">Issues and Workarounds</h3>
<p>This section includes limitations and workarounds for the IIF function. For more on troubleshooting user creation issues, see related documentation on handling null or empty values.</p>
<ul>
<li><p>The IIF function does not support AND and OR logical operators directly. For AND logic, use nested IIF statements:</p>
<pre><code>IIF([country]=&quot;USA&quot; AND [state]=&quot;CA&quot;, &quot;True&quot;, &quot;False&quot;)
IIF([country]=&quot;USA&quot;, IIF([state]=&quot;CA&quot;, &quot;True&quot;, &quot;False&quot;), &quot;False&quot;)
</code></pre></li>
<li><p>To achieve OR logic, similar nesting can be applied:</p>
<pre><code>IIF([country]=&quot;USA&quot; OR [state]=&quot;CA&quot;, &quot;True&quot;, &quot;False&quot;)
IIF([country]=&quot;USA&quot;, &quot;True&quot;, IIF([state]=&quot;CA&quot;, &quot;True&quot;, &quot;False&quot;))
</code></pre></li>
<li><p>If the source attribute in the IIF function is empty or null, the function fails:</p>
<ul>
<li>Unsupported IIF expressions: <ul>
<li><code>IIF([country]=&quot;&quot;, &quot;Other&quot;, [country])</code></li>
<li><code>IIF([IsNullorEmpty([country])], &quot;Other&quot;, [country])</code></li>
<li><code>IIF([IsPresent([country])], [country], &quot;Other&quot;)</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Recommended solution:</p>
<ul>
<li>Use the Switch function to check for null or empty values and set defaults:
<code>Switch([country], [country], &quot;&quot;, &quot;Other&quot;)</code></li>
</ul>
</li>
</ul>
<h2 id="function-instrvalue1-value2-start-comparetype">Function: InStr(value1, value2, start, compareType)</h2>
<h3 id="description-12">Description</h3>
<p>The InStr function finds the first occurrence of a substring in a string</p>
<h3 id="parameters-15">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value1</td>
<td>Required</td>
<td>String</td>
<td>String to be searched</td>
</tr>
<tr>
<td>value2</td>
<td>Required</td>
<td>String</td>
<td>String to be found</td>
</tr>
<tr>
<td>start</td>
<td>Optional</td>
<td>Integer</td>
<td>Starting position to find the substring</td>
</tr>
<tr>
<td>compareType</td>
<td>Optional</td>
<td>Enum</td>
<td>Can be vbTextCompare or vbBinaryCompare</td>
</tr>
</tbody>
</table>
<h3 id="example-4">Example</h3>
<pre><code>InStr(&quot;The quick brown fox&quot;,&quot;quick&quot;)
</code></pre><p>Evaluates to 5</p>
<pre><code>InStr(&quot;repeated&quot;, &quot;e&quot;, 3, vbBinaryCompare)
</code></pre><p>Evaluates to 7</p>
<hr>
<h2 id="function-isnullexpression">Function: IsNull(Expression)</h2>
<h3 id="description-13">Description</h3>
<p>If the expression evaluates to Null, then the IsNull function returns true. For an attribute, a Null is expressed by the absence of the attribute.</p>
<h3 id="parameters-16">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<h3 id="example-5">Example</h3>
<pre><code>IsNull([displayName])
</code></pre><p>Returns True if the attribute isn&#39;t present.</p>
<hr>
<h2 id="function-isnullorempty">Function: IsNullOrEmpty</h2>
<h3 id="description-14">Description</h3>
<h3 id="parameters-17">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<h3 id="example-6">Example</h3>
<pre><code>IsNullOrEmpty([email])
</code></pre><p>Returns True if the email field is either null or an empty string.</p>
<h2 id="function-isnullorempty-1">Function: IsNullOrEmpty</h2>
<h3 id="description-15">Description</h3>
<p>If the expression is null or an empty string, then the IsNullOrEmpty function returns true. For an attribute, this would evaluate to True if the attribute is absent or is present but is an empty string. The inverse of this function is named IsPresent.</p>
<h3 id="parameters-18">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<h3 id="example-7">Example</h3>
<p><code>IsNullOrEmpty([displayName])</code></p>
<p>Returns True if the attribute isn&#39;t present or is an empty string.</p>
<h2 id="function-ispresent">Function: IsPresent</h2>
<h3 id="description-16">Description</h3>
<p>If the expression evaluates to a string that isn&#39;t Null and isn&#39;t empty, then the IsPresent function returns true. The inverse of this function is named IsNullOrEmpty.</p>
<h3 id="parameters-19">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<h3 id="example-8">Example</h3>
<p><code>Switch(IsPresent([directManager]),[directManager], IsPresent([skipleveManager]),[skipleveManager], IsPresent([director]),[director])</code></p>
<h2 id="function-isstring">Function: IsString</h2>
<h3 id="description-17">Description</h3>
<p>If the expression can be evaluated to a string type, then the IsString function evaluates to True.</p>
<h3 id="parameters-20">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<h2 id="expression-1">Expression</h2>
<p><strong>Required</strong>: Yes<br><strong>Type</strong>: Expression<br><strong>Notes</strong>: Expression to be evaluated</p>
<h2 id="item">Item</h2>
<h3 id="function-8">Function</h3>
<p><code>Item(attribute, index)</code></p>
<h3 id="description-18">Description</h3>
<p>The Item function returns one item from a multi-valued string/attribute.</p>
<h3 id="parameters-21">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute</td>
<td>Required</td>
<td>Attribute</td>
<td>Multi-valued attribute to be searched</td>
</tr>
<tr>
<td>index</td>
<td>Required</td>
<td>Integer</td>
<td>Index to an item in the multi-valued string</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: <code>Item([proxyAddresses], 1)</code> returns the first item in the multi-valued attribute.
Index 0 shouldn&#39;t be used.</p>
<h2 id="join">Join</h2>
<h3 id="function-9">Function</h3>
<p><code>Join(separator, source1, source2, ...)</code></p>
<h3 id="description-19">Description</h3>
<p>Join() is similar to Append(), except that it can combine multiple source string values into a single string, and each value will be separated by a separator string. If one of the source values is a multi-value attribute, then every value in that attribute will be joined together, separated by the separator value.</p>
<h3 id="parameters-22">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>separator</td>
<td>Required</td>
<td>String</td>
<td>String used to separate source values when they are concatenated into one string. Can be &quot;&quot; if no separator is required.</td>
</tr>
</tbody>
</table>
<h2 id="left">Left</h2>
<h3 id="function-10">Function:</h3>
<p>Left(String, NumChars)</p>
<h3 id="description-20">Description:</h3>
<p>The Left function returns a specified number of characters from the left of a string. If NumChars = 0, return empty string. If numChars &lt; 0, return input string. If string is null, return empty string. If string contains fewer characters than the number specified in numChars, a string identical to string (that is, containing all characters in parameter 1) is returned.</p>
<h3 id="parameters-23">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>Required</td>
<td>Attribute</td>
<td>The string to return characters from</td>
</tr>
<tr>
<td>NumChars</td>
<td>Required</td>
<td>Integer</td>
<td>A number identifying the number of characters to return from the beginning (left) of string</td>
</tr>
</tbody>
</table>
<h3 id="example-9">Example:</h3>
<p>Left(&quot;John Doe&quot;, 3)</p>
<p>Returns &quot;Joh&quot;.</p>
<h2 id="mid">Mid</h2>
<h3 id="function-11">Function:</h3>
<p>Mid(source, start, length)</p>
<h3 id="description-21">Description:</h3>
<p>Returns a substring of the source value. A substring is a string that contains only some of the characters from the source string.</p>
<h3 id="parameters-24">Parameters:</h3>
<pre><code class="lang-mermaid">Expandable details not directly provided
</code></pre><h2 id="parameters-25">Parameters</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute.</td>
</tr>
<tr>
<td>start</td>
<td>Required</td>
<td>Integer</td>
<td>Index in the source string where substring should start.</td>
</tr>
<tr>
<td>length</td>
<td>Required</td>
<td>Integer</td>
<td>Length of the substring.</td>
</tr>
</tbody>
</table>
<h2 id="normalizediacritics">NormalizeDiacritics</h2>
<h3 id="function-normalizediacriticssource">Function: NormalizeDiacritics(source)</h3>
<p><strong>Description:</strong>
Requires one string argument. Returns the string, but with any diacritical characters replaced with equivalent nondiacritical characters. Typically used to convert first names and last names containing diacritical characters into legal values for various user identifiers.</p>
<h3 id="parameters-26">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually a first name or last name attribute.</td>
</tr>
</tbody>
</table>
<h3 id="diacritic-conversion-table">Diacritic Conversion Table</h3>
<table>
<thead>
<tr>
<th>Character with Diacritic</th>
<th>Normalized Character</th>
<th>Character with Diacritic</th>
<th>Normalized Character</th>
</tr>
</thead>
<tbody>
<tr>
<td>á, à, â, ã, å, ā, ă, ą, ä, ã</td>
<td>a</td>
<td>Á, À, Â, Ã, Å, Ā, Ă, Ą, Ä, Ã</td>
<td>A</td>
</tr>
<tr>
<td>æ, ä</td>
<td>ae</td>
<td>Æ, Ä</td>
<td>AE</td>
</tr>
<tr>
<td>ç, ć, č, ĉ, ç</td>
<td>c</td>
<td>Ç, Ć, Č, Ĉ, Ç</td>
<td>C</td>
</tr>
<tr>
<td>đ, ď, đ</td>
<td>d</td>
<td>Đ, Ď, Đ</td>
<td>D</td>
</tr>
<tr>
<td>é, è, ê, ē, ĕ, ė, ë, ē, ė, ë</td>
<td>e</td>
<td>É, È, Ê, Ē, Ĕ, Ė, Ë, Ē, Ė, Ë</td>
<td>E</td>
</tr>
</tbody>
</table>
<h2 id="character-diacritic-normalization-table">Character Diacritic Normalization Table</h2>
<table>
<thead>
<tr>
<th>Character with Diacritic</th>
<th>Normalized character</th>
<th>Character with Diacritic</th>
<th>Normalized character</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğ, ğ, ğ</td>
<td>g</td>
<td>Ğ, Ğ, Ğ</td>
<td>G</td>
</tr>
<tr>
<td>ì, í, î, ï, ĩ, ĭ, į, i̇, i̇</td>
<td>i</td>
<td>Ì, Í, Î, Ï, Ĩ, Ĭ, Į, İ, İ</td>
<td>I</td>
</tr>
<tr>
<td>ĺ, ļ, ľ, ł</td>
<td>l</td>
<td>Ĺ, Ļ, Ľ, Ł</td>
<td>L</td>
</tr>
<tr>
<td>ń, ņ, ň, ǹ</td>
<td>n</td>
<td>Ń, Ņ, Ň, Ǹ</td>
<td>N</td>
</tr>
<tr>
<td>ò, ó, ô, ö, õ, ő, ơ, o̊, ő, ó̌, ò̌, ǒ, ǫ</td>
<td>o</td>
<td>Ò, Ó, Ô, Ö, Õ, Ő, Ơ, O̊, Ő, Ó̌, Ò̌, Ǒ, Ǫ</td>
<td>O</td>
</tr>
<tr>
<td>œ, ö, œ</td>
<td>oe</td>
<td>Œ, Ö, Œ</td>
<td>OE</td>
</tr>
<tr>
<td>ŕ, ŗ, ř</td>
<td>r</td>
<td>Ŕ, Ŗ, Ř</td>
<td>R</td>
</tr>
<tr>
<td>ß</td>
<td>ss</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>ś, ŝ, š, ş, s̩</td>
<td>s</td>
<td>Ś, Ŝ, Š, Ş, S̩</td>
<td>S</td>
</tr>
<tr>
<td>ţ, ť, ŧ</td>
<td>t</td>
<td>Ţ, Ť, Ŧ</td>
<td>T</td>
</tr>
<tr>
<td>ù, ú, û, ü, ũ, ű, ů, ų, ut̄, út̄, ùt̄, ǔ, ų</td>
<td>u</td>
<td>Ù, Ú, Û, Ü, Ũ, Ű, Ů, Ų, Ut̄, Út̄, Ùt̄, Ǔ, Ų</td>
<td>U</td>
</tr>
<tr>
<td>ý, ÿ, ŷ, ỳ, ỹ, y̌</td>
<td>y</td>
<td>Ý, Ÿ, Ŷ, Ỳ, Ỹ, Y̌</td>
<td>Y</td>
</tr>
<tr>
<td>ź, ż, ž, z̧</td>
<td>z</td>
<td>Ź, Ż, Ž, Z̧</td>
<td>Z</td>
</tr>
</tbody>
</table>
<h3 id="remove-diacritics-from-a-string">Remove Diacritics from a String</h3>
<p><strong>Example:</strong></p>
<ul>
<li>Replace characters containing accent marks with equivalent characters that don&#39;t contain accent marks.</li>
</ul>
<p><strong>Expression:</strong></p>
<pre><code>NormalizeDiacritics([givenName])
</code></pre><p><strong>Sample input/output:</strong></p>
<ul>
<li><strong>INPUT (givenName):</strong> &quot;Zoë&quot;</li>
<li><strong>OUTPUT:</strong> &quot;Zoe&quot;</li>
</ul>
<h3 id="not-function">Not Function</h3>
<p><strong>Function:</strong> Not(source)</p>
<h2 id="description-flips-the-boolean-value-of-the-source-if-source-value-is-true-returns-false-otherwise-returns-true">Description: Flips the boolean value of the source. If source value is True, returns False. Otherwise, returns True.</h2>
<h3 id="parameters-27">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>Boolean String</td>
<td>Expected source values are &quot;True&quot; or &quot;False&quot;.</td>
</tr>
</tbody>
</table>
<h2 id="now">Now</h2>
<h3 id="function-now">Function: Now()</h3>
<h3 id="description-22">Description</h3>
<p>The Now function returns a string representing the current UTC DateTime in the format M/d/yyyy h:mm:ss tt.</p>
<h3 id="example-10">Example</h3>
<p>Now()<br>Example value returned 7/2/2021 3:33:38 PM</p>
<h2 id="numfromdate">NumFromDate</h2>
<h3 id="function-numfromdatevalue">Function: NumFromDate(value)</h3>
<h3 id="description-23">Description</h3>
<p>The NumFromDate function converts a DateTime value to Active Directory format that is required to set attributes like accountExpires. Use this function to convert DateTime values received from cloud HR apps like Workday and SuccessFactors to their equivalent AD representation.</p>
<h3 id="parameters-28">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Required</td>
<td>String</td>
<td>Date time string in ISO 8601 format. If the date variable is in a different format, use FormatDateTime function to convert the date to ISO 8601 format.</td>
</tr>
</tbody>
</table>
<h3 id="example-11">Example</h3>
<h2 id="workday-example">Workday Example</h2>
<p>Assuming you want to map the attribute <strong>ContractEndDate</strong> from Workday, which is in the format <code>2020-12-31-08:00</code> to <strong>accountExpires</strong> field in AD, here&#39;s how you can use this function and change the timezone offset to match your locale:</p>
<pre><code class="lang-plaintext">NumFromDate(Join(&quot;&quot;, FormatDateTime([ContractEndDate], &quot;yyyy-MM-ddzzz&quot;, &quot;yyyy-MM-dd&quot;), &quot;:23:59:59-08:00&quot;))
</code></pre><h2 id="successfactors-example">SuccessFactors Example</h2>
<p>Assuming you want to map the attribute <strong>endDate</strong> from SuccessFactors, which is in the format <code>M/d/yyyy hh:mm:ss tt</code> to <strong>accountExpires</strong> field in AD, here&#39;s how you can use this function and change the time zone offset to match your locale:</p>
<pre><code class="lang-plaintext">NumFromDate(Join(&quot;&quot;, FormatDateTime([endDate], &quot;M/d/yyyy hh:mm:ss tt&quot;, &quot;yyyy-MM-dd&quot;), &quot;:23:59:59-08:00&quot;))
</code></pre><h2 id="pcase-function">PCase Function</h2>
<h3 id="description-24">Description</h3>
<p>The <code>PCase</code> function converts the first character of each word in a string to upper case, and all other characters are converted to lower case.</p>
<h3 id="parameters-29">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Optional</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>source value to convert to proper case.</td>
</tr>
<tr>
<td>wordSeparators</td>
<td>Optional</td>
<td>String</td>
<td>Specify a set of characters used as word separators (example: &quot;-&quot;)</td>
</tr>
</tbody>
</table>
<h3 id="remarks">Remarks</h3>
<ul>
<li>If the <code>wordSeparators</code> parameter isn&#39;t specified, then <code>PCase</code> internally invokes the .NET function <code>ToTitleCase</code> to convert the <code>source</code> string to proper case. </li>
<li>The .NET <code>ToTitleCase</code> supports a comprehensive set of the Unicode character categories as word separators.<ul>
<li>Space character</li>
<li>New line character</li>
<li>Control characters like CRLF</li>
<li>Format control characters</li>
<li>Connector/Punctuation characters like underscore</li>
<li>Dash/Punctuation characters like dash and hyphen (including characters such as En Dash, Em Dash, double hyphen, etc.)</li>
</ul>
</li>
</ul>
<h2 id="randomstring">RandomString</h2>
<h3 id="function-12">Function</h3>
<p>RandomString(Length, MinimumNumbers, MinimumSpecialCharacters, MinimumCapital, MinimumLowerCase, CharactersToAvoid)</p>
<h2 id="character-types">Character Types</h2>
<ul>
<li><strong>OpenPunctuation and ClosePunctuation</strong> characters that occur in pairs like parenthesis, curly bracket, angle bracket, etc.</li>
<li><strong>InitialQuotePunctuation and FinalQuotePunctuation</strong> characters like single quotes, double quotes and angular quotes.</li>
<li><strong>OtherPunctuation</strong> characters like exclamation mark, number sign, percent sign, ampersand, asterisk, comma, full stop, colon, semi-colon, etc.</li>
<li><strong>MathSymbol</strong> characters like plus sign, less-than and greater-than sign, vertical line, tilde, equals sign, etc.</li>
<li><strong>CurrencySymbol</strong> characters like dollar sign, cent sign, pound sign, euro sign, etc.</li>
<li><strong>ModifierSymbol</strong> characters like macron, accents, arrow heads, etc.</li>
<li><strong>OtherSymbol</strong> characters like copyright sign, degree sign, registered sign, etc.</li>
<li>If the <strong>wordSeparators</strong> parameter is specified, then PCase only uses the characters specified as word separators.</li>
</ul>
<h2 id="example-12">Example</h2>
<p>Let&#39;s say you&#39;re sourcing the attributes <code>firstName</code> and <code>lastName</code> from SAP SuccessFactors and in HR both these attributes are in upper-case. Using the PCase function, you can convert the name to proper case as shown below.</p>
<table>
<thead>
<tr>
<th>Expression</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>PCase([firstName])</td>
<td>firstName = &quot;PABLO GONSALVES (SECOND)&quot;</td>
<td>&quot;Pablo Gonsalves (Second)&quot;</td>
<td>As the wordSeparators parameter isn&#39;t specified, the PCase function uses the default word separators character set.</td>
</tr>
<tr>
<td>PCase([lastName], &#39; .&#39;)</td>
<td>lastName = &quot;PINTO-DE&#39;SILVA&quot;</td>
<td>&quot;Pinto-De&#39;Silva&quot;</td>
<td>The PCase function uses characters in the wordSeparators parameter to identify words and transform them to proper case.</td>
</tr>
<tr>
<td>PCase(Join(&#39; &#39;, [firstName], [lastName]))</td>
<td>firstName = GREGORY, lastName = &quot;JAMES&quot;</td>
<td>&quot;Gregory James&quot;</td>
<td>You can nest the Join function within PCase. As the wordSeparators parameter isn&#39;t specified, the PCase function uses the default word separators character set.</td>
</tr>
</tbody>
</table>
<h2 id="description-25">Description</h2>
<p>The RandomString function generates a random string based on the conditions specified. Characters allowed can be identified <a href="#">here</a>.</p>
<h3 id="parameters-30">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Length</td>
<td>Required</td>
<td>Number</td>
<td>Total length of the random string. This should be greater than or equal to the sum of MinimumNumbers, MinimumSpecialCharacters, and MinimumCapital. 256 characters max.</td>
</tr>
<tr>
<td>MinimumNumbers</td>
<td>Required</td>
<td>Number</td>
<td>Minimum numbers in the random string.</td>
</tr>
<tr>
<td>MinimumSpecialCharacters</td>
<td>Required</td>
<td>Number</td>
<td>Minimum number of special characters.</td>
</tr>
<tr>
<td>MinimumCapital</td>
<td>Required</td>
<td>Number</td>
<td>Minimum number of capital letters in the random string.</td>
</tr>
<tr>
<td>MinimumLowerCase</td>
<td>Required</td>
<td>Number</td>
<td>Minimum number of lower case letters in the random string.</td>
</tr>
<tr>
<td>CharactersToAvoid</td>
<td>Optional</td>
<td>String</td>
<td>Characters to be excluded when generating the random string.</td>
</tr>
</tbody>
</table>
<h3 id="example-1-2">Example 1:</h3>
<p>Generate a random string without special character restrictions:
<code>RandomString(6, 3, 0, 0, 3)</code> Generates a random string with 6 characters. The string contains 3 numbers and 3 lower case characters (1a73qt).</p>
<h3 id="example-2-2">Example 2:</h3>
<p>Generate a random string with special character restrictions:
<code>RandomString(10, 2, 2, 2, 1, &quot;?.&quot;)</code> Generates a random string with 10 characters. The string contains at least 2 numbers, 2 special characters, 2 capital letters, 1 lower case letter and excludes the characters &quot;?&quot; and &quot;,&quot; (1@!2BaRg53).</p>
<h2 id="redact">Redact</h2>
<h3 id="function-13">Function:</h3>
<p>Redact()</p>
<h3 id="description-26">Description</h3>
<p>The Redact function replaces the attribute value with the string literal &quot;[Redact]&quot; in the provisioning logs.</p>
<h3 id="parameters-31">Parameters:</h3>
<p>(Paint text table similar as above with parameter details)</p>
<h2 id="redact-function">Redact Function</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute/value</td>
<td>Required</td>
<td>String</td>
<td>Specify the attribute or constant / string to redact from the logs.</td>
</tr>
</tbody>
</table>
<h3 id="examples">Examples:</h3>
<ul>
<li>Redact an attribute: <code>Redact([userPrincipalName])</code> Removes the userPrincipalName from the provisioning logs.</li>
<li>Redact a string: <code>Redact(&quot;StringToBeRedacted&quot;)</code> Removes a constant string from the provisioning logs.</li>
<li>Redact a random string: <code>Redact(RandomString(6,3,0,0,3))</code> Removes the random string from the provisioning logs.</li>
</ul>
<h2 id="removeduplicates-function">RemoveDuplicates Function</h2>
<p><strong>Description</strong>: The RemoveDuplicates function takes a multi-valued string and make sure each value is unique.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute</td>
<td>Required</td>
<td>Multi-valued Attribute</td>
<td>Multi-valued attribute that has duplicates removed</td>
</tr>
</tbody>
</table>
<h3 id="example-13">Example:</h3>
<ul>
<li><code>RemoveDuplicates([proxyAddresses])</code> Returns a sanitized proxyAddress attribute where all duplicate values are removed.</li>
</ul>
<h2 id="replace-function">Replace Function</h2>
<p><strong>Description</strong>: Replaces values within a string in a case-sensitive manner. The function behaves differently depending on the parameters provided.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Source string where replacements are to be made</td>
</tr>
<tr>
<td>oldValue</td>
<td>Required</td>
<td>String</td>
<td>Value to find in the source string</td>
</tr>
<tr>
<td>regexPattern</td>
<td>Optional</td>
<td>String</td>
<td>Pattern to match in the source string</td>
</tr>
<tr>
<td>regexGroupName</td>
<td>Optional</td>
<td>String</td>
<td>Part of the matched pattern to replace</td>
</tr>
<tr>
<td>replacementValue</td>
<td>Optional</td>
<td>String</td>
<td>Value to replace in the source string</td>
</tr>
<tr>
<td>replacementAttributeName</td>
<td>Optional</td>
<td>String</td>
<td>Attribute name for the replacement value</td>
</tr>
<tr>
<td>template</td>
<td>Optional</td>
<td>String</td>
<td>Template for forming the replacement string</td>
</tr>
</tbody>
</table>
<h2 id="functionality-overview">Functionality Overview</h2>
<h3 id="replacement-functions">Replacement Functions</h3>
<ul>
<li><strong>When oldValue and replacementValue are provided:</strong><ul>
<li>Replaces all occurrences of oldValue in the source with replacementValue</li>
</ul>
</li>
<li><strong>When oldValue and template are provided:</strong><ul>
<li>Replaces all occurrences of the oldValue in the template with the source value</li>
</ul>
</li>
<li><strong>When regexPattern and replacementValue are provided:</strong><ul>
<li>The function applies the regexPattern to the source string and you can use the regex group names to construct the string for replacementValue </li>
</ul>
</li>
</ul>
<h3 id="regex-group-functionality">Regex Group Functionality</h3>
<ul>
<li><strong>When regexPattern, regexGroupName, replacementValue are provided:</strong><ul>
<li>The function applies the regexPattern to the source string and replaces all values matching regexGroupName with replacementValue</li>
</ul>
</li>
<li><strong>When regexPattern, regexGroupName, replacementAttributeName are provided:</strong><ul>
<li>If source has a value, source is returned</li>
<li>If source has no value, the function applies the regexPattern to the replacementAttributeName and returns the value matching regexGroupName</li>
</ul>
</li>
</ul>
<h3 id="important-note-1">Important Note</h3>
<p>To learn more about regex grouping constructs and named sub-expressions, see Grouping Constructs in Regular Expressions.</p>
<h3 id="parameters-table">Parameters Table</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>oldValue</td>
<td>Optional</td>
<td>String</td>
<td>Value to be replaced in source or template.</td>
</tr>
<tr>
<td>regexPattern</td>
<td>Optional</td>
<td>String</td>
<td>Regex pattern for the value to be replaced in source. When replacementAttributeName is used, the regexPattern is applied to extract a value from replacementAttributeName.</td>
</tr>
<tr>
<td>regexGroupName</td>
<td>Optional</td>
<td>String</td>
<td>Name of the group inside regexPattern. When named replacementAttributeName is used, we&#39;ll extract the value of the named regex group from the</td>
</tr>
</tbody>
</table>
<h2 id="attribute-details">Attribute Details</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>replacementValue</td>
<td>Optional</td>
<td>String</td>
<td>New value to replace old one with.</td>
</tr>
<tr>
<td>replacementAttributeName</td>
<td>Optional</td>
<td>String</td>
<td>Name of the attribute to be used for replacement value</td>
</tr>
<tr>
<td>template</td>
<td>Optional</td>
<td>String</td>
<td>When template value is provided, we&#39;ll look for oldValue inside the template and replace it with source value.</td>
</tr>
</tbody>
</table>
<h2 id="replace-characters-using-a-regular-expression">Replace characters using a regular expression</h2>
<h3 id="example-1-basic-replacement">Example 1: Basic Replacement</h3>
<p>Using oldValue and replacementValue to replace the entire source string with another string.</p>
<ul>
<li><strong>source</strong>: <code>[BusinessTitle]</code></li>
<li><strong>oldValue</strong>: &quot;Product Developer&quot;</li>
<li><strong>replacementValue</strong>: &quot;Software Engineer&quot;</li>
<li><strong>Expression output</strong>: Software Engineer</li>
</ul>
<h3 id="example-2-using-templates">Example 2: Using Templates</h3>
<p>Using oldValue and template to insert the source string into another templated string.</p>
<ul>
<li><strong>source</strong>: <code>[UserID]</code> = &quot;jsmith&quot;</li>
<li><strong>template</strong>: <code>&lt;username&gt;@contoso.com</code></li>
<li><strong>Expression output</strong>: Using the UserID value, the result is <code>jsmith@contoso.com</code></li>
</ul>
<h2 id="example-3-regex-pattern-and-replacement-value">Example 3: Regex Pattern and Replacement Value</h2>
<p>Using regexPattern and replacementValue to extract a portion of the source string and replace it with an empty string or a custom value built using regex patterns or regex group names.</p>
<h3 id="scenario">Scenario</h3>
<p>You have a source attribute <code>telephoneNumber</code> that includes <code>country code</code> and <code>phone number</code> separated by a space character. For instance, +91 9998887777. </p>
<p>To extract the 10 digit phone number, you can use the following expression in your attribute mapping:</p>
<pre><code class="lang-plaintext">Replace([[telephoneNumber]], &quot;^\+(\d{2})\s(\d{10})&quot;, &quot;${phoneNumber}&quot;)
</code></pre><ul>
<li><strong>source</strong>: <ul>
<li><code>telephoneNumber</code> = &quot;+91 9998887777&quot;</li>
</ul>
</li>
<li><strong>regexPattern</strong>: <ul>
<li><code>&quot;^\+(\d{2})\s(\d{10})&quot;</code></li>
</ul>
</li>
<li><strong>replacementValue</strong>: <ul>
<li><code>&quot;${phoneNumber}&quot;</code></li>
</ul>
</li>
<li><strong>Expression output</strong>: <ul>
<li><code>9998887777</code></li>
</ul>
</li>
</ul>
<p>You can also use this pattern to remove characters and condense a string. For example, the next expression removes parentheses, dashes, and space characters from the mobile number string and returns only digits:</p>
<pre><code class="lang-plaintext">Replace([mobile], &quot;[()\\s-]+&quot;, &quot;&quot;)
</code></pre><ul>
<li><strong>source</strong>: <ul>
<li><code>mobile</code> = &quot;+1 (999) 888-7777&quot;</li>
</ul>
</li>
<li><strong>regexPattern</strong>: <ul>
<li><code>&quot;[()\\s-]+&quot;</code></li>
</ul>
</li>
<li><strong>replacementValue</strong>: <ul>
<li><code>&quot;&quot;</code> (empty string)</li>
</ul>
</li>
<li><strong>Expression output</strong>: <ul>
<li><code>19998887777</code></li>
</ul>
</li>
</ul>
<h2 id="example-4-regex-pattern-regex-group-name-and-replacement-value">Example 4: Regex Pattern, Regex Group Name, and Replacement Value</h2>
<p>You can use regexPattern, regexGroupName, and replacementValue to extract a specific portion of the source string and replace it with another literal value or empty string.</p>
<h3 id="scenario-1">Scenario</h3>
<p>Your source system has an attribute <code>AddressLineData</code> with street number and name. For a recent move, only the street number of the address changed. To update only the street number part of the address:</p>
<pre><code class="lang-plaintext">Replace([AddressLineData], &quot;(?&lt;=^)(\d+)(?=\s.*)&quot;, &quot;888&quot;)
</code></pre><ul>
<li><strong>source</strong>: <ul>
<li><code>AddressLineData</code> = &quot;545 Tremont Street&quot;</li>
</ul>
</li>
<li><strong>regexPattern</strong>: <ul>
<li><code>&quot;(?&lt;=^)(\d+)(?=\s.*)&quot;</code></li>
</ul>
</li>
<li><strong>replacementValue</strong>: <ul>
<li><code>&quot;888&quot;</code></li>
</ul>
</li>
<li><strong>Expression output</strong>: <ul>
<li>&quot;888 Tremont Street&quot;</li>
</ul>
</li>
</ul>
<h2 id="regular-expressions-and-attribute-replacement-examples">Regular Expressions and Attribute Replacement Examples</h2>
<h3 id="example-4-street-number-replacement">Example 4: Street Number Replacement</h3>
<ul>
<li><strong>source</strong>: <code>streetNumber=&quot;123&quot;</code></li>
<li><strong>regexPattern</strong>: <code>&quot;(?&lt;=streetNumber^)\d+&quot;</code></li>
<li><strong>regexGroupName</strong>: <code>&quot;streetNumber&quot;</code></li>
<li><strong>replacementValue</strong>: <code>&quot;888&quot;</code></li>
<li><strong>Expression output</strong>: <code>888 Tremont Street</code></li>
</ul>
<h3 id="example-5-domain-suffix-removal">Example 5: Domain Suffix Removal</h3>
<p>Removes the domain suffix from a UPN to generate login ID without domain suffix.</p>
<ul>
<li><strong>source</strong>: <code>[userPrincipalName] = &quot;jsmith@contoso.com&quot;</code></li>
<li><strong>regexPattern</strong>: <code>&quot;(?&lt;=\@.*)&quot;</code></li>
<li><strong>regexGroupName</strong>: <code>&quot;Suffix&quot;</code></li>
<li><strong>replacementValue</strong>: <code>&quot;&quot;</code> (empty string)</li>
<li><strong>Expression output</strong>: <code>jsmith</code></li>
</ul>
<h3 id="example-6-handling-empty-telephone-numbers">Example 6: Handling Empty Telephone Numbers</h3>
<p>Uses regex to extract exact 10 digits of the mobile number attribute when the source attribute is empty.</p>
<ul>
<li><strong>source</strong>: <code>[telephoneNumber] = &quot;&quot;</code> (empty string)</li>
<li><strong>regexPattern</strong>: <code>&quot;\+(\d{2})(\d{10})&quot;</code></li>
<li><strong>regexGroupName</strong>: <code>&quot;phoneNumber&quot;</code></li>
<li><strong>replacementAttributeName</strong>: <code>[mobile] = &quot;+91 8887779999&quot;</code></li>
<li><strong>Expression output</strong>: <code>8887779999</code></li>
</ul>
<h3 id="example-7-removing-certain-characters">Example 7: Removing Certain Characters</h3>
<p>Targets and removes specific characters from a string value using regex.</p>
<ul>
<li><strong>source</strong>: <code>[mailNickname] = &quot;john_doe72&quot;</code></li>
<li><strong>oldValue</strong>: <code>&quot;[\-a-zA-Z]+,&quot;</code></li>
<li><strong>replaceValue</strong>: <code>&quot;&quot;</code></li>
<li><strong>Expression output</strong>: <code>72</code></li>
</ul>
<h2 id="selectuniquevalue">SelectUniqueValue</h2>
<h3 id="function-14">Function:</h3>
<p><code>SelectUniqueValue(uniqueValueRule1, uniqueValueRule2, uniqueValueRule3, ...)</code></p>
<h3 id="description-27">Description:</h3>
<p>Requires a minimum of two arguments, which are unique value generation rules defined using expressions. The function evaluates each rule and then checks the value generated for uniqueness in the target app/directory. The first unique value found will be the one returned. If all of the values already exist in the target, the entry will get escrowed, and the reason gets logged in the audit logs. There is no upper bound to the number of arguments that can be provided.</p>
<ul>
<li>This function must be at the top-level and cannot be nested.</li>
<li>This function cannot be applied to attributes that have a matching precedence.</li>
<li>This function is only meant to be used for entry creations. When using it with an attribute, set the Apply Mapping property to Only during object creation.</li>
<li>This function is currently only supported for &quot;Workday to Active Directory User Provisioning&quot; and &quot;SuccessFactors to Active Directory User Provisioning&quot;. It cannot be used with other provisioning applications.</li>
<li>The LDAP search that <code>SelectUniqueValue</code> function performs in on-premises Active Directory doesn&#39;t escape special characters like diacritics. If you pass a string like &quot;Jessica Smith&quot; that contains a special character, you will encounter processing errors. Nest the <code>NormalizeDiacritics</code> function as shown in the example below to normalize special characters.</li>
</ul>
<h3 id="parameters-32">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>uniqueValueRule1…</td>
<td>At least 2 are required, no upper bound</td>
<td>String</td>
<td>List of unique value generation rules to evaluate.</td>
</tr>
</tbody>
</table>
<h3 id="generate-unique-value-for-userprincipalname-upn-attribute">Generate unique value for userPrincipalName (UPN) attribute</h3>
<p>Example: Based on the user&#39;s first name, middle name and last name, you need to generate a value for the UPN attribute and check for its uniqueness in the target AD directory before assigning the value to the UPN attribute.</p>
<h4 id="expression-2">Expression:</h4>
<p><code>ad-attr-mapping-expr</code></p>
<h2 id="select-unique-value-function">Select Unique Value Function</h2>
<pre><code>SelectUniqueValue(
    Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, 
    [PreferredFirstName], [PreferredLastName]))), &quot;contoso.com&quot;),
    Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, 
    Mid([PreferredFirstName], 1, 1), [PreferredLastName]))), &quot;contoso.com&quot;),
    Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, 
    Mid([PreferredFirstName], 1, 2), [PreferredLastName]))), &quot;contoso.com&quot;)
)
</code></pre><h3 id="sample-inputoutput-3">Sample input/output:</h3>
<ul>
<li>INPUT (PreferredFirstName): &quot;John&quot;</li>
<li>INPUT (PreferredLastName): &quot;Smith&quot;</li>
<li>OUTPUT: &quot;John.Smith@contoso.com&quot; if UPN value of John.Smith@contoso.com doesn&#39;t already exist in the directory</li>
<li>OUTPUT: &quot;J.Smith@contoso.com&quot; if UPN value of John.Smith@contoso.com already exists in the directory</li>
<li>OUTPUT: &quot;Jo.Smith@contoso.com&quot; if the above two UPN values already exist in the directory</li>
</ul>
<h2 id="singleapproleassignment">SingleAppRoleAssignment</h2>
<h3 id="function-15">Function</h3>
<p><code>SingleAppRoleAssignment({appRoleAssignments})</code></p>
<h3 id="description-28">Description</h3>
<p>Returns a single appRoleAssignment from the list of all appRoleAssignments assigned to a user for a given application. This function is required to convert the appRoleAssignments object into a single role name string. The best practice is to ensure only one appRoleAssignment is assigned to one user at a time. This function isn&#39;t supported in scenarios where users have multiple app role assignments.</p>
<h3 id="parameters-33">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>[appRoleAssignments]</td>
<td>Required</td>
<td>String</td>
<td>appRoleAssignments object.</td>
</tr>
</tbody>
</table>
<h2 id="split">Split</h2>
<h3 id="function-16">Function</h3>
<p><code>Split(source, delimiter)</code></p>
<h2 id="split-a-string-into-a-multi-valued-array">Split a String into a Multi-Valued Array</h2>
<h3 id="description-29">Description</h3>
<p>Splits a string into a multi-valued array, using the specified delimiter character.</p>
<h3 id="parameters-34">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>source value to update</td>
</tr>
<tr>
<td>delimiter</td>
<td>Required</td>
<td>String</td>
<td>Specifies the character that will be used to split the string (example: &quot;,&quot;)</td>
</tr>
</tbody>
</table>
<h3 id="example-14">Example</h3>
<p>You need to take a comma-delimited list of strings, and split them into an array that can be plugged into a multi-value attribute like Salesforce&#39;s PermissionSets attribute. In this example, a list of permission sets has been populated in extensionAttribute5 in Microsoft Entra ID.</p>
<p><strong>Expression:</strong> <code>Split(extensionAttribute5, &quot;,&quot;)</code></p>
<p><strong>Sample input/output:</strong></p>
<ul>
<li><strong>INPUT</strong> (extensionAttribute5): &quot;PermissionSetOne, PermissionSetTwo&quot;</li>
<li><strong>OUTPUT</strong>: [&quot;PermissionSetOne&quot;, &quot;PermissionSetTwo&quot;]</li>
</ul>
<h2 id="stripspaces">StripSpaces</h2>
<h3 id="function-17">Function</h3>
<p><code>StripSpaces(source)</code></p>
<h3 id="description-30">Description</h3>
<p>Removes all space (&quot; &quot;) characters from the source string.</p>
<h3 id="parameters-35">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>source value to update</td>
</tr>
</tbody>
</table>
<h2 id="switch">Switch</h2>
<h3 id="function-18">Function:</h3>
<p>Switch(source, defaultValue, key1, value1, key2, value2, ...)</p>
<h3 id="description-31">Description:</h3>
<p>When source value matches a key, returns value for that key. If source value doesn&#39;t match any keys, returns defaultValue. Key and value parameters must always come in pairs. The function always expects an even number of parameters. The function shouldn&#39;t be used for referential attributes such as manager.</p>
<h3 id="note-1">Note</h3>
<p>Switch function performs a case-sensitive string comparison of the source and key values. If you&#39;d like to perform a case-insensitive comparison, normalize the source string before comparison using a nested ToLower function and ensure that all key strings use lowercase. Example: <code>Switch(ToLower([statusFlag]), &quot;0&quot;, &quot;true&quot;, &quot;1&quot;, &quot;false&quot;, &quot;0&quot;)</code>. In this example, the source attribute statusFlag may have values (&quot;True&quot; / &quot;true&quot; / &quot;TRUE&quot;). However, the Switch function will always convert it to lowercase string &quot;true&quot; before comparison with key parameters.</p>
<h3 id="caution">Caution</h3>
<p>For the source parameter, do not use the nested functions IsPresent, IsNull or IsNullOrEmpty. Instead use a literal empty string as one of the key values. Example: <code>Switch([statusFlag], &quot;Default Value&quot;, &quot;true&quot;, &quot;1&quot;, &quot;&quot;, &quot;0&quot;)</code>. In this example, if the source attribute statusFlag is empty, the Switch function will return the value 0.</p>
<h3 id="parameters-36">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Source value to update.</td>
</tr>
<tr>
<td>defaultValue</td>
<td>Optional</td>
<td>String</td>
<td>Default value to be used when source doesn&#39;t match any keys. Can be empty string (&quot;&quot;).</td>
</tr>
<tr>
<td>key</td>
<td>Required</td>
<td>String</td>
<td>Key to compare source value with.</td>
</tr>
<tr>
<td>value</td>
<td>Required</td>
<td>String</td>
<td>Replacement value for the source matching the key.</td>
</tr>
</tbody>
</table>
<h2 id="replace-a-value-based-on-predefined-set-of-options">Replace a value based on predefined set of options</h2>
<p>Example: Define the time zone of the user based on the state code stored in Microsoft Entra ID. If the state code doesn&#39;t match any of the predefined options, use default value of &quot;Australia/Sydney&quot;.</p>
<p><strong>Expression</strong>: <code>Switch([state], &quot;Australia/Sydney&quot;, &quot;NSW&quot;, &quot;Australia/Sydney&quot;, &quot;QLD&quot;, &quot;Australia/Brisbane&quot;, &quot;SA&quot;, &quot;Australia/Adelaide&quot;)</code></p>
<h3 id="sample-inputoutput-4">Sample input/output:</h3>
<ul>
<li>INPUT (state): &quot;QLD&quot;</li>
<li>OUTPUT: &quot;Australia/Brisbane&quot;</li>
</ul>
<h2 id="tolower">ToLower</h2>
<h3 id="function-tolowersource-culture">Function: ToLower(source, culture)</h3>
<p><strong>Description</strong>: Takes a <code>source</code> string value and converts it to lower case using the culture rules that are specified. If there is no <code>culture</code> info specified, then it will use Invariant culture.</p>
<p>If you would like to set existing values in the target system to lower case, <a href="https://example.com">update the schema for your target application</a> and set the property caseExact to &#39;true&#39; for the attribute that you&#39;re interested in.</p>
<h3 id="parameters-37">Parameters:</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object</td>
</tr>
<tr>
<td>culture</td>
<td>Optional</td>
<td>String</td>
<td>The format for the culture name based on RFC 4646 is <code>languagecode2-country/regioncode2</code>, where <code>languagecode2</code> is the two-letter language code and <code>country/regioncode2</code> is the two-letter subculture code. Examples include ja-JP for Japanese (Japan) and en-US for English (United States). In cases where a two-letter language code isn&#39;t available, a three-letter code derived from ISO 639-2 is used.</td>
</tr>
</tbody>
</table>
<h2 id="convert-generated-userprincipalname-upn-value-to-lower-case">Convert generated userPrincipalName (UPN) value to lower case</h2>
<h2 id="example-generating-upn-value">Example: Generating UPN Value</h2>
<p>You would like to generate the UPN value by concatenating the PreferredFirstName and PreferredLastName source fields and converting all characters to lower case.</p>
<pre><code>ToLower(Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, [PreferredFirstName], [PreferredLastName]))), &quot;contoso.com&quot;))
</code></pre><h3 id="sample-inputoutput-5">Sample Input/Output:</h3>
<ul>
<li><strong>INPUT (PreferredFirstName):</strong> &quot;John&quot;</li>
<li><strong>INPUT (PreferredLastName):</strong> &quot;Smith&quot;</li>
<li><strong>OUTPUT:</strong> &quot;john.smith@contoso.com&quot;</li>
</ul>
<h2 id="toupper">ToUpper</h2>
<h3 id="function-touppersource-culture">Function: ToUpper(source, culture)</h3>
<h3 id="description-32">Description</h3>
<p>Takes a source string value and converts it to upper case using the culture rules that are specified. If there is no culture info specified, then it will use Invariant culture.</p>
<p>If you would like to set existing values in the target system to upper case, update the schema for your target application and set the property caseExact to &#39;true&#39; for the attribute that you&#39;re interested in.</p>
<h3 id="parameters-38">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>culture</td>
<td>Optional</td>
<td>String</td>
<td>The format for the culture name based on RFC 4646 is languagecode2-country/regioncode2, where languagecode2 is the two-letter language code and country/regioncode2 is the two-letter subculture code. Examples include ja-JP for Japanese (Japan) and en-US for English (United States). In cases where a two-letter language code isn’t available, a three-letter code derived from ISO 639-2 is used.</td>
</tr>
</tbody>
</table>
<h2 id="function-wordstringwordnumberdelimiters">Function: Word(String,WordNumber,Delimiters)</h2>
<h3 id="description-33">Description</h3>
<p>The Word function returns a word contained within a string, based on parameters describing the delimiters to use and the word number to return. Each string of characters in string separated by the one of the characters in delimiters are identified as words:</p>
<p>If number &lt; 1, returns empty string. If string is null, returns empty string. If string contains less than number words, or string doesn&#39;t contain any words identified by delimiters, an empty string is returned.</p>
<h3 id="parameters-39">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>Required</td>
<td>Multi-valued Attribute</td>
<td>String to return a word from.</td>
</tr>
<tr>
<td>WordNumber</td>
<td>Required</td>
<td>Integer</td>
<td>Number identifying which word number should return</td>
</tr>
<tr>
<td>delimiters</td>
<td>Required</td>
<td>String</td>
<td>A string representing the delimiter(s) that should be used to identify words</td>
</tr>
</tbody>
</table>
<h3 id="example-15">Example</h3>
<p>Word(&quot;The quick brown fox&quot;,3, &quot; &quot;)<br>Returns &quot;brown&quot;.</p>
<p>Word(&quot;This,string!has&amp;many separators&quot;,3,&quot; !&amp;#&quot;)<br>Returns &quot;has&quot;.</p>
<h3 id="examples-1">Examples</h3>
<p>This section provides more expression function usage examples.</p>
<h4 id="strip-known-domain-name">Strip known domain name</h4>
<p>Strip a known domain name from a user&#39;s email to obtain a user name. For example, if the domain is &quot;contoso.com&quot;, then you could use the following expression:</p>
<p>Expression: Replace([mail], &quot;@contoso.com&quot;, &quot;&quot;, &quot;&quot;)</p>
<h2 id="sample-input--output">Sample Input / Output</h2>
<ul>
<li>INPUT (mail): &quot;john.doe@contoso.com&quot;</li>
<li>OUTPUT: &quot;john.doe&quot;</li>
</ul>
<h2 id="generate-user-alias-by-concatenating-parts-of-first-and-last-name">Generate User Alias by Concatenating Parts of First and Last Name</h2>
<p>Generate a user alias by taking first three letters of user&#39;s first name and first five letters of user&#39;s last name.</p>
<p>Expression: <code>Append(Mid([givenName], 1, 3), Mid([surname], 1, 5))</code></p>
<h3 id="sample-inputoutput-6">Sample input/output:</h3>
<ul>
<li>INPUT (givenName): &quot;John&quot;</li>
<li>INPUT (surname): &quot;Doe&quot;</li>
<li>OUTPUT: &quot;JohDoe&quot;</li>
</ul>
<h2 id="add-a-comma-between-last-name-and-first-name">Add a Comma Between Last Name and First Name</h2>
<p>Add a comma between last name and first name.</p>
<p>Expression: <code>Join(&quot;, &quot;, [surname], [givenName])</code></p>
<h3 id="sample-inputoutput-7">Sample input/output:</h3>
<ul>
<li>INPUT (givenName): &quot;John&quot;</li>
<li>INPUT (surname): &quot;Doe&quot;</li>
<li>OUTPUT: &quot;Doe, John&quot;</li>
</ul>
<h2 id="generate-an-id-for-a-user-based-on-their-microsoft-entra-id-object-id">Generate an ID for a User Based on Their Microsoft Entra ID Object ID</h2>
<p>Remove any letters from the ID and add 1000 at the beginning.</p>
<p>This expression allows you to generate an identifier for a user that starts with 1000 and is likely to be unique.</p>
<p>Expression: <code>Join(&quot;&quot;, 1000, Replace(ConvertToUTF8Hex([objectId]), &quot;[a-zA-Z]*&quot;, &quot;&quot;))</code></p>
<h3 id="sample-inputoutput-8">Sample input/output:</h3>
<ul>
<li>INPUT: &quot;d05e47b1-3909-445a-ba5e-ca60cbc0e4b4&quot;</li>
</ul>
<h2 id="output-8">OUTPUT:</h2>
<p>&quot;10006430356534376231233393039234343561262613565263613630636263065346234&quot;</p>
<h2 id="related-articles-1">Related Articles</h2>
<ul>
<li>Automate User Provisioning/Deprovisioning to SaaS Apps</li>
<li>Customizing Attribute Mappings for User Provisioning</li>
<li>Scoping Filters for User Provisioning</li>
<li>Using SCIM to enable automatic provisioning of users and groups from Microsoft Entra ID to applications</li>
<li>Account Provisioning Notifications</li>
<li>List of Tutorials on How to Integrate SaaS Apps</li>
</ul>
</userobjectid></article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Follow this project on github <a href="https://github.com/douglasware/ElumenotionSite">Elumenotion Site and Samples</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>