<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Multitenant organizations documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Multitenant organizations documentation ">
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../styles/docfx.min.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      
      

      <script>
        MathJax = {
          options: {
            processHtmlClass: ['tex2jax_process', 'math']
          }
        };
      </script>

      <script type="text/javascript" src="../../styles/docfx.min.js"></script>
      <script type="text/javascript" src="../../styles/main.js"></script>
  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="png" src="../../logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="multitenant-organizations-documentation">Multitenant organizations documentation</h1>

<p>A multitenant organization is an organization that has more than one instance of Microsoft Entra ID. Describes ways that users can have a seamless experience accessing resources and collaborating across multiple tenants.</p>
<h1 id="about-multitenant-organizations">About multitenant organizations</h1>
<h2 id="overview">OVERVIEW</h2>
<p>Multitenant organization capabilities</p>
<p>Compare multitenant capabilities</p>
<p>Configure a multitenant organization</p>
<h2 id="overview-1">OVERVIEW</h2>
<p>What is a multitenant organization?</p>
<h2 id="how-to-guide">HOW-TO GUIDE</h2>
<p>Microsoft 365 admin center</p>
<p>PowerShell or Microsoft Graph API</p>
<p>Configure cross-tenant synchronization</p>
<h2 id="overview-2">OVERVIEW</h2>
<p>What is cross-tenant synchronization?</p>
<h2 id="how-to-guide-1">HOW-TO GUIDE</h2>
<p>Microsoft Entra admin center</p>
<p>PowerShell or Microsoft Graph API</p>
<p>Collaborate in Microsoft 365</p>
<p>CONCEPT</p>
<p>Identity provisioning for Microsoft 365<br>Microsoft 365 multitenant people search<br>Plan for multitenant organizations in Microsoft 365</p>
<p>At the top of the image, there is a heading titled “Collaborate in Microsoft 365” which is underlined. Below it, the section labeled “CONCEPT” includes a list of related topics, which are:</p>
<ol>
<li>Identity provisioning for Microsoft 365  </li>
<li>Microsoft 365 multitenant people search  </li>
<li>Plan for multitenant organizations in Microsoft 365</li>
</ol>
<p>This describes the textual content and organization of the information on the page.</p>
<h1 id="multitenant-organization-capabilities-in-microsoft-entra-id">Multitenant organization capabilities in Microsoft Entra ID</h1>
<p>Article · 04/23/2024</p>
<p>This article provides an overview of the multitenant organization scenario and the related capabilities in Microsoft Entra ID.</p>
<h1 id="what-is-a-tenant">What is a tenant?</h1>
<p>A tenant is an instance of Microsoft Entra ID in which information about a single organization resides including organizational objects such as users, groups, and devices and also application registrations, such as Microsoft 365 and third-party applications. A tenant also contains access and compliance policies for resources, such as applications registered in the directory. The primary functions served by a tenant include identity authentication as well as resource access management.</p>
<p>From a Microsoft Entra perspective, a tenant forms an identity and access management scope. For example, a tenant administrator makes an application available to some or all the users in the tenant and enforces access policies on that application for users in that tenant. In addition, a tenant contains organizational branding data that drives end-user experiences, such as the organizations email domains and SharePoint URLs used by employees in that organization. From a Microsoft 365 perspective, a tenant forms the default collaboration and licensing boundary. For example, users in Microsoft Teams or Microsoft Outlook can easily find and collaborate with other users in their tenant, but don&#39;t have the ability to find or see users in other tenants.</p>
<p>Tenants contain privileged organizational data and are securely isolated from other tenants. In addition, tenants can be configured to have data persisted and processed in a specific region or cloud, which enables organizations to use tenants as a mechanism to meet data residency and handling compliance requirements.</p>
<h1 id="what-is-a-multitenant-organization">What is a multitenant organization?</h1>
<p>A multitenant organization is an organization that has more than one instance of Microsoft Entra ID. Here are the primary reasons why an organization might have multiple tenants:</p>
<p>· Conglomerates: Organizations with multiple subsidiaries or business units that operate independently.</p>
<p>· Mergers and acquisitions: Organizations that merge or acquire companies.</p>
<p>· Divestiture activity: In a divestiture, one organization splits off part of its business to form a new organization or sell it to an existing organization.</p>
<p>· Multiple clouds: Organizations that have compliance or regulatory needs to exist in multiple cloud environments.</p>
<p>· Multiple geographical boundaries: Organizations that operate in multiple geographic locations with various residency regulations.</p>
<p>· Test or staging tenants: Organizations that need multiple tenants for testing or staging purposes before deploying more broadly to primary tenants.</p>
<p>· Department or employee-created tenants: Organizations where departments or employees have created tenants for development, testing, or separate control.</p>
<p>Multitenant challenges</p>
<p>Your organization may have recently acquired a new company, merged with another company, or restructured based on newly formed business units. If you have disparate identity management systems, it might be challenging for users in different tenants to access resources and collaborate.</p>
<p>The following diagram shows how users in other tenants might not be able to access applications across tenants in your organization.</p>
<figure>

Figure Description: The diagram illustrates access issues in a multitenant environment. It shows two tenant symbols, &quot;Tenant&quot; and &quot;Primary Tenant,&quot; with bidirectional arrows between them indicating potential communication or access paths. Red crosses on some arrows suggest barriers to this access.

<code>mermaid
graph TD;
    Tenant --&gt;|Access Denied| PrimaryTenant[Primary Tenant]
    PrimaryTenant --&gt;|Access Denied| Tenant
    Tenant --&gt;|Access Allowed| PrimaryTenant
    PrimaryTenant --&gt;|Access Allowed| Tenant</code>

</figure>

<p>As your organization evolves, your IT team must adapt to meet the changing needs. This often includes integrating with an existing tenant or forming a new one. Regardless of how the identity infrastructure is managed, it&#39;s critical that users have a seamless experience accessing resources and collaborating. Today, you may be using custom scripts or on-premises solutions to bring the tenants together to provide a seamless experience across tenants.</p>
<p>B2B direct connect</p>
<p>To enable users across tenants to collaborate in Teams Connect shared channels, you can use Microsoft Entra B2B direct connect. B2B direct connect is a feature of External Identities that lets you set up a mutual trust relationship with another Microsoft Entra organization for seamless collaboration in Teams. When the trust is established, the B2B direct connect user has single sign-on access using credentials from their home tenant.</p>
<h1 id="heres-the-primary-constraint-with-using-b2b-direct-connect-across-multiple-tenants">Here&#39;s the primary constraint with using B2B direct connect across multiple tenants:</h1>
<ul>
<li>Currently, B2B direct connect works only with Teams Connect shared channels.</li>
</ul>
<p>Figure: A flow diagram showing &quot;B2B direct connect users&quot; moving between a &quot;Tenant&quot; and a &quot;Primary tenant&quot;, both connected to &quot;Teams Connect shared channels&quot;.</p>
<pre><code class="lang-mermaid">graph LR;
    B2B_direct_connect_users--&gt;Tenant;
    Tenant--&gt;Primary_tenant;
    Primary_tenant--&gt;Teams_Connect_shared_channels;
    Teams_Connect_shared_channels--&gt;B2B_direct_connect_users;
</code></pre><p>For more information, see B2B direct connect overview.</p>
<h1 id="b2b-collaboration">B2B collaboration</h1>
<p>To enable users across tenants to collaborate, you can use Microsoft Entra B2B collaboration. B2B collaboration is a feature within External Identities that lets you invite guest users to collaborate with your organization. Once the external user has redeemed their invitation or completed sign-up, they&#39;re represented in your tenant as a user object. With B2B collaboration, you can securely share your company&#39;s applications and services with external users, while maintaining control over your own corporate data.</p>
<p>Here are the primary constraints with using B2B collaboration across multiple tenants:</p>
<ul>
<li>Administrators must invite users using the B2B invitation process or build an onboarding experience using the B2B collaboration invitation manager.</li>
<li>Administrators might have to synchronize users using custom scripts.</li>
<li>Depending on automatic redemption settings, users might need to accept a consent prompt and follow a redemption process in each tenant.</li>
<li>By default, users are of type external guest, which has different permissions than external member and might not be the desired user experience.</li>
</ul>
<p>Figure: Diagram showing &quot;B2B collab users&quot; in a flow between &quot;Tenant&quot; and &quot;Primary tenant&quot; linked to &quot;Microsoft apps&quot; and &quot;Non-Microsoft apps&quot;.</p>
<pre><code class="lang-mermaid">graph LR;
    Tenant--&gt;Primary_tenant;
    Primary_tenant--&gt;Microsoft_apps;
    Primary_tenant--&gt;Non_Microsoft_apps;
    B2B_collab_users--&gt;Tenant;
    Tenant--&gt;B2B_collab_users;
    B2B_collab_users--&gt;Primary_tenant;
    Primary_tenant--&gt;B2B_collab_users;
</code></pre><p>For more information, see B2B collaboration overview.</p>
<h1 id="cross-tenant-synchronization">Cross-tenant synchronization</h1>
<p>If you want users to have a more seamless collaboration experience across tenants, you can use cross-tenant synchronization. Cross-tenant synchronization is a one-way synchronization service in Microsoft Entra ID that automates creating, updating, and deleting B2B collaboration users across tenants in an organization. Cross-tenant synchronization builds on the B2B collaboration functionality and utilizes existing B2B cross-tenant access settings. Users are represented in the target tenant as a B2B collaboration user object.</p>
<p>Here are the primary benefits with using cross-tenant synchronization:</p>
<p>· Automatically create B2B collaboration users within your organization and provide them access to the applications they need, without creating and maintaining custom scripts.</p>
<p>· Improve the user experience and ensure that users can access resources, without receiving an invitation email and having to accept a consent prompt in each tenant.</p>
<p>· Automatically update users and remove them when they leave the organization.</p>
<p>Here are the primary constraints with using cross-tenant synchronization across multiple tenants:</p>
<p>· Doesn&#39;t enhance the current Teams or Microsoft 365 experiences. Synchronized users will have the same cross-tenant Teams and Microsoft 365 experiences available to any other B2B collaboration user.</p>
<p>· Doesn&#39;t synchronize groups, devices, or contacts.</p>
<p>The figure demonstrates the process of cross-tenant synchronization for B2B collaboration users between source and target tenants. It shows:</p>
<ul>
<li>B2B collaboration users are used as External members.</li>
<li>These users move between a source tenant and a target tenant.</li>
<li>The synchronization includes Microsoft apps but excludes non-Microsoft apps.</li>
</ul>
<pre><code class="lang-mermaid">graph LR;
    SourceTenant(&quot;Source tenant&quot;) --&gt;|B2B collab users (External members)| CrossTenantSync1(&quot;Cross-tenant sync&quot;);
    CrossTenantSync1 --&gt; TargetTenant(&quot;Target tenant&quot;);
    TargetTenant --&gt;|Access to| MicrosoftApps(&quot;Microsoft apps&quot;);
    src(TargetTenant) --&gt;|No access to| NonMicrosoftApps(&quot;Non-Microsoft apps&quot;);
    SourceTenant --&gt; CrossTenantSync2(&quot;Cross-tenant sync&quot;);
    CrossTenantSync2 --&gt; SourceTenant;
</code></pre><p>For more information, see What is cross-tenant synchronization?.</p>
<h1 id="multitenant-organization">Multitenant organization</h1>
<p>Multitenant organization is a feature in Microsoft Entra ID and Microsoft 365 that enables you to form a tenant group within your organization. Each pair of tenants in the group is governed by cross-tenant access settings that you can use to configure B2B or cross-tenant synchronization.</p>
<p>Here are the primary benefits of a multitenant organization:</p>
<p>· Differentiate in-organization and out-of-organization external users</p>
<p>· Improved collaborative experience in new Microsoft Teams</p>
<p>· Improved people search experience across tenants</p>
<p>Figure: The image represents a network diagram showing the relationships between an owner tenant and two member tenants, all interconnected through cross-tenant access settings. The owner tenant (C) is depicted with links to both member tenants (A and B), indicating the pathways for access and information flow.</p>
<pre><code class="lang-mermaid">graph TD;
    OwnerTenantC[&quot;Owner tenant (C)&quot;] --&gt; MemberTenantA[&quot;Member tenant (A)&quot;]
    OwnerTenantC[&quot;Owner tenant (C)&quot;] --&gt; MemberTenantB[&quot;Member tenant (B)&quot;]
    MemberTenantA[&quot;Member tenant (A)&quot;] --&gt; MemberTenantB[&quot;Member tenant (B)&quot;]
</code></pre><p>For more information, see What is a multitenant organization in Microsoft Entra ID?.</p>
<h1 id="compare-multitenant-capabilities">Compare multitenant capabilities</h1>
<p>Depending on the needs of your organization, you can use any combination of B2B direct connect, B2B collaboration, cross-tenant synchronization, and multitenant organization capabilities. B2B direct connect and B2B collaboration are independent capabilities, while cross-tenant synchronization and multitenant organization capabilities are independent of each other, though both rely on underlying B2B collaboration.</p>
<p>The following table compares the capabilities of each feature. For more information about different external identity scenarios, see Comparing External Identities feature sets.</p>
<table>
<thead>
<tr>
<th></th>
<th>B2B direct connect (Org-to-org external or internal)</th>
<th>B2B collaboration (Org-to-org external or internal)</th>
<th>Cross-tenant synchronization (Org internal)</th>
<th>Multitenant organization (Org internal)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Purpose</td>
<td>Users can access Teams Connect shared channels hosted in external tenants.</td>
<td>Users can access apps/resources hosted in external tenants, usually with limited guest privileges. Depending on automatic redemption settings, users might need to accept a consent prompt in each tenant.</td>
<td>Users can seamlessly access apps/resources across the same organization, even if they&#39;re hosted in different tenants.</td>
<td>Users can more seamlessly collaborate across a multitenant organization in new Teams and people search.</td>
</tr>
<tr>
<td>Value</td>
<td>Enables external collaboration within Teams Connect shared channels only. More convenient for administrators because they don&#39;t have to manage B2B external users.</td>
<td>Enables external collaboration. More control and monitoring for administrators by managing the B2B collaboration users. Administrators can limit the access that these external users have to their apps/resources.</td>
<td>Enables collaboration across organizational tenants. Administrators don&#39;t have to manually invite and synchronize users between tenants to ensure continuous access to apps/resources within the organization.</td>
<td>Enables collaboration across organizational tenants. Administrators continue to have full configuration ability via cross-tenant access settings. Optional cross-tenant access templates allow pre-configuration of cross-tenant access settings.</td>
</tr>
<tr>
<td>Primary administrator workflow</td>
<td>Configure cross-tenant access to provide external users inbound access to tenant the credentials for their home tenant.</td>
<td>Add external users to resource tenant by using the B2B invitation process or build your own onboarding experience using the B2B collaboration</td>
<td>Configure the cross-tenant synchronization engine to synchronize users between multiple tenants as B2B collaboration users.</td>
<td>Create a multitenant organization, add (invite) tenants, join a multitenant organization. Leverage existing B2B collaboration users or use cross-tenant synchronization to ensure continuous access to resources across tenants.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th></th>
<th>B2B direct connect (Org-to-org external or internal)</th>
<th>B2B collaboration (Org-to-org external or internal)</th>
<th>Cross-tenant synchronization (Org internal)</th>
<th>Multitenant organization (Org internal)</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td>invitation manager.</td>
<td></td>
<td>provision B2B collaboration users.</td>
</tr>
<tr>
<td>Trust level</td>
<td>Mid trust. B2B direct connect users are less easy to track, mandating a certain level of trust with the external organization.</td>
<td>Low to mid trust. User objects can be tracked easily and managed with granular controls.</td>
<td>High trust. All tenants are part of the same organization, and users are typically granted member access to all apps/resources.</td>
<td>High trust. All tenants are part of the same organization, and users are typically granted member access to all apps/resources.</td>
</tr>
<tr>
<td>Effect on users</td>
<td>Users access the resource tenant using the credentials for their home tenant. User objects aren&#39;t created in the resource tenant.</td>
<td>External users are added to a tenant as B2B collaboration users.</td>
<td>Within the same organization, users are synchronized from their home tenant to the resource tenant as B2B collaboration users.</td>
<td>Within the same multitenant organization, B2B collaboration users, particularly member users, benefit from enhanced, seamless collaboration across Microsoft 365.</td>
</tr>
<tr>
<td>User type</td>
<td>B2B direct connect user - N/A</td>
<td>B2B collaboration user</td>
<td>B2B collaboration user</td>
<td>B2B collaboration user</td>
</tr>
<tr>
<td></td>
<td></td>
<td>- External member (default) - External guest (default)</td>
<td>- External member (default) - External guest</td>
<td>- External member (default) - External guest</td>
</tr>
</tbody>
</table>
<p>The diagram illustrates the interaction and application of B2B direct connect, B2B collaboration, and cross-tenant synchronization. It shows a graphical representation of the collaboration and synchronization flows between different organizational models and how they facilitate various user interactions and trust levels in a multi-tenant environment.</p>
<pre><code class="lang-mermaid">graph TD;
    B2B_Direct_Connect[&quot;B2B Direct Connect (Org-to-org external/internal)&quot;]
    B2B_Collaboration[&quot;B2B Collaboration (Org-to-org external/internal)&quot;]
    Cross_Tenant_Synchronization[&quot;Cross-Tenant Synchronization (Org Internal)&quot;]

    B2B_Direct_Connect --&gt;|Facilitates connection without creating user objects in resource tenant| B2B_Collaboration
    B2B_Collaboration --&gt;|Provides detailed user management and member/guest roles| Cross_Tenant_Synchronization
    Cross_Tenant_Synchronization --&gt;|Involves synchronization of users within the same org| B2B_Collaboration
</code></pre><figure>

The diagram illustrates various business and collaboration scenarios across multiple organizations and how they are interconnected. It specifically shows:

- An internal organizational chart which connects to different tenant instances and collaborations.
- Business-to-business (B2B) collaboration featuring:
  - External members and guests associating with Adatum Corporation as an external collaborator.
  - Direct B2B connections involving Fabrikam (labeled as acquired) and Trey Research (labeled as an external collaborator).
  - A primary tenant labeled &quot;Contoso&quot; with a cross-tenant synchronization to Fabrikam, and external collaborations with Adatum Corporation and Trey Research.

<code>mermaid
graph TD;
    OrgInternal(&quot;Org internal&quot;)
    Contoso(&quot;Contoso (Primary tenant)&quot;)
    Fabrikam(&quot;Fabrikam (Acquired)&quot;)
    AdatumCorp(&quot;Adatum Corporation (External collaborator)&quot;)
    TreyResearch(&quot;Trey Research (External collaborator)&quot;)
    B2BCollabUsersMembers(&quot;B2B collab users (External members)&quot;)
    B2BCollabUsersGuests(&quot;B2B collab users (External guests)&quot;)
    B2BDirectConnect(&quot;B2B direct connect&quot;)
    B2BDirectConnectUsers(&quot;B2B direct connect users&quot;)
    CrossTenantSync(&quot;Cross-tenant sync&quot;)

    OrgInternal --&gt;|B2B collaboration| AdatumCorp
    OrgInternal --&gt;|B2B collaboration| B2BCollabUsersMembers
    OrgInternal --&gt;|B2B collaboration| B2BCollabUsersGuests
    OrgInternal --&gt;|Cross-tenant sync| Fabrikam
    Fabrikam --&gt;|B2B direct connect| Contoso 
    AdatumCorp --&gt;|B2B direct connect| Contoso 
    TreyResearch --&gt;|B2B direct connect| B2BDirectConnect
    B2BDirectConnect --&gt; Contoso</code>

</figure>

<h1 id="terminology">Terminology</h1>
<p>To better understand multitenant organization scenario related Microsoft Entra capabilities, you can refer back to the following list of terms.</p>
<ul>
<li>Expand table</li>
</ul>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>tenant</td>
<td>An instance of Microsoft Entra ID.</td>
</tr>
<tr>
<td>organization</td>
<td>The top level of a business hierarchy.</td>
</tr>
<tr>
<td>multitenant organization</td>
<td>An organization that has more than one instance of Microsoft Entra ID, as well as a capability to group those instances in Microsoft Entra ID.</td>
</tr>
<tr>
<td>creator tenant</td>
<td>The tenant that created the multitenant organization.</td>
</tr>
<tr>
<td>owner tenant</td>
<td>A tenant with the owner role. Initially, the creator tenant.</td>
</tr>
<tr>
<td>added tenant</td>
<td>A tenant that was added by an owner tenant.</td>
</tr>
<tr>
<td>joiner tenant</td>
<td>A tenant that is joining the multitenant organization.</td>
</tr>
<tr>
<td>join request</td>
<td>A joiner or added tenant submits a join request to join the multitenant organization.</td>
</tr>
<tr>
<td>pending tenant</td>
<td>A tenant that was added by an owner but that hasn&#39;t yet joined.</td>
</tr>
<tr>
<td>active tenant</td>
<td>A tenant that created or joined the multitenant organization.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>member tenant</td>
<td>A tenant with the member role. Most joiner tenants start as members.</td>
</tr>
<tr>
<td>multitenant organization tenant</td>
<td>An active tenant of the multitenant organization, not pending.</td>
</tr>
<tr>
<td>cross-tenant synchronization</td>
<td>A one-way synchronization service in Microsoft Entra ID that automates creating, updating, and deleting B2B collaboration users across tenants in an organization.</td>
</tr>
<tr>
<td>cross-tenant access settings</td>
<td>Settings to manage collaboration for specific Microsoft Entra organizations.</td>
</tr>
<tr>
<td>cross-tenant access settings template</td>
<td>An optional template to preconfigure cross-tenant access settings that are applied to any partner tenant newly joining the multitenant organization.</td>
</tr>
<tr>
<td>organizational settings</td>
<td>Cross-tenant access settings for specific Microsoft Entra organizations.</td>
</tr>
<tr>
<td>configuration</td>
<td>An application and underlying service principal in Microsoft Entra ID that includes the settings (such as target tenant, user scope, and attribute mappings) needed for cross-tenant synchronization.</td>
</tr>
<tr>
<td>provisioning</td>
<td>The process of automatically creating or synchronizing objects across a boundary.</td>
</tr>
<tr>
<td>automatic redemption</td>
<td>A B2B setting to automatically redeem invitations so newly created users don&#39;t receive an invitation email or have to accept a consent prompt when added to a target tenant.</td>
</tr>
</tbody>
</table>
<h1 id="next-steps">Next steps</h1>
<p>· What is a multitenant organization in Microsoft Entra ID?</p>
<p>· What is cross-tenant synchronization?</p>
<h1 id="what-is-a-multitenant-organization-in-microsoft-entra-id">What is a multitenant organization in Microsoft Entra ID?</h1>
<p>Article · 04/24/2024</p>
<p>Multitenant organization is a feature in Microsoft Entra ID and Microsoft 365 that enables you to form a tenant group within your organization. Each pair of tenants in the group is governed by cross-tenant access settings that you can use to configure B2B or cross-tenant synchronization.</p>
<h1 id="why-use-multitenant-organization">Why use multitenant organization?</h1>
<p>Here are the primary goals of multitenant organization:</p>
<p>· Define a group of tenants belonging to your organization</p>
<p>· Collaborate across your tenants in new Microsoft Teams</p>
<p>· Enable search and discovery of user profiles across your tenants through Microsoft 365 people search</p>
<h1 id="who-should-use-it">Who should use it?</h1>
<p>Organizations that own multiple Microsoft Entra tenants and want to streamline intra-organization cross-tenant collaboration in Microsoft 365.</p>
<p>The multitenant organization capability is built on the assumption of reciprocal provisioning of B2B member users across multitenant organization tenants.</p>
<p>As such, the multitenant organization capability assumes the simultaneous use of Microsoft Entra cross-tenant synchronization or an alternative bulk provisioning engine for external identities.</p>
<h1 id="benefits">Benefits</h1>
<p>Here are the primary benefits of a multitenant organization:</p>
<p>· Differentiate in-organization and out-of-organization external users</p>
<p>In Microsoft Entra ID, external users originating from within a multitenant organization can be differentiated from external users originating from outside the multitenant organization. This differentiation facilitates the application of different policies for in-organization and out-of-organization external users.</p>
<h1 id="improved-collaborative-experience-in-microsoft-teams">Improved collaborative experience in Microsoft Teams</h1>
<p>In new Microsoft Teams, multitenant organization users can expect an improved collaborative experience across tenants with chat, calling, and meeting start notifications from all connected tenants across the multitenant organization. Tenant switching is more seamless and faster. For more information, see Announcing more seamless collaboration in Microsoft Teams for multitenant organizations and Microsoft Teams: Advantages of the new architecture.</p>
<h1 id="improved-people-search-experience-across-tenants">Improved people search experience across tenants</h1>
<p>Across Microsoft 365 services, the multitenant organization people search experience is a collaboration feature that enables search and discovery of people across multiple tenants. Once enabled, users are able to search and discover synced user profiles in a tenant&#39;s global address list and view their corresponding people cards. For more information, see Microsoft 365 multitenant organization people search.</p>
<h1 id="how-does-a-multitenant-organization-work">How does a multitenant organization work?</h1>
<p>The multitenant organization capability enables you to form a tenant group within your organization. The following list describes the basic lifecycle of a multitenant organization.</p>
<h2 id="define-a-multitenant-organization">Define a multitenant organization</h2>
<p>One tenant administrator defines a multitenant organization as a grouping of tenants. The grouping of tenants isn&#39;t reciprocal until each listed tenant takes action to join the multitenant organization. The objective is a reciprocal agreement between all listed tenants.</p>
<h2 id="join-a-multitenant-organization">Join a multitenant organization</h2>
<p>Tenant administrators of listed tenants take action to join the multitenant organization. After joining, the multitenant organization relationship is reciprocal between each and every tenant that joined the multitenant organization.</p>
<h2 id="leave-a-multitenant-organization">Leave a multitenant organization</h2>
<p>Tenant administrators of listed tenants can leave a multitenant organization at any time. While a tenant administrator who defined the multitenant organization can add and remove listed tenants they don&#39;t control the other tenants.</p>
<p>A multitenant organization is established as a collaboration of equals. Each tenant administrator stays in control of their tenant and their membership in the multitenant organization.</p>
<h1 id="cross-tenant-access-settings">Cross-tenant access settings</h1>
<p>Administrators staying in control of their resources is a guiding principle for multitenant organization collaboration. Cross-tenant access settings are required for each tenant-to- tenant relationship. Tenant administrators explicitly configure, as needed, the following policies:</p>
<p>· Cross-tenant access partner configurations</p>
<p>For more information, see Configure cross-tenant access settings for B2B collaboration and crossTenantAccessPolicyConfigurationPartner resource type.</p>
<p>· Cross-tenant access identity synchronization</p>
<p>For more information, see Configure cross-tenant synchronization and crossTenantIdentitySyncPolicyPartner resource type.</p>
<h1 id="multitenant-organization-example">Multitenant organization example</h1>
<p>The following diagram shows three tenants A, B, and C that form a multitenant organization. It depicts a triangle where the three tenants (A, B, and C) are corners. The Owner tenant (C) is at the top corner, and the Member tenants (A) and (B) are at the left and right bottom corners respectively. Arrows between these tenants represent &quot;Cross-tenant access settings&quot;. There is a bi-directional arrow between each tenant, indicating the mutual settings configuration for access between them.</p>
<pre><code class="lang-mermaid">graph TD;
    OwnerTenantC[&quot;Owner tenant (C)&quot;] --&gt; MemberTenantA[&quot;Member tenant (A)&quot;]
    OwnerTenantC[&quot;Owner tenant (C)&quot;] --&gt; MemberTenantB[&quot;Member tenant (B)&quot;]
    MemberTenantA[&quot;Member tenant (A)&quot;] --&gt; MemberTenantB[&quot;Member tenant (B)&quot;]
</code></pre><table>
<thead>
<tr>
<th>Tenant</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>Administrators see a multitenant organization consisting of A, B, C. They also see cross-tenant access settings for B and C.</td>
</tr>
<tr>
<td>B</td>
<td>Administrators see a multitenant organization consisting of A, B, C. They also see cross-tenant access settings for A and C.</td>
</tr>
<tr>
<td>C</td>
<td>Administrators see a multitenant organization consisting of A, B, C. They also see cross-tenant access settings for A and B.</td>
</tr>
</tbody>
</table>
<h1 id="templates-for-cross-tenant-access-settings">Templates for cross-tenant access settings</h1>
<p>To ease the setup of homogenous cross-tenant access settings applied to partner tenants in the multitenant organization, the administrator of each multitenant organization tenant can configure optional cross-tenant access settings templates dedicated to the multitenant organization. These templates can be used to preconfigure cross-tenant access settings that are applied to any partner tenant newly joining the multitenant organization.</p>
<h1 id="tenant-role-and-state">Tenant role and state</h1>
<p>To facilitate the management of a multitenant organization, any given multitenant organization tenant has an associated role and state.</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Tenant role</td>
<td>Description</td>
</tr>
<tr>
<td>Owner</td>
<td>One tenant creates the multitenant organization. The multitenant organization creating tenant receives the role of owner. The privilege of the owner tenant is to add tenants into a pending state as well as to remove tenants from the multitenant organization. Also, an owner tenant can change the role of other multitenant organization tenants.</td>
</tr>
<tr>
<td>Member</td>
<td>Following the addition of pending tenants to the multitenant organization, pending tenants need to join the multitenant organization to turn their state from pending to active. Joined tenants typically start in the member role. Any member tenant has the privilege to leave the multitenant organization.</td>
</tr>
</tbody>
</table>
<pre><code class="lang-mermaid">graph TD;
    Owner[&quot;Owner (creates organization, adds/removes tenants, changes roles)&quot;] --&gt; Member[&quot;Member (joins and may leave the organization, starts from pending to active)&quot;]
</code></pre><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Tenant state</td>
<td>Description</td>
</tr>
<tr>
<td>Pending</td>
<td>A pending tenant has yet to join a multitenant organization. While listed in an administrator&#39;s view of the multitenant organization, a pending tenant isn&#39;t yet part of the multitenant organization, and as such is hidden from an end user&#39;s view of a multitenant organization.</td>
</tr>
<tr>
<td>Active</td>
<td>Following the addition of pending tenants to the multitenant organization, pending tenants need to join the multitenant organization to turn their state from pending to active. Joined tenants typically start in the member role. Any member tenant has the privilege to leave the multitenant organization.</td>
</tr>
</tbody>
</table>
<h1 id="constraints">Constraints</h1>
<p>The multitenant organization capability has been designed with the following constraints:</p>
<ul>
<li>Any given tenant can only create or join a single multitenant organization.</li>
<li>Any multitenant organization must have at least one active owner tenant.</li>
<li>Each active tenant must have cross-tenant access settings for all active tenants.</li>
<li>Any active tenant may leave a multitenant organization by removing themselves from it.</li>
<li>A multitenant organization is deleted when the only remaining active (owner) tenant leaves.</li>
</ul>
<h1 id="limits">Limits</h1>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Limit</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Maximum number of active tenants, including the owner tenant</td>
<td>100</td>
<td>The owner tenant can add more than 100 pending tenants, but they won&#39;t be able to join the multitenant organization if the limit is exceeded. This limit is applied at the time a pending tenant joins a multitenant organization. This limit is specific to the number of tenants in a multitenant organization. It does not apply to cross-tenant synchronization by itself. To increase this limit, submit a support request in the Microsoft Entra or Microsoft 365 admin center. In the Microsoft Graph APIs, the default limit of 100 tenants is only enforced at the time of joining. In Microsoft 365 admin center, the default limit is enforced at multitenant organization creation time and at time of joining.</td>
</tr>
</tbody>
</table>
<h1 id="external-user-segmentation">External user segmentation</h1>
<p>By defining a multitenant organization, as well as pivoting on the Microsoft Entra user property of userType, external identities are segmented as follows:</p>
<ul>
<li>External members originating from within a multitenant organization</li>
<li>External guests originating from within a multitenant organization</li>
<li>External members originating from outside of your organization</li>
<li>External guests originating from outside of your organization</li>
</ul>
<p>This segmentation of external users, due to the definition of a multitenant organization, enables administrators to better differentiate in-organization from out-of-organization external users.</p>
<p>External members originating from within a multitenant organization are called multitenant organization members.</p>
<p>Multitenant collaboration capabilities in Microsoft 365 aim to provide a seamless collaboration experience across tenant boundaries when collaborating with multitenant organization member users.</p>
<h1 id="choosing-between-microsoft-365-admin-center-and-cross-tenant-synchronization">Choosing between Microsoft 365 admin center and cross-tenant synchronization</h1>
<ul>
<li>If you haven&#39;t previously used Microsoft Entra cross-tenant synchronization, and you intend to establish a collaborating user set topology where the same set of users is shared to all multitenant organization tenants, you might want to use the Microsoft 365 admin center share users functionality.</li>
<li>If you&#39;re already using Microsoft Entra cross-tenant synchronization, for various multi-hub multi-spoke topologies, you don&#39;t need to use the Microsoft 365 admin center share users functionality. Instead, you might want to continue using your existing Microsoft Entra cross-tenant synchronization jobs.</li>
</ul>
<h1 id="get-started">Get started</h1>
<p>Here are the basic steps to get started using multitenant organization.</p>
<h2 id="step-1-plan-your-deployment">Step 1: Plan your deployment</h2>
<p>For more information, see Plan for multitenant organizations in Microsoft 365.</p>
<h1 id="step-2-create-your-multitenant-organization">Step 2: Create your multitenant organization</h1>
<p>Create your multitenant organization using Microsoft 365 admin center, Microsoft Graph PowerShell, or Microsoft Graph API:</p>
<ul>
<li>First tenant, soon-to-be owner tenant, creates a multitenant organization.</li>
<li>Owner tenant adds one or more joiner tenants.</li>
</ul>
<h2 id="step-3-join-a-multitenant-organization">Step 3: Join a multitenant organization</h2>
<p>Join a multitenant organization using Microsoft 365 admin center or Microsoft Graph PowerShell, or Microsoft Graph API:</p>
<ul>
<li>Joiner tenants submit a join request to join the multitenant organization of owner tenant.</li>
<li>To allow for asynchronous processing, wait up to 2 hours.</li>
</ul>
<p>Your multitenant organization is formed.</p>
<h1 id="step-4-synchronize-users">Step 4: Synchronize users</h1>
<p>Depending on your use case, you may want to synchronize users using one of the following methods:</p>
<ul>
<li>Synchronize users in multitenant organizations in Microsoft 365</li>
<li>Configure cross-tenant synchronization</li>
<li>Configure cross-tenant synchronization using PowerShell or Microsoft Graph API</li>
<li>Your alternative bulk provisioning engine</li>
</ul>
<h1 id="license-requirements">License requirements</h1>
<p>The multitenant organization capability requires Microsoft Entra ID P1 licenses. Only one Microsoft Entra ID P1 license is required per employee per multitenant organization. Also, you must have at least one Microsoft Entra ID P1 license per tenant. To find the right license for your requirements, see Compare generally available features of Microsoft Entra ID.</p>
<h1 id="next-steps-1">Next steps</h1>
<ul>
<li>Plan for multitenant organizations in Microsoft 365</li>
<li>What is cross-tenant synchronization?</li>
</ul>
<h1 id="what-is-cross-tenant-synchronization">What is cross-tenant synchronization?</h1>
<p>Article · 01/03/2024</p>
<p>Cross-tenant synchronization automates creating, updating, and deleting Microsoft Entra B2B collaboration users across tenants in an organization. It enables users to access applications and collaborate across tenants, while still allowing the organization to evolve.</p>
<p>Here are the primary goals of cross-tenant synchronization:</p>
<p>· Seamless collaboration for a multitenant organization</p>
<p>· Automate lifecycle management of B2B collaboration users in a multitenant organization</p>
<p>· Automatically remove B2B accounts when a user leaves the organization</p>
<p><a href="https://www.youtube-nocookie.com/embed/7B-PQwNfGBcz">https://www.youtube-nocookie.com/embed/7B-PQwNfGBcz</a>  </p>
<h1 id="why-use-cross-tenant-synchronization">Why use cross-tenant synchronization?</h1>
<p>Cross-tenant synchronization automates creating, updating, and deleting B2B collaboration users. Users created with cross-tenant synchronization are able to access both Microsoft applications (such as Teams and SharePoint) and non-Microsoft applications (such as ServiceNow, Adobe, and many more), regardless of which tenant the apps are integrated with. These users continue to benefit from the security capabilities in Microsoft Entra ID, such as Microsoft Entra Conditional Access and cross-tenant access settings, and can be governed through features such as Microsoft Entra entitlement management.</p>
<p>The following diagram shows how you can use cross-tenant synchronization to enable users to access applications across tenants in your organization.</p>
<h3 id="diagram-description">Diagram Description:</h3>
<p>The diagram illustrates the process of cross-tenant synchronization allowing multiple individual users in separate tenants to access diverse applications across these tenants seamlessly. The diagram likely presents various nodes representing different tenants and the connections between these nodes illustrate the flow of data or user access permissions that enable the cross-tenant functionality.</p>
<pre><code class="lang-mermaid">graph TD;
    TenantA(&quot;Tenant A - User &amp; Application Data Flow&quot;) --&gt; TenantB(&quot;Tenant B - Seamless User Access&quot;)
    TenantB --&gt; TenantC(&quot;Tenant C - Data and Security Integration&quot;)
    TenantA --&gt; TenantC
</code></pre><figure>

The image shows a diagram of cross-tenant synchronization between multiple organizations and applications. There are three main sections depicted:

1. On the left, two separate locations of Fabrikam (Mexico and US) with users marked as internal or external are represented by green and purple triangles. These sections link to a middle segment labeled &quot;Cross-tenant sync.&quot;

2. The middle section features a central location labeled &quot;Contoso&quot; with four users (User1, User2, User3, User4) represented by shapes, depicting their status as internal or external. This connects to another segment also labeled &quot;Cross-tenant sync.&quot;

3. The rightmost section illustrates connectivity between Microsoft apps and non-Microsoft apps, signifying the integration provided across the depicted organizations.

<code>mermaid
graph TD;
    Fabrikam_Mexico --&gt; Cross_tenant_sync1[Cross-tenant sync]
    Fabrikam_US --&gt; Cross_tenant_sync2[Cross-tenant sync]
    Cross_tenant_sync1 --&gt; Contoso
    Cross_tenant_sync2 --&gt; Contoso
    Contoso --&gt; Microsoft_apps[Microsoft apps]
    Contoso --&gt; Non_Microsoft_apps[Non-Microsoft apps]</code>

</figure>

<h1 id="who-should-use">Who should use?</h1>
<p>· Organizations that own multiple Microsoft Entra tenants and want to streamline intra-organization cross-tenant application access.</p>
<p>· Cross-tenant synchronization is not currently suitable for use across organizational boundaries.</p>
<h1 id="benefits-1">Benefits</h1>
<p>With cross-tenant synchronization, you can do the following:</p>
<p>· Automatically create B2B collaboration users within your organization and provide them access to the applications they need, without creating and maintaining custom scripts.</p>
<p>· Improve the user experience and ensure that users can access resources, without receiving an invitation email and having to accept a consent prompt in each tenant.</p>
<p>· Automatically update users and remove them when they leave the organization.</p>
<h1 id="teams-and-microsoft-365">Teams and Microsoft 365</h1>
<p>Users created by cross-tenant synchronization will have the same experience when accessing Microsoft Teams and other Microsoft 365 services as B2B collaboration users created through a manual invitation. If your organization uses shared channels, please see the known issues document for additional details. Over time, the member userType will be used by the various Microsoft 365 services to provide differentiated end user experiences for users in a multitenant organization.</p>
<h1 id="properties">Properties</h1>
<p>When you configure cross-tenant synchronization, you define a trust relationship between a source tenant and a target tenant. Cross-tenant synchronization has the following properties:</p>
<p>· Based on the Microsoft Entra provisioning engine.</p>
<p>· Is a push process from the source tenant, not a pull process from the target tenant.</p>
<p>· Supports pushing only internal members from the source tenant. It doesn&#39;t support syncing external users from the source tenant.</p>
<p>· Users in scope for synchronization are configured in the source tenant.</p>
<p>· Attribute mapping is configured in the source tenant.</p>
<p>· Extension attributes are supported.</p>
<p>· Target tenant administrators can stop a synchronization at any time.</p>
<p>The following table shows the parts of cross-tenant synchronization and which tenant they&#39;re configured.</p>
<table>
<thead>
<tr>
<th>Tenant</th>
<th>Cross-tenant access settings</th>
<th>Automatic redemption</th>
<th>Sync settings configuration</th>
<th>Users in scope</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source tenant</td>
<td></td>
<td><span class="emoji" shortcode="heavy_check_mark">✔️</span></td>
<td><span class="emoji" shortcode="heavy_check_mark">✔️</span></td>
<td><span class="emoji" shortcode="heavy_check_mark">✔️</span></td>
</tr>
<tr>
<td>Target tenant</td>
<td><span class="emoji" shortcode="heavy_check_mark">✔️</span></td>
<td><span class="emoji" shortcode="heavy_check_mark">✔️</span></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="cross-tenant-synchronization-setting">Cross-tenant synchronization setting</h1>
<p>The cross-tenant synchronization setting is an inbound only organizational setting to allow the administrator of a source tenant to synchronize users into a target tenant. This setting is a check box with the name Allow users sync into this tenant that is specified in the target tenant. This setting doesn&#39;t impact B2B invitations created through other processes such as manual invitation or Microsoft Entra entitlement management.</p>
<p>Home &gt; Contoso | External Identities &gt; External Identities | Cross-tenant access settings &gt;</p>
<h1 id="inbound-access-settings---contoso">Inbound access settings - Contoso</h1>
<p>X
 ✅
B2B collaboration B2B direct connect Trust settings Cross-tenant sync</p>
<p>Enabling this will allow the admin of the specified (source) tenant to sync objects into this (target) tenant.</p>
<p>Disabling this will block admins of the source tenant from syncing objects into the target tenant but will not remove currently synced objects. We recommend that this setting should only be used between tenants that are part of the same organization.
 ✅
V Allow users sync into this tenant</p>
<p>Save</p>
<p>Discard</p>
<p>To configure this setting using Microsoft Graph, see the Update crossTenantIdentitySyncPolicyPartner API. For more information, see Configure cross-tenant synchronization.</p>
<h2 id="automatic-redemption-setting">Automatic redemption setting</h2>
<p>The automatic redemption setting is an inbound and outbound organizational trust setting to automatically redeem invitations so users don&#39;t have to accept the consent prompt the first time they access the resource/target tenant. This setting is a check box with the following name:</p>
<ul>
<li>Automatically redeem invitations with the tenant <tenant></tenant></li>
</ul>
<p>Text Description of Figure:
In the image, under the &quot;Automatic redemption&quot; section, there is a check box with a label &quot;Check this setting if you want to automatically redeem invitations. If so, users from the specified tenant won&#39;t have to accept the consent prompt the first time they access this tenant using cross-tenant synchronization, B2B collaboration, or B2B direct connect. This setting will only suppress the consent prompt if the specified tenant checks this setting for outbound access as well.&quot; Below this description is an activation checkbox labeled &quot;Automatically redeem invitations with the tenant fc16b9b2-c752-43d3-a1aa-c75e9a85a7dc.&quot; There are options to &quot;Save&quot; and &quot;Discard&quot; the settings.</p>
<p>mermaidjs Diagram:</p>
<pre><code class="lang-mermaid">graph TD;
    AutomaticRedemption[&quot;Automatic redemption setting&quot;]
    Checkbox[&quot;Check this setting if you want to...&quot;]
    TenantID[&quot;Automatically redeem invitations with the tenant fc16b9b2-c752-43d3-a1aa-c75e9a85a7dc&quot;]

    AutomaticRedemption --&gt; Checkbox --&gt; TenantID
</code></pre><h2 id="compare-setting-for-different-scenarios">Compare setting for different scenarios</h2>
<p>The automatic redemption setting applies to cross-tenant synchronization, B2B collaboration, and B2B direct connect in the following situations:</p>
<p>· When users are created in a target tenant using cross-tenant synchronization.</p>
<p>· When users are added to a resource tenant using B2B collaboration.</p>
<p>· When users access resources in a resource tenant using B2B direct connect.</p>
<p>The following table shows how this setting compares when enabled for these scenarios:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Cross-tenant synchronization</th>
<th>B2B collaboration</th>
<th>B2B direct connect</th>
</tr>
</thead>
<tbody>
<tr>
<td>Automatic redemption setting</td>
<td>Required</td>
<td>Optional</td>
<td>Optional</td>
</tr>
<tr>
<td>Users receive a B2B collaboration invitation email</td>
<td>No</td>
<td>No</td>
<td>N/A</td>
</tr>
<tr>
<td>Users must accept a consent prompt</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>Users receive a B2B collaboration notification email</td>
<td>No</td>
<td>Yes</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<p>This setting doesn&#39;t impact application consent experiences. For more information, see Consent experience for applications in Microsoft Entra ID. This setting isn&#39;t supported for organizations across different Microsoft cloud environments, such as Azure commercial and Azure Government.</p>
<h3 id="when-is-consent-prompt-suppressed">When is consent prompt suppressed?</h3>
<p>The automatic redemption setting will only suppress the consent prompt and invitation email if both the home/source tenant (outbound) and resource/target tenant (inbound) checks this setting.</p>
<p><strong>Figure Content:</strong>
Illustration of workflow between &quot;Source tenant&quot; and &quot;Target tenant.&quot; Arrows indicate direction of access settings with flags showing that both tenants have selected the option to &quot;Automatically redeem invitations.&quot;</p>
<pre><code class="lang-mermaid">graph LR;
    Source_tenant[&quot;Source tenant&quot;] --&gt; Target_tenant[&quot;Target tenant&quot;]
    subgraph Source_tenant
        Outbound_access_settings[&quot;Outbound access settings ✅&gt; Automatically redeem invitations&quot;]
    end
    subgraph Target_tenant
        Inbound_access_settings[&quot;Inbound access settings ✅&gt; Automatically redeem invitations&quot;]
    end
</code></pre><p>The following table shows the consent prompt behavior for source tenant users when the automatic redemption setting is checked for different cross-tenant access setting combinations.</p>
<table>
<thead>
<tr>
<th>Home/source tenant</th>
<th>Resource/target tenant</th>
<th>Consent prompt behavior for source tenant users</th>
</tr>
</thead>
<tbody>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Suppressed</td>
</tr>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Outbound</td>
<td>Inbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
<tr>
<td>Inbound</td>
<td>Outbound</td>
<td>Not suppressed</td>
</tr>
</tbody>
</table>
<p>To configure this setting using Microsoft Graph, see the Update crossTenantAccessPolicyConfigurationPartner API. For more information, see Configure cross-tenant synchronization.</p>
<h1 id="how-do-users-know-what-tenants-they-belong-to">How do users know what tenants they belong to?</h1>
<p>For cross-tenant synchronization, users don&#39;t receive an email or have to accept a consent prompt. If users want to see what tenants they belong to, they can open their My Account page and select Organizations. In the Microsoft Entra admin center, users can open their Portal settings, view their Directories + subscriptions, and switch directories.</p>
<p>For more information, including privacy information, see Leave an organization as an external user.</p>
<h1 id="get-started-1">Get started</h1>
<p>Here are the basic steps to get started using cross-tenant synchronization.</p>
<p>Step 1: Define how to structure the tenants in your organization</p>
<p>Cross-tenant synchronization provides a flexible solution to enable collaboration, but every organization is different. For example, you might have a central tenant, satellite tenants, or sort of a mesh of tenants. Cross-tenant synchronization supports any of these topologies. For more information, see Topologies for cross-tenant synchronization.</p>
<p>Text Description of Figure: The illustration shows various tenant structures possible within an organization. It includes diagrams representing central, satellite, and mesh topologies with arrows indicating possible synchronization paths between tenants.</p>
<pre><code class="lang-mermaid">graph TD;
    CentralTenant(&quot;Central Tenant&quot;) --&gt; SatelliteTenant1(&quot;Satellite Tenant 1&quot;);
    CentralTenant --&gt; SatelliteTenant2(&quot;Satellite Tenant 2&quot;);
    SatelliteTenant1 --&gt; MeshTenant1(&quot;Mesh Tenant 1&quot;);
    SatelliteTenant2 --&gt; MeshTenant1;
    MeshTenant1 --&gt; MeshTenant2(&quot;Mesh Tenant 2&quot;);
</code></pre><p>Step 2: Enable cross-tenant synchronization in the target tenants</p>
<p>In the target tenant where users are created, navigate to the Cross-tenant access settings page. Here you enable cross-tenant synchronization and the B2B automatic redemption settings by selecting the respective check boxes. For more information, see Configure cross-tenant synchronization.</p>
<p>Text Description of Figure: This image depicts a settings interface titled &quot;Target tenant&quot;, under the sub-heading &quot;Inbound access settings&quot;. It shows two checked options: &quot;Allow users sync into this tenant&quot; and &quot;Automatically redeem invitations&quot;.</p>
<pre><code class="lang-mermaid">graph TD;
    TargetTenant(&quot;Target Tenant&quot;) --&gt; InboundAccessSettings(&quot;Inbound Access Settings&quot;);
    InboundAccessSettings --&gt; AllowUsersSync(&quot;Allow users sync into this tenant: selected&quot;);
    InboundAccessSettings --&gt; AutomaticallyRedeemInvitations(&quot;Automatically redeem invitations: selected&quot;);
</code></pre><p>Step 3: Enable cross-tenant synchronization in the source tenants</p>
<p>In any source tenant, navigate to the Cross-tenant access settings page and enable the B2B automatic redemption feature. Next, you use the Cross-tenant synchronization page to set up a cross-tenant synchronization job and specify:</p>
<p>· Which users you want to synchronize</p>
<p>· What attributes you want to include</p>
<p>· Any transformations</p>
<p>For anyone that has used Microsoft Entra ID to provision identities into a SaaS application, this experience will be familiar. Once you have synchronization configured,</p>
<p>you can start testing with a few users and make sure they&#39;re created with all the attributes that you need. When testing is complete, you can quickly add additional users to synchronize and roll out across your organization. For more information, see Configure cross-tenant synchronization.</p>
<figure>

Source tenant is depicted to the left sending information to Cross-tenant synchronization depicted in the middle, which in turn sends information to the Target tenant on the right. Below the tenants, different settings are depicted: Outbound access settings -&gt; Automatically redeem invitations; Inbound access settings -&gt; Allow users sync into this tenant, Automatically redeem invitations.

<!-- mermaid
graph LR;
    Source_tenant -->|Cross-tenant synchronization| Target_tenant;
    Outbound_access_settings -.-&gt;|Automatically redeem invitations| Cross_tenant_synchronization;
    Inbound_access_settings -.-&gt;|Allow users sync into this tenant| Target_tenant;
    Inbound_access_settings -.-&gt;|Automatically redeem invitations| Target_tenant;
--&gt;
</figure>



<h1 id="license-requirements-1">License requirements</h1>
<p>In the source tenant: Using this feature requires Microsoft Entra ID P1 licenses. Each user who is synchronized with cross-tenant synchronization must have a P1 license in their home/source tenant. To find the right license for your requirements, see Compare generally available features of Microsoft Entra ID.</p>
<p>In the target tenant: Cross-tenant sync relies on the Microsoft Entra External ID billing model. To understand the external identities licensing model, see MAU billing model for Microsoft Entra External ID. You will also need at least one Microsoft Entra ID P1 license in the target tenant to enable auto-redemption.</p>
<h1 id="frequently-asked-questions">Frequently asked questions</h1>
<h1 id="clouds">Clouds</h1>
<p>Which clouds can cross-tenant synchronization be used in?</p>
<p>· Cross-tenant synchronization is supported within the commercial cloud and Azure Government.</p>
<p>· Cross-tenant synchronization isn&#39;t supported within the Microsoft Azure operated by 21Vianet cloud.</p>
<p>· Synchronization is only supported between two tenants in the same cloud.</p>
<p>· Cross-cloud (such as public cloud to Azure Government) isn&#39;t currently supported.</p>
<h1 id="existing-b2b-users">Existing B2B users</h1>
<p>Will cross-tenant synchronization manage existing B2B users?</p>
<p>Yes. Cross-tenant synchronization uses an internal attribute called the alternativeSecurityIdentifier to uniquely match an internal user in the source tenant with an external / B2B user in the target tenant. Cross-tenant synchronization can update existing B2B users, ensuring that each user has only one account.</p>
<p>· Cross-tenant synchronization cannot match an internal user in the source tenant with an internal user in the target tenant (both type member and type guest).</p>
<h1 id="synchronization-frequency">Synchronization frequency</h1>
<p>How often does cross-tenant synchronization run?</p>
<p>· The sync interval is currently fixed to start at 40-minute intervals. Sync duration varies based on the number of in-scope users. The initial sync cycle is likely to take significantly longer than the following incremental sync cycles.</p>
<h1 id="scope">Scope</h1>
<p>How do I control what is synchronized into the target tenant?</p>
<p>· In the source tenant, you can control which users are provisioned with the configuration or attribute-based filters. You can also control what attributes on the user object are synchronized. For more information, see Scoping users or groups to be provisioned with scoping filters.</p>
<p>If a user is removed from the scope of sync in a source tenant, will cross-tenant synchronization soft delete them in the target?</p>
<p>· Yes. If a user is removed from the scope of sync in a source tenant, cross-tenant synchronization will soft delete them in the target tenant.</p>
<h1 id="object-types">Object types</h1>
<p>What object types can be synchronized?</p>
<p>· Microsoft Entra users can be synchronized between tenants. (Groups, devices, and contacts aren&#39;t currently supported.)</p>
<p>What user types can be synchronized?</p>
<p>· Internal members can be synchronized from source tenants. Internal guests can&#39;t be synchronized from source tenants.</p>
<p>· Users can be synchronized to target tenants as external members (default) or external guests.</p>
<p>For more information about the UserType definitions, see Properties of a Microsoft Entra B2B collaboration user.</p>
<p>I have existing B2B collaboration users. What will happen to them?</p>
<p>· Cross-tenant synchronization will match the user and make any necessary updates to the user, such as update the display name. By default, the UserType won&#39;t be updated from guest to member, but you can configure this in the attribute mappings.</p>
<h1 id="attributes">Attributes</h1>
<p>What user attributes can be synchronized?</p>
<p>· Cross-tenant synchronization will sync commonly used attributes on the user object in Microsoft Entra ID, including (but not limited to) displayName, userPrincipalName, and directory extension attributes.</p>
<p>· Cross-tenant synchronization supports provisioning the manager attribute. Both the user and their manager must be in scope for provisioning.</p>
<p>o For cross-tenant synchronization configurations created before January 2024 with the default schema / attribute mappings:</p>
<p>o The manager attribute will automatically be added to the mappings.</p>
<p>o This does not trigger an initial sync cycle.</p>
<p>o Manager updates will apply on the incremental cycle for users that are undergoing changes (e.g. manager change). The sync engine doesn&#39;t automatically update all existing users that were provisioned previously.</p>
<p>o To update the manager for existing users that are in scope for provisioning, you can use on-demand provisioning for specific users or do a restart to provision the manager for all users.</p>
<p>o For cross-tenant synchronization configurations created before January 2024 with a custom schema / attribute mappings (e.g. you added an attribute to the mappings or changed the default mappings):</p>
<p>o You need to manually add the manager attribute to your attribute mappings. This will trigger a restart and update all users that are in scope for provisioning. This should be a direct mapping of the manager attribute in the source tenant to the manager in the target tenant.</p>
<p>o If the manager of a user is removed in the source tenant and no new manager is assigned in the source tenant, the manager attribute will not be updated in the target tenant.</p>
<p>What attributes can&#39;t be synchronized?</p>
<p>· Attributes including (but not limited to) photos, custom security attributes, and user attributes outside of the directory can&#39;t be synchronized by cross-tenant synchronization.</p>
<p>Can I control where user attributes are sourced/managed?</p>
<p>· Cross-tenant synchronization doesn&#39;t offer direct control over source of authority. The user and its attributes are deemed authoritative at the source tenant. There are parallel sources of authority workstreams that will evolve source of authority controls for users down to the attribute level and a user object at the source may ultimately reflect multiple underlying sources. For the tenant-to-tenant process, this is still treated as the source tenant&#39;s values being authoritative for the sync process (even if pieces actually originate elsewhere) into the target tenant. Currently, there&#39;s no support for reversing the sync process&#39;s source of authority.
· Cross-tenant synchronization only supports source of authority at the object level. That means all attributes of a user must come from the same source, including credentials. It isn&#39;t possible to reverse the source of authority or federation direction of a synchronized object.</p>
<p>What happens if attributes for a synced user are changed in the target tenant?</p>
<p>· Cross-tenant synchronization doesn&#39;t query for changes in the target. If no changes are made to the synced user in the source tenant, then user attribute changes made in the target tenant will persist. However, if changes are made to the user in the source tenant, then during the next synchronization cycle, the user in the target tenant will be updated to match the user in the source tenant.</p>
<p>Can the target tenant manually block sign-in for a specific home/source tenant user that is synced?</p>
<p>· If no changes are made to the synced user in the source tenant, then the block sign-in setting in the target tenant will persist. If a change is detected for the user in the source tenant, cross-tenant synchronization will re-enable that user blocked from sign-in in the target tenant.</p>
<p>Structure</p>
<p>Can I sync a mesh between multiple tenants?</p>
<p>· Cross-tenant synchronization is configured as a single-direction peer-to-peer sync, meaning sync is configured between one source and one target tenant. Multiple instances of cross-tenant synchronization can be configured to sync from a single</p>
<p>source to multiple targets and from multiple sources into a single target. But only one sync instance can exist between a source and a target.</p>
<p>· Cross-tenant synchronization only synchronizes users that are internal to the home/source tenant, ensuring that you can&#39;t end up with a loop where a user is written back to the same tenant.</p>
<p>· Multiple topologies are supported. For more information, see Topologies for cross-tenant synchronization.</p>
<p>Can I use cross-tenant synchronization across organizations (outside my multitenant organization)?</p>
<p>· For privacy reasons, cross-tenant synchronization is intended for use within an organization. We recommend using entitlement management for inviting B2B collaboration users across organizations.</p>
<p>Can cross-tenant synchronization be used to migrate users from one tenant to another tenant?</p>
<p>· No. Cross-tenant synchronization isn&#39;t a migration tool because the source tenant is required for synchronized users to authenticate. In addition, tenant migrations would require migrating user data such as SharePoint and OneDrive.</p>
<p>B2B collaboration</p>
<p>Does cross-tenant synchronization resolve any present B2B collaboration limitations?</p>
<p>Since cross-tenant synchronization is built on existing B2B collaboration technology, existing limitations apply. Examples include (but aren&#39;t limited to):</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>App or service</td>
<td>Limitations</td>
</tr>
<tr>
<td>Power BI</td>
<td>- Support for UserType Member in Power BI is currently in preview. For more information, see Distribute Power BI content to external guest users with Microsoft Entra B2B.</td>
</tr>
<tr>
<td>Azure Virtual Desktop</td>
<td>- External member and external guest aren&#39;t supported in Azure Virtual Desktop.</td>
</tr>
</tbody>
</table>
<p>B2B direct connect</p>
<p>How does cross-tenant synchronization relate to B2B direct connect?</p>
<p>B2B direct connect is the underlying identity technology required for Teams Connect shared channels.</p>
<p>We recommend B2B collaboration for all other cross-tenant application access scenarios, including both Microsoft and non-Microsoft applications.</p>
<p>B2B direct connect and cross-tenant synchronization are designed to co-exist, and you can enable them both for broad coverage of cross-tenant scenarios.</p>
<p>We&#39;re trying to determine the extent to which we&#39;ll need to utilize cross-tenant synchronization in our multitenant organization. Do you plan to extend support for B2B direct connect beyond Teams Connect?</p>
<p>There&#39;s no plan to extend support for B2B direct connect beyond Teams Connect shared channels.</p>
<h2 id="microsoft-365">Microsoft 365</h2>
<p>Does cross-tenant synchronization enhance any cross-tenant Microsoft 365 app access user experiences?</p>
<p>Cross-tenant synchronization utilizes a feature that improves the user experience by suppressing the first-time B2B consent prompt and redemption process in each tenant.</p>
<p>Synchronized users will have the same cross-tenant Microsoft 365 experiences available to any other B2B collaboration user.</p>
<p>Can cross-tenant synchronization enable people search scenarios where synchronized users appear in the global address list of the target tenant?</p>
<p>Yes, but you must set the value for the showInAddressList attribute of synchronized users to True, which is not set by default. If you want to create a unified address list, you&#39;ll need to set up a mesh peer-to-peer topology. For more information, see Step 9: Review attribute mappings.</p>
<p>Cross-tenant synchronization creates B2B collaboration users and doesn&#39;t create contacts.</p>
<h2 id="teams">Teams</h2>
<p>Does cross-tenant synchronization enhance any current Teams experiences?</p>
<p>Synchronized users will have the same cross-tenant Microsoft 365 experiences available to any other B2B collaboration user.</p>
<!-- PageHeader="Integration" -->
<p>What federation options are supported for users in the target tenant back to the source tenant?</p>
<p>· For each internal user in the source tenant, cross-tenant synchronization creates a federated external user (commonly used in B2B) in the target. It supports syncing internal users. This includes internal users federated to other identity systems using domain federation (such as Active Directory Federation Services). It doesn&#39;t support syncing external users.</p>
<p>Does cross-tenant synchronization use System for Cross-Domain Identity Management (SCIM)?</p>
<p>. No. Currently, Microsoft Entra ID supports a SCIM client, but not a SCIM server. For more information, see SCIM synchronization with Microsoft Entra ID.</p>
<h1 id="deprovisioning">Deprovisioning</h1>
<p>Does cross-tenant synchronization support deprovisioning users?</p>
<p>· Yes, when the below actions occur in the source tenant, the user will be soft deleted in the target tenant.</p>
<p>o Delete the user in the source tenant
 ❌
o Unassign the user from the cross-tenant synchronization configuration
 ❌
o Remove the user from a group that is assigned to the cross-tenant synchronization configuration
 ❌</p>
<p>o An attribute on the user changes such that they do not meet the scoping filter conditions defined on the cross-tenant synchronization configuration anymore
 ❌</p>
<p>. If the user is blocked from sign-in in the source tenant (accountEnabled = false) they will be blocked from sign-in in the target. This is not a deletion, but an updated to the accountEnabled property.</p>
<p>· Users are not soft deleted from the target tenant in this scenario:</p>
<ol>
<li>Add a user to a group and assign it to the cross-tenant synchronization configuration in the source tenant.</li>
<li>Provision the user on-demand or through the incremental cycle.</li>
<li>Update the account enabled status to false on the user in the source tenant.</li>
<li>Provision the user on-demand or through the incremental cycle. The account enabled status is changed to false in the target tenant.</li>
<li>Remove the user from the group in the source tenant.
❌ ❌ ❌ ✅ ✅ ✅</li>
</ol>
<p>Does cross-tenant synchronization support restoring users?</p>
<ul>
<li>If the user in the source tenant is restored, reassigned to the app, meets the scoping condition again within 30 days of soft deletion, it will be restored in the target tenant.</li>
<li>IT admins can also manually restore the user directly in the target tenant.</li>
</ul>
<p>How can I deprovision all the users that are currently in scope of cross-tenant synchronization?</p>
<ul>
<li>Unassign all users and / or groups from the cross-tenant synchronization configuration. This will trigger all the users that were unassigned, either directly or through group membership, to be deprovisioned in subsequent sync cycles. Please note that the target tenant will need to keep the inbound policy for sync enabled until deprovisioning is complete. If the scope is set to Sync all users and groups, you will also need to change it to Sync only assigned users and groups. The users will be automatically soft deleted by cross-tenant synchronization. The users will be automatically hard deleted after 30 days or you can choose to hard delete the users directly from the target tenant. You can choose to hard delete the users directly in the target tenant or wait 30 days for the users to be automatically hard deleted.</li>
</ul>
<p>If the sync relationship is severed, are external users previously managed by cross-tenant synchronization deleted in the target tenant?</p>
<ul>
<li>No. No changes are made to the external users previously managed by cross-tenant synchronization if the relationship is severed (for example, if the cross-tenant synchronization policy is deleted).</li>
</ul>
<p>Next steps</p>
<ul>
<li>Topologies for cross-tenant synchronization</li>
<li>Configure cross-tenant synchronization</li>
</ul>
<h1 id="multitenant-organization-identity-provisioning-for-microsoft-365">Multitenant organization identity provisioning for Microsoft 365</h1>
<p>Article · 04/24/2024</p>
<p>The multitenant organization capability is designed for organizations that own multiple Microsoft Entra tenants and want to streamline intra-organization cross-tenant collaboration in Microsoft 365. It&#39;s built on the premise of reciprocal provisioning of B2B member users across multitenant organization tenants.</p>
<h1 id="microsoft-365-people-search">Microsoft 365 people search</h1>
<p>Teams external access and Teams shared channels excluded, Microsoft 365 people search is typically scoped to within local tenant boundaries. In multitenant organizations with increased need for cross-tenant coworker collaboration, it&#39;s recommended to reciprocally provision users from their home tenants into the resource tenants of collaborating coworkers.</p>
<h1 id="new-microsoft-teams">New Microsoft Teams</h1>
<p>The new Microsoft Teams experience improves upon Microsoft 365 people search and Teams external access for a unified seamless collaboration experience. For this improved experience to light up, the multitenant organization representation in Microsoft Entra ID is required and collaborating users shall be provisioned as B2B members.</p>
<h1 id="collaborating-user-set">Collaborating user set</h1>
<p>Collaboration in Microsoft 365 is built on the premise of reciprocal provisioning of B2B identities across multitenant organization tenants.</p>
<p>For example, say Annie in tenant A, Bob and Barbara in tenant B, and Charlie in tenant C want to collaborate. Conceptually, these four users represent a collaborating user set of four internal identities across three tenants.</p>
<p>For people search to succeed, while scoped to local tenant boundaries, the entire collaborating user set must be represented within the scope of each multitenant organization tenant A, B, and C, in the form of either internal or B2B identities.</p>
<p>Text description of figure: Three distinct sections, each representing &quot;Tenant A&quot;, &quot;Tenant B&quot;, and &quot;Tenant C&quot;. In each, certain users are shown as &quot;Internal&quot;, and others as shared between the tenants, represented as &quot;External&quot;. Each user is represented by a colored circle and labeled:</p>
<ul>
<li>Tenant A shows: Annie (Internal)</li>
<li>Tenant B shows: Bob, Barbara (Internal)</li>
<li>Tenant C shows: Charles (Internal)</li>
</ul>
<pre><code class="lang-mermaid">graph TD;
    A[&quot;Tenant A&quot;] --&gt;|Internal| Annie
    B[&quot;Tenant B&quot;] --&gt;|Internal| Bob
    B --&gt;|Internal| Barbara
    C[&quot;Tenant C&quot;] --&gt;|Internal| Charles
</code></pre><p>Depending on your organization&#39;s needs, the collaborating user set may contain a subset of collaborating employees, or eventually all employees.</p>
<p>Text description of figure: Similar to the previous figure with Tenant sections, but this time indicating the flow of external users among the tenants, showing which external identities are recognized by which tenants:</p>
<ul>
<li>Tenant A shows Bob, Barbara, and Charles as External</li>
<li>Tenant B shows Annie and Charles as External</li>
<li>Tenant C shows Annie, Bob, and Barbara as External</li>
</ul>
<pre><code class="lang-mermaid">graph TD;
    A1[&quot;Tenant A&quot;] --&gt;|External| Bob
    A1 --&gt;|External| Barbara
    A1 --&gt;|External| Charles
    B1[&quot;Tenant B&quot;] --&gt;|External| Annie
    B1 --&gt;|External| Charles
    C1[&quot;Tenant C&quot;] --&gt;|External| Annie
    C1 --&gt;|External| Bob
    C1 --&gt;|External| Barbara
</code></pre><p>Sharing your users</p>
<p>One of the simpler ways to achieve a collaborating user set in each multitenant organization tenant is for each tenant administrator to define their user contribution and synchronization them outbound. Tenant administrators on the receiving end should accept the shared users inbound.</p>
<ul>
<li>Administrator A contributes or shares Annie</li>
<li>Administrator B contributes or shares Bob and Barbara</li>
<li>Administrator C contributes or shares Charles</li>
</ul>
<figure>

Figure: This is a diagram showing the orchestration of users across multiple tenants in an organization. It illustrates Tenant A (represented by a purple diamond), Tenant B (represented by a blue triangle), and Tenant C (represented by a green square), each containing internal and external users (internal users shown in blue icons, external users in green). Solid lines indicate the bi-directional relationship between the tenants and their users in terms of data or collaboration flow.

<code>mermaid
graph TD;
    TenantA[Tenant A] --&gt;|Internal Annie, External Bob Barbara Charles| TenantB[Tenant B]
    TenantB --&gt;|Internal Bob Barbara, External Annie Charles| TenantC[Tenant C]
    TenantC --&gt;|Internal Charles, External Annie Bob Barbara| TenantA</code>

</figure>

<p>Microsoft 365 admin center facilitates orchestration of such a collaborating user set across multitenant organization tenants. For more information, see Synchronize users in multitenant organizations in Microsoft 365.</p>
<p>Alternatively, pair-wise configuration of inbound and outbound cross-tenant synchronization can be used to orchestrate such collating user set across multitenant organization tenants. For more information, see What is a cross-tenant synchronization.</p>
<h1 id="b2b-member-users">B2B member users</h1>
<p>To ensure a seamless collaboration experience across the multitenant organization in new Microsoft Teams, B2B identities are provisioned as B2B users of Member userType.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>User synchronization method</th>
<th>Default userType property</th>
</tr>
</thead>
<tbody>
<tr>
<td>Synchronize users in multitenant organizations in Microsoft 365</td>
<td>Member</td>
</tr>
<tr>
<td></td>
<td>Remains Guest, if the B2B identity already existed as Guest</td>
</tr>
<tr>
<td>Cross-tenant synchronization in Microsoft Entra ID</td>
<td>Member</td>
</tr>
<tr>
<td></td>
<td>Remains Guest, if the B2B identity already existed as Guest</td>
</tr>
</tbody>
</table>
<p>From a security perspective, you should review the default permissions granted to B2B member users. For more information, see Compare member and guest default permissions.</p>
<p>To change the userType from Guest to Member (or vice versa), a source tenant administrator can amend the attribute mappings, or a target tenant administrator can change the userType if the property is not recurringly synchronized.</p>
<h1 id="unsharing-your-users">Unsharing your users</h1>
<p>To unshare users, you deprovision users by using the user deprovisioning capabilities available in Microsoft Entra cross-tenant synchronization. By default, when provisioning scope is reduced while a synchronization job is running, users fall out of scope and are soft deleted, unless Target Object Actions for Delete is disabled. For more information, see Deprovisioning and Define who is in scope for provisioning.</p>
<h1 id="next-steps-2">Next steps</h1>
<ul>
<li>Plan for multitenant organizations in Microsoft 365</li>
<li>Set up a multitenant org in Microsoft 365</li>
</ul>
<h1 id="multitenant-organization-optional-policy-templates">Multitenant organization optional policy templates</h1>
<p>Article · 04/23/2024</p>
<p>Administrators staying in control of their resources is a guiding principle for multitenant organization collaboration. Cross-tenant access settings are required for each tenant-to-tenant relationship. Tenant administrators explicitly configure cross-tenant access partner configurations and identity synchronization settings for partner tenants inside the multitenant organization.</p>
<p>To help apply homogenous cross-tenant access settings to partner tenants in the multitenant organization, the administrator of each tenant can configure optional cross-tenant access settings templates dedicated to the multitenant organization. This article describes how to use templates to preconfigure cross-tenant access settings that are applied to any partner tenant newly joining the multitenant organization.</p>
<h2 id="autogeneration-of-cross-tenant-access-settings">Autogeneration of cross-tenant access settings</h2>
<p>Within a multitenant organization, each pair of tenants must have bi-directional cross-tenant access settings, for both, partner configuration and identity synchronization. These settings provide the underlying policy framework for enabling trust and for sharing users and applications.</p>
<p>When your tenant joins a new multitenant organization, or when a partner tenant joins your existing multitenant organization, cross-tenant access settings to other partner tenants in the enlarged multitenant organization, if they don&#39;t already exist, are automatically generated in an unconfigured state. In an unconfigured state, these cross-tenant access settings pass through the default settings.</p>
<p>Default cross-tenant access settings apply to all external tenants for which you haven&#39;t created organization-specific customized settings. Typically, these settings are configured to be nontrusting. For example, cross-tenant trusts for multifactor authentication and compliant device claims might be disabled and user and group sharing in B2B direct connect or B2B collaboration might be disallowed.</p>
<p>In multitenant organizations, on the other hand, cross-tenant access settings are typically expected to be trusting. For example, cross-tenant trusts for multifactor authentication and compliant device claims might be enabled and user and group sharing in B2B direct connect or B2B collaboration might be allowed.</p>
<p>While the autogeneration of cross-tenant access settings for multitenant organization partner tenants in and of itself doesn&#39;t change any authentication or authorization policy behavior, it allows your organization to easily customize the cross-tenant access settings for partner tenants in the multitenant organization on a per-tenant basis.</p>
<h1 id="policy-templates-at-multitenant-organization-formation">Policy templates at multitenant organization formation</h1>
<p>As previously described, in multitenant organizations, cross-tenant access settings are typically expected to be trusting. For example, cross-tenant trusts for multifactor authentication and compliant device claims might be enabled and user and group sharing in B2B direct connect or B2B collaboration might be allowed.</p>
<p>While autogeneration of cross-tenant access settings, per previous section, guarantees the existence of cross-tenant access settings for every multitenant organization partner tenant, further maintenance of the cross-tenant access settings for multitenant organization partner tenants is conducted individually, on a per-tenant basis.</p>
<p>To reduce the workload for administrators at the time of multitenant organization formation, you can optionally use policy templates for preemptive configuration of cross-tenant access settings. These template settings are applied at the time of your tenant joins a multitenant organization to all external multitenant organization partner tenants as well as at the time of any partner tenant joins your existing multitenant organization to such new partner tenant.</p>
<p>Enablement or configuration of the optional policy templates, at the time of a partner tenant joins a multitenant organization, preemptively amend the corresponding cross-tenant access settings, for both partner configuration and identity synchronization.</p>
<p>As an example, consider the actions of the administrators for an anticipated multitenant organization with three tenants, A, B, and C.</p>
<ul>
<li>The administrators of all three tenants enable and configure their respective optional policy templates to enable cross-tenant trusts for multifactor authentication and compliant device claims and to allow user and group sharing in B2B direct connect and B2B collaboration.</li>
<li>Administrator A creates the multitenant organization and adds tenants B and C as pending tenants to the multitenant organization.</li>
<li>Administrator B joins the multitenant organization. Cross-tenant access settings in tenant A for partner tenant B are amended, according to tenant A policy template settings. Vice versa, cross-tenant access settings in tenant B for partner tenant A are amended, according to tenant B policy template settings.</li>
</ul>
<p>Administrator C joins the multitenant organization. Cross-tenant access settings in tenants A (and B) for partner tenant C are amended, according to tenant A (and B) policy template settings. Similarly, cross-tenant access settings in tenant C for partner tenants A and B are amended, according to tenant C policy template settings.</p>
<p>Following the formation of this multitenant organization of three tenants, the cross-tenant access settings of all tenant pairs in the multitenant organization have preemptively been configured.</p>
<p>In summary, configuration of the optional policy templates enable you to homogeneously initialize cross-tenant access settings across your multitenant organization, while maintaining maximum flexibility to customize your cross-tenant access settings as needed on a per-tenant basis.</p>
<p>To stop using the policy templates, you can reset them to their default state. For more information, see Configure multitenant organization templates.</p>
<p>Policy template scoping and additional properties</p>
<p>To provide administrators with further configurability, you can choose when cross- tenant access settings are to be amended according to the policy templates. For example, you can choose to apply the policy templates for the following tenants when a tenant joins a multitenant organization:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Tenant</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Only new partner tenants</td>
<td>Tenants whose cross-tenant access settings are autogenerated</td>
</tr>
<tr>
<td>Only existing partner tenants</td>
<td>Tenants who already have cross-tenant access settings</td>
</tr>
<tr>
<td>All partner tenants</td>
<td>Both new partner tenants and existing partner tenants</td>
</tr>
<tr>
<td>No partner tenants</td>
<td>Policy templates are effectively disabled</td>
</tr>
</tbody>
</table>
<p>In this context, new partners refer to tenants for which you haven&#39;t yet configured cross-tenant access settings, while existing partners refer to tenants for which you have already configured cross-tenant access settings. This scoping is specified with the templateApplicationLevel property on the cross-tenant access partner configuration template and the templateApplicationLevel property on the cross-tenant access identity synchronization template.</p>
<p>Finally, in terms of interpretation of template property values, any template property value of null has no effect on the corresponding property value in the targeted cross-tenant access settings, while a defined template property value causes the corresponding property value in the targeted cross-tenant access settings to be amended in accordance with the template. The following table illustrates how template property values are being applied to corresponding cross-tenant access setting values.</p>
<table>
<thead>
<tr>
<th>Template Value</th>
<th>Initial Partner Settings Value (Before joining multitenant org)</th>
<th>Final Partner Settings Value (After joining multitenant org)</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
<td><partner settings="" value=""></partner></td>
<td><partner settings="" value=""></partner></td>
</tr>
<tr>
<td><template value=""></template></td>
<td><any value=""></any></td>
<td><template value=""></template></td>
</tr>
</tbody>
</table>
<p>Policy templates used by Microsoft 365 admin center</p>
<p>When a multitenant organization is formed in Microsoft 365 admin center, an administrator agrees to the following multitenant organization template settings:</p>
<ul>
<li>Identity synchronization is set to allow users to synchronize into this tenant</li>
<li>Cross-tenant access is set to automatically redeem user invitations for both inbound and outbound</li>
</ul>
<p>This is achieved by setting the corresponding three template property values to true:</p>
<ul>
<li>automaticUserConsentSettings.inboundAllowed</li>
<li>automaticUserConsentSettings.outboundAllowed</li>
<li>userSyncInbound</li>
</ul>
<p>For more information, see Join or leave a multitenant organization in Microsoft 365.</p>
<p>Cross-tenant access settings at time of multitenant organization disassembly</p>
<p>Currently, there&#39;s no equivalent policy template feature supporting the disassembly of a multitenant organization. When a partner tenant leaves the multitenant organization, each tenant administrator must re-examine and amend accordingly the cross-tenant access settings for the partner tenant that left the multitenant organization.</p>
<p>The partner tenant that left the multitenant organization must re-examine and amend accordingly the cross-tenant access settings for all former multitenant organization partner tenants as well as consider resetting the two policy templates for cross-tenant access settings.</p>
<h1 id="next-steps-3">Next steps</h1>
<ul>
<li>Configure multitenant organization templates using the Microsoft Graph API</li>
</ul>
<h1 id="limitations-in-multitenant-organizations">Limitations in multitenant organizations</h1>
<p>Article · 04/24/2024</p>
<p>This article describes limitations to be aware of when you work with multitenant organization functionality across Microsoft Entra ID and Microsoft 365. To provide feedback about the multitenant organization functionality on UserVoice, see <a href="https://feedbackportal.microsoft.com/feedback/forum/06735c62-321c-ec11-b6e6-0022481f8472">Microsoft Entra UserVoice</a>.</p>
<h2 id="scope-1">Scope</h2>
<p>The limitations described in this article have the following scope.</p>
<h3 id="expand-table">Expand table</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>In scope</td>
<td>Microsoft Entra administrator limitations related to multitenant organizations to support seamless collaboration experiences in new Teams, with reciprocally provisioned B2B members</td>
</tr>
<tr>
<td>Related scope</td>
<td>Microsoft 365 admin center limitations related to multitenant organizations</td>
</tr>
<tr>
<td></td>
<td>Microsoft 365 multitenant organization people search experiences</td>
</tr>
<tr>
<td></td>
<td>Cross-tenant synchronization limitations related to Microsoft 365</td>
</tr>
<tr>
<td>Out of scope</td>
<td>Cross-tenant synchronization unrelated to Microsoft 365</td>
</tr>
<tr>
<td></td>
<td>End user experiences in new Teams</td>
</tr>
<tr>
<td></td>
<td>End user experiences in Power BI</td>
</tr>
<tr>
<td></td>
<td>Tenant migration or consolidation</td>
</tr>
<tr>
<td>Unsupported scenarios</td>
<td>Seamless collaboration experience across multitenant organizations in classic Teams</td>
</tr>
<tr>
<td></td>
<td>Self-service for multitenant organizations larger than 100 tenants</td>
</tr>
<tr>
<td></td>
<td>Multitenant organizations in Azure Government or Microsoft Azure operated by 21Vianet</td>
</tr>
<tr>
<td></td>
<td>Cross-cloud multitenant organizations</td>
</tr>
</tbody>
</table>
<h2 id="microsoft-365-admin-center-versus-cross-tenant-synchronization">Microsoft 365 admin center versus cross-tenant synchronization</h2>
<ul>
<li><p>Whether you use the Microsoft 365 admin center share users functionality or Microsoft Entra cross-tenant synchronization, the following items apply:</p>
<ul>
<li>In the identity platform, both methods are represented as Microsoft Entra cross-tenant synchronization jobs.</li>
</ul>
</li>
<li><p>Synchronization jobs created with Microsoft Entra ID will not appear in the Microsoft 365 admin center.</p>
</li>
<li>If you created your synchronization job in the Microsoft 365 admin center, do not modify the synchronization job name using Microsoft Entra ID, otherwise it will no longer appear in the admin center.<ul>
<li>You might adjust the attribute mappings to match your organizations&#39; needs.</li>
</ul>
</li>
<li>By default, new B2B users are provisioned as B2B members, while existing B2B guests remain B2B guests.<ul>
<li>You can opt to convert B2B guests into B2B members by setting Apply this mapping to Always.</li>
</ul>
</li>
<li>If you&#39;re using Microsoft Entra cross-tenant synchronization to provision your users, rather than the Microsoft 365 admin center share users functionality, Microsoft 365 admin center indicates an Outbound sync status of Not configured. This is expected behavior. Currently, Microsoft 365 admin center only shows the status of Microsoft Entra cross-tenant synchronization jobs created and managed by Microsoft 365 admin center and doesn&#39;t display Microsoft Entra cross-tenant synchronizations created and managed in Microsoft Entra ID.</li>
<li>If you view Microsoft Entra cross-tenant synchronization in Microsoft Entra admin center, after adding tenants to or after joining a multitenant organization in Microsoft 365 admin center, you&#39;ll see a cross-tenant synchronization configuration with the name MTO_Sync_<tenantid>. Refrain from editing or changing the name if you want Microsoft 365 admin center to recognize the configuration as created and managed by Microsoft 365 admin center.</tenantid></li>
<li>Microsoft Entra cross-tenant synchronization doesn&#39;t support establishing a cross-tenant synchronization configuration before the tenant in question allows inbound synchronization in their cross-tenant access settings for identity synchronization. Hence the usage of the cross-tenant access settings template for identity synchronization is encouraged, with userSyncInbound set to true, as facilitated by Microsoft 365 admin center.</li>
<li>There&#39;s no established or supported pattern for Microsoft 365 admin center to take control of pre-existing Microsoft Entra cross-tenant synchronization configurations and jobs.</li>
</ul>
<h3 id="join-requests">Join requests</h3>
<ul>
<li>There are multiple reasons why a join request might fail. If the Microsoft 365 admin center doesn&#39;t indicate why a join request isn&#39;t succeeding, try examining the join request response by using the Microsoft Graph APIs or Microsoft Graph Explorer.</li>
</ul>
<p>If you followed the correct sequence to create a multitenant organization and add a tenant to the multitenant organization, and the added tenant&#39;s join request keeps failing, submit a support request in the Microsoft Entra or Microsoft 365 admin center.</p>
<h1 id="microsoft-apps">Microsoft apps</h1>
<ul>
<li><p>In SharePoint OneDrive, the promotion of B2B guests to B2B members might not happen automatically. If faced with a user type mismatch between Microsoft Entra ID and SharePoint OneDrive, try Set-SPUser [-SyncFromAD].</p>
</li>
<li><p>In SharePoint OneDrive user interfaces, when sharing a file with People in Fabrikam, the current user interfaces might be counterintuitive, because B2B members in Fabrikam from Contoso count towards People in Fabrikam.</p>
</li>
<li><p>In Microsoft Forms, B2B member users might not be able to access forms.</p>
</li>
<li><p>In Microsoft Power BI, B2B member users are not yet supported. B2B guest users can continue to access Power BI dashboards.</p>
</li>
<li><p>In Microsoft Power Apps, Microsoft Dynamics 365, and related workloads, B2B member users may have restricted functionality. For more information, see Invite users with Microsoft Entra B2B collaboration.</p>
</li>
</ul>
<h2 id="b2b-users-or-b2b-members">B2B users or B2B members</h2>
<ul>
<li><p>The promotion of B2B guests to B2B members represents a strategic decision by multitenant organizations to consider B2B members as trusted users of the organization. Review the default permissions for B2B members.</p>
</li>
<li><p>To promote B2B guests to B2B members, a source tenant administrator can amend the attribute mappings, or a target tenant administrator can change the userType if the property is not recurringly synchronized.</p>
</li>
<li><p>As your organization rolls out the multitenant organization functionality including provisioning of B2B users across multitenant organization tenants, you might want to provision some users as B2B guests, while provision others users as B2B members. To achieve this, you might want to establish two Microsoft Entra cross-tenant synchronization configurations in the source tenant, one with userType attribute mappings configured to B2B guest, and another with userType attribute mappings configured to B2B member, each with Apply this mapping set to ✅ ❌ ❌ ✅ ❌ ❌ ❌ ❌ ❌ ✅ ❌ ❌ ✅ ❌ ❌ ❌</p>
</li>
</ul>
<p>Always. By moving a user from one configuration&#39;s scope to the other, you can easily control who will be a B2B guest or a B2B member in the target tenant.</p>
<ul>
<li><p>As part of a multitenant organization, reset redemption for an already redeemed B2B user is currently disabled.</p>
</li>
<li><p>The at-scale provisioning of B2B users might collide with contact objects. The handling or conversion of contact objects is currently not supported.</p>
</li>
<li><p>Using Microsoft Entra cross-tenant synchronization to target hybrid identities that have been converted to B2B users has not been tested in source of authority conflicts and is not supported.</p>
</li>
</ul>
<h1 id="cross-tenant-synchronization-deprovisioning">Cross-tenant synchronization deprovisioning</h1>
<ul>
<li><p>By default, when provisioning scope is reduced while a synchronization job is running, users fall out of scope and are soft deleted, unless Target Object Actions for Delete is disabled. For more information, see Deprovisioning and Define who is in scope for provisioning.</p>
</li>
<li><p>Currently, SkipOutOfScopeDeletions works for application provisioning jobs, but not for Microsoft Entra cross-tenant synchronization. To avoid soft deletion of users taken out of scope of cross-tenant synchronization, set Target Object Actions for Delete to disabled.</p>
</li>
</ul>
<h1 id="next-steps-4">Next steps</h1>
<ul>
<li>Known issues for provisioning in Microsoft Entra ID</li>
</ul>
<h1 id="topologies-for-cross-tenant-collaboration">Topologies for cross-tenant collaboration</h1>
<p>Article · 11/03/2023</p>
<p>Organizations often find themselves managing multiple tenants due to mergers and acquisitions, regulatory requirements, or administrative boundaries. Regardless of your scenario, Microsoft Entra offers a flexible and ready-to-use solution for provisioning accounts across tenants and facilitating seamless collaboration. Microsoft Entra accommodates the following three models and can adapt to your evolving organizational needs.</p>
<p>✔ Hub and spoke</p>
<p>✔ Mesh</p>
<p>✔ Just-in-time</p>
<h1 id="hub-and-spoke">Hub and spoke</h1>
<p>The hub and spoke topology presents two common patterns:</p>
<ul>
<li><p>Option 1 (application hub): In this option, you can integrate commonly used applications into a central hub tenant that users from across the organization can access.</p>
</li>
<li><p>Option 2 (user hub): Alternatively, option 2 centralizes all your users in a single tenant and provisions them into spoke tenants where resources are managed.</p>
</li>
</ul>
<p>Let&#39;s examine a few real-world scenarios and see how they align with each of these models.</p>
<h1 id="mergers-and-acquisitions-application-hub">Mergers and acquisitions (application hub)</h1>
<p>During mergers and acquisitions, the ability to quickly enable collaboration is crucial, allowing businesses to function cohesively while complex IT decisions are being made. For instance, when a newly acquired company&#39;s employees need immediate access to applications such as the internal help desk ticketing system or benefits application, cross-tenant synchronization proves invaluable. This synchronization process allows users from the acquired company to be provisioned into the application hub from day one, granting them access to SaaS apps, on-premises applications, and other cloud resources. Within the target tenant, admins can set up access packages to grant time limited access to additional applications such as Salesforce and Amazon Web Services</p>
<p>that contain business critical data. The following diagram shows recently acquired tenants on the left and their users being provisioned into the parent company&#39;s tenant, which grants users access to the necessary resources.</p>
<p>The diagram illustrates various software and platform components linking to Active Directory.</p>
<ul>
<li>At the top, it lists HR with two connecting lines extending outward to other applications grouped into three categories:<ul>
<li>SaaS apps (represented by Salesforce and AWS logos)</li>
<li>Microsoft apps (showing logos of various Microsoft services including Azure)</li>
<li>On-premises apps (displaying SQL and Active Directory icons)
These categories then connect to an Active Directory icon at the bottom, indicating gateway for assimilating users of acquired tenants into the main corporate environment.</li>
</ul>
</li>
</ul>
<pre><code class="lang-mermaid">graph TD;
    HR --&gt; SaaS_apps;
    HR --&gt; Microsoft_apps;
    HR --&gt; On_premises_apps;
    SaaS_apps --&gt; ActiveDirectory;
    Microsoft_apps --&gt; ActiveDirectory;
    On_premises_apps --&gt; ActiveDirectory;
    subgraph SaaS_apps
        Salesforce;
        AWS;
    end
    subgraph Microsoft_apps
        Azure;
        Others[&quot;Various Microsoft services&quot;];
    end
    subgraph On_premises_apps
        SQL;
        ActiveDirectory1(&quot;Active Directory (On-prem)&quot;);
    end
</code></pre><h1 id="separate-collaboration-and-resource-tenants-user-hub">Separate collaboration and resource tenants (user hub)</h1>
<p>As organizations scale their usage of Azure, they often create dedicated tenants for managing critical Azure resources. Meanwhile, they rely on a central hub tenant for user provisioning. This model empowers administrators in the hub tenant to establish central security and governance policies while granting development teams greater autonomy and agility to deploy required Azure resources. Cross-tenant synchronization supports this topology by enabling administrators to provision a subset of users into the spoke tenants and manage the lifecycle of those users.</p>
<figure>
The figure illustrates a model of cross-tenant synchronization in a decentralized organizational structure. It shows a central pyramid-like structure labeled &quot;Active Directory&quot; with arrows pointing to and from four smaller pyramid structures labeled &quot;A&quot;. Additionally, there are icons representing &quot;HR&quot; systems and &quot;salesforce&quot; suggesting integration with these platforms. The overall diagram emphasizes the interconnected nature of different systems within a decentralized environment.

<code>mermaid
graph TD;
    ActiveDirectory(&quot;Active Directory&quot;) --&gt;|Synchronization| A1(&quot;Tenant A&quot;)
    ActiveDirectory --&gt;|Synchronization| A2(&quot;Tenant A&quot;)
    ActiveDirectory --&gt;|Synchronization| A3(&quot;Tenant A&quot;)
    ActiveDirectory --&gt;|Synchronization| A4(&quot;Tenant A&quot;)
    HR --&gt; ActiveDirectory
    Salesforce --&gt; ActiveDirectory</code>
</figure>

<h1 id="mesh">Mesh</h1>
<p>While some companies centralize their users within a single tenant, others have a more decentralized structure with applications, HR systems, and Active Directory domains integrated into each tenant. Cross-tenant synchronization offers the flexibility to choose which users are provisioned into each tenant.</p>
<h1 id="collaborate-within-a-portfolio-company-partial-mesh">Collaborate within a portfolio company (partial-mesh)</h1>
<p>In this scenario, each tenant represents a different company within the same parent organization. Administrators in each tenant choose a subset of users to provision into the target tenant. This solution provides flexibility for each tenant to operate independently, while facilitating collaboration when users need access to critical resources.</p>
<figure>
    The diagram illustrates a cross-tenant synchronization model between four tenants. Three tenants are each represented by a diagram consisting of three components: a main blue pyramid, a Salesforce icon, and a secondary pyramid component. Arrows are shown indicating two-way synchronization processes: one between a tenant labeled with both &quot;aws&quot; and &quot;salesforce&quot; icons and the other tenants, and bi-directional synchronization exists among all the three other tenants.

    <code>mermaid
    graph LR;
        AWS_Salesforce(&quot;AWS &amp; Salesforce Tenant&quot;) -- Bidirectional --&gt; Salesforce_Tenant1(&quot;Salesforce Tenant 1&quot;)
        Salesforce_Tenant1 -- Bidirectional --&gt; Salesforce_Tenant2(&quot;Salesforce Tenant 2&quot;)
        Salesforce_Tenant2 -- Bidirectional --&gt; Salesforce_Tenant3(&quot;Salesforce Tenant 3&quot;)
        Salesforce_Tenant3 -- Bidirectional --&gt; AWS_Salesforce</code>
</figure>

<p>Cross-tenant synchronization is one way. An internal member user can be synchronized into multiple tenants as an external user. When the topology shows a synchronization going in both directions, it&#39;s a distinct set of users in each direction and each arrow is a separate configuration.</p>
<h1 id="collaborate-across-business-units-full-mesh">Collaborate across business units (full-mesh)</h1>
<p>In this scenario, the organization has designated different tenants for each business unit. The business units work closely together, in particular using Microsoft Teams. As a result, each tenant has chosen to provision all users across the four tenants in the organization. As new users join the company or leave, the provisioning service takes care of creating and deleting users. The organization has also configured a multitenant organization that includes all four tenants. Now when users need to collaborate in Teams, they&#39;re able to easily find users across the company and start chats and meetings with those users.</p>
<figure>
Figure Description: The diagram shows interconnected organizations represented by geometric icons, specifically triangles with accompanying logos. There are two main triangles, each labeled with a corporate logo: one represents &quot;aws&quot; and the other &quot;salesforce&quot;. Both these triangles are connected via arrows indicating a flow of collaboration or data exchange between &quot;aws&quot; and &quot;salesforce&quot;. Additionally, each triangle connects to a smaller purple circle with graphical symbols inside, possibly indicating user groups or data sources.
</figure>

<h1 id="just-in-time">Just-in-time</h1>
<p>While the scenarios discussed so far cover collaboration within an organization, there are cases where cross-organization collaboration is vital. This could be in the context of joint ventures or organizations of independent legal entities. By employing connected organizations and entitlement management, you can define policies for accessing resources across connected organizations and enable users to request access to the resources they need.</p>
<h1 id="joint-ventures">Joint ventures</h1>
<p>Consider Contoso and Litware, separate organizations engaged in a multi-year joint venture. They need to collaborate closely. Administrators at Contoso have defined access packages containing the resources required by Litware users. When a new Litware employee needs access to Contoso&#39;s resources, they can request access to the access package. Upon approval, they are provisioned with the necessary resources. Access can be time-limited and subject to periodic review to ensure compliance with Contoso&#39;s governance requirements.</p>
<p>The following diagram shows how two organizations can just-in-time collaborate by using connected organizations and entitlement management.</p>
<pre><code class="lang-mermaid">graph TD;
    OrganizationA[aws] --&gt; |&quot;Collaboration/Data exchange&quot;| OrganizationB[salesforce]
    OrganizationB[salesforce] --&gt; |&quot;Collaboration/Data exchange&quot;| OrganizationA[aws]
    aws --&gt; |&quot;Data/Resources access&quot;| UserGroupA[&quot;Purple circle (aws)&quot;]
    salesforce --&gt; |&quot;Data/Resources access&quot;| UserGroupB[&quot;Purple circle (salesforce)&quot;]
</code></pre><p>| | ||</p>
<table>
<thead>
<tr>
<th>Litware</th>
<th>Litware</th>
<th>Litware</th>
</tr>
</thead>
<tbody>
<tr>
<td>user 1</td>
<td>user 2</td>
<td>user 3</td>
</tr>
</tbody>
</table>
<p>The figure represents a document diagramming connections and access within an organizational setting, titled &quot;Contoso&quot; which is connected to &quot;Litware.&quot; It outlines the various resources such as marketing and sales catalogs and groups, detailing access levels and policies for team members. Users labeled as &quot;User 1,&quot; &quot;User 2,&quot; and &quot;User 3&quot; are shown with specific connections to resources like the marketing app and sales app, along with roles like site member or contributor, documenting access permissions and separation of duties policies.</p>
<pre><code class="lang-mermaid">graph TD;
    Contoso --&gt;|Connected to| Litware;
    Contoso --&gt;|Marketing group| Marketing_catalog;
    Contoso --&gt;|Sales group| Sales_catalog;
    Marketing_catalog --&gt; Marketing_app;
    Sales_catalog --&gt; Sales_app;
    Sales_catalog --&gt; Sales_team_group;
    Sales_team_group --&gt;|Member| Sales_site;
    Sales_site --&gt;|Contributor| Sales_app;
    Sales_app --&gt;|Access package| Salesperson_access_package;
    Sales_app --&gt;|Access package| Sales_support_access_package;
    User1 --&gt;|Can request| Policies_for_access_request;
    User2 --&gt;|Can request| Policies_for_access_request;
    User3 --&gt;|Can request| Policies_for_access_request;
</code></pre><h1 id="next-steps-5">Next steps</h1>
<ul>
<li>What is cross-tenant synchronization?</li>
<li>Configure cross-tenant synchronization</li>
</ul>
<h1 id="feedback">Feedback</h1>
<p>Was this page helpful?</p>
<p>Yes</p>
<p>No</p>
<p>Provide product feedback  |  Get help at Microsoft Q&amp;A</p>
<h1 id="governance-and-cross-tenant-synchronization">Governance and cross-tenant synchronization</h1>
<p>Article · 03/21/2024</p>
<p>Cross-tenant synchronization is a flexible and ready-to-use solution to provision accounts and facilitate seamless collaboration across tenants in an organization. Cross- tenant synchronization automatically manages user identity lifecycle across tenants. It provisions, synchronizes, and deprovisions users in the scope of synchronization from source tenants.</p>
<p>This article describes how Microsoft Entra ID Governance customers can use cross- tenant synchronization to manage identity and access lifecycles across multitenant organizations.</p>
<h2 id="deployment-example">Deployment example</h2>
<p>In this example, Contoso is a multitenant organization with three production Microsoft Entra tenants. Contoso is deploying cross-tenant synchronization and Microsoft Entra ID Governance features to address the following scenarios:</p>
<ul>
<li>Manage employee identity lifecycles across multiple tenants</li>
<li>Use workflows to automate lifecycle processes for employees that originate in other tenants</li>
<li>Assign resource access automatically to employees that originate in other tenants</li>
<li>Allow employees to request access to resources in multiple tenants</li>
<li>Review the access of synchronized users</li>
</ul>
<p>From a cross-tenant synchronization perspective, Contoso Europe, Middle East, and Africa (Contoso EMEA) and Contoso United States (Contoso US) are source tenants and Contoso is a target tenant.</p>
<p>The following diagram illustrates the topology:</p>
<p><strong>Figure Description:</strong>
The diagram depicts the cross-tenant synchronization topology. Contoso Europe, Middle East, and Africa (Contoso EMEA) and Contoso United States (Contoso US) are shown as source tenants directing synchronization flows towards Contoso, which is the target tenant.</p>
<pre><code class="lang-mermaid">graph TD;
    Contoso_EMEA[&quot;Contoso Europe, Middle East, and Africa (Contoso EMEA)&quot;] --&gt; Contoso[&quot;Contoso (Target Tenant)&quot;];
    Contoso_US[&quot;Contoso United States (Contoso US)&quot;] --&gt; Contoso[&quot;Contoso (Target Tenant)&quot;];
</code></pre><figure>

This diagram depicts the supported topology for cross-tenant synchronization in Microsoft Entra ID. It includes two administrators, one for Contoso EMEA and one for Contoso US, both of whom are engaged in cross-tenant sync activities with a central system labeled as Contoso. This central system is depicted as providing access to several services including marketing catalogs, automatic assignment policies, access reviews, and lifecycle workflows.

<code>mermaid
graph TD;
    ContosoEMEA[Contoso EMEA Hybrid Identity Administrator] --&gt; Contoso[Contoso]
    ContosoUS[Contoso US Hybrid Identity Administrator] --&gt; Contoso[Contoso]
    Contoso --&gt; MarketingCatalogs[Marketing catalogs]
    Contoso --&gt; AutomaticAssignmentPolicies[Automatic assignment policies]
    Contoso --&gt; AccessReviews[Access Reviews]
    Contoso --&gt; LifecycleWorkflows[Lifecycle Workflows]</code>

</figure>

<p>This supported topology for cross-tenant synchronization is one of many in Microsoft Entra ID. Tenants can be a source tenant, a target tenant, or both. In the following sections, learn how cross-tenant synchronization and Microsoft Entra ID Governance features address several scenarios.</p>
<h1 id="manage-employee-lifecycles-across-tenants">Manage employee lifecycles across tenants</h1>
<p>Cross-tenant synchronization in Microsoft Entra ID automates creating, updating, and deleting B2B collaboration users.</p>
<p>When organizations create, or provision, a B2B collaboration user in a tenant, user access depends partly on how the organization provisioned them: Guest or Member user type. When you select user type, consider the various properties of a Microsoft Entra B2B collaboration user. The Member user type is suitable if users are part of the larger multitenant organization and need member-level access to resources in the organizational tenants. Microsoft Teams requires the Member user type in multitenant organizations.</p>
<p>By default, cross-tenant synchronization includes commonly used attributes on the user object in Microsoft Entra ID. The following diagram illustrates this scenario.</p>
<p>Organizations use the attributes to help create dynamic membership of groups and access packages in the source and target tenant. Some Microsoft Entra ID features have user attributes to target, such as lifecycle workflow user scoping.</p>
<p>To remove, or deprovision, a B2B collaboration user from a tenant automatically stops access to resources in that tenant. This configuration is relevant when employees leave an organization.</p>
<h3 id="figure-description">Figure Description</h3>
<p>This figure illustrates the process of cross-tenant synchronization and application provisioning related to access packages. It shows three main components connected through directional arrows:</p>
<ol>
<li>Cross-tenant Synchronization (syncs user attribute data) - represented by the first diagram that includes two overlaid blue triangles pointing towards a central platform.</li>
<li>Application Provisioning - represented by the central diagram featuring a cloud icon with arrows pointing inward.</li>
<li>Automatic Assignment Policies for Access Packages - represented by the final diagram showing a grid layout within a square.</li>
</ol>
<pre><code class="lang-mermaid">graph LR;
    CrossTenantSync(&quot;Cross-tenant Synchronization (syncs user attribute data)&quot;) --&gt; AppProvisioning(&quot;Application Provisioning&quot;)
    AppProvisioning --&gt; AutoAssignPolicies(&quot;Automatic Assignment Policies for Access Packages&quot;)
</code></pre><h1 id="automate-lifecycle-processes-with-workflows">Automate lifecycle processes with workflows</h1>
<p>Microsoft Entra ID lifecycle workflows are an identity governance feature to manage Microsoft Entra users. Organizations can automate joiner, mover, and leaver processes.</p>
<p>With cross-tenant synchronization, multitenant organizations can configure lifecycle workflows to run automatically for B2B collaboration users it manages. For example, configure a user onboarding workflow, triggered by the createdDateTime event user attribute, to request access package assignment for new B2B collaboration users. Use attributes such as userType and userPrincipalName to scope lifecycle workflows for users homed in other tenants the organization owns.</p>
<h1 id="govern-synchronized-user-access-with-access-packages">Govern synchronized user access with access packages</h1>
<p>Multitenant organizations can ensure B2B collaboration users have access to shared resources in a target tenant. Users can request access, where needed. In the following scenarios, see how the identity governance feature, entitlement management access packages govern resource access.</p>
<p>Automatically assign access in target tenants to employees from source tenants</p>
<p>The term birthright assignment refers to automatically granting resource access based on one or more user properties. To configure birthright assignment, create automatic assignment policies for access packages in entitlement management and configure resource roles to grant shared resource access.</p>
<p>Organizations manage cross-tenant synchronization configuration in the source tenant. Therefore, organizations can delegate resource access management to other source tenant administrators for synchronized B2B collaboration users:</p>
<p>· In the source tenant, administrators configure cross-tenant synchronization attribute mappings for the users that require cross-tenant resource access</p>
<p>· In the target tenant, administrators use attributes in automatic assignment policies to determine access package membership for synchronized B2B collaboration users</p>
<p>To drive automatic assignment policies in the target tenant, synchronize default attribute mappings, such as department or map directory extensions, in the source tenant.</p>
<p>Enable source-tenant employees to request access to target-tenant shared resources</p>
<p>With identity governance access package policies, multitenant organizations can allow B2B collaboration users, created by cross-tenant synchronization, to request access to shared resources in a target tenant. This process is useful if employees need just-in-time (JIT) access to a resource that another tenant owns.</p>
<p>Review synchronized-user access</p>
<p>Access reviews in Microsoft Entra ID enable organizations to manage group memberships, access to enterprise applications, and role assignments. Regularly review user access to ensure the right people have access.</p>
<p>When resource access configuration doesn&#39;t automatically assign access, such as with dynamic groups or access packages, configure access reviews to apply the results to resources upon completion. The following sections describe how multitenant organizations can configure access reviews for users across tenants in source and target tenants.</p>
<p>Review source-tenant user access</p>
<p>Multitenant organizations can include internal users in access reviews. This action enables access recertification in source tenants that synchronizes users. Use this approach for regular review of security groups assigned to cross-tenant synchronization. Therefore, ongoing B2B collaboration access to other tenants has approval in the user home tenant.</p>
<p>Use access reviews of users in source tenants to avoid potential conflicts between cross-tenant synchronization and access reviews that remove denied users upon completion.</p>
<h1 id="review-target-tenant-user-access">Review target-tenant user access</h1>
<p>Organizations can include B2B collaboration users in access reviews, including users provisioned by cross-tenant synchronization in target tenants. This option enables access recertification of resources in target tenants. Although organizations can target all users in access reviews, guest users can be explicitly targeted if necessary.</p>
<p>For organizations that synchronize B2B collaboration users, typically Microsoft doesn’t recommend removing denied guest users automatically from access reviews. Cross-tenant synchronization reprovisions the users if they&#39;re in the synchronization scope.</p>
<h1 id="next-steps-6">Next steps</h1>
<ul>
<li>Multitenant organizations and Microsoft 365</li>
<li>Multitenant organization templates</li>
<li>Topologies for cross-tenant synchronization</li>
</ul>
<h1 id="govern-access-for-security-operations-center-soc-teams-in-a-multitenant-environment">Govern access for security operations center (SOC) teams in a multitenant environment</h1>
<p>Article · 05/02/2024</p>
<p>Managing multitenant environments can add another layer of complexity when it comes to keeping up with the ever-evolving security threats facing your enterprise. Navigating across multiple tenants can be time consuming and reduce the overall efficiency of security operation center (SOC) teams. Multitenant management in Microsoft Defender XDR provides security operation teams with a single, unified view of all the tenants they manage. This view enables teams to quickly investigate incidents and perform advanced hunting across data from multiple tenants, improving their security operations.</p>
<p>Microsoft Entra ID Governance enables you to govern the access and lifecycle of the users who are members of the SOC teams and threat hunter teams. This document explores:</p>
<ul>
<li>The controls you can put in place for SOC teams to securely access resources across tenants.</li>
<li>Example topologies for how you can implement your lifecycle and access controls.</li>
<li>Deployment considerations (roles, monitoring, APIs).</li>
</ul>
<h1 id="manage-the-lifecycle-and-access-of-a-soc-user">Manage the lifecycle and access of a SOC user</h1>
<p>Microsoft Entra provides the controls needed to govern the lifecycle of a SOC user and to securely provide access to the resources they need. In this document, the term source tenant refers to where the SOC users originate and authenticate against. Target tenant refers to the tenant that they&#39;re investigating when there&#39;s an incident. Organizations have multiple target tenants due to mergers and acquisitions, aligning tenants with business units, and aligning tenants with geos.</p>
<h1 id="lifecycle-control">Lifecycle control</h1>
<p>Entitlement management, through access packages and connected organizations allows the target tenant administrator to define collections of resources (ex: app roles, directory roles, and groups) that users from the source tenant can request access to. If the user is approved for the resources they need, but don&#39;t yet have a B2B account, entitlement management will automatically create a B2B account for the user in the</p>
<p>target tenant. When they don&#39;t have any remaining entitlements in the target tenant, their B2B account will automatically be removed. Learn more</p>
<p>Cross-tenant synchronization allows the source tenant to automate creating, updating, and deleting B2B users across tenants in an organization.</p>
<p>Learn more</p>
<p>Comparing entitlement management and cross-tenant synchronization</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Entitlement management</th>
<th>Cross-tenant synchronization</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create users in the target tenant</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>Update users in the target tenant when their attributes change in the source tenant</td>
<td></td>
<td>✅</td>
</tr>
<tr>
<td>Delete users</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>Assign users to groups, directory roles, app roles</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>Attributes of the user in the target tenant</td>
<td>Minimal, supplied by user themself at request time</td>
<td>Synchronized from the source tenant</td>
</tr>
</tbody>
</table>
<p>Access control</p>
<p>You can use entitlement management and cross-tenant access policies to control access to resources across tenants. Entitlement management will assign the right users to the right resources, while cross-tenant access policies and conditional access together perform the necessary run-time checks to ensure the right users are accessing the right resources.</p>
<p>Entitlement management</p>
<p>Assigning Microsoft Entra roles through entitlement management access packages helps to efficiently manage role assignments at scale and improves the role assignment lifecycle. It provides a flexible request and approval process for gaining access to directory roles, app roles, and groups while also enabling automatic assignment to resources based on user attributes.</p>
<h1 id="cross-tenant-access-policies">Cross-tenant access policies</h1>
<p>External identities cross-tenant access settings manage how you collaborate with other Microsoft Entra organizations through B2B collaboration. These settings determine both the level of inbound access users in external Microsoft Entra organizations have to your resources, and the level of outbound access your users have to external organizations.</p>
<h1 id="deployment-topologies">Deployment topologies</h1>
<p>This section describes how you can use tools such as cross-tenant synchronization, entitlement management, cross-tenant access policies, and conditional access together. In both topologies, the target tenant admin has full control over access to resources in the target tenant. They differ in who initiates provisioning and deprovisioning.</p>
<h1 id="topology-1">Topology 1</h1>
<p>In topology 1, the source tenant configures entitlement management and cross-tenant synchronization to provision users into the target tenant. Then, the administrator of the target tenant configures access packages to provide access to the necessary directory roles, group, and app roles in the target tenant.</p>
<h3 id="text-description-of-the-figure">Text description of the figure:</h3>
<p>The image illustrates the process flow between a source tenant and a target tenant for configuring access in Topology 1. There are 3 key steps highlighted:</p>
<ol>
<li><p><strong>Source Tenant:</strong></p>
<ul>
<li><strong>SoC Users&#39; Governance:</strong><ul>
<li>Users are added to the SoC security groups through access packages.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Cross-Tenant Synchronization:</strong></p>
<ul>
<li><strong>Inject Attributes to Map to SoC Access Package:</strong><ul>
<li>Users are provisioned automatically through cross-tenant sync.</li>
<li>SoC users will have eligible access for Security Operator and Security Admin roles.</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Target Tenant:</strong></p>
<ul>
<li><strong>Guest Accounts Provisioning:</strong></li>
<li><strong>Access Packages Assignment:</strong><ul>
<li>Access Package 1 provides Security Reader access.</li>
<li>Access Package 2 provides Security Operator access.</li>
<li>Access Package 3 provides Security Admin access.</li>
</ul>
</li>
</ul>
</li>
</ol>
<pre><code class="lang-mermaid">flowchart TB
    SourceTenant(Source Tenant)
    TargetTenant(Target Tenant)
    SoC_1_Users(&quot;SoC 1 Access Package 1 Security Reader&quot;)
    SoC_2_Users(&quot;SoC 2 Access Package 2 Security Operator&quot;)
    SoC_3_Users(&quot;SoC 3 Access Package 3 Security Admin&quot;)
    SourceTenant --&gt; |&quot;1. SoC users&#39; governance&quot;| SoC_1_Users
    SourceTenant --&gt; |&quot;2. SoC users are provisioned through cross-tenant sync, eligible for Security Operator &amp; Admin roles&quot;| SoC_2_Users
    SourceTenant --&gt; |&quot;2. SoC users are provisioned through cross-tenant sync, eligible for Security Operator &amp; Admin roles&quot;| SoC_3_Users
    TargetTenant --&gt; |&quot;3. Provide Security Reader access through Access Package 1&quot;| SoC_1_Users
    TargetTenant --&gt; |&quot;3. Provide Security Operator access through Access Package 2&quot;| SoC_2_Users
    TargetTenant --&gt; |&quot;3. Provide Security Admin access through Access Package 3&quot;| SoC_3_Users
</code></pre><p>Steps to configure topology 1</p>
<ol>
<li>In the source tenant, configure cross-tenant synchronization to provision internal accounts in the source tenant as external accounts in the target tenant.</li>
</ol>
<p>As users are assigned to the cross-tenant synchronization service principal, they&#39;ll automatically be provisioned into the target tenant. As they&#39;re removed from the configuration, they&#39;ll automatically be deprovisioned. As part of your attribute mappings, you can add a new mapping of type constant to provision a directory extension attribute on the user to indicate that they&#39;re a SOC administrator. Alternatively, if you have an attribute such as department that you can rely on for this step, you can skip creating the extension. This attribute will be used in the target tenant to provide them with access to the necessary roles.</p>
<ol>
<li>In the source tenant, create an access package that includes the cross-tenant synchronization service principal as a resource.</li>
</ol>
<p>As users are granted access to the package, they&#39;ll be assigned to the cross-tenant synchronization service principal. Ensure that you set up periodic access reviews of the access package or time-limit the assignments to ensure that only the users that need access to the target tenant continue to have access.</p>
<ol>
<li>In the target tenant, create access packages to provide the necessary roles for investigating an incident.</li>
</ol>
<p>We recommend one autoassigned access package to provide the Security Reader role and one request based package for the Security Operator and Security Administrator roles.</p>
<p>Once you have completed the setup, SOC users can navigate to myaccess.microsoft.com to request time-limited access to the necessary access packages in the source tenant. Once approved, they&#39;ll automatically be provisioned into the target tenant(s) with the security reader role. They can then request additional access in any tenants where they need the Security Operator or Security Administrator roles. Once their access period is over or they&#39;re removed as part of an access review, they&#39;ll be deprovisioned from all the target tenants they don&#39;t need access to anymore.</p>
<p>In topology 2 the target tenant administrator defines the access packages and resources that the source users can request access to. If the source tenant administrator would like to restrict which of their users can access the target tenant, you can use a cross-tenant access policy coupled with an access package to block all access to the target tenant, except for users that are part of a group that is included in an access package in the home tenant.</p>
<figure>

Text description of the figure:

The image presents a flowchart diagram illustrating the steps and procedures between a &quot;Source tenant&quot; and a &quot;Target tenant.&quot; Three main steps are depicted: (1) SoC users&#39; governance, (2) Guest accounts provisioning, and (3) Access packages assignment. The first step involves establishing a connected organization between the tenants. The second step outlines defining access packages within the target tenant that are necessary for various roles and ensuring they are accessible by the connected organization. The third step shows that upon requesting an access package, SoC users will automatically receive Security Reader access and will be eligible for Security Operator and Security Admin roles. The roles are represented by three access packages: Security Reader, Security Operator, and Security Admin.

<code>mermaid
graph TD;
    SourceTenant(&quot;Source Tenant&quot;) --&gt;|&quot;1. Establish a connected organization&quot;| ConnectedOrganization(&quot;Connected Organization&quot;);
    ConnectedOrganization --&gt;|&quot;2. Define access packages for necessary roles&quot;| PackageDefinition(&quot;Access Packages Defined&quot;);
    PackageDefinition --&gt;|&quot;3. Access Packages Assignment&quot;| PackageAssignment(&quot;Access Packages Assigned&quot;);
    PackageAssignment --&gt; SecurityReader(&quot;Security Reader&quot;);
    PackageAssignment --&gt; SecurityOperator(&quot;Security Operator&quot;);
    PackageAssignment --&gt; SecurityAdmin(&quot;Security Admin&quot;);
    SecurityReader --&gt;|&quot;SoC users auto-assigned upon request&quot;| Users(&quot;SoC Users&quot;);
    SecurityOperator --&gt;|&quot;Eligible access&quot;| Users;
    SecurityAdmin --&gt;|&quot;Eligible access&quot;| Users;</code>

</figure>

<p>Steps to configure topology 2</p>
<ol>
<li>In the target tenant, add the source tenant as a connected organization.</li>
</ol>
<p>This setting allows the target tenant administrator to make access packages available to the source tenant.</p>
<ol>
<li><p>In the target tenant, create an access package that provides the Security Reader, Security Administrator, and Security Operator roles.</p>
</li>
<li><p>Users from the source tenant can now request access packages in the target tenant.</p>
</li>
</ol>
<p>Once you have completed the setup, SOC users can navigate to myaccess.microsoft.com to request time-limited access to the necessary roles in each tenant.</p>
<h1 id="topologies-compared">Topologies compared</h1>
<p>In both topologies, the target tenant can control what resources users have access to. This can be accomplished using a mix of cross-tenant access policies, conditional access, and assignment of apps and roles to users. They differ in who configures and initiates provisioning. In topology 1, the source tenant configures provisioning and pushes users into the target tenants. In topology 2, the target tenant defines which users are eligible to access their tenant.</p>
<p>If a user needs access to several tenants at one time, topology 1 makes it easy for them to request access to an access package in one tenant and automatically get provisioned into several tenants. If the target tenant wants to ensure full control over who is</p>
<h1 id="deployment-considerations">Deployment considerations</h1>
<p>Monitoring</p>
<p>Actions performed by a SOC analyst in Microsoft Entra are audited in the Microsoft Entra tenant that they&#39;re working in. Organizations can maintain an audit trail of actions performed, generate alerts when specific actions are performed, and analyze actions performed by pushing audit logs into Azure Monitor.</p>
<p>Learn more</p>
<p>Actions performed by a SOC analyst in Microsoft Defender are also audited.</p>
<p>Learn more</p>
<h1 id="scaling-deployment-with-powershell--apis">Scaling deployment with PowerShell / APIs</h1>
<p>Every step that is configured through the user interface in Microsoft Entra has accompanying Microsoft Graph APIs and PowerShell commandlets, enabling you to deploy your desired policies/configuration across the tenants in your organization.</p>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Microsoft Graph API</th>
<th>PowerShell</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cross-tenant synchronization</td>
<td>Link</td>
<td>Link</td>
</tr>
<tr>
<td>Entitlement management</td>
<td>Link</td>
<td>Link</td>
</tr>
<tr>
<td>Cross-tenant access policies</td>
<td>Link</td>
<td>Link</td>
</tr>
</tbody>
</table>
<h1 id="role-based-access-control">Role-based access control</h1>
<p>Configuring the capabilities described in topology 1 and topology 2 require the following roles:</p>
<ul>
<li>Configuring cross-tenant access settings - Security Administrator</li>
<li>Configuring cross-tenant synchronization - Hybrid Identity Administrator</li>
<li>Configuring entitlement management - Identity Governance Administrator</li>
<li>Microsoft Defender supports both built-in roles such as Security Reader, Security Administrator, and Security Operator and custom roles.</li>
</ul>
<h1 id="next-steps-7">Next steps</h1>
<p>· What is cross-tenant synchronization?</p>
<p>· What is entitlement management?</p>
<p>· Multitenant management in Defender XDR</p>
<h1 id="known-issues-for-provisioning-in-microsoft-entra-id">Known issues for provisioning in Microsoft Entra ID</h1>
<p>Article · 02/14/2024</p>
<p>This article discusses known issues to be aware of when you work with app provisioning or cross-tenant synchronization. To provide feedback about the application provisioning service on UserVoice, see Microsoft Entra application provision UserVoice ZZ. We watch UserVoice closely so that we can improve the service.</p>
<h1 id="note">Note</h1>
<p>This article isn&#39;t a comprehensive list of known issues. If you know of an issue that isn&#39;t listed, provide feedback at the bottom of the page.</p>
<h1 id="authorization">Authorization</h1>
<h2 id="unable-to-change-provisioning-mode-back-to-manual">Unable to change provisioning mode back to manual</h2>
<p>After you&#39;ve configured provisioning for the first time, you&#39;ll notice that the provisioning mode has switched from manual to automatic. You can&#39;t change it back to manual. But you can turn off provisioning through the UI. Turning off provisioning in the UI effectively does the same as setting the dropdown to manual.</p>
<h1 id="attribute-mappings">Attribute mappings</h1>
<h2 id="attribute-samaccountname-or-usertype-not-available-as-a-source-attribute">Attribute SamAccountName or userType not available as a source attribute</h2>
<p>The attributes SamAccountName and userType aren&#39;t available as a source attribute by default. Extend your schema to add the attributes. You can add the attributes to the list of available source attributes by extending your schema. To learn more, see Missing source attribute.</p>
<h2 id="source-attribute-dropdown-missing-for-schema-extension">Source attribute dropdown missing for schema extension</h2>
<p>Extensions to your schema can sometimes be missing from the source attribute dropdown in the UI. Go into the advanced settings of your attribute mappings and</p>
<h1 id="null-attribute-cant-be-provisioned">Null attribute can&#39;t be provisioned</h1>
<p>Microsoft Entra ID currently can&#39;t provision null attributes. If an attribute is null on the user object, it will be skipped.</p>
<h1 id="maximum-characters-for-attribute-mapping-expressions">Maximum characters for attribute-mapping expressions</h1>
<p>Attribute-mapping expressions can have a maximum of 10,000 characters.</p>
<h2 id="unsupported-scoping-filters">Unsupported scoping filters</h2>
<p>The appRoleAssignments, userType, and accountExpires attributes aren&#39;t supported as scoping filters.</p>
<h1 id="multivalue-directory-extensions">Multivalue directory extensions</h1>
<p>Multivalue directory extensions can&#39;t be used in attribute mappings or scoping filters.</p>
<h1 id="service-issues">Service issues</h1>
<p>Unsupported scenarios</p>
<ul>
<li>Provisioning passwords isn&#39;t supported.</li>
<li>Provisioning nested groups isn&#39;t supported.</li>
<li>Provisioning to B2C tenants isn&#39;t supported because of the size of the tenants.</li>
<li>Not all provisioning apps are available in all clouds. For example, Atlassian isn&#39;t yet available in the Government cloud. We&#39;re working with app developers to onboard their apps to all clouds.</li>
</ul>
<h1 id="automatic-provisioning-isnt-available-on-my-oidc-based-application">Automatic provisioning isn&#39;t available on my OIDC-based application</h1>
<p>If you create an app registration, the corresponding service principal in enterprise apps won&#39;t be enabled for automatic user provisioning. You&#39;ll need to either request the app be added to the gallery, if intended for use by multiple organizations, or create a second non-gallery app for provisioning.</p>
<h1 id="manager-isnt-provisioned">Manager isn&#39;t provisioned</h1>
<p>If a user and their manager are both in scope for provisioning, the service provisions the user and then updates the manager. If on day one the user is in scope and the manager is out of scope, we&#39;ll provision the user without the manager reference. When the manager comes into scope, the manager reference won&#39;t be updated until you restart provisioning and cause the service to reevaluate all the users again.</p>
<h1 id="the-provisioning-interval-is-fixed">The provisioning interval is fixed</h1>
<p>The time between provisioning cycles is currently not configurable.</p>
<h1 id="changes-not-moving-from-target-app-to-microsoft-entra-id">Changes not moving from target app to Microsoft Entra ID</h1>
<p>The app provisioning service isn&#39;t aware of changes made in external apps. So, no action is taken to roll back. The app provisioning service relies on changes made in Microsoft Entra ID.</p>
<h1 id="switching-from-sync-all-to-sync-assigned-not-working">Switching from Sync All to Sync Assigned not working</h1>
<p>After you change scope from Sync All to Sync Assigned, make sure to also perform a restart to ensure that the change takes effect. You can do the restart from the UI.</p>
<h1 id="provisioning-cycle-continues-until-completion">Provisioning cycle continues until completion</h1>
<p>When you set provisioning to enabled = off or select Stop, the current provisioning cycle continues running until completion. The service stops executing any future cycles until you turn provisioning on again.</p>
<h1 id="member-of-group-not-provisioned">Member of group not provisioned</h1>
<p>When a group is in scope and a member is out of scope, the group will be provisioned. The out-of-scope user won&#39;t be provisioned. If the member comes back into scope, the service won&#39;t immediately detect the change. Restarting provisioning addresses the issue. Periodically restart the service to ensure that all users are properly provisioned.</p>
<h1 id="global-reader">Global Reader</h1>
<p>The Global Reader role is unable to read the provisioning configuration. Create a custom role with the microsoft.directory/applications/synchronization/standard/read</p>
<h1 id="microsoft-azure-government-cloud">Microsoft Azure Government Cloud</h1>
<p>Credentials, including the secret token, notification email, and SSO certificate notification emails together have a 1KB limit in the Microsoft Azure Government Cloud.</p>
<h1 id="on-premises-application-provisioning">On-premises application provisioning</h1>
<p>The following information is a current list of known limitations with the Microsoft Entra ECMA Connector Host and on-premises application provisioning.</p>
<h1 id="application-and-directories">Application and directories</h1>
<p>The following applications and directories aren&#39;t yet supported.</p>
<p>Active Directory Domain Services (user or group writeback from Microsoft Entra ID by using the on-premises provisioning preview)</p>
<p>· When a user is managed by Microsoft Entra Connect, the source of authority is on-premises Active Directory Domain Services. So, user attributes can&#39;t be changed in Microsoft Entra ID. This preview doesn&#39;t change the source of authority for users managed by Microsoft Entra Connect.</p>
<p>· Attempting to use Microsoft Entra Connect and the on-premises provisioning to provision groups or users into Active Directory Domain Services can lead to creation of a loop, where Microsoft Entra Connect can overwrite a change that was made by the provisioning service in the cloud. Microsoft is working on a dedicated capability for group or user writeback. Upvote the UserVoice feedback on this <a href="https://your-link-here.com">website 4</a> to track the status of the preview. Alternatively, you can use <a href="https://your-link-here.com">Microsoft Identity Manager</a> for user or group writeback from Microsoft Entra ID to Active Directory.</p>
<h1 id="microsoft-entra-id">Microsoft Entra ID</h1>
<p>By using on-premises provisioning, you can take a user already in Microsoft Entra ID and provision them into a third-party application. You can&#39;t bring a user into the directory from a third-party application. Customers will need to rely on our native HR integrations, Microsoft Entra Connect, Microsoft Identity Manager, or Microsoft Graph, to bring users into the directory.</p>
<h1 id="attributes-and-objects">Attributes and objects</h1>
<p>The following attributes and objects aren&#39;t supported:</p>
<ul>
<li>Multivalued attributes.</li>
<li>Reference attributes (for example, manager).</li>
<li>Groups.</li>
<li>Complex anchors (for example, ObjectTypeName+UserName).</li>
<li>Attributes that have characters such as &quot;.&quot; or &quot;[&quot;</li>
<li>Binary attributes.</li>
<li>On-premises applications are sometimes not federated with Microsoft Entra ID and require local passwords. The on-premises provisioning preview doesn&#39;t support password synchronization. Provisioning initial one-time passwords is supported. Ensure that you&#39;re using the Redact function to redact the passwords from the logs. In the SQL and LDAP connectors, the passwords aren&#39;t exported on the initial call to the application, but rather a second call with set password.</li>
</ul>
<h2 id="ssl-certificates">SSL certificates</h2>
<p>The Microsoft Entra ECMA Connector Host currently requires either an SSL certificate to be trusted by Azure or the provisioning agent to be used. The certificate subject must match the host name the Microsoft Entra ECMA Connector Host is installed on.</p>
<h2 id="anchor-attributes">Anchor attributes</h2>
<p>The Microsoft Entra ECMA Connector Host currently doesn&#39;t support anchor attribute changes (renames) or target systems, which require multiple attributes to form an anchor.</p>
<h2 id="attribute-discovery-and-mapping">Attribute discovery and mapping</h2>
<p>The attributes that the target application supports are discovered and surfaced in the Microsoft Entra admin center in Attribute Mappings. Newly added attributes will continue to be discovered. If an attribute type has changed, for example, string to Boolean, and the attribute is part of the mappings, the type won&#39;t change automatically in the Microsoft Entra admin center. Customers will need to go into advanced settings in mappings and manually update the attribute type.</p>
<h2 id="provisioning-agent">Provisioning agent</h2>
<p>· The agent doesn&#39;t currently support auto update for the on-premises application provisioning scenario. We&#39;re actively working to close this gap and ensure that auto update is enabled by default and required for all customers.</p>
<p>· The same provisioning agent can&#39;t be used for on-premises app provisioning and cloud sync / HR- driven provisioning.</p>
<h1 id="next-steps-8">Next steps</h1>
<p>How provisioning works</p>
<h1 id="configure-a-multitenant-organization-using-powershell-or-microsoft-graph-api">Configure a multitenant organization using PowerShell or Microsoft Graph API</h1>
<p>Article · 04/24/2024</p>
<p>This article describes the key steps to configure a multitenant organization using Microsoft Graph PowerShell or Microsoft Graph API. This article uses an example owner tenant named Cairo and two member tenants named Berlin and Athens.</p>
<p>If you instead want to use the Microsoft 365 admin center to configure a multitenant organization, see Set up a multitenant org in Microsoft 365 and Join or leave a multitenant organization in Microsoft 365. To learn how to configure Microsoft Teams for your multitenant organization, see The new Microsoft Teams desktop client.</p>
<p>Figure: Illustration showing the Cross-tenant access settings between the example owner tenant, Cairo, and member tenants, Athens and Berlin. The owner tenant Cairo is at the top, with directional arrows pointing towards the member tenants, Athens on the left and Berlin on the right, demonstrating the access configuration among them. </p>
<pre><code class="lang-mermaid">graph TD;
    OwnerTenantCairo[&quot;Owner tenant (Cairo)&quot;] --&gt; MemberTenantAthens[&quot;Member tenant (Athens)&quot;]
    OwnerTenantCairo[&quot;Owner tenant (Cairo)&quot;] --&gt; MemberTenantBerlin[&quot;Member tenant (Berlin)&quot;]
</code></pre><h1 id="prerequisites">Prerequisites</h1>
<p>Owner tenant</p>
<ul>
<li>For license information, see License requirements.</li>
<li>Security Administrator role to configure cross-tenant access settings and templates for the multitenant organization.</li>
<li>Global Administrator role to consent to required permissions.</li>
</ul>
<p>Member tenant</p>
<p>· For license information, see License requirements.</p>
<p>· Security Administrator role to configure cross-tenant access settings and templates for the multitenant organization.</p>
<p>· Global Administrator role to consent to required permissions.</p>
<h3 id="step-1-sign-in-to-the-owner-tenant">Step 1: Sign in to the owner tenant</h3>
<p>Owner tenant</p>
<ol>
<li>Start PowerShell.</li>
<li>If necessary, install the Microsoft Graph PowerShell SDK.</li>
<li>Get the tenant ID of the owner and member tenants and initialize variables.</li>
</ol>
<pre><code class="lang-PowerShell">$OwnerTenantId = &quot;&lt;OwnerTenantId&gt;&quot;
$MemberTenantIdB = &quot;&lt;MemberTenantIdB&gt;&quot;
$MemberTenantIdA = &quot;&lt;MemberTenantIdA&gt;&quot;
</code></pre><ol>
<li>Use the Connect-MgGraph command to sign in to the owner tenant and consent to the following required permissions.</li>
</ol>
<ul>
<li>MultiTenantOrganization.ReadWrite.All</li>
<li>Policy.Read.All</li>
<li>Policy.ReadWrite.CrossTenantAccess</li>
<li>Application.ReadWrite.All</li>
<li>Directory.ReadWrite.All</li>
</ul>
<pre><code class="lang-PowerShell">Connect-MgGraph -TenantId $OwnerTenantId -Scopes &quot;MultiTenantOrganization.ReadWrite.All&quot;, &quot;Policy.Read.All&quot;, &quot;Policy.ReadWrite.CrossTenantAccess&quot;, &quot;Application.ReadWrite.All&quot;, &quot;Directory.ReadWrite.All&quot;
</code></pre><p>eadWrite.CrossTenantAccess&quot;, &quot;Application.ReadWrite.All&quot;, &quot;Directory.ReadWrite.All&quot;</p>
<h1 id="step-2-create-a-multitenant-organization">Step 2: Create a multitenant organization</h1>
<h3 id="figure-description-1">Figure Description</h3>
<p>A diagram shows a multitenant organization creation flow. A blue triangle points downwards, symbolizing the initiation or start of the process in an Owner tenant environment.</p>
<pre><code class="lang-mermaid">graph TD;
    Start(&quot;Start - Owner Tenant&quot;) --&gt; Command1[&quot;Update-MgBetaTenantRelationshipMultiTenantOrganization - DisplayName &#39;Cairo&#39;&quot;]
    Command1 --&gt; Check[&quot;Get-MgBetaTenantRelationshipMultiTenantOrganization - Format List&quot;]
    Check --&gt; ActiveState[&quot;State: active&quot;]
</code></pre><p>Owner tenant</p>
<p>PowerShell</p>
<ol>
<li>In the owner tenant, use the Update-</li>
</ol>
<p>MgBetaTenantRelationshipMultiTenantOrganization command to create your multitenant organization. This operation can take a few minutes.</p>
<p>PowerShell</p>
<p>Update-MgBetaTenantRelationshipMultiTenantOrganization -DisplayName &quot;Cairo&quot;</p>
<ol>
<li>Use the Get-MgBetaTenantRelationshipMultiTenantOrganization command to check that the operation has completed before proceeding.</li>
</ol>
<p>PowerShell</p>
<p>Get-MgBetaTenantRelationshipMultiTenantOrganization Format-List</p>
<p>Output</p>
<p>CreatedDateTime</p>
<p>: 1/8/2024 7:47:45 PM</p>
<p>Description</p>
<p>:</p>
<p>DisplayName</p>
<p>: Cairo</p>
<p>Id</p>
<p>: &lt; MtoIdC&gt;</p>
<p>JoinRequest</p>
<p>:</p>
<p>Microsoft. Graph. Beta. PowerShell.Models.MicrosoftGraphMultiTenantOrg</p>
<p>anizationJoinRequestRecord</p>
<p>State</p>
<p>: active</p>
<p>Tenants</p>
<p>:</p>
<p>AdditionalProperties : {[@odata.context,</p>
<p><a href="https://graph.microsoft.com/beta/$metadata#tenantRelationships/mult">https://graph.microsoft.com/beta/$metadata#tenantRelationships/mult</a></p>
<p>iTenantOrganization/$entity]}</p>
<h1 id="step-3-add-tenants">Step 3: Add tenants</h1>
<p>Owner tenant</p>
<p>PowerShell</p>
<ol>
<li>In the owner tenant, use the New- MgBetaTenantRelationshipMultiTenantOrganizationTenant command to add tenants to your multitenant organization.</li>
</ol>
<p>PowerShell</p>
<p>New-MgBetaTenantRelationshipMultiTenantOrganizationTenant -TenantID $MemberTenantIdB -DisplayName &quot;Berlin&quot; | Format-List</p>
<p>PowerShell</p>
<p>New-MgBetaTenantRelationshipMultiTenantOrganizationTenant -TenantID $MemberTenantIdA -DisplayName &quot;Athens&quot; | Format-List</p>
<ol>
<li>Use the Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant command to verify that the operation has completed before proceeding.</li>
</ol>
<p>PowerShell</p>
<p>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant | Format-List</p>
<p>Output</p>
<p>AddedByTenantId: <ownertenantid><p>
<p>AddedDateTime: 1/8/2024 7:47:45 PM</p>
<p>DeletedDateTime:</p>
<p>DisplayName: Cairo</p>
<p>Id: <mtoidc><p>
<p>JoinedDateTime:</p>
<p>Role: owner</p>
<p>State: active</p>
<p>TenantId: <ownertenantid><p>
<p>TransitionDetails: Microsoft.Graph.Beta.PowerShell.Models.MicrosoftGraphMultiTenantOrganizationMemberTransitionDetails</p>
<p>AdditionalProperties: {[multiTenantOrgLabelType, none]}</p>
<h3 id="diagram-description-1">Diagram description</h3>
<p>The figure represents a flowchart or diagram delineating the relationships or operations described in the PowerShell commands text involving tenants management in a multitenant setup.</p>
<pre><code class="lang-mermaid">graph TD;
    OwnerTenant[&quot;Owner Tenant&quot;] --&gt; Berlin[&quot;Tenant: Berlin&quot;]
    OwnerTenant --&gt; Athens[&quot;Tenant: Athens&quot;]
    Berlin --&gt; Cairo[&quot;Tenant: Cairo&quot;]
    Athens --&gt; Cairo
</code></pre><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>AddedByTenantId</td>
<td>: &lt; OwnerTenantId&gt;</td>
</tr>
<tr>
<td>AddedDateTime</td>
<td>: 1/8/2024 8:05:25 PM</td>
</tr>
<tr>
<td>DeletedDateTime</td>
<td>:</td>
</tr>
<tr>
<td>DisplayName</td>
<td>: Berlin</td>
</tr>
<tr>
<td>Id</td>
<td>: &lt; MtoIdB&gt;</td>
</tr>
<tr>
<td>JoinedDateTime</td>
<td>:</td>
</tr>
<tr>
<td>Role</td>
<td>: member</td>
</tr>
<tr>
<td>State</td>
<td>: pending</td>
</tr>
<tr>
<td>TenantId</td>
<td>: &lt; MemberTenantIdB&gt;</td>
</tr>
</tbody>
</table>
<p>TransitionDetails</p>
<p>:</p>
<p>Microsoft. Graph. Beta. PowerShell. Models. MicrosoftGraphMultiTenantOrganizationMemberTransitionDetails AdditionalProperties : {[multiTenantOrgLabelType, none] }</p>
<p>AddedByTenantId</p>
<p>: &lt; OwnerTenantId&gt;</p>
<p>AddedDateTime</p>
<p>: 1/8/2024 8:08:47 PM</p>
<p>DeletedDateTime</p>
<p>:</p>
<p>DisplayName</p>
<p>: Athens</p>
<p>Id</p>
<p>: &lt; MtoIdA&gt;</p>
<p>JoinedDateTime</p>
<p>:</p>
<p>Role</p>
<p>: member</p>
<p>State</p>
<p>: pending</p>
<p>TenantId</p>
<p>: &lt; MemberTenantIdA&gt;</p>
<p>:</p>
<p>TransitionDetails</p>
<p>Microsoft. Graph. Beta. PowerShell.Models. MicrosoftGraphMultiTenantOrganizationMemberTransitionDetails</p>
<p>AdditionalProperties : {[multiTenantOrgLabelType, none]}</p>
<h1 id="step-4-optional-change-the-role-of-a-tenant">Step 4: (Optional) Change the role of a tenant</h1>
<p>Description of the figure: Diagram showing the potential transitions between roles in a multi-tenant organization.</p>
<pre><code class="lang-mermaid">graph TD;
    MemberTenant --&gt; OwnerTenant[&quot;Change member tenant to owner tenant&quot;];
    OwnerTenant --&gt; MemberTenant[&quot;Change owner tenant to member tenant&quot;];
</code></pre><p>Owner tenant</p>
<p>By default, tenants added to the multitenant organization are member tenants. Optionally, you can change them to owner tenants, which allow them to add other tenants to the multitenant organization. You can also change an owner tenant to a member tenant.</p>
<p>PowerShell</p>
<p>1. In the owner tenant, use the Update- MgBetaTenantRelationshipMultiTenantOrganizationTenant command to change a member tenant to an owner tenant.</p>
<p>PowerShell</p>
<p>Update-MgBetaTenantRelationshipMultiTenantOrganizationTenant - MultiTenantOrganizationMemberId $MemberTenantIdB -Role &quot;Owner&quot; Format-List</p>
<h1 id="2-use-the-get-mgbetatenantrelationshipmultitenantorganizationtenant-command-to-verify-the-change">2. Use the Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant command to verify the change.</h1>
<p>PowerShell</p>
<p>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant -
MultiTenantOrganizationMemberId $MemberTenantIdB
Format-List</p>
<h1 id="output">Output</h1>
<p>AddedByTenantId
: &lt; OwnerTenantId&gt;
AddedDateTime
: 1/8/2024 8:05:25 PM
DeletedDateTime
:
DisplayName
: Berlin
Id
: &lt; MtoIdB&gt;
JoinedDateTime
:
Role
: owner
State
: pending
TenantId
: &lt; MemberTenantIdB&gt;
TransitionDetails
:
Microsoft. Graph. Beta. PowerShell. Models. MicrosoftGraphMultiTenantOrganizationMemberTransitionDetails AdditionalProperties : {[@odata.context, <a href="https://graph.microsoft.com/beta/$metadata#tenantRelationships/multiTenantOrganization/tenants/$entity">https://graph.microsoft.com/beta/$metadata#tenantRelationships/multiTenantOrganization/tenants/$entity</a>], [multiTenantOrgLabelType, none]}</p>
<h1 id="step-5-optional-remove-a-member-tenant">Step 5: (Optional) Remove a member tenant</h1>
<p>Owner tenant</p>
<p>You can remove any member tenant, including your own. You can&#39;t remove owner tenants. Also, you can&#39;t remove the original creator tenant, even if it has been changed from owner to member.</p>
<p>PowerShell</p>
<h3 id="description-of-the-missing-figure">Description of the Missing Figure</h3>
<p>The figure likely illustrates a diagram or flowchart showing the relationship between the owner tenant and member tenants within an organization, demonstrating the process or authorization required to remove a member tenant.</p>
<pre><code class="lang-mermaid">graph TD;
    OwnerTenantC[&quot;Owner tenant (C)&quot;] --&gt; MemberTenantA[&quot;Member tenant (A)&quot;]
    OwnerTenantC --&gt; MemberTenantB[&quot;Member tenant (B)&quot;]
    MemberTenantA --&gt; MemberTenantB
</code></pre><ol>
<li>In the owner tenant, use the Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant command to remove any member tenant. This operation takes a few minutes.</li>
</ol>
<p>PowerShell</p>
<p>Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId <membertenantidd><p>
<ol>
<li>Use the Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant command to verify the change.</li>
</ol>
<p>PowerShell</p>
<p>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId <membertenantidd><p>
<p>After the remove command completes, the output is similar to the following. This is an expected error message. It indicates that the tenant has been removed from the multitenant organization.</p>
<p>Output</p>
<p>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant_Get: Unable to read the company information from the directory.</p>
<p>Status: 404 (NotFound) ErrorCode: Directory_ObjectNotFound Date: 2024-01-08T20:35:11</p>
<hr>
<p>Step 6: Sign in to a member tenant</p>
<p>Text Description for Figure: The figure illustrates a graphical user interface depicting the process of signing into a member tenant.</p>
<pre><code class="lang-mermaid">graph TD;
    CairoTenant --&gt; BerlinTenant;
    CairoTenant --&gt; AthensTenant;
</code></pre><p>Member tenant</p>
<p>The Cairo tenant created a multitenant organization and added the Berlin and Athens tenants. In these steps, you sign in to the Berlin tenant and join the multitenant organization created by Cairo.</p>
<ol>
<li><p>Start PowerShell.</p>
</li>
<li><p>Use the Connect-MgGraph command to sign in to the member tenant and consent to the following required permissions.</p>
</li>
</ol>
<ul>
<li>MultiTenantOrganization.ReadWrite.All</li>
<li>Policy.Read.All</li>
<li>Policy.ReadWrite.CrossTenantAccess</li>
<li>Application.ReadWrite.All</li>
<li>Directory.ReadWrite.All</li>
</ul>
<p>PowerShell</p>
<p>Connect-MgGraph -TenantId $MemberTenantIdB -Scopes &quot;MultiTenantOrganization.ReadWrite.All&quot;, &quot;Policy.Read.All&quot;, &quot;Policy.ReadWrite.CrossTenantAccess&quot;, &quot;Application.ReadWrite.All&quot;, &quot;Directory.ReadWrite.All&quot;</p>
<h1 id="step-7-join-the-multitenant-organization">Step 7: Join the multitenant organization</h1>
<p><strong>Figure Description:</strong>
A diagram showing the process to join the multitenant organization. The diagram contains an arrow pointing downwards which symbolizes the action of joining.</p>
<pre><code class="lang-mermaid">graph TD;
    Start[Join Process Start] --&gt; End[Join Process End]
</code></pre><p>Member tenant</p>
<p>PowerShell</p>
<ol>
<li>In the member tenant, use the Update-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest command to join the multitenant organization.</li>
</ol>
<p>PowerShell</p>
<p>Update-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest - AddedByTenantId $OwnerTenantId | Format-List</p>
<ol>
<li>Use the Get-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest command to verify the join.</li>
</ol>
<!-- PageHeader="PowerShell" -->
<p>Get-MgBetaTenantRelationshipMultiTenantOrganizationJoinRequest Format-List</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Output</td>
<td></td>
</tr>
<tr>
<td>AddedByTenantId</td>
<td>: &lt; OwnerTenantId&gt;</td>
</tr>
<tr>
<td>Id</td>
<td>: &lt; MtoJoinRequestIdB&gt;</td>
</tr>
<tr>
<td>MemberState</td>
<td>: active</td>
</tr>
<tr>
<td>Role</td>
<td>: member</td>
</tr>
<tr>
<td>TransitionDetails</td>
<td>:</td>
</tr>
<tr>
<td>Microsoft. Graph. Beta. PowerShell. Models. MicrosoftGraphMultiTenantOrg anizationJoinRequestTransitionDetails</td>
<td></td>
</tr>
<tr>
<td>AdditionalProperties : {[@odata.context,</td>
<td></td>
</tr>
<tr>
<td><a href="https://graph.microsoft.com/beta/$metadata#tenantRelationships/mult">https://graph.microsoft.com/beta/$metadata#tenantRelationships/mult</a> iTenantOrganization/joinRequest/$entity]}</td>
<td></td>
</tr>
</tbody>
</table>
<p>3. Use the Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant</p>
<p>command to check the multitenant organization itself. It should reflect the</p>
<p>join operation.</p>
<p>PowerShell</p>
<p>Get-MgBetaTenantRelationshipMultiTenantOrganizationTenant | Format-</p>
<p>List</p>
<p>Output</p>
<p>AddedByTenantId</p>
<p>: &lt; OwnerTenantId&gt;</p>
<p>AddedDateTime</p>
<p>: 1/8/2024 8:05:25 PM</p>
<p>DeletedDateTime</p>
<p>:</p>
<p>DisplayName</p>
<p>: Berlin</p>
<p>Id</p>
<p>: &lt; MtoJoinRequestIdB&gt;</p>
<p>JoinedDateTime</p>
<p>: 1/8/2024 9:53:55 PM</p>
<p>Role</p>
<p>: member</p>
<p>State</p>
<p>: active</p>
<p>TenantId</p>
<p>: &lt; MemberTenantIdB&gt;</p>
<p>:</p>
<p>TransitionDetails</p>
<p>Microsoft. Graph. Beta. PowerShell. Models. MicrosoftGraphMultiTenantOrg</p>
<p>anizationMemberTransitionDetails</p>
<p>AdditionalProperties : {[multiTenantOrgLabelType, none]}</p>
<p>AddedByTenantId</p>
<p>: &lt; OwnerTenantId&gt;</p>
<p>AddedDateTime</p>
<p>: 1/8/2024 7:47:45 PM</p>
<p>DeletedDateTime</p>
<p>:</p>
<p>DisplayName</p>
<p>: Cairo</p>
<p>Id</p>
<p>: &lt; Id&gt;</p>
<p>JoinedDateTime</p>
<p>:</p>
<p>Role</p>
<p>: owner</p>
<p>State</p>
<p>: active</p>
<p>TenantId</p>
<p>: &lt; OwnerTenantId&gt;</p>
<p>TransitionDetails</p>
<p>:</p>
<p>Microsoft. Graph. Beta. PowerShell.Models.MicrosoftGraphMultiTenantOrg</p>
<p>anizationMemberTransitionDetails</p>
<p>AdditionalProperties : {[multiTenantOrgLabelType, none]}</p>
<ol>
<li>To allow for asynchronous processing, wait up to 2 hours before joining a multitenant organization is completed.</li>
</ol>
<h1 id="step-8-optional-leave-the-multitenant-organization">Step 8: (Optional) Leave the multitenant organization</h1>
<p>Figure contains a downward-pointing triangle icon, symbolizing the option to leave or exit an organization. This figurative representation likely emphasizes the action of leaving or exiting as one moves away from the apex of involvement, symbolized by the broad end of the triangle.</p>
<pre><code class="lang-mermaid">graph TD;
    A[&quot;Member Tenant (current state)&quot;] --&gt; B[&quot;Exited State&quot;]
</code></pre><p>Member tenant</p>
<p>You can leave a multitenant organization that you have joined. The process for removing your own tenant from the multitenant organization is the same as the process for removing another tenant from the multitenant organization.</p>
<p>If your tenant is the only multitenant organization owner, you must designate a new tenant to be the multitenant organization owner. For steps, see Step 4: (Optional) Change the role of a tenant.</p>
<p>PowerShell</p>
<p>. In the tenant, use the Remove- MgBetaTenantRelationshipMultiTenantOrganizationTenant command to remove the tenant. This operation takes a few minutes.</p>
<p>PowerShell</p>
<p>Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant - MultiTenantOrganizationMemberId <membertenantid><p>
<p>Step 9: (Optional) Delete the multitenant organization</p>
<h1 id="owner-tenant">Owner tenant</h1>
<p>You delete a multitenant organization by removing all tenants. The process for removing the final owner tenant is the same as the process for removing all other member tenants.</p>
<p>PowerShell</p>
<ul>
<li>In the final owner tenant, use the Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant command to remove the tenant. This operation takes a few minutes.</li>
</ul>
<p>PowerShell</p>
<p>Remove-MgBetaTenantRelationshipMultiTenantOrganizationTenant -MultiTenantOrganizationMemberId $OwnerTenantId</p>
<h2 id="next-steps-9">Next steps</h2>
<ul>
<li>Set up a multitenant org in Microsoft 365</li>
<li>Synchronize users in multitenant organizations in Microsoft 365</li>
<li>The new Microsoft Teams desktop client</li>
<li>Configure multitenant organization templates using the Microsoft Graph API</li>
</ul>
<h1 id="configure-multitenant-organization-policy-templates-using-the-microsoft-graph-api">Configure multitenant organization policy templates using the Microsoft Graph API</h1>
<p>Article · 04/24/2024</p>
<p>This article describes how to configure a policy template for your multitenant organization.</p>
<h1 id="prerequisites-1">Prerequisites</h1>
<p>· For license information, see License requirements.</p>
<p>· Security Administrator role to configure cross-tenant access settings and templates for the multitenant organization.</p>
<p>· Global Administrator role to consent to required permissions.</p>
<h1 id="cross-tenant-access-policy-partner-template">Cross-tenant access policy partner template</h1>
<p>The cross-tenant access partner configuration handles trust settings and automatic user consent settings between partner tenants. For example, you can use these settings to trust multifactor authentication claims for inbound users from the target partner tenant. With the template in an unconfigured state, partner configurations for partner tenants in the multitenant organization won&#39;t be amended, with all trust settings passed through from default settings. However, if you configure the template, then partner configurations will be amended corresponding to the policy template.</p>
<h1 id="configure-inbound-and-outbound-automatic-redemption">Configure inbound and outbound automatic redemption</h1>
<p>To specify which trust settings and automatic user consent settings to apply to your policy template, use the Update multiTenantOrganizationPartnerConfigurationTemplate API. If you create or join a multitenant organization using the Microsoft 365 admin center, this configuration is handled automatically.</p>
<p>Request</p>
<p>HTTP</p>
<p>PATCH</p>
<p><a href="https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/">https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/</a> multiTenantOrganizationPartnerConfiguration</p>
<p>{
&quot;inboundTrust&quot;: {
&quot;isMfaAccepted&quot;: true,
&quot;isCompliantDeviceAccepted&quot;: true,
&quot;isHybridAzureADJoinedDeviceAccepted&quot;: true
},
&quot;automaticUserConsentSettings&quot;: {
&quot;inboundAllowed&quot;: true,
&quot;outboundAllowed&quot;: true
},
&quot;templateApplicationLevel&quot;: &quot;newPartners,existingPartners&quot;
}</p>
<h1 id="disable-the-template-for-existing-partners">Disable the template for existing partners</h1>
<p>To apply this template only to new multitenant organization members and exclude existing partners, set the <code>templateApplicationLevel</code> parameter to new partners only.</p>
<p>Request</p>
<h3 id="figure-description-2">Figure Description</h3>
<p>HTTP PATCH request to modify cross tenant access policy templates, specifically targeting the configuration for multi-tenant organization partner. The inbound trust accepts multifactor authentication, compliant devices, and hybrid Azure AD joined devices. Both inbound and outbound automatic user consent is allowed. The application level is set specifically for new partners.</p>
<pre><code class="lang-mermaid">graph TD;
    API[HTTP PATCH Request] --&gt;|URL| URL[https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration]
    API --&gt;|Body| Body1[Inbound Trust: MFA, Compliant Device, Hybrid Azure AD joined Device]
    Body1 --&gt; Body2[Automatic User Consent Settings: Inbound Allowed, Outbound Allowed]
    Body2 --&gt; Body3[Template Application Level: newPartners]
</code></pre><h1 id="disable-the-template-completely">Disable the template completely</h1>
<p>To disable the template completely, set the <code>templateApplicationLevel</code> parameter to null.</p>
<p>Request</p>
<p>PATCH</p>
<p><a href="https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration">https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration</a></p>
<p>{
&quot;inboundTrust&quot;: {
&quot;isMfaAccepted&quot;: true,
&quot;isCompliantDeviceAccepted&quot;: true,
&quot;isHybridAzureADJoinedDeviceAccepted&quot;: true
},
&quot;automaticUserConsentSettings&quot;: {
&quot;inboundAllowed&quot;: true,
&quot;outboundAllowed&quot;: true
},
&quot;templateApplicationLevel&quot;: &quot;&quot;
}</p>
<h1 id="reset-the-template">Reset the template</h1>
<p>To reset the template to its default state (decline all trust and automatic user consent), use the multiTenantOrganizationPartnerConfigurationTemplate: resetToDefaultSettings API.</p>
<p>HTTP</p>
<p>POST</p>
<p><a href="https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration/resetToDefaultSettings">https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationPartnerConfiguration/resetToDefaultSettings</a></p>
<h1 id="cross-tenant-synchronization-template">Cross-tenant synchronization template</h1>
<p>The identity synchronization policy governs cross-tenant synchronization, which allows you to share users and groups across tenants in your organization. You can use these settings to allow inbound user synchronization. With the template in an unconfigured state, the identity synchronization policy for partner tenants in the multitenant organization won&#39;t be amended. However, if you configure the template, then the identity synchronization policy will be amended corresponding to the policy template.</p>
<h1 id="configure-inbound-user-synchronization">Configure inbound user synchronization</h1>
<p>To allow inbound user synchronization in the policy template, use the Update multiTenantOrganizationIdentitySyncPolicyTemplate API. If you create or join a</p>
<p>multitenant organization using the Microsoft 365 admin center, this configuration is handled automatically.</p>
<p>Request</p>
<pre><code>HTTP PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization 
{
  &quot;userSyncInbound&quot;: {
    &quot;isSyncAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: &quot;newPartners,existingPartners&quot;
}
</code></pre><p>Disable the template for existing partners</p>
<p>To apply this template only to new multitenant organization members and exclude existing partners, set the templateApplicationLevel parameter to new partners only.</p>
<p>Request</p>
<pre><code>HTTP PATCH https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization 
{
  &quot;userSyncInbound&quot;: {
    &quot;isSyncAllowed&quot;: true
  },
  &quot;templateApplicationLevel&quot;: &quot;newPartners&quot;
}
</code></pre><p>Disable the template completely</p>
<p>To disable the template completely, set the templateApplicationLevel parameter to null.</p>
<p>Request</p>
<pre><code>HTTP
</code></pre><p>PATCH<br><a href="https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization">https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization</a>  </p>
<p>{ &quot;userSyncInbound&quot;: { &quot;isSyncAllowed&quot;: true }, &quot;templateApplicationLevel&quot;: &quot;&quot; }  </p>
<p>Reset the template  </p>
<p>To reset the template to its default state (decline inbound synchronization), use the multiTenantOrganizationIdentitySyncPolicyTemplate: resetToDefaultSettings API.  </p>
<p>Request  </p>
<p>HTTP  </p>
<p>POST<br><a href="https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization/resetToDefaultSettings">https://graph.microsoft.com/beta/policies/crossTenantAccessPolicy/templates/multiTenantOrganizationIdentitySynchronization/resetToDefaultSettings</a>  </p>
<p>Next steps  </p>
<p>· Configure cross-tenant synchronization</p>
<h1 id="configure-cross-tenant-synchronization">Configure cross-tenant synchronization</h1>
<p>Article · 03/11/2024</p>
<p>This article describes the steps to configure cross-tenant synchronization using the Microsoft Entra admin center. When configured, Microsoft Entra ID automatically provisions and de-provisions B2B users in your target tenant. For important details on what this service does, how it works, and frequently asked questions, see Automate user provisioning and deprovisioning to SaaS applications with Microsoft Entra ID.</p>
<p>Figure 0: Diagram showing the flow between Source Tenant and Target Tenant with details on internal and external users and their respective settings. The Source Tenant (left) includes &#39;UserS1&#39;, &#39;UserS2&#39;, &#39;UserS3&#39; within the &#39;Internal&#39; category and their &#39;Outbound access settings&#39; are configured to &#39;Automatically redeem invitations&#39;. The &#39;Cross-tenant synchronization&#39; arrow points towards the Target Tenant, which contains &#39;UserT1&#39;, &#39;UserT2&#39;, &#39;UserT3&#39;, and &#39;GroupT1&#39; within the &#39;Internal&#39; section, and external users &#39;UserS1&#39; and &#39;UserS3&#39;. The &#39;Inbound access settings&#39; of the Target Tenant allow synchronization into this tenant and &#39;Automatically redeem invitations&#39; is active. Configuration settings are highlighted, including &#39;Scope&#39; and &#39;Scoping filters&#39; for department EQUALS Marketing with &#39;Attribute mappings&#39; for &#39;accountEnabled&#39;, &#39;employeeld&#39;, &#39;userPrincipalName + extensionName&#39; as &#39;companyName&#39;.</p>
<pre><code class="lang-mermaid">graph LR;
    UserS1_Internal(Source Tenant: UserS1 Internal) --&gt;|Cross-tenant synchronization| UserS1_Internal_Target(Target Tenant: UserS1 Internal)
    UserS2_Internal(Source Tenant: UserS2 Internal) --&gt;|Cross-tenant synchronization| UserS2_Internal_Target(Target Tenant: UserS2 Internal)
    UserS3_Internal(Source Tenant: UserS3 Internal) --&gt;|Cross-tenant synchronization| UserS3_Internal_Target(Target Tenant: UserS3 Internal)
    UserS1_Internal -.-&gt;|Automatically redeem invitations| UserS1_External_Target(Target Tenant: UserS1 External)
    UserS3_Internal -.-&gt;|Automatically redeem invitations| UserS3_External_Target(Target Tenant: UserS3 External)
</code></pre><h1 id="learning-objectives">Learning objectives</h1>
<p>By the end of this article, you&#39;ll be able to:</p>
<ul>
<li>Create B2B users in your target tenant</li>
<li>Remove B2B users in your target tenant</li>
<li>Keep user attributes synchronized between your source and target tenants</li>
</ul>
<p>Prerequisites</p>
<p>Figure 1: Placeholder representing prerequisites for implementing cross-tenant synchronization, likely indicating necessary configurations or initial settings within the Source Tenant.</p>
<p>· Microsoft Entra ID P1 or P2 license. For more information, see License requirements.</p>
<p>· Security Administrator role to configure cross-tenant access settings.</p>
<p>· Hybrid Identity Administrator role to configure cross-tenant synchronization.</p>
<p>· Cloud Application Administrator or Application Administrator role to assign users to a configuration and to delete a configuration.</p>
<p>Target tenant</p>
<p>· Microsoft Entra ID P1 or P2 license. For more information, see License requirements.</p>
<p>· Security Administrator role to configure cross-tenant access settings.</p>
<h2 id="step-1-plan-your-provisioning-deployment">Step 1: Plan your provisioning deployment</h2>
<ol>
<li><p>Define how you would like to structure the tenants in your organization.</p>
</li>
<li><p>Learn about how the provisioning service works.</p>
</li>
<li><p>Determine who will be in scope for provisioning.</p>
</li>
<li><p>Determine what data to map between tenants.</p>
</li>
</ol>
<h2 id="step-2-enable-user-synchronization-in-the-target-tenant">Step 2: Enable user synchronization in the target tenant</h2>
<p>Tip</p>
<p>Steps in this article might vary slightly based on the portal you start from.</p>
<h3 id="target-tenant">Target tenant</h3>
<ol>
<li><p>Sign in to the Microsoft Entra admin center of the target tenant.</p>
</li>
<li><p>Browse to Identity &gt; External Identities &gt; Cross-tenant access settings.</p>
</li>
<li><p>On the Organization settings tab, select Add organization.</p>
</li>
<li><p>Add the source tenant by typing the tenant ID or domain name and selecting Add.</p>
</li>
</ol>
<p>X</p>
<p>Home &gt; Inbound access settings - Contoso &gt; External Identities</p>
<p>Figure: The screenshot shows the settings interface for &quot;External Identities | Cross-tenant access settings&quot; under Microsoft Entra for the Contoso organization. It includes various options like &quot;Add organization&quot;, &quot;Refresh&quot;, and &quot;Columns&quot;. Below these, there are sections labeled &quot;Organizational settings&quot;, &quot;Default settings&quot;, and &quot;Microsoft cloud settings&quot;. The interface allows adding an external Microsoft Entra tenant by typing one of its domain names or tenant ID. There is also an informational message discussing the usage of cross-tenant access settings to manage collaboration with external Microsoft cloud tenants. The document interface seems to be set to add or manage settings.</p>
<pre><code class="lang-mermaid">graph TD;
    Settings[&quot;External Identities | Cross-tenant access settings&quot;]
    AddOrganization[&quot;Add organization&quot;]
    Refresh[&quot;Refresh&quot;]
    Columns[&quot;Columns&quot;]

    Settings --&gt; AddOrganization
    Settings --&gt; Refresh
    Settings --&gt; Columns
</code></pre><ol>
<li><p>Under Inbound access of the added organization, select Inherited from default.</p>
</li>
<li><p>Select the Cross-tenant sync tab.</p>
</li>
<li><p>Check the Allow users sync into this tenant check box.</p>
</li>
</ol>
<p>Figure: The image depicts the interface for &quot;Inbound access settings - Fabrikam&quot; with tabs for B2B collaboration, B2B direct connect, Trust settings, and Cross-tenant sync. In the Cross-tenant sync tab, it describes the function enabling the admin of one tenant to sync objects into another tenant. Options to allow this feature are displayed with a checkbox labeled &quot;Allow users sync into this tenant&quot;. The snapshot captures buttons for &quot;Save&quot; and &quot;Discard&quot;.</p>
<pre><code class="lang-mermaid">graph TD;
    B2BCollab[&quot;B2B collaboration&quot;]
    B2BDirectConnect[&quot;B2B direct connect&quot;]
    TrustSettings[&quot;Trust settings&quot;]
    CrossTenantSync[&quot;Cross-tenant sync - Allow users sync into this tenant&quot;]

    B2BCollab --&gt; CrossTenantSync
    B2BDirectConnect --&gt; CrossTenantSync
    TrustSettings --&gt; CrossTenantSync
</code></pre><ol>
<li><p>Select Save.</p>
</li>
<li><p>If you see an Enable cross-tenant sync and auto-redemption dialog box asking if you want to enable auto-redemption, select Yes.</p>
</li>
</ol>
<p>Selecting Yes will automatically redeem invitations in the target tenant.</p>
<p>✅
X</p>
<h1 id="inbound-access-settings---fabrikam-">Inbound access settings - Fabrikam ..</h1>
<p>Figure: The image depicts a mock-up of a user interface for &quot;Inbound access settings&quot; in a software application. The primary focus is on tabs labeled &quot;B2B collaboration&quot;, &quot;B2B direct connect&quot;, &quot;Trust settings&quot;, and &quot;Cross-tenant sync&quot;. A dialog box titled &quot;Enable cross-tenant sync and auto-redemption?&quot; is prominently displayed, offering a &quot;Yes&quot; and &quot;No&quot; option. Additional text within the dialog explains the implications of enabling or disabling cross-tenant synchronization and auto-redemption.</p>
<pre><code class="lang-mermaid">graph TD;
    Settings[&quot;Inbound Access Settings Page&quot;] --&gt; B2BCollaboration[&quot;Tab: B2B Collaboration&quot;];
    Settings --&gt; B2BDirectConnect[&quot;Tab: B2B Direct Connect&quot;];
    Settings --&gt; TrustSettings[&quot;Tab: Trust Settings&quot;];
    Settings --&gt; CrossTenantSync[&quot;Tab: Cross-tenant Sync&quot;];
    CrossTenantSync --&gt; EnableSyncDialog[&quot;Dialog: Enable Cross-tenant Sync and Auto-redemption&quot;];
    EnableSyncDialog --&gt; YesOption[&quot;Option: Yes&quot;];
    EnableSyncDialog --&gt; NoOption[&quot;Option: No&quot;];
</code></pre><h2 id="step-3-automatically-redeem-invitations-in-the-target-tenant">Step 3: Automatically redeem invitations in the target tenant</h2>
<p>Figure: A generic placeholder icon for a document or operations step is shown, suggesting this part of the document deals with a procedural step regarding &quot;Automatically redeem invitations in the target tenant&quot;.</p>
<pre><code class="lang-mermaid">graph TD;
    Step[&quot;Procedural Step: Automatically Redeem Invitations&quot;];
</code></pre><h3 id="target-tenant-1">Target tenant</h3>
<p>In this step, you automatically redeem invitations so users from the source tenant don&#39;t have to accept the consent prompt. This setting must be checked in both the source tenant (outbound) and target tenant (inbound). For more information, see Automatic redemption setting.</p>
<ol>
<li><p>In the target tenant, on the same Inbound access settings page, select the Trust settings tab.</p>
</li>
<li><p>Check the Automatically redeem invitations with the tenant <tenant> check box.<p>
</tenant></li>
</ol>
<p>This box might already be checked if you previously selected Yes in the Enable cross-tenant sync and auto-redemption dialog box.</p>
<p>Figure: The image displays a section of a user interface focusing on a setting labeled &quot;Automatic redemption&quot;. A checkbox next to the text indicates the option to &quot;Automatically redeem invitations with the tenant Fabrikam&quot;. Additional text below the checkbox explains that selecting this option will suppress the consent prompt for first-time access through cross-tenant synchronization, B2B collaborations, or B2B direct connect, requiring that the setting is also enabled for outbound access.</p>
<pre><code class="lang-mermaid">graph TD;
    SettingSection[&quot;Automatic Redemption Setting Section&quot;] --&gt; Checkbox[&quot;Checkbox: Automatically Redeem Invitations with Tenant Fabrikam&quot;];
    SettingSection --&gt; ExplanationText[&quot;Explanation: Helps suppress consent prompt on first-time access&quot;];
</code></pre><ol>
<li>Select Save.
❌ ❌ ❌</li>
</ol>
<h1 id="step-4-automatically-redeem-invitations-in-the-source-tenant">Step 4: Automatically redeem invitations in the source tenant</h1>
<p>Source tenant</p>
<p>In this step, you automatically redeem invitations in the source tenant.</p>
<ol>
<li><p>Sign in to the Microsoft Entra admin center of the source tenant.</p>
</li>
<li><p>Browse to Identity &gt; External Identities &gt; Cross-tenant access settings.</p>
</li>
<li><p>On the Organization settings tab, select Add organization.</p>
</li>
<li><p>Add the target tenant by typing the tenant ID or domain name and selecting Add.</p>
</li>
</ol>
<p><strong>Figure Description</strong>: The screenshot depicts a browser window with Microsoft Entra admin center opened to the &quot;External Identities | Cross-tenant access settings&quot; page. The &quot;Add organization&quot; modal dialog is displayed, prompting the user to type a tenant ID or domain name. The screen also shows tabs for &quot;Organizational settings,&quot; &quot;Default settings,&quot; and various other options on the sidebar including &quot;Overview,&quot; &quot;All identity providers,&quot; and &quot;User flows.&quot;</p>
<ol>
<li><p>Under Outbound access for the target organization, select Inherited from default.</p>
</li>
<li><p>Select the Trust settings tab.</p>
</li>
<li><p>Check the Automatically redeem invitations with the tenant <tenant> check box.<p>
</tenant></li>
</ol>
<p>Home &gt; Fabrikam &gt; External Identities | Cross-tenant access settings &gt;</p>
<h1 id="outbound-access-settings---contoso">Outbound access settings - Contoso</h1>
<p> ✅
X</p>
<p>B2B collaboration ❌ B2B direct connect Trust settings</p>
<p>Automatic redemption</p>
<p>Check this setting if you want to automatically redeem invitations. If so, users from this tenant don&#39;t have to accept the consent prompt the first time they access the specified tenant using cross-tenant synchronization, B2B collaboration, or B2B direct connect. This setting will only suppress the consent prompt if the specified tenant checks this setting for inbound access as well. Learn more
 ✅ ✅
V Automatically redeem invitations with the tenant Contoso.</p>
<p>Save</p>
<p>Discard</p>
<ol>
<li>Select Save.</li>
</ol>
<p>Step 5: Create a configuration in the source tenant</p>
<blockquote><p><strong>Figure Description</strong>: The image is a screenshot depicting the user interface for creating a new configuration in the source tenant on a web-based platform. It displays options like &quot;Identity &gt; External Identities &gt; Cross-tenant synchronization&quot;, with a navigation path shown at the top. There are buttons such as &quot;Configurations&quot;, and &quot;New configuration&quot;, with steps listed for creating a configuration.</p>
</blockquote>
<p>Source tenant</p>
<ol>
<li><p>In the source tenant, browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</p>
</li>
<li><p>Select Configurations.</p>
</li>
<li><p>At the top of the page, select New configuration.</p>
</li>
<li><p>Provide a name for the configuration and select Create.</p>
</li>
</ol>
<p>It can take up to 15 seconds for the configuration that you just created to appear in the list.</p>
<p>Step 6: Test the connection to the target tenant</p>
<blockquote><p><strong>Figure Description</strong>: This image illustrates the user interface for testing a configuration between the source and target tenant. The user interface shows that a new configuration appears in a list, highlighting the ability to select and test connectivity between the source and the target tenant.</p>
</blockquote>
<p>Source tenant</p>
<ol>
<li>In the source tenant, you should see your new configuration. If not, in the configuration list, select your configuration.</li>
</ol>
<blockquote><p>Outbound access settings - Contoso &gt; Cross-tenant synchronization | Configurations &gt;</p>
<p>Fabrikam to Contoso Fabrikam - Microsoft Entra ID</p>
<p>Overview
 ✅
X</p>
<p>«</p>
<p>Got feedback?</p>
<p>Overview</p>
<p>Provision on demand</p>
<p>Manage
Users and groups
Provisioning
Expression builder
Activity
Audit logs
Provisioning logs
Insights</p>
<p>Troubleshooting + Support
New support request</p>
<p>Automate identity lifecycle management with Microsoft Entra</p>
<p>Automatically create, update, and delete accounts when users join, leave, and move within your organization. Learn more.</p>
<p>Get started</p>
<p>What is provisioning? Plan an application deployment.</p>
<p>Configure automatic provisioning.</p>
<ol>
<li><p>Select Get started.</p>
</li>
<li><p>Set the Provisioning Mode to Automatic.</p>
</li>
<li><p>Under the Admin Credentials section, change the Authentication Method to Cross Tenant Synchronization Policy.</p>
</li>
</ol>
</blockquote>
<p>The first image shows the Fabrikam to Contoso Overview page within a software interface, displaying sections like Overview, Manage (including Users and groups, Provisioning, and other options), Activity, and Troubleshooting + Support. It highlights features for automating identity lifecycle management by allowing administrators to automatically create, update, and delete user accounts as needed within an organization.</p>
<pre><code class="lang-mermaid">graph TD;
    Overview --&gt; Provision_On_Demand[&quot;Provision on demand&quot;];
    Overview --&gt; Manage;
    Manage --&gt; Users_and_groups[&quot;Users and groups&quot;];
    Manage --&gt; Provisioning;
    Manage --&gt; Expression_builder[&quot;Expression builder&quot;];
    Overview --&gt; Activity;
    Activity --&gt; Audit_logs[&quot;Audit logs&quot;];
    Activity --&gt; Provisioning_logs[&quot;Provisioning logs&quot;];
    Activity --&gt; Insights;
    Overview --&gt; Troubleshooting_Support[&quot;Troubleshooting + Support&quot;];
    Troubleshooting_Support --&gt; New_support_request[&quot;New support request&quot;];
    Overview --&gt; Automate_identity_management[&quot;Automate identity lifecycle management&quot;];
    Automate_identity_management --&gt; Automatic_creation[&quot;Automatically create, update, delete accounts&quot;];
</code></pre><p>The second image is a detailed view of the Provisioning settings in the Microsoft Entra platform, indicating how to set up automatic user account provisioning between Fabrikam and Contoso. The screenshot includes options to select provisioning mode, configure admin credentials, and set an authentication method specifically tailored for Cross Tenant Synchronization Policy.</p>
<pre><code class="lang-mermaid">graph TD;
    Provisioning_Page[&quot;Provisioning Page&quot;] --&gt; Provisioning_Mode_Select[&quot;Provisioning Mode: Automatic&quot;];
    Provisioning_Page --&gt; Admin_Credentials_Section[&quot;Admin Credentials Section&quot;];
    Admin_Credentials_Section --&gt; Authentication_Method_Selection[&quot;Authentication Method: Cross Tenant Synchronization Policy&quot;];
    Admin_Credentials_Section --&gt; Tenant_Id_Input[&quot;Tenant Id Input&quot;];
    Admin_Credentials_Section --&gt; Test_Connection_Button[&quot;Test Connection Button&quot;];
</code></pre><p>5. In the Tenant Id box, enter the tenant ID of the target tenant.</p>
<p>6. Select Test Connection to test the connection.</p>
<p>You should see a message that the supplied credentials are authorized to enable provisioning. If the test connection fails, see Troubleshooting tips later in this article.</p>
<p>Figure: A screenshot of a notifications panel. The upper section shows a link for &quot;More events in the activity log&quot; and a &quot;Dismiss all&quot; button. The main focus is on a confirmation message stating &quot;Testing connection to Fabrikam to Contoso&quot; with a green check mark, and beneath this text, &quot;The supplied credentials are authorized to enable provisioning&quot; followed by a timestamp of &quot;a few seconds ago&quot;.</p>
<pre><code class="lang-mermaid">graph LR;
    ConnectionTest(Fabrikam to Contoso Connection Test) --&gt;|Status| Authorized{Credentials Authorized}
</code></pre><p>7. Select Save.</p>
<p>Mappings and Settings sections appear.</p>
<p>8. Close the Provisioning page.</p>
<h1 id="step-7-define-who-is-in-scope-for-provisioning">Step 7: Define who is in scope for provisioning</h1>
<p>Source tenant</p>
<p>The Microsoft Entra provisioning service allows you to define who will be provisioned in one or both of the following ways:</p>
<p>· Based on assignment to the configuration</p>
<p>. Based on attributes of the user</p>
<p>Start small. Test with a small set of users before rolling out to everyone. When the scope for provisioning is set to assigned users and groups, you can control it by assigning one or two users to the configuration. You can further refine who is in scope for provisioning by creating attribute-based scoping filters, described in the next step.</p>
<p>1. In the source tenant, select Provisioning and expand the Settings section.</p>
<figure>
The image shows a screenshot of a digital interface for &quot;Fabrikam to Contoso&quot; provisioning settings within a software application. Key visible elements include:<br>- navigation tabs such as &#39;Overview&#39;, &#39;Provision on demand&#39;, &#39;Users and groups&#39;, &#39;Provisioning&#39;, etc.<br>- a selected option in settings &#39;Sync only assigned users and groups&#39; under the &#39;Scope&#39;.<br>- various toggles for &#39;Prevent accidental deletion&#39;, &#39;Provisioning Status&#39;, and checkboxes for &#39;Send an email notification when a failure occurs&#39;.<br>- buttons for &#39;Save&#39; and &#39;Discard&#39; at the top of the interface.
</figure>

<pre><code class="lang-mermaid">graph TD;
    Overview --&gt; ProvisionOnDemand[&quot;Provision on demand&quot;];
    ProvisionOnDemand --&gt; UsersAndGroups[&quot;Users and groups&quot;];
    UsersAndGroups --&gt; Provisioning;
    Provisioning --&gt; Settings;
    Settings --&gt; Scope[&quot;Scope&quot;];
    Scope --&gt; &quot;Sync only assigned users and groups&quot;;
    Scope --&gt; &quot;Prevent accidental deletion&quot;;
    Scope --&gt; &quot;Send an email notification when a failure occurs&quot;;
    Settings --&gt; &quot;Provisioning Status&quot;;
    Overview --&gt; &quot;Save/Discard&quot;;
</code></pre><ol>
<li>In the Scope list, select whether to synchronize all users in the source tenant or only users assigned to the configuration.</li>
</ol>
<p>It&#39;s recommended that you select Sync only assigned users and groups instead of Sync all users and groups. Reducing the number of users in scope improves performance.</p>
<ol>
<li><p>If you made any changes, select Save.</p>
</li>
<li><p>On the configuration page, select Users and groups.</p>
</li>
</ol>
<p>For cross-tenant synchronization to work, at least one internal user must be assigned to the configuration.</p>
<ol>
<li><p>Select Add user/group.</p>
</li>
<li><p>On the Add Assignment page, under Users and groups, select None Selected.</p>
</li>
<li><p>On the Users and groups pane, search for and select one or more internal users or groups you want to assign to the configuration.</p>
</li>
</ol>
<p>If you select a group to assign to the configuration, only users that are direct members in the group will be in scope for provisioning. You can select a static group or a dynamic group. The assignment doesn&#39;t cascade to nested groups.</p>
<ol>
<li>Select Select.</li>
</ol>
<p>9. Select Assign.</p>
<figure>
The figure displays a user interface with the title &quot;Fabrikam to Contoso | Users and groups&quot;, part of an outbound access settings configuration for cross-tenant synchronization. Visible menu items include Overview, Provision on demand, Manage (expanded with sub-menu items for Users and groups, Provisioning, Expression builder), Activity (containing Audit logs, Provisioning logs, Insights, Troubleshooting + Support with an option for New support request). The main panel shows a table titled &quot;Display Name, Object Type, Role assigned&quot; with entries for &quot;US User3, User, Default Access&quot;, &quot;US User1, User, Default Access&quot;, and &quot;GR Group1, Group, Default Access&quot;. Additionally, a message box reminds that the application will not be visible in My Apps unless the &#39;visible to users?&#39; setting is enabled in properties.
</figure>

<pre><code class="lang-mermaid">graph TD;
    Manage --&gt; UsersAndGroups[Users and groups];
    Manage --&gt; Provisioning;
    Manage --&gt; ExpressionBuilder[Expression builder];
</code></pre><table>
<thead>
<tr>
<th>Display Name</th>
<th>Object Type</th>
<th>Role assigned</th>
</tr>
</thead>
<tbody>
<tr>
<td>US User3</td>
<td>User</td>
<td>Default Access</td>
</tr>
<tr>
<td>US User1</td>
<td>User</td>
<td>Default Access</td>
</tr>
<tr>
<td>GR Group1</td>
<td>Group</td>
<td>Default Access</td>
</tr>
</tbody>
</table>
<p>For more information, see Assign users and groups to an application.</p>
<p>Step 8: (Optional) Define who is in scope for provisioning with scoping filters</p>
<h2 id="source-tenant">Source tenant</h2>
<p>Regardless of the value you selected for Scope in the previous step, you can further limit which users are synchronized by creating attribute-based scoping filters.</p>
<p>1. In the source tenant, select Provisioning and expand the Mappings section.</p>
<h1 id="home--cross-tenant-synchronization--configurations--fabrikam-to-contoso">Home &gt; Cross-tenant synchronization | Configurations &gt; Fabrikam to Contoso</h1>
<h1 id="fabrikam-to-contoso--provisioning">Fabrikam to Contoso | Provisioning</h1>
<p> ✅
X</p>
<p>Fabrikam - Microsoft Entra ID</p>
<p>«</p>
<p>Save ✅ Discard</p>
<p>1 Overview</p>
<p>V Admin Credentials</p>
<p>Provision on demand</p>
<p>Manage</p>
<p>1 Mappings</p>
<p>Users and groups</p>
<p>Provisioning</p>
<p>Mappings Mappings allow you to define how data should flow between Microsoft Entra ID and Azure Active Directory (target tenant).</p>
<p>Expression builder</p>
<p>Activity - Audit logs</p>
<p>Provisioning logs ❌ Restore default mappings</p>
<p>Insights</p>
<p>Troubleshooting + Support v Settings</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Enabled</th>
</tr>
</thead>
<tbody>
<tr>
<td>Provision Microsoft Entra ID Users</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>New support request</p>
<p>Provisioning Status
 ✅
+</p>
<p>On</p>
<p>Off</p>
<ol>
<li><p>Select Provision Microsoft Entra ID Users to open the Attribute Mapping page.</p>
</li>
<li><p>Under Source Object Scope, select All records.</p>
</li>
</ol>
<figure>
The image depicts a user interface for cross-tenant synchronization under the configuration from Fabrikam to Contoso, focusing on the section titled &quot;Attribute Mapping&quot;. It features UI elements such as input checkboxes and dropdown lists. The attributes displayed allow the user to configure settings where the source object is defined as &quot;User&quot; and the scope is set for &quot;All records&quot;. Actions like &quot;Create&quot;, &quot;Update&quot;, and &quot;Delete&quot; can be toggled for the target object actions, and the setting &quot;Provision Microsoft Entra ID Users&quot; is enabled.
</figure>

<pre><code class="lang-mermaid">graph TD;
    SourceObjectUser[&quot;Source Object: User&quot;] --&gt; SourceObjectScopeAllRecords[&quot;Source Object Scope: All Records&quot;];
    SourceObjectScopeAllRecords --&gt; TargetObjectActionsCreate[&quot;Target Object Actions: Create&quot;];
    SourceObjectScopeAllRecords --&gt; TargetObjectActionsUpdate[&quot;Target Object Actions: Update&quot;];
    SourceObjectScopeAllRecords --&gt; TargetObjectActionsDelete[&quot;Target Object Actions: Delete&quot;];
    ProvisionMicrosoftEntraIDUsersEnabled[&quot;Provision Microsoft Entra ID Users: Enabled&quot;] -.-&gt; TargetObjectActionsCreate;
    ProvisionMicrosoftEntraIDUsersEnabled -.-&gt; TargetObjectActionsUpdate;
    ProvisionMicrosoftEntraIDUsersEnabled -.-&gt; TargetObjectActionsDelete;
</code></pre><ol>
<li><p>On the Source Object Scope page, select Add scoping filter.</p>
</li>
<li><p>Add any scoping filters to define which users are in scope for provisioning.</p>
</li>
</ol>
<p>To configure scoping filters, refer to the instructions provided in Scoping users or groups to be provisioned with scoping filters.</p>
<table>
<thead>
<tr>
<th>Target Attribute</th>
<th>Operator</th>
<th></th>
<th>Value</th>
<th>Add/Remove</th>
</tr>
</thead>
<tbody>
<tr>
<td>No scoping filters found</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>department</td>
<td>EQUALS</td>
<td></td>
<td>Marketing</td>
<td>Add New Scoping Clause</td>
</tr>
</tbody>
</table>
<p>6. Select Ok and Save to save any changes.</p>
<p>If you added a filter, you&#39;ll see a message that saving your changes will result in all assigned users and groups being resynchronized. This may take a long time depending on the size of your directory.</p>
<p>7. Select Yes and close the Attribute Mapping page.</p>
<p>Step 9: Review attribute mappings</p>
<p>Source tenant</p>
<p>Attribute mappings allow you to define how data should flow between the source tenant and target tenant. For information on how to customize the default attribute mappings, see Tutorial - Customize user provisioning attribute-mappings for SaaS applications in Microsoft Entra ID.</p>
<p>1. In the source tenant, select Provisioning and expand the Mappings section.</p>
<p>2. Select Provision Microsoft Entra ID Users.</p>
<p>3. On the Attribute Mapping page, scroll down to review the user attributes that are synchronized between tenants in the Attribute Mappings section.</p>
<p>The first attribute, alternativeSecurityIdentifier, is an internal attribute used to uniquely identify the user across tenants, match users in the source tenant with existing users in the target tenant, and ensure that each user only has one account. The matching attribute cannot be changed. Attempting to change the matching attribute or adding additional matching attributes will result in a schemaInvalid error.</p>
<p>Figure: The image shows a screenshot of a user interface for &quot;Attribute Mapping&quot; in a cross-tenant synchronization tool. The UI is part of a provisioning process between &quot;Fabrikam&quot; and &quot;Contoso&quot;. The displayed section includes a list of attribute mappings with options to save or discard changes. It defines how attributes like alternativeSecurityIdentifier and accountEnabled are synchronized between Azure Active Directory of one tenant (source) and another (target). Each row contains the names of the attributes in both source and target directory, a precedence for matching, and a &#39;delete&#39; button to remove the attribute mapping.</p>
<pre><code class="lang-mermaid">graph TD;
    A[Attribute Mapping UI] --&gt; B[Fabrikam to Contoso]
    B --&gt; C[Provisioning]
    C --&gt; D[Save Options]
    C --&gt; E[Discard Changes]
    A --&gt; F[Attribute List]
    F --&gt; G[AlternativesecurityIdentifier]
    F --&gt; H[AccountEnabled]
    F --&gt; I[Delete Button]
</code></pre><table>
<thead>
<tr>
<th>Azure Active Directory Attribute</th>
<th>Azure Active Directory (target tenant) Attribute</th>
<th>Matching precedence</th>
<th>Remove</th>
</tr>
</thead>
<tbody>
<tr>
<td>AltSecldFromNetid([netid])</td>
<td>alternativeSecurityIds</td>
<td>1</td>
<td>Delete</td>
</tr>
<tr>
<td>IsSoftDeleted</td>
<td>IsSoftDeleted</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>accountEnabled</td>
<td>accountEnabled</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>streetAddress</td>
<td>streetAddress</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>city</td>
<td>city</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>state</td>
<td>state</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>postalCode</td>
<td>postalCode</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>country</td>
<td>country</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>department</td>
<td>department</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>employeeId</td>
<td>employeeId</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>displayName</td>
<td>displayName</td>
<td></td>
<td>Delete</td>
</tr>
<tr>
<td>givenName</td>
<td>givenName</td>
<td></td>
<td>Delete</td>
</tr>
</tbody>
</table>
<ol>
<li><p>Select the Member (userType) attribute to open the Edit Attribute page.</p>
</li>
<li><p>Review the Constant Value setting for the userType attribute.</p>
</li>
</ol>
<p>This setting defines the type of user that will be created in the target tenant and can be one of the values in the following table. By default, users will be created as external member (B2B collaboration users). For more information, see Properties of a Microsoft Entra B2B collaboration user.</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Constant Value</td>
<td>Description</td>
</tr>
<tr>
<td>Member</td>
<td>Default. Users will be created as external member (B2B collaboration users) in the target tenant. Users will be able to function as any internal member of the target tenant.</td>
</tr>
<tr>
<td>Guest</td>
<td>Users will be created as external guests (B2B collaboration users) in the target tenant.</td>
</tr>
</tbody>
</table>
<p>1 Note</p>
<p>If the B2B user already exists in the target tenant then Member (userType) will not changed to Member, unless the Apply this mapping setting is set to Always.</p>
<p>The user type you choose has the following limitations for apps or services (but aren&#39;t limited to):</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>App or service</td>
<td>Limitations</td>
</tr>
<tr>
<td>Power BI</td>
<td>- Support for UserType Member in Power BI is currently in preview. For more information, see Distribute Power BI content to external guest users with Microsoft Entra B2B.</td>
</tr>
<tr>
<td>Azure Virtual Desktop</td>
<td>- External member and external guest aren&#39;t supported in Azure Virtual Desktop.</td>
</tr>
</tbody>
</table>
<p>... &gt; Cross-tenant synchronization | Configurations &gt; Fabrikam to Contoso | Provisioning &gt;</p>
<h1 id="edit-attribute">Edit Attribute</h1>
<p>A mapping lets you define how the attributes in one class of Microsoft Entra object (e.g. Users) should flow to and from this application.</p>
<p>Mapping type 
: Constant</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Constant Value *</td>
<td>Member</td>
</tr>
<tr>
<td>Target attribute *</td>
<td>userType</td>
</tr>
</tbody>
</table>
<p>Matching precedence 0</p>
<p>Apply this mapping 
Only during object creation</p>
<ol>
<li><p>If you want to define any transformations, on the Attribute Mapping page, select the attribute you want to transform, such as displayName.</p>
</li>
<li><p>Set the Mapping type to Expression.</p>
</li>
<li><p>In the Expression box, enter the transformation expression. For example with the display name, you can do the following:</p>
</li>
</ol>
<p>· Flip the first name and last name and add a comma in between.</p>
<p>. Add the domain name in parentheses at the end of the display name.</p>
<p>For examples, see Reference for writing expressions for attribute mappings in Microsoft Entra ID.</p>
<p>Figure: The image shows a software interface for editing an attribute in a configuration setting for cross-tenant synchronization. The interface includes options for setting the mapping type to &quot;Expression&quot; and entering an expression for an attribute named &quot;displayName&quot;. The filled out expression field shows &quot;[displayName]&quot; and indicates that the expression was correctly parsed. Below are options for default value if null, using the expression builder, and selecting the target attribute.</p>
<p>Tip</p>
<p>You can map directory extensions by updating the schema of the cross-tenant synchronization. For more information, see Map directory extensions in cross-tenant synchronization.</p>
<p>Step 10: Specify additional provisioning settings</p>
<p>Source tenant</p>
<p>1. In the source tenant, select Provisioning and expand the Settings section.</p>
<p>Figure: The interface for provisioning settings in a software application, specifically showing a section labeled &quot;Fabrikam to Contoso | Provisioning&quot;. It includes various configurable options such as &quot;Admin Credentials&quot;, &quot;Provision on demand&quot;, &quot;Mappings&quot;, &quot;Users and groups&quot;, &quot;Audit logs&quot;, &quot;Provisioning logs&quot;, and toggles for &quot;Send an email notification when a failure occurs&quot;, &quot;Prevent accidental deletion&quot; with a threshold setting at 500, and &quot;Sync only assigned users and groups&quot;. The lower part of the interface displays a toggle for &quot;Provisioning Status&quot; set to Off.</p>
<pre><code class="lang-mermaid">graph TD;
    FabrikamToContoso(&quot;Fabrikam to Contoso | Provisioning&quot;) --&gt; Settings;
    Settings --&gt; AdminCred[Admin Credentials]
    Settings --&gt; ProvisionOnDemand(&quot;Provision on demand&quot;)
    Settings --&gt; Mappings
    Settings --&gt; UsersAndGroups(&quot;Users and groups&quot;)
    Settings --&gt; Provisioning
    Settings --&gt; ExpressionBuilder(&quot;Expression builder&quot;)
    Settings --&gt; Activity;
    Activity --&gt; AuditLogs(&quot;Audit logs&quot;)
    Activity --&gt; ProvisioningLogs(&quot;Provisioning logs&quot;)
    Activity --&gt; Insights
    Settings --&gt; Troubleshooting;
    Troubleshooting --&gt; NewSupportRequest(&quot;New support request&quot;)
    Settings --&gt; EmailNotification(&quot;Send an email notification when a failure occurs&quot;)
    Settings --&gt; PreventDeletion(&quot;Prevent accidental deletion&quot;)
    PreventDeletion --&gt; Threshold(&quot;Threshold: 500&quot;)
    Settings --&gt; SyncSettings(&quot;Sync only assigned users and groups&quot;)
    Settings --&gt; ProvisioningStatus;
    ProvisioningStatus --&gt; On
    ProvisioningStatus --&gt; Off
</code></pre><p>2. Check the Send an email notification when a failure occurs check box.</p>
<p>3. In the Notification Email box, enter the email address of a person or group who should receive provisioning error notifications.</p>
<p>Email notifications are sent within 24 hours of the job entering quarantine state. For custom alerts, see Understand how provisioning integrates with Azure Monitor logs.</p>
<p>4. To prevent accidental deletion, select Prevent accidental deletion and specify a threshold value. By default, the threshold is set to 500.</p>
<p>For more information, see Enable accidental deletions prevention in the Microsoft Entra provisioning service.</p>
<p>5. Select Save to save any changes.</p>
<p>Step 11: Test provision on demand</p>
<p>Source tenant</p>
<p>Now that you have a configuration, you can test on-demand provisioning with one of your users.</p>
<ol>
<li><p>In the source tenant, browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</p>
</li>
<li><p>Select Configurations and then select your configuration.</p>
</li>
<li><p>Select Provision on demand.</p>
</li>
<li><p>In the Select a user or group box, search for and select one of your test users.</p>
</li>
</ol>
<p>Figure: The UI screen depicts a navigation path within a software application from &quot;Fabrikam to Contoso | Provisioning &gt; Cross-tenant synchronization | Configurations &gt; Fabrikam to Contoso | Provision on demand&quot;. It illustrates various options such as “Overview”, “Provision on demand”, &quot;Manage&quot;, &quot;Users and groups&quot;, &quot;Provisioning&quot;, &quot;Expression builder&quot;, &quot;Activity&quot;, &quot;Audit logs&quot;, &quot;Provisioning logs&quot;, &quot;Insights&quot;, &quot;Troubleshooting + Support&quot;, and “New support request”. The provision tab is focused with procedures to proceed with on-demand provisioning for &quot;User1&quot;. There is also a “Provision” button located at the bottom right of the pane.</p>
<pre><code class="lang-mermaid">graph TD;
    Overview --&gt; Provision_on_demand;
    Manage --&gt; &quot;Users and groups&quot;;
    Manage --&gt; Provisioning;
    Manage --&gt; Expression_builder;
    Activity --&gt; Audit_logs;
    Activity --&gt; Provisioning_logs;
    Troubleshooting_Support --&gt; New_support_request;
    Provision_on_demand --&gt; &quot;Selected user User1&quot;;
    &quot;Selected user User1&quot; --&gt; Provision_button[ Provision ];
</code></pre><ol>
<li>Select Provision.</li>
</ol>
<p>After a few moments, the Perform action page appears with information about the provisioning of the test user in the target tenant.</p>
<h1 id="perform-action">Perform action</h1>
<p>Modified attributes (successful) Data flow</p>
<p>User &#39;user1@fabrikam.com&#39; was created in Azure Active Directory (target tenant)</p>
<table>
<thead>
<tr>
<th>Target attribute name</th>
<th>Source attribute value</th>
<th>Expression</th>
<th>Original target attribute value</th>
<th>Modified target attribute value</th>
</tr>
</thead>
<tbody>
<tr>
<td>IsSoftDeleted</td>
<td>False</td>
<td>[IsSoftDeleted]</td>
<td></td>
<td>False</td>
</tr>
<tr>
<td>accountEnabled</td>
<td>True</td>
<td>[accountEnabled]</td>
<td></td>
<td>True</td>
</tr>
<tr>
<td>displayName</td>
<td>User1</td>
<td>[displayName]</td>
<td></td>
<td>User1</td>
</tr>
<tr>
<td>mailNickname</td>
<td>user1</td>
<td>[mailNickname]</td>
<td></td>
<td>user1</td>
</tr>
<tr>
<td>alternativeSecurityIds</td>
<td>AltSecIdFromNetid(&quot;1003&quot;)</td>
<td>AltSecIdFromNetid([netid])</td>
<td></td>
<td>(1 values)</td>
</tr>
<tr>
<td>showInAddressList</td>
<td>&quot;true&quot;</td>
<td>&quot;true&quot;</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>userType</td>
<td>&quot;Member&quot;</td>
<td>&quot;Member&quot;</td>
<td></td>
<td>Member</td>
</tr>
<tr>
<td>preferredLanguage</td>
<td>undefined</td>
<td>[preferredLanguage]</td>
<td></td>
<td>en-US</td>
</tr>
</tbody>
</table>
<p>If the user isn&#39;t in scope, you&#39;ll see a page with information about why test user was skipped.</p>
<p>The image shows a popup titled &quot;Determine if user is in scope&quot;, detailing the reasons for skipping user &#39;alice@fabrikam.com&#39;. These reasons include the user not being assigned to the application and lacking required entitlement for provisioning. Below are attributes like SkipReason (NotEffectivelyEntitled), IsActive (True), Assigned to the application (False), and IsInProvisioningScope (True).</p>
<pre><code class="lang-mermaid">graph TD;
    User_NotAssigned[&quot;Assigned to the application: False&quot;] --&gt; SkipReason[&quot;Skip Reason: NotEffectivelyEntitled&quot;]
    User_InScope[&quot;Is In Provisioning Scope: True&quot;] --&gt; IsActive[&quot;Is Active: True&quot;]
</code></pre><p>On the Provision on demand page, you can view details about the provision and have the option to retry.</p>
<p>✅
Fabrikam to Contoso | Provisioning &gt; Cross-tenant synchronization | Configurations &gt; Fabrikam to Contoso</p>
<h3 id="figure-1-provision-on-demand---user-management-interface">Figure 1: Provision on demand - User Management Interface</h3>
<ul>
<li>Description: The interface for &quot;Provision on demand&quot; in the Microsoft Entra ID shows a flow for user management, with steps including user import, determination of scope, matching between source and target system, and performing actions such as user creation or update. It marks all steps shown with a &quot;Success&quot; status.</li>
</ul>
<pre><code class="lang-mermaid">graph TD;
    ImportUser(&quot;Import user - Success&quot;)
    DetermineScope(&quot;Determine if user is in scope - Success&quot;)
    MatchUser(&quot;Match user between source and target system - Success&quot;)
    PerformAction(&quot;Perform action in target application - Success&quot;)

    ImportUser --&gt; DetermineScope
    DetermineScope --&gt; MatchUser
    MatchUser --&gt; PerformAction
</code></pre><p>X</p>
<h3 id="figure-2-user-provisioning-log-details">Figure 2: User Provisioning Log Details</h3>
<ul>
<li>Description: The screenshot displays detailed logs of the provisioning activities, showing specific user activities such as &#39;Import user&#39;, &#39;Determine if user is in scope&#39;, &#39;Match user between source and target system&#39;, and &#39;Perform action&#39;. Each step has a success status and a button for viewing more details or retrying the process. A button to provision another object is also visible.</li>
</ul>
<pre><code class="lang-mermaid">graph TD;
    Import(&quot;1. Import user - Success&quot;)
    InScope(&quot;2. Determine if user is in scope - Success&quot;)
    Match(&quot;3. Match user between source and target system - Success&quot;)
    Action(&quot;4. Perform action - Success&quot;)

    Import --&gt; InScope
    InScope --&gt; Match
    Match --&gt; Action
</code></pre><h2 id="6-in-the-target-tenant-verify-that-the-test-user-was-provisioned">6. In the target tenant, verify that the test user was provisioned.</h2>
<h3 id="figure-3-user-verification-in-microsoft-entra-id">Figure 3: User Verification in Microsoft Entra ID</h3>
<ul>
<li>Description: Interface showing the user1&#39;s entry in the Microsoft Entra ID under Contoso tenant, verifying the user provisioning status. Contains options like &#39;Download users&#39;, &#39;Bulk operations&#39;, &#39;Manage view&#39;, and specific user details like display name, principal name, and company name without any classified data.</li>
</ul>
<pre><code class="lang-mermaid">graph TD;
    AD(&quot;Azure Directory - Microsoft Entra ID&quot;)
    User(&quot;User1 - Provisioned&quot;)

    AD --&gt; User
</code></pre><ol>
<li>If all is working as expected, assign additional users to the configuration.</li>
</ol>
<p>For more information, see On-demand provisioning in Microsoft Entra ID.</p>
<p>Step 12: Start the provisioning job
❌ ❌ ✅ ❌ ❌ ❌ ✅</p>
<h1 id="source-tenant-1">Source tenant</h1>
<p>The provisioning job starts the initial synchronization cycle of all users defined in Scope of the Settings section. The initial cycle takes longer to perform than subsequent cycles, which occur approximately every 40 minutes as long as the Microsoft Entra provisioning service is running.</p>
<ol>
<li><p>In the source tenant, browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</p>
</li>
<li><p>Select Configurations and then select your configuration.</p>
</li>
<li><p>On the Overview page, review the provisioning details.</p>
</li>
</ol>
<p><em>Description of Figure 1:</em> The image shows a user interface with options for &quot;Fabrikam to Contoso Provisioning&quot; under &quot;Cross-tenant synchronization&quot;. The user interface includes tabs and buttons such as &quot;Start provisioning&quot;, &quot;Stop provisioning&quot;, &quot;Restart provisioning&quot;, and a progress bar indicating that the initial cycle is not run and 0% complete. It also contains links to view provisioning logs and technical information.</p>
<ol>
<li>Select Start provisioning to start the provisioning job.</li>
</ol>
<h1 id="step-13-monitor-provisioning">Step 13: Monitor provisioning</h1>
<p>Source and target tenants</p>
<p>Once you&#39;ve started a provisioning job, you can monitor the status.</p>
<ol>
<li>In the source tenant, on the Overview page, check the progress bar to see the status of the provisioning cycle and how close it&#39;s to completion. For more information, see Check the status of user provisioning.</li>
</ol>
<p><em>Description of Figure Image:</em> The image captures an Overview page where the user can observe the current cycle status through a progress bar.</p>
<p>If provisioning seems to be in an unhealthy state, the configuration will go into quarantine. For more information, see Application provisioning in quarantine status.</p>
<figure>
Description of Figure: The interface screenshot displays the overview of &quot;Fabrikam to Contoso&quot; provisioning in Microsoft Entra ID. Key features visible include tabs for overview, provision on demand, and various user activity. The screen highlights options such as start, stop, and restart provisioning, with a visual indication that the initial cycle is completed and current users status showing &quot;2&quot;. The sidebar offers access to other areas such as Users and groups, Audit logs, Provisioning logs, and more.
</figure>

<pre><code class="lang-mermaid">graph TD;
    Overview[&quot;Fabrikam to Contoso | Overview&quot;] --&gt;|Provisioning options| Start_provisioning[Start provisioning]
    Overview --&gt;|Provisioning options| Stop_provisioning[Stop provisioning]
    Overview --&gt;|Provisioning options| Restart_provisioning[Restart provisioning]
    Overview --&gt;|Users count| View_provisioning_logs[View provisioning logs]
    View_provisioning_logs --&gt;|Logs link| Provisioning_logs
</code></pre><ol>
<li>Select Provisioning logs to determine which users have been provisioned successfully or unsuccessfully. By default, the logs are filtered by the service principal ID of the configuration. For more information, see Provisioning logs in Microsoft Entra ID.</li>
</ol>
<figure>
Description of Figure: The detailed view of the Provisioning logs under the &quot;Fabrikam to Contoso&quot; provisioning shows a list of provisioning actions for specific users. The interface provides options to download, learn more, refresh, and custom settings for columns. Additional filter options include Identity Name or ID, Date, Show dates as, Status, and Action.
</figure>

<pre><code class="lang-mermaid">graph TD;
    Provisioning_logs[&quot;Fabrikam to Contoso | Provisioning logs&quot;] --&gt; User_entries
    User_entries --&gt;|Filter by| Identity_ID[Identity Name or ID]
    User_entries --&gt;|Filter by| Date[Date]
    User_entries --&gt;|Filter by| Status[Status]
    User_entries --&gt;|Filter by| Action[Action]
</code></pre><table>
<thead>
<tr>
<th>Users and groups Provisioning</th>
<th>Date</th>
<th>Identity</th>
<th>Action</th>
<th>Source System</th>
<th>Target System</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression builder Activity</td>
<td>1/22/2024, 6:18:47 PM</td>
<td>Display Name User3 Source ID Target ID</td>
<td>Update</td>
<td>Azure Active Directory</td>
<td>Azure Active Directory (target tenant)</td>
<td>Success</td>
</tr>
<tr>
<td></td>
<td>1/22/2024, 6:18:47 PM</td>
<td>Display Name User3 Source ID Target ID</td>
<td>Create</td>
<td>Azure Active Directory</td>
<td>Azure Active Directory (target tenant)</td>
<td>Success</td>
</tr>
<tr>
<td>Audit logs</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Provisioning logs 0 Insights Troubleshooting + Support</td>
<td>1/22/2024, 6:18:39 PM</td>
<td>Display Name User1 Source ID Target ID</td>
<td>Other</td>
<td>Azure Active Directory</td>
<td>Azure Active Directory (target tenant)</td>
<td>Skipped</td>
</tr>
<tr>
<td></td>
<td>1/22/2024, 6:07:48 PM</td>
<td>Display Name User1 Source ID Target ID ❌</td>
<td>Update</td>
<td>Azure Active Directory</td>
<td>Azure Active Directory (target tenant)</td>
<td>Success +</td>
</tr>
<tr>
<td>New support request</td>
<td>1/22/2024, 6:07:48 PM</td>
<td>Display Name User1 Source ID Target ID ❌ ❌</td>
<td>Create</td>
<td>Azure Active Directory</td>
<td>Azure Active Directory (target tenant)</td>
<td>Success</td>
</tr>
</tbody>
</table>
<ol>
<li>Select Audit logs to view all logged events in Microsoft Entra ID. For more information, see Audit logs in Microsoft Entra ID.</li>
</ol>
<p>You can also view audit logs in the target tenant.</p>
<ol>
<li>In the target tenant, select Users &gt; Audit logs to view logged events for user management.</li>
</ol>
<p><strong>Figure 1: Screenshot of the audit logs interface in Microsoft Entra showing various user-related activities under the audit log section. The interface includes options to filter by date, service category, activity, and has a feedback button. Each log entry details actions such as user provisioning and synchronization activities between &#39;Fabrikam&#39; and &#39;Contoso&#39;. The interface has options to download, refresh, and manage columns.</strong></p>
<pre><code class="lang-mermaid">graph TD;
    ActivityLogs[&quot;Audit Logs Interface&quot;]
    UserProvisioning[&quot;User Provisioning Activities&quot;]
    SyncActivities[&quot;Synchronization Activities&quot;]
    Filters[&quot;Filter Options: Date, Service, Category, Activity&quot;]
    LogDetails[&quot;Log Entries Detailing Actions&quot;]
    Interactions[&quot;Interactions: Download, Refresh, Manage Columns&quot;]

    ActivityLogs --&gt; UserProvisioning
    ActivityLogs --&gt; SyncActivities
    ActivityLogs --&gt; Filters
    ActivityLogs --&gt; LogDetails
    ActivityLogs --&gt; Interactions
</code></pre><p>Step 14: Configure leave settings</p>
<p>Target tenant</p>
<p>Even though users are being provisioned in the target tenant, they still might be able to remove themselves. If users remove themselves and they are in scope, they&#39;ll be provisioned again during the next provisioning cycle. If you want to disallow the ability for users to remove themselves from your organization, you must configure the External user leave settings.</p>
<ol>
<li><p>In the target tenant, browse to Identity &gt; External Identities &gt; External collaboration settings.</p>
</li>
<li><p>Under External user leave settings, choose whether to allow external users to leave your organization themselves.</p>
</li>
</ol>
<p><strong>Figure 2: An illustration of the settings interface for configuring external user leave settings in a system management tool. Shows options to allow or prevent external users from self-removing from an organization with check-options for configuring per the administrator&#39;s preference.</strong></p>
<pre><code class="lang-mermaid">graph TD;
    LeaveSettings[&quot;External User Leave Settings Interface&quot;]
    ConfigureOptions[&quot;Configuration Options: Allow or Prevent Self-removal&quot;]
    AdminControl[&quot;Administrator Preference Check-options&quot;]

    LeaveSettings --&gt; ConfigureOptions
    ConfigureOptions --&gt; AdminControl
</code></pre><p>This setting also applies to B2B collaboration and B2B direct connect, so if you set External user leave settings to No, B2B collaboration users and B2B direct connect users can&#39;t leave your organization themselves. For more information, see Leave an organization as an external user.</p>
<h1 id="troubleshooting-tips">Troubleshooting tips</h1>
<h2 id="delete-a-configuration">Delete a configuration</h2>
<p>Follows these steps to delete a configuration on the Configurations page.</p>
<p>1. In the source tenant, browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</p>
<p>2. On the Configurations page, add a check mark next to the configuration you want to delete.</p>
<p>3. Select Delete and then OK to delete the configuration.</p>
<p><strong>Figure Description:</strong>
 The figure shows a user interface of the &quot;Cross-tenant synchronization | Configurations&quot; panel on a computer screen. It displays an overview and a list of configurations with the option buttons &quot;New configuration&quot;, &quot;Refresh&quot;, and &quot;Delete&quot;. Three configurations named &quot;Fabrikam3&quot;, &quot;Fabrikam4&quot;, and &quot;Fabrikam5&quot; are listed under the &quot;Name&quot; column, each associated with the &quot;Default Directory&quot; under the &quot;Tenant Name&quot; column. The &quot;Fabrikam3&quot; is checked, indicating selection for deletion.</p>
<pre><code class="lang-mermaid">graph TD;
    Overview --&gt; Configurations;
    Configurations --&gt; &quot;|New configuration|&quot;;
    Configurations --&gt; Refresh;
    Configurations --&gt; Delete;
    Delete --&gt; Fabrikam3[(&quot;Fabrikam3 (Default Directory)&quot;)];
    Delete --&gt; Fabrikam4[(&quot;Fabrikam4 (Default Directory)&quot;)];
    Delete --&gt; Fabrikam5[(&quot;Fabrikam5 (Default Directory)&quot;)];
    Click[Fabrikam3] --&gt; Delete;
</code></pre><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>❌</td>
<td>Name</td>
<td>Tenant Name</td>
</tr>
<tr>
<td>✅</td>
<td>Fabrikam3</td>
<td>Default Directory</td>
</tr>
<tr>
<td>❌</td>
<td>Fabrikam4</td>
<td>Default Directory</td>
</tr>
<tr>
<td>❌</td>
<td>Fabrikam5</td>
<td>Default Directory</td>
</tr>
</tbody>
</table>
<p>Symptom - Test connection fails with AzureDirectoryB2BManagementPolicyCheckFailure</p>
<p>When configuring cross-tenant synchronization in the source tenant and you test the connection, it fails with the following error message:</p>
<p>You appear to have entered invalid credentials. Please confirm you are using the correct information for an administrative account.</p>
<h1 id="notifications">Notifications</h1>
<p>More events in the activity log -&gt;</p>
<p>Dismiss all</p>
<h3 id="testing-connection-to-fabrikam">Testing connection to Fabrikam</h3>
<p>You appear to have entered invalid credentials. Please confirm you are using the correct information for an administrative account.</p>
<p>Error code: AzureDirectoryB2BManagementPolicyCheckFailure<br>Details: Policy permitting auto-redemption of invitations not configured.<br>Request-id:</p>
<h4 id="time-indication-for-the-testing-connection-activity">Time Indication for the Testing Connection Activity</h4>
<p>This is a notification message stating the policy error and includes a timestamp indicating the event occurred &quot;16 minutes ago&quot;.</p>
<pre><code class="lang-mermaid">graph TD;
    ErrorEvent(&quot;Error Event: Testing connection to Fabrikam - 16 minutes ago&quot;)
</code></pre><h2 id="cause">Cause</h2>
<p>This error indicates the policy to automatically redeem invitations in both the source and target tenants wasn&#39;t set up.</p>
<h2 id="solution">Solution</h2>
<p>Follow the steps in Step 3: Automatically redeem invitations in the target tenant and Step 4: Automatically redeem invitations in the source tenant.</p>
<h2 id="symptom---automatic-redemption-check-box-is-disabled">Symptom - Automatic redemption check box is disabled</h2>
<p>When configuring cross-tenant synchronization, the Automatic redemption check box is disabled.</p>
<p>Home &gt; Contoso | External Identities &gt; External Identities | Cross-tenant access settings &gt; Outbound access settings - Contoso</p>
<p>X</p>
<p>You need Azure AD Premium to configure trust settings and target select users, groups and applications in cross-tenant access settings.</p>
<p>B2B collaboration</p>
<p>B2B direct connect Trust settings</p>
<p>Automatic redemption</p>
<p>Check this setting if you want to automatically redeem invitations. If so, users from this tenant don&#39;t have to accept the consent prompt the first time they access the specified tenant using cross-tenant synchronization, B2B collaboration, or B2B direct connect. This setting will only suppress the consent prompt if the specified tenant checks this setting for inbound access as well. Learn more ❌ Automatically redeem invitations with the tenant aa5eaf5a-ecc3-49f6-aac8-e50a26e228de.</p>
<p>Save Discard</p>
<p>+</p>
<p>Cause</p>
<p>Your tenant doesn&#39;t have a Microsoft Entra ID P1 or P2 license.</p>
<p>Solution</p>
<p>You must have Microsoft Entra ID P1 or P2 to configure trust settings.</p>
<p>Symptom - Recently deleted user in the target tenant is not restored</p>
<p>After soft deleting a synchronized user in the target tenant, the user isn&#39;t restored during the next synchronization cycle. If you try to soft delete a user with on-demand provisioning and then restore the user, it can result in duplicate users.</p>
<p>Cause</p>
<p>Restoring a previously soft-deleted user in the target tenant isn&#39;t supported.</p>
<p>Solution</p>
<p>Manually restore the soft-deleted user in the target tenant. For more information, see Restore or remove a recently deleted user using Microsoft Entra ID.</p>
<p>Symptom - Users are skipped because SMS sign-in is enabled on the user
✅</p>
<p>Users are skipped from synchronization. The scoping step includes the following filter with status false: &quot;Filter external users.alternativeSecurityIds EQUALS &#39;None&#39;&quot;</p>
<p>Cause</p>
<p>If SMS sign-in is enabled for a user, they will be skipped by the provisioning service.</p>
<p>Solution</p>
<p>Disable SMS Sign-in for the users. The script below shows how you can disable SMS Sign-in using PowerShell.</p>
<p>PowerShell</p>
<h5 id="disable-sms-sign-in-options-for-the-users">Disable SMS Sign-in options for the users</h5>
<h5 id="import-module">Import module</h5>
<p>Install-Module Microsoft.Graph.Users.Actions
Install-Module Microsoft.Graph.Identity.SignIns
Install-Module Microsoft.Graph.Users.Actions</p>
<p>Connect-MgGraph -Scopes &quot;User.Read.All&quot;, &quot;Group.ReadWrite.All&quot;, &quot;UserAuthenticationMethod.Read.All&quot;, &quot;UserAuthenticationMethod.ReadWrite&quot;, &quot;UserAuthenticationMethod.ReadWrite.All&quot;</p>
<h5 id="the-value-for-phoneauthenticationmethodid-is-3179e48a-750b-4051-897c-87b9720928f7">The value for phoneAuthenticationMethodId is 3179e48a-750b-4051-897c-87b9720928f7</h5>
<p>$phoneAuthenticationMethodId = &quot;3179e48a-750b-4051-897c-87b9720928f7&quot;</p>
<h5 id="get-the-user-details">Get the User Details</h5>
<p>$userId = &quot;objectid_of_the_user_in_Azure_AD&quot;</p>
<h5 id="validate-the-value-for-smssigninstate">validate the value for SmsSignInState</h5>
<p>$smssignin = Get-MgUserAuthenticationPhoneMethod -UserId $userId
{
    if($smssignin.SmsSignInState -eq &quot;ready&quot;){</p>
<h5 id="disable-sms-sign-in-for-the-user-is-set-to-ready">Disable Sms Sign-In for the user is set to ready</h5>
<pre><code>    Disable-MgUserAuthenticationPhoneMethodSmsSignIn -UserId $userId - PhoneAuthenticationMethodId $phoneAuthenticationMethodId
    Write-Host &quot;SMS sign-in disabled for the user&quot; -ForegroundColor Green
} else{
    Write-Host &quot;SMS sign-in status not set or found for the user &quot; - ForegroundColor Yellow
}
</code></pre><p>}</p>
<h1 id="symptom---users-fail-to-provision-with-error-azureactivedirectoryforbidden">Symptom - Users fail to provision with error &quot;AzureActiveDirectoryForbidden&quot;</h1>
<p>Users in scope fail to provision. The provisioning logs details include the following error message:</p>
<blockquote><p>Guest invitations not allowed for your company. Contact your company administrator for more details.</p>
</blockquote>
<h1 id="cause-1">Cause</h1>
<p>This error indicates the Guest invite settings in the target tenant are configured with the most restrictive setting: &quot;No one in the organization can invite guest users including admins (most restrictive)&quot;.</p>
<h1 id="solution-1">Solution</h1>
<p>Change the Guest invite settings in the target tenant to a less restrictive setting. For more information, see Configure external collaboration settings.</p>
<h1 id="next-steps-10">Next steps</h1>
<ul>
<li>Tutorial: Reporting on automatic user account provisioning</li>
<li>Managing user account provisioning for enterprise apps in the Azure portal</li>
<li>What is single sign-on in Microsoft Entra ID?</li>
</ul>
<h1 id="configure-cross-tenant-synchronization-using-powershell-or-microsoft-graph-api">Configure cross-tenant synchronization using PowerShell or Microsoft Graph API</h1>
<p>Article · 04/23/2024</p>
<p>This article describes the key steps to configure cross-tenant synchronization using Microsoft Graph PowerShell or Microsoft Graph API. When configured, Microsoft Entra ID automatically provisions and de-provisions B2B users in your target tenant. For detailed steps using the Microsoft Entra admin center, see <a href="https://example.com/configure-cross-tenant-synchronization">Configure cross-tenant synchronization</a>.</p>
<p>The first figure demonstrates the configuration and synchronization process from a source tenant to a target tenant. It shows internal users UserS1, UserS2, and UserS3 in the source tenant with outbound access settings set to automatically redeem invitations. These users synchronize with UserT1, UserT2, and UserT3 in the target tenant as well as a group GroupT1. The diagram also includes configuration details such as scoping filters where the department equals Marketing and attribute mappings for accountEnabled, employeeld, userPrincipalName, and extensionName (companyName).</p>
<pre><code class="lang-mermaid">graph LR;
    SourceTenant(&quot;Source tenant&quot;) --&gt; |&quot;Cross-tenant synchronization&quot;| TargetTenant(&quot;Target tenant&quot;);
    SourceTenant --&gt;|Internal Users| UserS1(&quot;User S1 Internal&quot;);
    SourceTenant --&gt;|Internal Users| UserS2(&quot;User S2 Internal&quot;);
    SourceTenant --&gt;|Internal Users| UserS3(&quot;User S3 Internal&quot;);
    SourceTenant -.-&gt;|&quot;Configuration&quot;| Configuration;
    Configuration --&gt;|Outbound access settings: Automatically redeem invitations| TargetTenant;
    Configuration --&gt;|Scoping filters: department EQUALS Marketing| TargetTenant;
    Configuration --&gt;|Attribute mappings| TargetTenant;
    TargetTenant --&gt;|Internal Users| UserT1(&quot;User T1&quot;);
    TargetTenant --&gt;|Internal Users| UserT2(&quot;User T2&quot;);
    TargetTenant --&gt;|Internal Users| UserT3(&quot;User T3&quot;);
    TargetTenant --&gt;|&quot;Group T1&quot;| GroupT1(&quot;Group T1&quot;);
</code></pre><h1 id="prerequisites-2">Prerequisites</h1>
<p>Source tenant:</p>
<ul>
<li>Microsoft Entra ID P1 or P2 license. For more information, see <a href="https://example.com/license-requirements">License requirements</a>.</li>
<li>Security Administrator role to configure cross-tenant access settings.</li>
<li>Hybrid Identity Administrator role to configure cross-tenant synchronization.</li>
</ul>
<p>· Cloud Application Administrator or Application Administrator role to assign users to a configuration and to delete a configuration.</p>
<p>· Global Administrator role to consent to required permissions.</p>
<p>Figure 1: An infographics displaying the role requirements under a header that reads &quot;Target tenant&quot;. The roles listed include: Microsoft Entra ID P1 or P2 license information, Security Administrator role for configuring cross-tenant access, and Global Administrator role for consents. It visually emphasizes the roles with distinct icons next to each bullet point.</p>
<pre><code class="lang-mermaid">graph TD;
    TenantRoles[ &quot;Target Tenant Roles&quot; ]
    License[&quot;Microsoft Entra ID P1 or P2 License&quot;]
    SecAdminRole[&quot;Security Administrator Role&quot;]
    GlobalAdminConsent[&quot;Global Administrator Role to Consent&quot;]

    TenantRoles --&gt; License
    TenantRoles --&gt; SecAdminRole
    TenantRoles --&gt; GlobalAdminConsent
</code></pre><p>Target tenant</p>
<p>· Microsoft Entra ID P1 or P2 license. For more information, see License requirements.</p>
<p>· Security Administrator role to configure cross-tenant access settings.</p>
<p>· Global Administrator role to consent to required permissions.</p>
<h1 id="step-1-sign-in-to-the-target-tenant">Step 1: Sign in to the target tenant</h1>
<p>Figure 2: A screenshot of a PowerShell interface with steps and commands typed. It includes commands starting PowerShell, installing Microsoft Graph PowerShell SDK, retrieving tenant IDs of source and target tenants, initializing variables, and using Connect-MgGraph command to sign into the tenant and consent to permissions.</p>
<pre><code class="lang-mermaid">graph TD;
    PowerShellLoginStep1(&quot;Start PowerShell&quot;)
    PowerShellLoginStep2(&quot;Install Microsoft Graph PowerShell SDK&quot;)
    PowerShellLoginStep3(&quot;Retrieve and Initialize Tenant IDs&quot;)
    PowerShellLoginStep4(&quot;Sign in and Consent Permissions using Connect-MgGraph&quot;)

    PowerShellLoginStep1 --&gt; PowerShellLoginStep2
    PowerShellLoginStep2 --&gt; PowerShellLoginStep3
    PowerShellLoginStep3 --&gt; PowerShellLoginStep4
</code></pre><p>Target tenant</p>
<p>PowerShell</p>
<ol>
<li><p>Start PowerShell.</p>
</li>
<li><p>If necessary, install the Microsoft Graph PowerShell SDK.</p>
</li>
<li><p>Get the tenant ID of the source and target tenants and initialize variables.</p>
</li>
</ol>
<p>PowerShell </p>
<p>$SourceTenantId = &quot;<sourcetenantid>&quot; $TargetTenantId = &quot;<targettenantid>&quot;<p>
<ol>
<li>Use the Connect-MgGraph command to sign in to the target tenant and consent to the following required permissions.</li>
</ol>
<p>· Policy.Read.All</p>
<p>· Policy.ReadWrite.CrossTenantAccess</p>
<p>PowerShell</p>
<p>Connect-MgGraph -TenantId $TargetTenantId -Scopes &quot;Policy.Read.All&quot;,&quot;Policy.ReadWrite.CrossTenantAccess&quot;</p>
<h1 id="step-2-enable-user-synchronization-in-the-target-tenant-1">Step 2: Enable user synchronization in the target tenant</h1>
<p><strong>Figure: A diagram illustrating the process of enabling user synchronization in the target tenant. This diagram likely includes symbols and text that clarify the steps involved in the process, such as initiating commands in PowerShell and handling potential errors.</strong></p>
<p>Target tenant</p>
<p>PowerShell</p>
<ol>
<li>In the target tenant, use the New-MgPolicyCrossTenantAccessPolicyPartner command to create a new partner configuration in a cross-tenant access policy between the target tenant and the source tenant. Use the source tenant ID in the request.</li>
</ol>
<p>If you get the error New-MgPolicyCrossTenantAccessPolicyPartner_Create: Another object with the same value for property tenantId already exists, you might already have an existing configuration. For more information, see Symptom - New-MgPolicyCrossTenantAccessPolicyPartner_Create error.</p>
<p>PowerShell</p>
<pre><code class="lang-mermaid">graph TD;
    NewConfig[Create New Configuration] --&gt; CheckError{Check for Existing Configuration}
    CheckError -- &quot;Error Found&quot; --&gt; ExistingConfig[Handle Existing Configuration]
    CheckError -- &quot;No Error&quot; --&gt; Success[Configuration Successful]
</code></pre><p>$Params = @{ TenantId = $SourceTenantId } New-MgPolicyCrossTenantAccessPolicyPartner -BodyParameter $Params Format-List</p>
<p>Output</p>
<p>AutomaticUserConsentSettings :</p>
<p>Microsoft. Graph. PowerShell. Models.MicrosoftGraphInboundOutboundPolicyConfiguration</p>
<p>B2BCollaborationInbound :</p>
<p>Microsoft. Graph. PowerShell. Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting</p>
<p>B2BCollaborationOutbound</p>
<p>Microsoft. Graph. PowerShell. Models. MicrosoftGraphCrossTenantAccessPolicyB2BSetting B2BDirectConnectInbound :</p>
<p>Microsoft. Graph. PowerShell. Models. MicrosoftGraphCrossTenantAccessPolicyB2BSetting B2BDirectConnectOutbound : Microsoft. Graph. PowerShell. Models. MicrosoftGraphCrossTenantAccessPolicyB2BSetting</p>
<p>IdentitySynchronization :</p>
<p>Microsoft. Graph. PowerShell.Models.MicrosoftGraphCrossTenantIdentity</p>
<p>SyncPolicyPartner InboundTrust :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyInboundTrust IsServiceProvider :
TenantId : <sourcetenantid> TenantRestrictions : Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyTenantRestrictions AdditionalProperties : {[@odata.context, <a href="https://graph.microsoft.com/v1.0/$metadata#policies/crossTenantAccessPolicy/partners/$entity">https://graph.microsoft.com/v1.0/$metadata#policies/crossTenantAccessPolicy/partners/$entity</a>], 
[crossCloudMeetingConfiguration, 
System.Collections.Generic.Dictionary2[System.String, System.Object ]], [protectedContentSharing, 
System.Collections.Generic.Dictionary 2[System.String, System.Object ]]}<p>
<ol>
<li>Use the Invoke-MgGraphRequest command to enable user synchronization in the target tenant.</li>
</ol>
<p>If you get an Request_MultipleObjectsWithSameKeyValue error, you might already have an existing policy. For more information, see Symptom - Request_MultipleObjectsWithSameKeyValue error.</p>
<p>PowerShell
$Params = @{
    userSyncInbound = @{
        isSyncAllowed = $true
    }
}
Invoke-MgGraphRequest -Method PUT -Uri &quot;<a href="https://graph.microsoft.com/v1.0/policies/crossTenantAccessPolicy/partners/$SourceTenantId/identitySynchronization">https://graph.microsoft.com/v1.0/policies/crossTenantAccessPolicy/partners/$SourceTenantId/identitySynchronization</a>&quot; -Body $Params</p>
<ol>
<li>Use the Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization command to verify IsSyncAllowed is set to True.</li>
</ol>
<p>PowerShell
(Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization -CrossTenantAccessPolicyConfigurationPartnerTenantId $SourceTenantId).UserSyncInbound</p>
<p>Output</p>
<p>IsSyncAllowed
True</p>
<h1 id="step-3-automatically-redeem-invitations-in-the-target-tenant-1">Step 3: Automatically redeem invitations in the target tenant</h1>
<h3 id="figure-description-3">Figure Description</h3>
<p>The figure shows a structured layout of Step 3, starting with the section title &quot;Automatically redeem invitations in the target tenant.&quot; It has icons and labels indicating it deals with the target tenant and PowerShell commands. The main content details the PowerShell command for the Update-MgPolicyCrossTenantAccessPolicyPartner to handle cross-tenant access by automatically redeeming invitations and suppressing consent prompts.</p>
<pre><code class="lang-mermaid">graph TD;
    TargetTenantCommand[&quot;PowerShell Command: Update-MgPolicyCrossTenantAccessPolicyPartner&quot;] --&gt; Parameters{&quot;Parameters: Automatically redeeming and suppressing prompts&quot;}
    Parameters --&gt; InboundAllowedSet[&quot;Setting: InboundAllowed=True&quot;]
</code></pre><p>Target tenant</p>
<p>PowerShell</p>
<ol>
<li>In the target tenant, use the Update-MgPolicyCrossTenantAccessPolicyPartner command to automatically redeem invitations and suppress consent prompts for inbound access.</li>
</ol>
<p>PowerShell</p>
<pre><code>$AutomaticUserConsentSettings = @{ &quot;InboundAllowed&quot;=&quot;True&quot;
} Update-MgPolicyCrossTenantAccessPolicyPartner - CrossTenantAccessPolicyConfigurationPartnerTenantId $SourceTenantId -AutomaticUserConsentSettings $AutomaticUserConsentSettings
</code></pre><h1 id="step-4-sign-in-to-the-source-tenant">Step 4: Sign in to the source tenant</h1>
<h3 id="figure-description-4">Figure Description</h3>
<p>The figure illustrates Step 4, labeled &quot;Sign in to the source tenant.&quot; It includes an icon and label indicating it involves the source tenant and PowerShell commands on initializing and retrieving tenant IDs.</p>
<pre><code class="lang-mermaid">graph TD;
    SourceTenantCommand[&quot;PowerShell Command: Initialize and Retrieve IDs&quot;] --&gt; InitialSetup{&quot;Initial Setup: Get tenant IDs&quot;}
    InitialSetup --&gt; SourceTenant[&quot;Action: Start PowerShell in source tenant&quot;]
</code></pre><p>Source tenant</p>
<p>PowerShell</p>
<ol>
<li><p>Start an instance of PowerShell.</p>
</li>
<li><p>Get the tenant ID of the source and target tenants and initialize variables.</p>
</li>
</ol>
<p>$SourceTenantId = &quot;<sourcetenantid>&quot; $TargetTenantId = &quot;<targettenantid>&quot;<p>
<ol>
<li>Use the Connect-MgGraph command to sign in to the source tenant and consent to the following required permissions.</li>
</ol>
<ul>
<li>Policy.Read.All</li>
<li>Policy.ReadWrite.CrossTenantAccess</li>
<li>Application.ReadWrite.All</li>
<li>Directory.ReadWrite.All</li>
<li>AuditLog.Read.All</li>
</ul>
<p>PowerShell</p>
<p>Connect-MgGraph -TenantId $SourceTenantId -Scopes &quot;Policy.Read.All&quot;, &quot;Policy.ReadWrite.CrossTenantAccess&quot;, &quot;Application.ReadWrite.All&quot;, &quot;Directory.ReadWrite.All&quot;, &quot;AuditLog.Read.All&quot;</p>
<h1 id="step-5-automatically-redeem-invitations-in-the-source-tenant">Step 5: Automatically redeem invitations in the source tenant</h1>
<p>Text description of figure: Step 5 involves a diagram or a flow chart that potentially illustrates the process of automatically redeeming invitations in the source tenant. Exact details are not displayed.</p>
<p>Source tenant</p>
<p>PowerShell</p>
<ol>
<li>In the source tenant, use the New-MgPolicyCrossTenantAccessPolicyPartner command to create a new partner configuration in a cross-tenant access policy between the source tenant and the target tenant. Use the target tenant ID in the request.</li>
</ol>
<p>If you get the error New-MgPolicyCrossTenantAccessPolicyPartner_Create: Another object with the same value for property tenantId already exists you might already have an existing configuration. For more information, see Symptom - New-MgPolicyCrossTenantAccessPolicyPartner_Create error.</p>
<p>PowerShell</p>
<p>$Params = @{
    TenantId = $TargetTenantId
}
New-MgPolicyCrossTenantAccessPolicyPartner -BodyParameter $Params | Format-List</p>
<p>Output</p>
<p>AutomaticUserConsentSettings :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphInboundOutboundPolicyConfiguration
B2BCollaborationInbound :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
B2BCollaborationOutbound :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
B2BDirectConnectInbound :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
B2BDirectConnectOutbound :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyB2BSetting
IdentitySynchronization :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantIdentitySyncPolicyPartner
InboundTrust :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyInboundTrust
IsServiceProvider :
TenantId : <targettenantid>
TenantRestrictions :
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCrossTenantAccessPolicyTenantRestrictions
AdditionalProperties : {[[@odata.context, <a href="https://graph.microsoft.com/v1.0/$metadata#policies/crossTenantAccessPolicy/partners/$entity">https://graph.microsoft.com/v1.0/$metadata#policies/crossTenantAccessPolicy/partners/$entity</a>], [crossCloudMeetingConfiguration, System.Collections.Generic.Dictionary2[System.String, System.Object]], [protectedContentSharing, System.Collections.Generic.Dictionary`2[System.String, System.Object]]}<p>
<p>Use the Update-MgPolicyCrossTenantAccessPolicyPartner command to automatically redeem invitations and suppress consent prompts for outbound access.</p>
<p>$AutomaticUserConsentSettings = @{ &quot;OutboundAllowed&quot;=&quot;True&quot; } Update-MgPolicyCrossTenantAccessPolicyPartner -
CrossTenantAccessPolicyConfigurationPartnerTenantId $TargetTenantId -AutomaticUserConsentSettings $AutomaticUserConsentSettings</p>
<h1 id="step-6-create-a-configuration-application-in-the-source-tenant">Step 6: Create a configuration application in the source tenant</h1>
<p>Source tenant</p>
<p>PowerShell</p>
<ol>
<li>In the source tenant, use the Invoke-MgInstantiateApplicationTemplate command to add an instance of a configuration application from the Microsoft Entra application gallery into your tenant.</li>
</ol>
<p>PowerShell</p>
<p>Invoke-MgInstantiateApplicationTemplate -ApplicationTemplateId &quot;518e5f48-1fc8-4c48-9387-9fdf28b0dfe7&quot; -DisplayName &quot;Fabrikam&quot;</p>
<ol>
<li>Use the Get-MgServicePrincipal command to get the service principal ID and app role ID.</li>
</ol>
<p>PowerShell</p>
<p>Get-MgServicePrincipal -Filter &quot;DisplayName eq &#39;Fabrikam&#39;&quot; | Format-List</p>
<p>Output</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>AccountEnabled</td>
<td>: True</td>
</tr>
<tr>
<td>AddIns</td>
<td>: {}</td>
</tr>
<tr>
<td>AlternativeNames</td>
<td>: {}</td>
</tr>
<tr>
<td>AppDescription</td>
<td>:</td>
</tr>
<tr>
<td>AppDisplayName</td>
<td>: Fabrikam</td>
</tr>
</tbody>
</table>
<p>AppId
: <appid><p>
<p>AppManagementPolicies</p>
<p>AppOwnerOrganizationId
: <appownerorganizationid><p>
<p>AppRoleAssignedTo</p>
<p>AppRoleAssignmentRequired
: True</p>
<p>AppRoleAssignments</p>
<p>AppRoles
: {<approleid>}<p>
<p>ApplicationTemplateId
: 518e5f48-1fc8-4c48-9387-9fdf28b0dfe7</p>
<p>ClaimsMappingPolicies</p>
<p>CreatedObjects</p>
<p>CustomSecurityAttributes
Microsoft.Graph.PowerShell.Models.MicrosoftGraphCustomSecurityAttributeValue</p>
<p>DelegatedPermissionClassifications</p>
<p>DeletedDateTime</p>
<p>Description</p>
<p>DisabledByMicrosoftStatus</p>
<p>DisplayName
: Fabrikam</p>
<p>Endpoints</p>
<p>ErrorUrl</p>
<p>FederatedIdentityCredentials</p>
<p>HomeRealmDiscoveryPolicies</p>
<p>Homepage
https://account.activedirectory.windowsazure.com:444/applications/default.aspx?metadata=aad2aadsync|ISV9.1|primary|z</p>
<p>Id
: <serviceprincipalid><p>
<p>Info
Microsoft.Graph.PowerShell.Models.MicrosoftGraphInformationalUrl</p>
<p>KeyCredentials</p>
<p>LicenseDetails</p>
<p>$ServicePrincipalId = &quot;<serviceprincipalid>&quot;<p>
<p>$AppRoleId= &quot;<approleid>&quot;<p>
<h1 id="step-7-test-the-connection-to-the-target-tenant">Step 7: Test the connection to the target tenant</h1>
<p>Source tenant</p>
<p><strong>PowerShell</strong></p>
<ol>
<li>In the source tenant, use the Invoke-MgGraphRequest command to test the connection to the target tenant and validate the credentials.</li>
</ol>
<p>The figure shows a PowerShell script including a parameter configuration block and an Invoke-MgGraphRequest command. The parameters are set to not use saved credentials, specify the &quot;Azure2Azure&quot; template ID, and include credentials specified as a company ID and a target tenant ID. The command performs a POST request to the Microsoft Graph API’s servicePrincipal endpoint to validate credentials.</p>
<pre><code class="lang-mermaid">graph TD;
    ParamsConfig[&quot;Parameters Configuration (Azure2Azure, CompanyID, SyncPolicy)&quot;] --&gt; InvokeMgGraph[&quot;Invoke-MgGraphRequest POST&quot;];
</code></pre><h1 id="step-8-create-a-provisioning-job-in-the-source-tenant">Step 8: Create a provisioning job in the source tenant</h1>
<p>Source tenant</p>
<p><strong>PowerShell</strong></p>
<ol>
<li>Determine the synchronization template to use, such as Azure2Azure.</li>
</ol>
<p>The figure likely illustrates setting up a PowerShell command for creating a provisioning job, potentially with parameters specifying the synchronization template.</p>
<p>A template has pre-configured synchronization settings.</p>
<ol>
<li>In the source tenant, use the New-MgServicePrincipalSynchronizationJob command to create a provisioning job based on a template.</li>
</ol>
<p>PowerShell</p>
<p>New-MgServicePrincipalSynchronizationJob -ServicePrincipalId $ServicePrincipalId -TemplateId &quot;Azure2Azure&quot; | Format-List</p>
<h1 id="output-1">Output</h1>
<p>Id : &lt; JobId&gt;<br>Schedule :<br>Microsoft. Graph. PowerShell.Models.MicrosoftGraphSynchronizationSchedule  </p>
<p>Schema<br>Microsoft. Graph. PowerShell. Models. MicrosoftGraphSynchronizationSchema  </p>
<p>Status<br>Microsoft. Graph. PowerShell.Models.MicrosoftGraphSynchronizationStatus<br>SynchronizationJobSettings : {AzureIngestionAttributeOptimization, LookaheadQueryEnabled}<br>TemplateId : Azure2Azure<br>AdditionalProperties : {[@odata.context, <a href="https://graph.microsoft.com/v1.0/$metadata#servicePrincipals(">https://graph.microsoft.com/v1.0/$metadata#servicePrincipals(</a>&#39;<serv iceprincipalid="">&#39;)/synchro nization/jobs/$entity]}<p>
<p>3. Initialize a variable for the job ID.</p>
<p>PowerShell</p>
<p>$JobId = &quot;<jobid>&quot;<p>
<p>Step 9: Save your credentials</p>
<p>Source tenant</p>
<p>PowerShell</p>
<p><em>In the image, a purple directional arrow labeled &#39;Save your credentials&#39; points downwards. This visual element symbolizes an instruction or step focusing on securely storing or saving credentials relating to the source tenant.</em> </p>
<pre><code class="lang-mermaid">graph TD;
    Step9[&quot;Step 9: Save your credentials&quot;]
</code></pre><ol>
<li>In the source tenant, use the Invoke-MgGraphRequest command to save your credentials.</li>
</ol>
<p>PowerShell</p>
<pre><code class="lang-PowerShell">$Params = @{
    &quot;value&quot; = @(
        @{
            &quot;key&quot; = &quot;AuthenticationType&quot;
            &quot;value&quot; = &quot;SyncPolicy&quot;
        }
        @{
            &quot;key&quot; = &quot;CompanyId&quot;
            &quot;value&quot; = $TargetTenantId
        }
    )
}
Invoke-MgGraphRequest -Method PUT -Uri &quot;https://graph.microsoft.com/v1.0/servicePrincipals/$ServicePrincipalId/synchronization/secrets&quot; -Body $Params
</code></pre><p>Step 10: Assign a user to the configuration</p>
<p>Source tenant</p>
<p>For cross-tenant synchronization to work, at least one internal user must be assigned to the configuration.</p>
<p>PowerShell</p>
<ol>
<li>In the source tenant, use the New-MgServicePrincipalAppRoleAssignedTo command to assign an internal user to the configuration.</li>
</ol>
<p>PowerShell</p>
<pre><code class="lang-PowerShell">$Params = @{
    PrincipalId = &quot;&lt;PrincipalId&gt;&quot;
    ResourceId = $ServicePrincipalId
    AppRoleId = $AppRoleId
}
</code></pre><p>New-MgServicePrincipalAppRoleAssignedTo -ServicePrincipalId $ServicePrincipalId -BodyParameter $Params | Format-List</p>
<h1 id="output-2">Output</h1>
<p>AppRoleId<br>: &lt; AppRoleId&gt;  </p>
<p>CreatedDateTime<br>: 7/31/2023 10:27:12 PM  </p>
<p>DeletedDateTime<br>:  </p>
<p>Id<br>: &lt; Id&gt;  </p>
<p>PrincipalDisplayName<br>: User1  </p>
<p>PrincipalId<br>: &lt; PrincipalId&gt;  </p>
<p>PrincipalType<br>: User  </p>
<p>ResourceDisplayName<br>: Fabrikam  </p>
<p>ResourceId<br>: &lt; ServicePrincipalId&gt;  </p>
<p>AdditionalProperties<br>: {[@odata.context,<br>https://graph.microsoft.com/v1.0/$metadata#appRoleAssignments/$entity]}  </p>
<h1 id="step-11-test-provision-on-demand">Step 11: Test provision on demand</h1>
<p><strong>Text description of figure</strong>: The figure shows a graphical representation of a diamond-shaped icon with an arrow pointing downward, situated above the heading &quot;Source tenant&quot;. This symbolizes the action of provisioning on demand.</p>
<pre><code class="lang-mermaid">graph TD;
    Action[Download arrow (Provision on demand)] --&gt; Heading[&quot;Source tenant&quot;]
</code></pre><p>Source tenant</p>
<p>Now that you have a configuration, you can test on-demand provisioning with one of your users.</p>
<p>PowerShell</p>
<ol>
<li>In the source tenant, use the Get-MgServicePrincipalSynchronizationJobSchema command to get the schema rule ID.</li>
</ol>
<p>PowerShell</p>
<p>$SynchronizationSchema = Get-MgServicePrincipalSynchronizationJobSchema -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId<br>$SynchronizationSchema.SynchronizationRules | Format-List  </p>
<p>Output  </p>
<p>ContainerFilter<br>:<br>Microsoft.Graph.PowerShell.Models.MicrosoftGraphContainerFilter  </p>
<p>Editable: True</p>
<p>GroupFilter: Microsoft.Graph.PowerShell.Models.MicrosoftGraphGroupFilter</p>
<p>Id: <ruleid><p>
<p>Metadata: {defaultSourceObjectMappings, supportsProvisionOnDemand}</p>
<p>Name: USER_INBOUND_USER</p>
<p>ObjectMappings: {Provision Azure Active Directory Users, , , .. }</p>
<p>Priority: 1</p>
<p>SourceDirectoryName: Azure Active Directory</p>
<p>TargetDirectoryName: Azure Active Directory (target tenant)</p>
<p>AdditionalProperties: {}</p>
<ol>
<li>Initialize a variable for the rule ID.</li>
</ol>
<p>PowerShell</p>
<pre><code>$RuleId = &quot;&lt;RuleId&gt;&quot;
</code></pre><ol>
<li>Use the New-MgServicePrincipalSynchronizationJobOnDemand command to provision a test user on demand.</li>
</ol>
<p>PowerShell</p>
<pre><code>$Params = @{
    Parameters = @(
        @{
            Subjects = @(
                @{
                    ObjectId = &quot;&lt;UserObjectId&gt;&quot;
                    ObjectTypeName = &quot;User&quot;
                }
            )
            RuleId = $RuleId
        }
    )
    New-MgServicePrincipalSynchronizationJobOnDemand -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId -BodyParameter $Params | Format-List
</code></pre><p>Output</p>
<pre><code>Key : Microsoft.Identity.Health.CPP.Common.DataContracts.SyncFabric.StatusInfo
Value : [{&quot;provisioningSteps&quot;: [{ &quot;name&quot; : &quot;EntryImport&quot;, &quot;type&quot; : &quot;Import&quot;, &quot;status&quot; : &quot;Success&quot;, &quot;description&quot;: &quot;Retrieved User
</code></pre><p>&#39;user1@fabrikam.com&#39; from Azure Active Directory&quot;, &quot;timestamp&quot; : &quot;2023-07-31T22 : 31:15.9116590Z&quot;, &quot;details&quot; : {&quot;objectId&quot;:</p>
<p>=</p>
<p><userobjectid>&quot;, &quot;accountEnabled&quot;: &quot;True&quot;, &quot;displayName&quot; : &quot;User1&quot;, &quot;mail Nickname&quot; : &quot;user1&quot;, &quot;userPrincipalName&quot; : &quot;use<p>
<p>AdditionalProperties : {[@odata.context, <a href="https://graph.microsoft.com/v1.0/$metadata#microsoft.graph.stringKe">https://graph.microsoft.com/v1.0/$metadata#microsoft.graph.stringKe</a> yStringValuePair]}</p>
<h1 id="step-12-start-the-provisioning-job">Step 12: Start the provisioning job</h1>
<p>Figure: An illustrative step-by-step diagram or flowchart indicating the process to start the provisioning job in the source tenant using PowerShell Commands.</p>
<pre><code class="lang-mermaid">graph LR;
    Configured[&quot;Provisioning Job Configured&quot;] --&gt; StartCmd[Start-MgServicePrincipalSynchronizationJob]
    StartCmd --&gt; JobStarted[&quot;Provisioning Job Started&quot;]
</code></pre><p>Source tenant</p>
<p>PowerShell</p>
<p>1. Now that the provisioning job is configured, in the source tenant, use the Start-MgServicePrincipalSynchronizationJob command to start the provisioning job.</p>
<p>PowerShell</p>
<p>Start-MgServicePrincipalSynchronizationJob -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId</p>
<h1 id="step-13-monitor-provisioning-1">Step 13: Monitor provisioning</h1>
<p>Figure: A diagram showing a timeline or process flow that details monitoring the provisioning status using PowerShell commands.</p>
<pre><code class="lang-mermaid">graph TD;
    JobStarted --&gt; CheckStatus[Get-MgServicePrincipalSynchronizationJob]
    CheckStatus --&gt; Monitoring[&quot;Monitoring Progress &amp; Statistics&quot;]
</code></pre><h2 id="source-tenant-2">Source tenant</h2>
<p>PowerShell</p>
<p>1. Now that the provisioning job is running, in the source tenant, use the Get- MgServicePrincipalSynchronizationJob command to monitor the progress of the current provisioning cycle as well as statistics to date such as the number of users and groups that have been created in the target system.</p>
<!-- PageHeader="PowerShell" -->
<p>Get-MgServicePrincipalSynchronizationJob -ServicePrincipalId $ServicePrincipalId -SynchronizationJobId $JobId | Format-List</p>
<h1 id="output-3">Output</h1>
<p>Id : <jobid>
Schedule : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSynchronizationSchedule
Schema : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSynchronizationSchema
Status : Microsoft.Graph.PowerShell.Models.MicrosoftGraphSynchronizationStatus
SynchronizationJobSettings : {AzureIngestionAttributeOptimization, LookaheadQueryEnabled}
TemplateId : Azure2Azure
AdditionalProperties : {[@odata.context, <a href="https://graph.microsoft.com/v1.0/$metadata#servicePrincipals(">https://graph.microsoft.com/v1.0/$metadata#servicePrincipals(</a>&#39;<serviceprincipalid>&#39;)/synchronization/jobs/$entity]}<p>
<p>In addition to monitoring the status of the provisioning job, use the Get-MgAuditLogProvisioning command to retrieve the provisioning logs and get all the provisioning events that occur. For example, query for a particular user and determine if they were successfully provisioned.</p>
<p>PowerShell</p>
<p>Get-MgAuditLogDirectoryAudit | Select -First 10 | Format-List</p>
<table>
<thead>
<tr>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr>
<td>ActivityDateTime</td>
</tr>
<tr>
<td>ActivityDisplayName</td>
</tr>
<tr>
<td>AdditionalDetails</td>
</tr>
<tr>
<td>Category</td>
</tr>
<tr>
<td>CorrelationId</td>
</tr>
<tr>
<td>Id</td>
</tr>
<tr>
<td>InitiatedBy</td>
</tr>
<tr>
<td>LoggedByService</td>
</tr>
<tr>
<td>OperationType</td>
</tr>
<tr>
<td>Result</td>
</tr>
</tbody>
</table>
<p>ResultReason</p>
<p>: User &#39;user2@fabrikam.com&#39; was created in</p>
<p>Azure Active Directory (target tenant)</p>
<p>TargetResources</p>
<p>: {<serviceprincipalid>, }<p>
<p>AdditionalProperties : {}</p>
<p>ActivityDateTime</p>
<p>: 7/31/2023 12:08:17 AM</p>
<p>ActivityDisplayName</p>
<p>: Export</p>
<p>AdditionalDetails</p>
<p>: {Details, ErrorCode, EventName, ipaddr ... }</p>
<p>Category</p>
<p>: ProvisioningManagement</p>
<p>CorrelationId</p>
<p>: cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec</p>
<p>Id</p>
<p>: Sync_cc519f3b-fb72-4ea2-9b7b-</p>
<p>8f9dc271c5ec_L5BFV_161778264</p>
<p>InitiatedBy</p>
<p>: Microsoft. Graph. PowerShell.Models.MicrosoftGraphAuditActivityInitiator1</p>
<p>LoggedByService</p>
<p>: Account Provisioning</p>
<p>OperationType</p>
<p>: </p>
<p>Result</p>
<p>: success</p>
<p>ResultReason</p>
<p>: User &#39;user2@fabrikam.com&#39; was updated in</p>
<p>Azure Active Directory (target tenant)</p>
<p>TargetResources</p>
<p>: {<serviceprincipalid>, }<p>
<p>AdditionalProperties : {}</p>
<p>ActivityDateTime</p>
<p>: 7/31/2023 12:08:14 AM</p>
<p>ActivityDisplayName</p>
<p>: Synchronization rule action</p>
<p>AdditionalDetails</p>
<p>: {Details, ErrorCode, EventName, ipaddr ... }</p>
<p>Category</p>
<p>: ProvisioningManagement</p>
<p>CorrelationId</p>
<p>: cc519f3b-fb72-4ea2-9b7b-8f9dc271c5ec</p>
<p>Id</p>
<p>: Sync_cc519f3b-fb72-4ea2-9b7b-</p>
<p>8f9dc271c5ec_L5BFV_161778395</p>
<p>InitiatedBy</p>
<p>: Microsoft. Graph. PowerShell.Models.MicrosoftGraphAuditActivityInitiator1</p>
<p>LoggedByService</p>
<p>: Account Provisioning</p>
<p>OperationType</p>
<p>: </p>
<p>Result</p>
<p>: success</p>
<p>ResultReason</p>
<p>: User &#39;user2@fabrikam.com&#39; will be created in</p>
<p>Azure Active Directory (target tenant) (User is active and assigned in Azure Active Directory, but no matching User was found in Azure Active Directory (target tenant))</p>
<p>TargetResources</p>
<p>: {<serviceprincipalid>, }<p>
<p>AdditionalProperties : {}</p>
<p>Troubleshooting tips</p>
<p>PowerShell</p>
<h1 id="symptom---insufficient-privileges-error">Symptom - Insufficient privileges error</h1>
<p>When you try to perform an action, you receive an error message similar to the following:</p>
<p>code: Authorization_RequestDenied message: Insufficient privileges to complete the operation.</p>
<p>Cause</p>
<p>Either the signed-in user doesn&#39;t have sufficient privileges, or you need to consent to one of the required permissions.</p>
<p>Solution</p>
<ol>
<li><p>Make sure you&#39;re assigned the required roles. See Prerequisites earlier in this article.</p>
</li>
<li><p>When you sign in with Connect-MgGraph, make sure you specify the required scopes. See Step 1: Sign in to the target tenant and Step 4: Sign in to the source tenant earlier in this article.</p>
</li>
</ol>
<p>Symptom - New- MgPolicyCrossTenantAccessPolicyPartner_Create error</p>
<p>When you try to create a new partner configuration, you receive an error message similar to the following:</p>
<p>New-MgPolicyCrossTenantAccessPolicyPartner_Create: Another object with the same value for property tenantId already exists.</p>
<p>Cause</p>
<p>You are likely trying to create a configuration or object that already exists, possibly from a previous configuration.</p>
<p>Solution</p>
<ol>
<li><p>Verify your syntax and that you are using the correct tenant ID.</p>
</li>
<li><p>Use the Get-MgPolicyCrossTenantAccessPolicyPartner command to list the existing object.</p>
</li>
<li><p>If you have an existing object, you might need to make an update using Update-MgPolicyCrossTenantAccessPolicyPartner</p>
</li>
</ol>
<h1 id="symptom---requestmultipleobjectswithsamekeyvalue-error">Symptom - Request_MultipleObjectsWithSameKeyValue error</h1>
<p>When you try to enable user synchronization, you receive an error message similar to the following:</p>
<p>Invoke-MgGraphRequest: PUT</p>
<p><a href="https://graph.microsoft.com/v1.0/policies/crossTenantAccessPolicy/partners/">https://graph.microsoft.com/v1.0/policies/crossTenantAccessPolicy/partners/</a><sourcetenantid>/identitySynchronization HTTP/1.1 409 Conflict<p>
<p>...</p>
<p>{&quot;error&quot; : { &quot;code&quot; : &quot;Request_MultipleObjectsWithSameKeyValue&quot;, &quot;message&quot; : &quot;A conflicting object with one or more of the specified property values is present in the directory.&quot;, &quot;details&quot;:</p>
<p>[{ &quot;code&quot; : &quot;ConflictingObjects&quot;, &quot;message&quot;:&quot;A conflicting object with one or more of the specified property values is present in the directory.&quot;,</p>
<p>Cause</p>
<p>You are likely trying to create a policy that already exists, possibly from a previous configuration.</p>
<p>Solution</p>
<ol>
<li><p>Verify your syntax and that you are using the correct tenant ID.</p>
</li>
<li><p>Use the Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization command to list the IsSyncAllowed setting.</p>
</li>
</ol>
<p>PowerShell</p>
<p>(Get-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization -CrossTenantAccessPolicyConfigurationPartnerTenantId $SourceTenantId) . UserSyncInbound</p>
<ol>
<li>If you have an existing policy, you might need to make an update using Set-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization command to enable user synchronization.</li>
</ol>
<!-- PageHeader="PowerShell" -->
<p>$Params = @{ 
    userSyncInbound = @{ 
        isSyncAllowed = $true 
    } 
} 
Set-MgPolicyCrossTenantAccessPolicyPartnerIdentitySynchronization -CrossTenantAccessPolicyConfigurationPartnerTenantId $SourceTenantId -BodyParameter $Params</p>
<h1 id="next-steps-11">Next steps</h1>
<ul>
<li>Microsoft Entra synchronization API overview</li>
<li>Tutorial: Develop and plan provisioning for a SCIM endpoint in Microsoft Entra ID</li>
</ul>
<h1 id="scoping-users-or-groups-to-be-provisioned-with-scoping-filters">Scoping users or groups to be provisioned with scoping filters</h1>
<p>Article · 01/18/2024</p>
<p>Learn how to use scoping filters in the Microsoft Entra provisioning service to define attribute based rules. The rules are used to determine which users or groups are provisioned.</p>
<h1 id="scoping-filter-use-cases">Scoping filter use cases</h1>
<p>You use scoping filters to prevent objects in applications that support automated user provisioning from being provisioned if an object doesn&#39;t satisfy your business requirements. A scoping filter allows you to include or exclude any users who have an attribute that matches a specific value. For example, when provisioning users from Microsoft Entra ID to a SaaS application used by a sales team, you can specify that only users with a &quot;Department&quot; attribute of &quot;Sales&quot; should be in scope for provisioning.</p>
<p>Scoping filters can be used differently depending on the type of provisioning connector:</p>
<ul>
<li>Outbound provisioning from Microsoft Entra ID to SaaS applications. When Microsoft Entra ID is the source system, user and group assignments are the most common method for determining which users are in scope for provisioning. These assignments also are used for enabling single sign-on and provide a single method to manage access and provisioning. Scoping filters can be used optionally, in addition to assignments or instead of them, to filter users based on attribute values.</li>
</ul>
<h1 id="tip">Tip</h1>
<p>The more users and groups in scope for provisioning, the longer the synchronization process can take. Setting the scope to sync assigned users and groups, limiting the number of groups assigned to the app, and limiting the size of the groups will reduce the time it takes to synchronize everyone that is in scope.</p>
<ul>
<li>Inbound provisioning from HCM applications to Microsoft Entra ID and Active Directory. When an HCM application such as Workday is the source system, scoping filters are the primary method for determining which users should be provisioned from the HCM application to Active Directory or Microsoft Entra ID.</li>
</ul>
<p>By default, Microsoft Entra provisioning connectors don&#39;t have any attribute-based scoping filters configured.</p>
<h1 id="scoping-filter-construction">Scoping filter construction</h1>
<p>A scoping filter consists of one or more clauses. Clauses determine which users are allowed to pass through the scoping filter by evaluating each user&#39;s attributes. For example, you might have one clause that requires that a user&#39;s &quot;State&quot; attribute equals &quot;New York&quot;, so only New York users are provisioned into the application.</p>
<p>A single clause defines a single condition for a single attribute value. If multiple clauses are created in a single scoping filter, they&#39;re evaluated together using &quot;AND&quot; logic. The &quot;AND&quot; logic means all clauses must evaluate to &quot;true&quot; in order for a user to be provisioned.</p>
<p>Finally, multiple scoping filters can be created for a single application. If multiple scoping filters are present, they&#39;re evaluated together by using &quot;OR&quot; logic. The &quot;OR&quot; logic means that if all the clauses in any of the configured scoping filters evaluate to &quot;true&quot;, the user is provisioned.</p>
<p>Each user or group processed by the Microsoft Entra provisioning service is always evaluated individually against each scoping filter.</p>
<p>As an example, consider the following scoping filter:</p>
<p>Figure: The image shows a graphical user interface for defining a scoping filter. It includes areas for adding and deleting scoping filters, specifying target attributes, operators, and values. The example shown has a scoping filter group named &quot;New York Engineering&quot; with the criteria: </p>
<ul>
<li>TARGET ATTRIBUTE &quot;City&quot; OPERATOR &quot;EQUALS&quot; VALUE &quot;New York&quot;</li>
<li>TARGET ATTRIBUTE &quot;Department&quot; OPERATOR &quot;EQUALS&quot; VALUE &quot;Engineering&quot;</li>
<li>TARGET ATTRIBUTE &quot;EmployeeID (extension)&quot; OPERATOR &quot;REGEX MATCH&quot; VALUE pattern matching IDs</li>
<li>TARGET ATTRIBUTE &quot;Job Title&quot; OPERATOR &quot;IS NOT NULL&quot;
There&#39;s a notation that if multiple scoping clauses are present, they are evaluated using &quot;AND&quot; logic, and if multiple scoping filters are present, they are evaluated using &quot;OR&quot; logic.</li>
</ul>
<p>Mermaid Diagram:</p>
<pre><code class="lang-mermaid">graph TD;
    ScopingFilterGroup1(&quot;Scoping Filter Group: New York Engineering&quot;)
    Condition1(&quot;City EQUALS New York&quot;) --&gt; ScopingFilterGroup1
    Condition2(&quot;Department EQUALS Engineering&quot;) --&gt; ScopingFilterGroup1
    Condition3(&quot;EmployeeID (extension) REGEX MATCH ID pattern&quot;) --&gt; ScopingFilterGroup1
    Condition4(&quot;Job Title IS NOT NULL&quot;) --&gt; ScopingFilterGroup1
</code></pre><p>According to this scoping filter, users must satisfy the following criteria to be provisioned:</p>
<p>· They must be in New York.</p>
<p>· They must work in the Engineering department.</p>
<p>· Their company employee ID must be between 1,000,000 and 2,000,000.</p>
<p>· Their job title must not be null or empty.</p>
<h1 id="create-scoping-filters">Create scoping filters</h1>
<p>Scoping filters are configured as part of the attribute mappings for each Microsoft Entra user provisioning connector. The following procedure assumes that you already set up automatic provisioning for one of the supported applications and are adding a scoping filter to it.</p>
<h2 id="create-a-scoping-filter">Create a scoping filter</h2>
<p>Q Tip</p>
<p>Steps in this article might vary slightly based on the portal you start from.</p>
<ol>
<li><p>Sign in to the Microsoft Entra admin center as at least a Application Administrator.</p>
</li>
<li><p>Browse to Identity &gt; Applications &gt; Enterprise applications &gt; All applications.</p>
</li>
<li><p>Select the application for which you have configured automatic provisioning: for example, &quot;ServiceNow&quot;.</p>
</li>
<li><p>Select the Provisioning tab.</p>
</li>
<li><p>In the Mappings section, select the mapping that you want to configure a scoping filter for: for example, &quot;Synchronize Microsoft Entra users to ServiceNow&quot;.</p>
</li>
<li><p>Select the Source object scope menu.</p>
</li>
<li><p>Select Add scoping filter.</p>
</li>
<li><p>Define a clause by selecting a source Attribute Name, an Operator, and an Attribute Value to match against. The following operators are supported:</p>
</li>
</ol>
<p>a. &amp;. Clause returns &quot;true&quot; if the evaluated attribute exists in the input string value.</p>
<p>b. !&amp;. Clause returns &quot;true&quot; if the evaluated attribute does not exist in the input string value.</p>
<p>c. ENDS_WITH. Clause returns &quot;true&quot; if the evaluated attribute ends with the input string value.</p>
<p>d. EQUALS. Clause returns &quot;true&quot; if the evaluated attribute matches the input string value exactly (case sensitive).</p>
<p>e. Greater Than. Clause returns &quot;true&quot; if the evaluated attribute is greater than the value. The value specified on the scoping filter must be an integer and the attribute on the user must be an integer [0,1,2, ... ].</p>
<p>f. Greater_Than_OR_EQUALS. Clause returns &quot;true&quot; if the evaluated attribute is greater than or equal to the value. The value specified on the scoping filter must be an integer and the attribute on the user must be an integer [0,1,2, ... ].</p>
<p>g. Includes. Clause returns &quot;true&quot; if the evaluated attribute contains the string value (case sensitive) as described here.</p>
<p>h. IS FALSE. Clause returns &quot;true&quot; if the evaluated attribute contains a Boolean value of false.</p>
<p>i. IS NOT NULL. Clause returns &quot;true&quot; if the evaluated attribute isn&#39;t empty.</p>
<p>j. IS NULL. Clause returns &quot;true&quot; if the evaluated attribute is empty.</p>
<p>k. IS TRUE. Clause returns &quot;true&quot; if the evaluated attribute contains a Boolean value of true.</p>
<p>l. NOT EQUALS. Clause returns &quot;true&quot; if the evaluated attribute doesn&#39;t match the input string value (case sensitive).</p>
<p>m. NOT REGEX MATCH. Clause returns &quot;true&quot; if the evaluated attribute doesn&#39;t match a regular expression pattern. It returns &quot;false&quot; if the attribute is null / empty.</p>
<p>n. REGEX MATCH. Clause returns &quot;true&quot; if the evaluated attribute matches a regular expression pattern. For example: ([1-9][0-9]) matches any number between 10 and 99 (case sensitive).</p>
<p><strong>Important Notes on Filter Support:</strong></p>
<ul>
<li>The IsMemberOf filter is not supported currently.</li>
<li>The members attribute on a group is not supported currently.</li>
<li>Filtering is not supported for multi-valued attributes.</li>
<li>Scoping filters will return &quot;false&quot; if the value is null / empty.</li>
</ul>
<p>9. Optionally, repeat steps 7-8 to add more scoping clauses.</p>
<p>10. In Scoping Filter Title, add a name for your scoping filter.</p>
<p>11. Select OK.</p>
<p>12. Select OK again on the Scoping Filters screen. Optionally, repeat steps 6-11 to add another scoping filter.</p>
<p>13. Select Save on the Attribute Mapping screen.</p>
<h1 id="important">Important</h1>
<p>Saving a new scoping filter triggers a new full sync for the application, where all users in the source system are evaluated again against the new scoping filter. If a user in the application was previously in scope for provisioning, but falls out of scope, their account is disabled or deprovisioned in the application. To override this default behavior, refer to Skip deletion for user accounts that go out of scope.</p>
<h1 id="common-scoping-filters">Common scoping filters</h1>
<p>( Expand table</p>
<table>
<thead>
<tr>
<th>Target Attribute</th>
<th>Operator</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>userPrincipalName</td>
<td>REGEX MATCH</td>
<td>.*\@domain.com</td>
<td>All users with userPrincipal that have the domain @domain.com are in scope for provisioning.</td>
</tr>
<tr>
<td>userPrincipalName</td>
<td>NOT REGEX MATCH</td>
<td>.*\@domain.com</td>
<td>All users with userPrincipal that has the domain @domain.com are out of scope for provisioning.</td>
</tr>
<tr>
<td>department</td>
<td>EQUALS</td>
<td>sales</td>
<td>All users from the sales department are in scope for provisioning</td>
</tr>
<tr>
<td>workerID</td>
<td>REGEX MATCH</td>
<td>(1[0-9][0-9][0-9][0-9][0-9][0-9])</td>
<td>All employees with workerID between 1000000 and 2000000 are in scope for provisioning.</td>
</tr>
</tbody>
</table>
<h1 id="related-articles">Related articles</h1>
<p>· Automate user provisioning and deprovisioning to SaaS applications</p>
<ul>
<li>Customize attribute mappings for user provisioning</li>
<li>Write expressions for attribute mappings</li>
<li>Account provisioning notifications</li>
<li>Use SCIM to enable automatic provisioning of users and groups from Microsoft Entra ID to applications</li>
<li>List of tutorials on how to integrate SaaS apps</li>
</ul>
<h1 id="enable-accidental-deletions-prevention-in-the-microsoft-entra-provisioning-service">Enable accidental deletions prevention in the Microsoft Entra provisioning service</h1>
<p>Article · 10/23/2023</p>
<p>The Microsoft Entra provisioning service includes a feature to help avoid accidental deletions. This feature ensures that users aren&#39;t disabled or deleted in an application unexpectedly.</p>
<p>You use accidental deletions to specify a deletion threshold. Anything above the threshold that you set requires an admin to explicitly allow the processing of the deletions.</p>
<h1 id="configure-accidental-deletion-prevention">Configure accidental deletion prevention</h1>
<p>To enable accidental deletion prevention:</p>
<ol>
<li>Sign in to the Microsoft Entra admin center as at least a Application Administrator.</li>
<li>Browse to Identity &gt; Applications &gt; Enterprise applications.</li>
<li>Select your application.</li>
<li>Select Provisioning and then on the provisioning page select Edit provisioning.<ol>
<li>Under Settings, select the Prevent accidental deletions check box and specify a deletion threshold.</li>
<li>Ensure the Notification Email address is completed. If the deletion threshold is met, an email is sent.</li>
<li>Select Save to save the changes.</li>
</ol>
</li>
</ol>
<p>When the deletion threshold is met, the job goes into quarantine, and a notification email is sent. The quarantined job can then be allowed or rejected. To learn more about quarantine behavior, see Application provisioning in quarantine status.</p>
<h1 id="recovering-from-an-accidental-deletion">Recovering from an accidental deletion</h1>
<p>When you encounter an accidental deletion, you see it on the provisioning status page. It says Provisioning has been quarantined. See quarantine details for more information.</p>
<h1 id="allowing-deletions">Allowing deletions</h1>
<p>The Allow deletes action deletes the objects that triggered the accidental delete threshold. Use the procedure to accept the deletions.</p>
<ol>
<li>Select Allow deletes.</li>
<li>Click Yes on the confirmation to allow the deletions.</li>
<li>View the confirmation that the deletions were accepted. The status returns to healthy with the next cycle.</li>
</ol>
<h1 id="rejecting-deletions">Rejecting deletions</h1>
<p>Investigate and reject deletions as necessary:</p>
<ul>
<li>Investigate the source of the deletions. You can use the provisioning logs for details.</li>
<li>Prevent the deletion by assigning the user / group to the application (or configuration) again, restoring the user / group, or updating your provisioning configuration.</li>
<li>Once you&#39;ve made the necessary changes to prevent the user / group from being deleted, restart provisioning. Don&#39;t restart provisioning until you&#39;ve made the necessary changes to prevent the users / groups from being deleted.</li>
</ul>
<h2 id="test-deletion-prevention">Test deletion prevention</h2>
<p>You can test the feature by triggering disable / deletion events by setting the threshold to a low number, for example 3, and then changing scoping filters, unassigning users, and deleting users from the directory (see common scenarios in next section).</p>
<p>Let the provisioning job run (20 - 40 mins) and navigate back to the provisioning page. Check the provisioning job in quarantine and choose to allow the deletions or review the provisioning logs to understand why the deletions occurred.</p>
<h2 id="common-deprovisioning-scenarios-to-test">Common deprovisioning scenarios to test</h2>
<ul>
<li>Delete a user / put them into the recycle bin.</li>
<li>Block sign in for a user.</li>
<li>Unassign a user or group from the application (or configuration).</li>
</ul>
<p>· Remove a user from a group that&#39;s provides them access to the application (or configuration).</p>
<p>To learn more about deprovisioning scenarios, see How Application Provisioning Works.</p>
<h1 id="frequently-asked-questions-1">Frequently Asked Questions</h1>
<h2 id="what-scenarios-count-toward-the-deletion-threshold">What scenarios count toward the deletion threshold?</h2>
<p>When a user is set for removal from the target application (or target tenant), it&#39;s counted against the deletion threshold. Scenarios that could lead to a user being removed from the target application (or target tenant) could include: unassigning the user from the application (or configuration) and soft / hard deleting a user in the directory. Groups evaluated for deletion count towards the deletion threshold. In addition to deletions, the same functionality also works for disables.</p>
<h2 id="what-is-the-interval-that-the-deletion-threshold-is-evaluated-on">What is the interval that the deletion threshold is evaluated on?</h2>
<p>It&#39;s evaluated each cycle. If the number of deletions doesn&#39;t exceed the threshold during a single cycle, the &quot;circuit breaker&quot; isn&#39;t triggered. If multiple cycles are needed to reach a steady state, the deletion threshold is evaluated per cycle.</p>
<h1 id="how-are-these-deletion-events-logged">How are these deletion events logged?</h1>
<p>You can find users that should be disabled / deleted but haven&#39;t due to the deletion threshold. Navigation to Provisioning logs and then filter Action with StagedAction or StagedDelete.</p>
<h1 id="next-steps-12">Next steps</h1>
<p>· How application provisioning works</p>
<p>· Plan an application provisioning deployment</p>
<h1 id="feedback-1">Feedback</h1>
<p>Was this page helpful?</p>
<p>3 Yes</p>
<p>No</p>
<p>Provide product feedback | Get help at Microsoft Q&amp;A</p>
<h1 id="on-demand-provisioning-in-microsoft-entra-id">On-demand provisioning in Microsoft Entra ID</h1>
<p>Article · 10/23/2023</p>
<p>Use on-demand provisioning to provision a user or group in seconds. Among other things, you can use this capability to:</p>
<ul>
<li>Troubleshoot configuration issues quickly.</li>
<li>Validate expressions that you&#39;ve defined.</li>
<li>Test scoping filters.</li>
</ul>
<h2 id="how-to-use-on-demand-provisioning">How to use on-demand provisioning</h2>
<p><strong>Tip</strong></p>
<p>Steps in this article may vary slightly based on the portal you start from.</p>
<ol>
<li>Sign in to the Microsoft Entra admin center as at least a Application Administrator.</li>
<li>Browse to Identity &gt; Applications &gt; Enterprise applications &gt; select your application.</li>
<li>Select Provisioning.</li>
<li>Configure provisioning by providing your admin credentials.</li>
<li>Select Provision on demand.</li>
<li>Search for a user by first name, last name, display name, user principal name, or email address. Alternatively, you can search for a group and pick up to five users.</li>
</ol>
<p><strong>Note</strong></p>
<p>For Cloud HR provisioning app (Workday / SuccessFactors to Active Directory / Microsoft Entra ID), the input value is different. For Workday scenario, please provide &quot;WorkerID&quot; or &quot;WID&quot; of the user in Workday. For SuccessFactors scenario, please provide &quot;personldExternal&quot; of the user in SuccessFactors.</p>
<ol>
<li>Select Provision at the bottom of the page.</li>
</ol>
<figure>

A screenshot from Microsoft Azure&#39;s Portal. It depicts an interface for the &quot;Provision on demand&quot; feature. The page is displaying options to select users or groups for provisioning. Two members are selected: Alex Wilber and Nestor Wilke, indicated with a green tick, and their respective email addresses are shown. There are also buttons labeled &quot;Learn More&quot; and &quot;Provision&quot; visible for operational actions.

<!-- FigureContent="A Provision on demand - Microsoft × + X C https://portal.azure.com/?Microsoft_AAD_Connect_Provisioning=tip&feature.provisionondemandsupportmember=true#view/Microsoft_AAD_Connect_Provisioning/UserPr ... A ... Microsoft Azure P Search resources, services, and docs (G+/) Home > scimreftest > AHCustom > Provision on demand ... × Learn More A Got feedback? Provision on-demand for a subset of users or groups before rolling it out broadly to your organization. When provisioning a group you can select 5 members at a time. ✅ No user or group will be provisioned on-demand that would not have been provisioned through the regular provisioning cycles. Selected group P On-demand provisioning Selected members 2 selected v p ✅ Alex Wilber AlexW@scimreftest.onmicrosoft.com MEMBER ✅ Nestor Wilke NestorW@scimreltest.onmicrosoft.com MEMBER + Provision" -->

</figure>

<h1 id="understand-the-provisioning-steps">Understand the provisioning steps</h1>
<p>The on-demand provisioning process attempts to show the steps that the provisioning service takes when provisioning a user. There are typically five steps to provision a user. One or more of those steps, explained in the following sections, are shown during the on-demand provisioning experience.</p>
<h2 id="step-1-test-connection">Step 1: Test connection</h2>
<p>The provisioning service attempts to authorize access to the target system by making a request for a &quot;test user&quot;. The provisioning service expects a response that indicates that the service authorized to continue with the provisioning steps. This step is shown only when it fails. It&#39;s not shown during the on-demand provisioning experience when the step is successful.</p>
<h2 id="troubleshooting-tips-1">Troubleshooting tips</h2>
<ul>
<li>Ensure that you&#39;ve provided valid credentials, such as the secret token and tenant URL, to the target system. The required credentials vary by application. For detailed configuration tutorials, see the tutorial list.</li>
<li>Make sure that the target system supports filtering on the matching attributes defined in the Attribute mappings pane. You might need to check the API documentation provided by the application developer to understand the supported filters.</li>
<li>For System for Cross-domain Identity Management (SCIM) applications, you can use a tool like Postman. Such tools help you ensure that the application responds.</li>
</ul>
<p>to authorization requests in the way that the Microsoft Entra provisioning service expects. Have a look at an example request.</p>
<h1 id="step-2-import-user">Step 2: Import user</h1>
<p>Next, the provisioning service retrieves the user from the source system. The user attributes that the service retrieves are used later to:</p>
<p>· Evaluate whether the user is in scope for provisioning.</p>
<p>· Check the target system for an existing user.</p>
<p>· Determine what user attributes to export to the target system.</p>
<h1 id="view-details">View details</h1>
<p>The View details section shows the properties of the user that were imported from the source system (for example, Microsoft Entra ID).</p>
<h1 id="troubleshooting-tips-2">Troubleshooting tips</h1>
<p>· Importing the user can fail when the matching attribute is missing on the user object in the source system. To resolve this failure, try one of these approaches:</p>
<ul>
<li>Update the user object with a value for the matching attribute.
❌</li>
<li>Change the matching attribute in your provisioning configuration.
❌
· If an attribute that you expected is missing from the imported list, ensure that the attribute has a value on the user object in the source system. The provisioning service currently doesn&#39;t support provisioning null attributes.</li>
</ul>
<p>· Make sure that the Attribute mapping page of your provisioning configuration contains the attribute that you expect.</p>
<h1 id="step-3-determine-if-user-is-in-scope">Step 3: Determine if user is in scope</h1>
<p>Next, the provisioning service determines whether the user is in scope for provisioning. The service considers aspects such as:</p>
<p>· Whether the user is assigned to the application.</p>
<p>· Whether scope is set to Sync assigned or Sync all.</p>
<p>· The scoping filters defined in your provisioning configuration.</p>
<p>The View details section shows the scoping conditions that were evaluated. You might see one or more of the following properties:</p>
<ul>
<li>Active in source system indicates that the user has the property IsActive set to true in Microsoft Entra ID.</li>
<li>Assigned to application indicates that the user is assigned to the application in Microsoft Entra ID.</li>
<li>Scope sync all indicates that the scope setting allows all users and groups in the tenant.</li>
<li>User has required role indicates that the user has the necessary roles to be provisioned into the application.</li>
<li>Scoping filters are also shown if you have defined scoping filters for your application. The filter is displayed with the following format: {scoping filter title} {scoping filter attribute} {scoping filter operator} {scoping filter value}.</li>
</ul>
<h1 id="troubleshooting-tips-3">Troubleshooting tips</h1>
<ul>
<li>Make sure that you&#39;ve defined a valid scoping role. For example, avoid using the Greater_Than operator with a noninteger value.</li>
<li>If the user doesn&#39;t have the necessary role, review the tips for provisioning users assigned to the default access role.</li>
</ul>
<h1 id="step-4-match-user-between-source-and-target">Step 4: Match user between source and target</h1>
<p>In this step, the service attempts to match the user that was retrieved in the import step with a user in the target system.</p>
<h1 id="view-details-1">View details</h1>
<p>The View details page shows the properties of the users that were matched in the target system. The context pane changes as follows:</p>
<ul>
<li>If no users are matched in the target system, no properties are shown.</li>
<li>If one user matches in the target system, the properties of that user are shown.</li>
<li>If multiple users match, the properties of both users are shown.</li>
<li>If multiple matching attributes are part of your attribute mappings, each matching attribute is evaluated sequentially and the matched users for that attribute are shown.</li>
</ul>
<p>· The provisioning service might not be able to match a user in the source system uniquely with a user in the target. Resolve this problem by ensuring that the matching attribute is unique.</p>
<p>· Make sure that the target system supports filtering on the attribute that&#39;s defined as the matching attribute.</p>
<h1 id="step-5-perform-action">Step 5: Perform action</h1>
<p>Finally, the provisioning service takes an action, such as creating, updating, deleting, or skipping the user.</p>
<p>Here&#39;s an example of what you might see after the successful on-demand provisioning of a user:
Figure: The image represents a user interface of Microsoft Azure showing the &quot;Perform Action&quot; panel with details of a group in a provisioning process. It includes tabs like &quot;Group details&quot;, &quot;Group membership operations&quot;, and &quot;User operations&quot;. Each tab displays relevant details, statuses, and options like &quot;Success&quot; and &quot;View Details&quot; for actions performed during user or group provisioning.</p>
<pre><code class="lang-mermaid">graph TD;
    ImportGroup[&quot;Import group&quot;] --&gt;|Success| ScopeDetermination[&quot;Determine if group is in scope&quot;]
    ScopeDetermination --&gt;|Success| MatchGroup[&quot;Match group between source and target system&quot;]
    MatchGroup --&gt;|Success| ActionResult[&quot;Perform action&quot;]
    ActionResult --&gt;|Success| ProvisionAnother[&quot;Provision another object&quot;]
</code></pre><h1 id="view-details-2">View details</h1>
<p>The View details section displays the attributes that were modified in the target system. This display represents the final output of the provisioning service activity and the attributes that were exported. If this step fails, the attributes displayed represent the attributes that the provisioning service attempted to modify.</p>
<h1 id="troubleshooting-tips-4">Troubleshooting tips</h1>
<p>· Failures for exporting changes can vary greatly. Check the documentation for provisioning logs for common failures.</p>
<p>· On-demand provisioning says the group or user can&#39;t be provisioned because they&#39;re not assigned to the application. There&#39;s a replication delay of up to a few</p>
<p>minutes between when an object is assigned to an application and when that assignment is honored in on-demand provisioning. You may need to wait a few minutes and try again.</p>
<h1 id="frequently-asked-questions-2">Frequently asked questions</h1>
<ul>
<li>Do you need to turn provisioning off to use on-demand provisioning? For applications that use a long-lived bearer token or a user name and password for authorization, no more steps are required. Applications that use OAuth for authorization currently require the provisioning job to be stopped before using on-demand provisioning. Applications such as G Suite, Box, Workplace by Facebook, and Slack fall into this category. Work is in progress to support on-demand provisioning for all applications without having to stop provisioning jobs.</li>
<li>How long does on-demand provisioning take? On-demand provisioning typically takes less than 30 seconds.</li>
</ul>
<h1 id="known-limitations">Known limitations</h1>
<p>There are currently a few known limitations to on-demand provisioning. Post your suggestions and feedback so we can better determine what improvements to make next.</p>
<h3 id="note-1">Note</h3>
<p>The following limitations are specific to the on-demand provisioning capability. For information about whether an application supports provisioning groups, deletions, or other capabilities, check the tutorial for that application.</p>
<ul>
<li>On-demand provisioning of groups supports updating up to five members at a time. Connectors for cross-tenant synchronization, Workday, etc. do not support group provisioning and as a result do not support on-demand provisioning of groups.</li>
<li>On-demand provisioning supports provisioning one user at a time through the Microsoft Entra admin center.</li>
<li>Restoring a previously soft-deleted user in the target tenant with on-demand provisioning isn&#39;t supported. If you try to soft-delete a user with on-demand provisioning and then restore the user, it can result in duplicate users.</li>
<li>On-demand provisioning of roles isn&#39;t supported.</li>
</ul>
<p>· On-demand provisioning supports disabling users that have been unassigned from the application. However, it doesn&#39;t support disabling or deleting users that have been disabled or deleted from Microsoft Entra ID. Those users don&#39;t appear when you search for a user.</p>
<p>· On-demand provisioning doesn&#39;t support nested groups that aren&#39;t directly assigned to the application.</p>
<p>· The on-demand provisioning request API can only accept a single group with up to 5 members at a time.</p>
<h1 id="next-steps-13">Next steps</h1>
<p>· Troubleshooting provisioning</p>
<h1 id="feedback-2">Feedback</h1>
<p>Was this page helpful? Yes 5 No</p>
<p>Provide product feedback 4 | Get help at Microsoft Q&amp;A
❌ ❌ ✅ ❌ ❌</p>
<h1 id="what-are-the-microsoft-entra-user-provisioning-logs">What are the Microsoft Entra user provisioning logs?</h1>
<p>Article · 01/25/2024</p>
<p>Microsoft Entra ID integrates with several third party services to provision users into your tenant. If you need to troubleshoot an issue with a provisioned user, you can use the information captured in the Microsoft Entra provisioning logs to help find a solution.</p>
<p>Two other activity logs are also available to help monitor the health of your tenant:</p>
<ul>
<li>Sign-ins – Information about sign-ins and how your resources are used by your users.</li>
<li>Audit – Information about changes applied to your tenant such as users and group management or updates applied to your tenant’s resources.</li>
</ul>
<p>This article gives you an overview of the user provisioning logs.</p>
<h2 id="license-and-role-requirements">License and role requirements</h2>
<p>The required roles and licenses might vary based on the report. Global Administrator can access all reports, but we recommend using a role with least privilege access to align with the Zero Trust guidance.</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Log / Report</th>
<th>Roles</th>
<th>Licenses</th>
</tr>
</thead>
<tbody>
<tr>
<td>Audit</td>
<td>Report Reader</td>
<td>All editions of</td>
</tr>
<tr>
<td></td>
<td>Security Reader</td>
<td>Microsoft Entra ID</td>
</tr>
<tr>
<td></td>
<td>Security Administrator</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Global Reader</td>
<td></td>
</tr>
<tr>
<td></td>
<td>A custom role with AuditLogsRead or</td>
<td></td>
</tr>
<tr>
<td></td>
<td>CustomSecAuditLogsRead permission</td>
<td></td>
</tr>
<tr>
<td>Sign-ins</td>
<td>Report Reader</td>
<td>All editions of</td>
</tr>
<tr>
<td></td>
<td>Security Reader</td>
<td>Microsoft Entra ID</td>
</tr>
<tr>
<td></td>
<td>Security Administrator</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Global Reader</td>
<td></td>
</tr>
<tr>
<td></td>
<td>A custom role with SignInLogsRead permission</td>
<td></td>
</tr>
<tr>
<td>Provisioning</td>
<td>Same as audit and sign-ins, plus</td>
<td>Microsoft Entra ID</td>
</tr>
<tr>
<td></td>
<td>Security Operator</td>
<td>P1/P2</td>
</tr>
<tr>
<td></td>
<td>Application Administrator</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Cloud App Administrator</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Log / Report</th>
<th>Roles</th>
<th>Licenses</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>A custom role with ProvisioningLogsRead permission</td>
<td></td>
</tr>
<tr>
<td>Usage and insights</td>
<td>Security Reader</td>
<td>Microsoft Entra ID P1/P2</td>
</tr>
<tr>
<td></td>
<td>Reports Reader</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Security Administrator</td>
<td></td>
</tr>
<tr>
<td>Identity Protection*</td>
<td>Security Administrator</td>
<td>Microsoft Entra ID Free</td>
</tr>
<tr>
<td></td>
<td>Security Operator</td>
<td></td>
</tr>
<tr>
<td></td>
<td>Security Reader</td>
<td>Microsoft 365 Apps</td>
</tr>
<tr>
<td></td>
<td>Global Reader</td>
<td>Microsoft Entra ID</td>
</tr>
<tr>
<td></td>
<td>A custom role with IdentityRiskEventReadWrite</td>
<td>P1/P2</td>
</tr>
<tr>
<td></td>
<td>permission</td>
<td></td>
</tr>
<tr>
<td>Microsoft Graph activity logs</td>
<td>Security Administrator</td>
<td>Microsoft Entra ID</td>
</tr>
<tr>
<td></td>
<td>A custom role with ListKeys permission</td>
<td>P1/P2</td>
</tr>
</tbody>
</table>
<p>*The level of access and capabilities for Identity Protection varies with the role and license. For more information, see the license requirements for Identity Protection.</p>
<h1 id="what-can-you-do-with-the-provisioning-logs">What can you do with the provisioning logs?</h1>
<p>You can use the provisioning logs to find answers to questions like:</p>
<ul>
<li>What groups were successfully created in ServiceNow?</li>
<li>What users were successfully removed from Adobe?</li>
<li>What users from Workday were successfully created in Active Directory?</li>
</ul>
<p><strong>Note</strong></p>
<p>Entries in the provisioning logs are system generated and can&#39;t be changed or deleted.</p>
<h1 id="what-do-the-logs-show">What do the logs show?</h1>
<p>When you select an item in the provisioning list view, you get more details about this item, such as the steps taken to provision the user and tips for troubleshooting issues. The details are grouped into four tabs.</p>
<ul>
<li><strong>Steps:</strong> This tab outlines the steps taken to provision an object. Provisioning an object can include the following steps, but not all steps are applicable to all provisioning events.</li>
</ul>
<p>o Import the object.
o Match the object between source and target.
o Determine if the object is in scope.
o Evaluate the object before synchronization.
o Provision the object (create, update, delete, or disable).</p>
<ul>
<li>The figure shows a tabbed interface with four steps. The steps shown are:<ol>
<li>Import User from Azure Active Directory with a success status indicator.</li>
<li>Determine if User is in scope with a scope checked indicator.</li>
<li>Match User between Azure Active Directory and Box with a matched status indicator.</li>
<li>Provision User in Box with a &#39;X&#39; indicating an error in this step.</li>
</ol>
</li>
<li>Below the steps, a detailed entry in a table format with headers &quot;EntryExportAdd&quot; includes columns for Result, Description, and Reportable Identifier. The row indicates a successful result where a user &#39;cheryl@f128.info&#39; was created in Box, and the reportable identifier is &#39;cheryl@f128.info&#39;.</li>
</ul>
<pre><code class="lang-mermaid">graph TD;
    Import[&quot;1. Import User from Azure Active Directory ✓&quot;]
    Scope[&quot;2. Determine if User is in scope ✓&quot;]
    Match[&quot;3. Match User between Azure Active Directory and Box ✓&quot;]
    Provision[&quot;4. Provision User in Box ✕&quot;]

    Import --&gt; Scope --&gt; Match --&gt; Provision
</code></pre><p>Troubleshooting &amp; Recommendations: If there was an error, this tab provides the error code and reason.</p>
<p>Modified Properties: If there were changes, this tab shows the old value and the new value.</p>
<p>Summary: Provides an overview of what happened and identifiers for the object in the source and target systems.</p>
<h1 id="map-directory-extensions-in-cross-tenant-synchronization">Map directory extensions in cross-tenant synchronization</h1>
<p>Article · 01/30/2024</p>
<p>Directory extensions enable you to extend the schema in Microsoft Entra ID with your own attributes. You can map these directory extensions when provisioning users in cross-tenant synchronization. Custom security attributes are different and aren&#39;t supported in cross-tenant synchronization.</p>
<p>This article describes how to map directory extensions in cross-tenant synchronization.</p>
<h1 id="prerequisites-3">Prerequisites</h1>
<p>· Hybrid Identity Administrator role to configure cross-tenant synchronization.</p>
<p>· Cloud Application Administrator or Application Administrator role to assign users to a configuration and to delete a configuration.</p>
<h1 id="create-directory-extensions">Create directory extensions</h1>
<p>If you don&#39;t already have directory extensions, you must create one or more directory extensions in the source or target tenant. You can create extensions using Microsoft Entra Connect or Microsoft Graph API. For information on how to create directory extensions, see Syncing extension attributes for Microsoft Entra Application Provisioning.</p>
<h1 id="map-directory-extensions">Map directory extensions</h1>
<figure>
Figure: Illustration showing the process of mapping directory extensions between source and target tenants in a cross-tenant synchronization setup. The diagram likely represents a flowchart or sequence of actions to be taken for successful integration.
</figure>

<pre><code class="lang-mermaid">graph TD;
    SourceTenant[&quot;Source Tenant&quot;] --&gt;|Maps| DirectoryExtensions[&quot;Directory Extensions&quot;];
    DirectoryExtensions --&gt;|Integrate| TargetTenant[&quot;Target Tenant&quot;];
</code></pre><h2 id="source-tenant-3">Source tenant</h2>
<p>Once you have one or more directory extensions, you can use them when mapping attributes in cross-tenant synchronization.</p>
<ol>
<li>Sign in to the Microsoft Entra admin center of the source tenant.</li>
<li>Browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</li>
<li>Select Configurations and then select your configuration.</li>
<li>Select Provisioning and expand the Mappings section.</li>
</ol>
<h1 id="home--cross-tenant-synchronization--configurations--fabrikam-to-contoso-1">Home &gt; Cross-tenant synchronization | Configurations &gt; Fabrikam to Contoso</h1>
<h1 id="fabrikam-to-contoso--provisioning-1">Fabrikam to Contoso | Provisioning</h1>
<p>X
 ✅
Fabrikam - Microsoft Entra ID</p>
<p>«</p>
<p>Save ✅ Discard</p>
<p>1 Overview</p>
<p>V Admin Credentials</p>
<p>Provision on demand</p>
<p>Manage</p>
<p>1 Mappings</p>
<p>Users and groups</p>
<p>Provisioning</p>
<p>Expression builder</p>
<p>Mappings</p>
<p>Mappings allow you to define how data should flow between Microsoft Entra ID and Azure Active Directory (target tenant).</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Enabled</th>
</tr>
</thead>
<tbody>
<tr>
<td>Provision Microsoft Entra ID Users</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p> ❌
Restore default mappings</p>
<p>Provisioning logs</p>
<p>Insights</p>
<p>Troubleshooting + Support</p>
<p>v Settings</p>
<p>Activity - Audit logs</p>
<p>New support request</p>
<p>Provisioning Status
 ✅
+</p>
<p>On Off</p>
<ol>
<li>Select Provision Microsoft Entra ID Users to open the Attribute Mapping page.</li>
</ol>
<hr>
<p><strong>Figure Description:</strong> A screenshot of a provisioning interface under the section titled &quot;Attribute Mapping&quot;. It shows a table with various user attributes such as preferredLanguage, surname, telephoneNumber, userPrincipalName, showInAddressList, mail, and userType, each paired with a delete button and an option to add new mapping.</p>
<pre><code class="lang-mermaid">graph LR;
    Provision_Microsoft_Entra_ID_Users[(&quot;Provision Microsoft Entra ID Users&quot;)]
    Add_New_Mapping[&quot;Add New Mapping&quot;]
    Source_Attribute_Dropdown[&quot;Source Attribute Dropdown&quot;]
    Show_Advanced_Options[&quot;Show Advanced Options&quot;]

    Provision_Microsoft_Entra_ID_Users --&gt; Add_New_Mapping
    Add_New_Mapping --&gt; Source_Attribute_Dropdown
    Add_New_Mapping --&gt; Show_Advanced_Options
</code></pre><hr>
<ol>
<li><p>Scroll to the bottom of the page and select Add new mapping.</p>
</li>
<li><p>In the Source attribute drop-down list, select a source attribute.</p>
</li>
</ol>
<p>If you created a directory extension in the source tenant, select the directory extension.</p>
<table>
<thead>
<tr>
<th>preferredLanguage</th>
<th>preferredLanguage</th>
<th>Delete</th>
</tr>
</thead>
<tbody>
<tr>
<td>surname</td>
<td>surname</td>
<td>Delete</td>
</tr>
<tr>
<td>telephoneNumber</td>
<td>telephoneNumber</td>
<td>Delete</td>
</tr>
<tr>
<td>userPrincipalName</td>
<td>userPrincipalName</td>
<td>Delete</td>
</tr>
<tr>
<td>true</td>
<td>showInAddressList</td>
<td>Delete</td>
</tr>
<tr>
<td>mail</td>
<td>mail</td>
<td>Delete</td>
</tr>
<tr>
<td>Member</td>
<td>userType</td>
<td>Delete</td>
</tr>
</tbody>
</table>
<p> ✅ ❌ ❌</p>
<h1 id="edit-attribute-1">Edit Attribute</h1>
<p>A mapping lets you define how the attributes in one class of Microsoft Entra object (e.g. Users) should flow to and from this application.</p>
<p>Mapping type 0</p>
<p>Direct</p>
<p>V</p>
<p>X</p>
<p>Source attribute *</p>
<p>V</p>
<p>employeeHireDate</p>
<p>employeeld</p>
<p>employeeLeaveDateTime</p>
<p>employeeOrgData.costCenter</p>
<p>V</p>
<p>employeeOrgData.division</p>
<p>employeeType</p>
<p>V</p>
<p>testExtension (extension_c44d2adc1ddd43f29f29248e8de53937_testExtension)</p>
<p>extensionAttribute1</p>
<p>extensionAttribute10</p>
<p>+</p>
<p>If the directory extension isn&#39;t listed, make sure that the directory extension was created successfully. You can also try to manually add the directory extension to the attribute list as described in the next section.</p>
<ol>
<li>In the Target attribute drop-down list, select a target attribute.</li>
</ol>
<p>If you created a directory extension in the target tenant, select the directory extension.</p>
<ol>
<li>Select Ok to save the mapping.</li>
</ol>
<h1 id="manually-add-directory-extensions-to-the-attribute-list">Manually add directory extensions to the attribute list</h1>
<p>Figure: Screenshot showing part of the configuration interface in a software application. It includes drop-down menus for selecting source attributes with a focus on handling attributes such as employee hire date, ID, leave date and time, cost center, and division among others. There is also an option to add directory extensions manually if they are not automatically listed.</p>
<pre><code class="lang-mermaid">graph TD;
    SourceAttribute[&quot;Source Attribute Dropdown&quot;] --&gt; |Select| EmployeeHireDate
    EmployeeHireDate --&gt; EmployeeID
    EmployeeID --&gt; EmployeeLeaveDateTime
    EmployeeLeaveDateTime --&gt; EmployeeOrgData_CostCenter[&quot;EmployeeOrgData.costCenter&quot;]
    EmployeeOrgData_CostCenter --&gt; EmployeeOrgData_Division[&quot;EmployeeOrgData.division&quot;]
    EmployeeOrgData_Division --&gt; EmployeeType
    EmployeeType --&gt; TestExtension
    TestExtension --&gt; ExtensionAttribute1
    ExtensionAttribute1 --&gt; ExtensionAttribute10
    ExtensionAttribute10 --&gt; DirectoryExtensions[&quot;Manually Add Directory Extensions&quot;]
</code></pre><h2 id="source-tenant-4">Source tenant</h2>
<p>If your directory extension wasn&#39;t automatically discovered, you can try the following steps to manually add the directory extension to the attribute list.</p>
<ol>
<li>Sign in to the Microsoft Entra admin center of the source tenant using the following link:</li>
</ol>
<!-- Microsoft_AAD_Connect_Provisioning_forceSchemaEditorEnabled=true -->
<ol>
<li><p>Browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</p>
</li>
<li><p>Select Configurations and then select your configuration.</p>
</li>
<li><p>Select Provisioning and expand the Mappings section.</p>
</li>
<li><p>Select Provision Microsoft Entra ID Users to open the Attribute Mapping page.</p>
</li>
<li><p>Scroll to the bottom and select the Show advanced settings check box.</p>
</li>
</ol>
<p>Home &gt; Cross-tenant synchronization | Configurations &gt; Fabrikam to Contoso | Provisioning &gt;</p>
<h1 id="attribute-mapping">Attribute Mapping</h1>
<table>
<thead>
<tr>
<th>userPrincipalName</th>
<th>userPrincipalName</th>
<th>Delete</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>true</td>
<td>showInAddressList</td>
<td>Delete</td>
<td></td>
</tr>
<tr>
<td>mail</td>
<td>mail</td>
<td>Delete</td>
<td></td>
</tr>
<tr>
<td>Member</td>
<td>userType</td>
<td>Delete</td>
<td></td>
</tr>
</tbody>
</table>
<p>Add New Mapping</p>
<p>Figure: Screenshot showing the &quot;Show advanced settings&quot; checkbox located below the attribute mapping table in the Microsoft Entra configuration page. Additionally, the focus is on an interface with &#39;Save&#39; and &#39;Discard&#39; buttons, emphasizing functionality allowing users to apply or discard changes to attribute mappings.</p>
<p>Supported Attributes</p>
<p>View and edit the list of attributes that appear in the source and target attribute lists for this application.</p>
<p>Edit attribute list for Microsoft Entra ID</p>
<p>Edit attribute list for Azure Active Directory (target tenant)</p>
<p>Use the expression builder</p>
<p>Figure: Schematic illustration or flowchart that demonstrates the process of reviewing, downloading, and editing the JSON representation of a schema using an option from the user interface provided in the Entra admin center. The focus of this figure is likely on the interaction between the user and the software via relevant interface elements.</p>
<p>In addition to configuring your attribute mappings through the user interface, you can review, download, and edit the JSON representation of your schema. Review your schema here.</p>
<p>Tip</p>
<p>If you don&#39;t see the Edit attribute list links, be sure that you are signed in to the Microsoft Entra admin center using the link in Step 1.</p>
<ol>
<li><p>If you created a directory extension in the source tenant, select the Edit attribute list for Microsoft Entra ID link.</p>
</li>
<li><p>If you created an extension in the target tenant, select the Edit attribute list for Azure Active Directory (target tenant) link.</p>
</li>
<li><p>Add the directory extension and select the appropriate options.</p>
</li>
</ol>
<p>Save ✅ Discard ❌ ❌</p>
<figure>
    The image shows a software interface for attribute mapping in a provisioning system titled &quot;Fabrikam to Contoso | Provisioning &gt; Attribute Mapping &gt; Edit Attribute List&quot;. It features a modal dialog box with a list of attribute names and their corresponding types (like &#39;String&#39; or &#39;Boolean&#39;), with checkboxes next to them indicating different settings. Below the list is a dropdown that is currently selecting a String attribute with some identifier, and another dropdown is blank. There are tips provided on the side which emphasize the functionality of the attribute list editor mentioning to leave some fields blank depending on the attribute type or new addition. There&#39;s also an option to save or discard changes at the top of the dialog box.
</figure>

<table>
<thead>
<tr>
<th>alternativeSecuritylds</th>
<th>String</th>
<th></th>
<th>❌</th>
<th>❌</th>
<th>✅</th>
</tr>
</thead>
<tbody>
<tr>
<td>showInAddressList</td>
<td>Boolean</td>
<td></td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>mail</td>
<td>String</td>
<td></td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>userState</td>
<td>String</td>
<td></td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>userType</td>
<td>String</td>
<td></td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>extension_c44d2adc1ddd4</td>
<td>String</td>
<td>V</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td></td>
<td>String</td>
<td>1</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
</tbody>
</table>
<ol>
<li><p>Select Save.</p>
</li>
<li><p>Refresh the browser.</p>
</li>
<li><p>Browse to the Attribute mappings page and try to map the directory extension as described earlier in this article.</p>
</li>
</ol>
<p>Manually add directory extensions by editing the schema</p>
<p>Source tenant</p>
<p>Follow these steps to manually add directory extensions to the schema by using the schema editor.</p>
<ol>
<li><p>Sign in to the Microsoft Entra admin center of the source tenant.</p>
</li>
<li><p>Browse to Identity &gt; External Identities &gt; Cross-tenant synchronization.</p>
</li>
<li><p>Select Configurations and then select your configuration.</p>
</li>
<li><p>Select Provisioning and expand the Mappings section.</p>
</li>
<li><p>Select Provision Microsoft Entra ID Users to open the Attribute Mapping page.</p>
</li>
</ol>
<h1 id="6-scroll-to-the-bottom-and-select-the-show-advanced-settings-check-box">6. Scroll to the bottom and select the Show advanced settings check box.</h1>
<p>Home &gt; Cross-tenant synchronization | Configurations &gt; Fabrikam to Contoso | Provisioning &gt; Attribute Mapping
 ✅
X</p>
<p>Save ✅ Discard</p>
<table>
<thead>
<tr>
<th>userPrincipalName</th>
<th>userPrincipalName</th>
<th>Delete</th>
</tr>
</thead>
<tbody>
<tr>
<td>true</td>
<td>showInAddressList</td>
<td>Delete</td>
</tr>
<tr>
<td>mail</td>
<td>mail</td>
<td>Delete</td>
</tr>
<tr>
<td>Member</td>
<td>userType</td>
<td>Delete</td>
</tr>
</tbody>
</table>
<p>Add New Mapping
 ✅</p>
<figure>

The first figure shows the &quot;Attribute Mapping&quot; interface with various attributes listed such as userPrincipalName, mail, and userType. Each attribute has a corresponding action button for deletion. Notably, there is a button highlighted for &quot;Show advanced options&quot; within the user interface.

<code>mermaid
graph TD;
    AttributeScreen[&quot;Attribute Mapping Screen&quot;] --&gt;|Highlights| ShowAdvancedOptionsButton[&quot;Show advanced options button&quot;]</code>

</figure>


<p>Supported Attributes</p>
<p>View and edit the list of attributes that appear in the source and target attribute lists for this application.</p>
<p>Edit attribute list for Microsoft Entra ID</p>
<p>Edit attribute list for Azure Active Directory (target tenant)</p>
<p>Use the expression builder</p>
<p>+</p>
<p>In addition to configuring your attribute mappings through the user interface, you can review, download, and edit the JSON representation of your schema. Review your schema here.</p>
<h1 id="7-select-the-review-your-schema-here-link-to-open-the-schema-editor-page">7. Select the Review your schema here link to open the Schema editor page.</h1>
<p>... Fabrikam to Contoso | Provisioning Attribute Mapping &gt;</p>
<p>Schema editor</p>
<p>>
 ✅
The schema below is a JSON representation of your provisioning configuration. You can use it to define what objects you want to provision, map objects between your source and target system, and specify who should be provisioned. We recommend making these changes directly through our configuration experience. The schema below is only used for saving your configuration and making changes in it.</p>
<p>We recommend downloading and saving the current configuration prior to making changes. A backup copy can be used to roll back to a known good state.</p>
<table>
<thead>
<tr>
<th>×</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
<tr>
<td>-</td>
</tr>
<tr>
<td>2</td>
</tr>
<tr>
<td>3</td>
</tr>
<tr>
<td>4</td>
</tr>
<tr>
<td>5</td>
</tr>
<tr>
<td>6</td>
</tr>
<tr>
<td>7</td>
</tr>
<tr>
<td>8</td>
</tr>
<tr>
<td>9</td>
</tr>
<tr>
<td>10</td>
</tr>
<tr>
<td>11</td>
</tr>
<tr>
<td>12</td>
</tr>
<tr>
<td>13</td>
</tr>
</tbody>
</table>
<figure>

The second figure displays the &quot;Schema Editor&quot; page with the JSON schema visible including various attributes such as &quot;id&quot;, &quot;version&quot;, and detailed synchronization rules. The interface also features options to save, discard, or download the schema.

<code>mermaid
graph TD;
    SchemaView[&quot;Schema Editor View&quot;] --&gt;|Contains| JsonSchema[&quot;JSON Schema Details&quot;]
    JsonSchema --&gt;|Includes| SyncRules[&quot;Synchronization Rules&quot;]
    SchemaView --&gt;|Action Options| SaveOption[&quot;Save&quot;]
    SchemaView --&gt;|Action Options| DiscardOption[&quot;Discard&quot;]
    SchemaView --&gt;|Action Options| DownloadOption[&quot;Download&quot;]</code>

</figure>


<p>8. Download an original copy of the schema as a backup.</p>
<p>9. Modify the schema following your required configuration.</p>
<p>10. Select Save.</p>
<ol>
<li><p>Refresh the browser.</p>
</li>
<li><p>Browse to the Attribute mappings page and try to map the directory extension as described earlier in this article.</p>
</li>
</ol>
<h1 id="next-steps-14">Next steps</h1>
<ul>
<li>Syncing extension attributes for Microsoft Entra Application Provisioning</li>
<li>Configure cross-tenant synchronization</li>
</ul>
<h1 id="reference-for-writing-expressions-for-attribute-mappings-in-microsoft-entra-id">Reference for writing expressions for attribute mappings in Microsoft Entra ID</h1>
<p>Article · 01/26/2024</p>
<p>When you configure provisioning to a SaaS application, one of the types of attribute mappings that you can specify is an expression mapping. For these mappings, you must write a script-like expression that allows you to transform your users&#39; data into formats that are more acceptable for the SaaS application.</p>
<h1 id="syntax-overview">Syntax overview</h1>
<p>The syntax for Expressions for Attribute Mappings is reminiscent of Visual Basic for Applications (VBA) functions.</p>
<ul>
<li>The entire expression must be defined in terms of functions, which consist of a name followed by arguments in parentheses: FunctionName(&lt;&lt;argument 1&gt;&gt;, &lt;<argument n="">&gt;)</argument></li>
<li>You can nest functions within each other. For example: FunctionOne(FunctionTwo(&lt;<argument1>&gt;))</argument1></li>
<li><p>You can pass three different types of arguments into functions:</p>
<ol>
<li>Attributes, which must be enclosed in square brackets. For example: [attributeName]</li>
<li>String constants, which must be enclosed in double quotes. For example: &quot;United States&quot;</li>
<li>Other Functions. For example: FunctionOne(&lt;<argument1>&gt;, FunctionTwo(&lt;<argument2>&gt;))</argument2></argument1></li>
</ol>
</li>
<li><p>For string constants, if you need a backslash () or quotation mark (&quot;) in the string, it must be escaped with the backslash () symbol. For example: &quot;Company name: &quot;Contoso&quot;&quot;</p>
</li>
<li>The syntax is case-sensitive, which must be considered while typing them as strings in a function vs copy pasting them directly from here.</li>
</ul>
<p>List of Functions</p>
<p>Append AppRoleAssignmentsComplex BitAnd CBool CDate Coalesce ConvertToBase64 ConvertToUTF8Hex Count CStr DateAdd DateDiff DateFromNum FormatDateTime Guid IgnoreFlowlfNullOrEmpty IIF InStr IsNull IsNullOrEmpty IsPresent IsString Item Join Left Mid NormalizeDiacritics Not Now NumFromDate PCase RandomString Redact RemoveDuplicates Replace SelectUnique Value SingleAppRoleAssignment Split StripSpaces Switch ToLower ToUpper Word</p>
<h1 id="append">Append</h1>
<p>Function: Append(source, suffix)</p>
<p>Description: Takes a source string value and appends the suffix to the end of it.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>suffix</td>
<td>Required</td>
<td>String</td>
<td>The string that you want to append to the end of the source value.</td>
</tr>
</tbody>
</table>
<p>Append constant suffix to user name</p>
<p>Example: If you&#39;re using a Salesforce Sandbox, you might need to append another suffix to all your user names before synchronizing them.</p>
<p>Expression: Append ([userPrincipalName], &quot;.test&quot;)</p>
<p>Sample input/output:</p>
<ul>
<li>INPUT: (userPrincipalName): &quot;John.Doe@contoso.com&quot;</li>
<li>OUTPUT: &quot;John.Doe@contoso.com.test&quot;</li>
</ul>
<p>AppRoleAssignmentsComplex</p>
<p>Function: AppRoleAssignmentsComplex([appRoleAssignments])</p>
<p>Description: Used to configure multiple roles for a user. For detailed usage, see Tutorial - Customize user provisioning attribute-mappings for SaaS applications in Microsoft Entra ID.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>appRoleAssignments</td>
<td>Required</td>
<td>String</td>
<td>appRoleAssignments object.</td>
</tr>
</tbody>
</table>
<p>BitAnd</p>
<p>Function: BitAnd(value1, value2)</p>
<p>Description: This function converts both parameters to the binary representation and sets a bit to:</p>
<ul>
<li>0 - if one or both of the corresponding bits in value1 and value2 are 0</li>
<li>1 - if both of the corresponding bits are 1.</li>
</ul>
<p>In other words, it returns 0 in all cases except when the corresponding bits of both parameters are 1.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value1</td>
<td>Required</td>
<td>Num</td>
<td>Numeric value that should be AND&#39;ed with value2</td>
</tr>
<tr>
<td>value2</td>
<td>Required</td>
<td>Num</td>
<td>Numeric value that should be AND&#39;ed with value1</td>
</tr>
</tbody>
</table>
<p>Example: BitAnd (&amp;HF, &amp;HF7)</p>
<p>11110111 AND 00000111 = 00000111 so BitAnd returns 7, the binary value of 00000111.</p>
<p>CBool</p>
<p>Function: CBool(Expression)</p>
<p>Description: CBool returns a boolean based on the evaluated expression. If the expression evaluates to a non-zero value, then CBool returns True, else it returns False.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>expression</td>
<td>Any valid expression</td>
</tr>
</tbody>
</table>
<p>Example: CBool([attribute1] = [attribute2])</p>
<p>Returns True if both attributes have the same value.</p>
<p>CDate</p>
<p>Function:</p>
<p>CDate(expression)</p>
<p>Description: The CDate function returns a UTC DateTime from a string. DateTime isn&#39;t a native attribute type but it can be used within date functions such as FormatDateTime and DateAdd.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Any valid string that represents a date/time. For supported formats, refer to .NET custom date and time format strings.</td>
</tr>
</tbody>
</table>
<p>Remarks: The returned string is always in UTC and follows the format M/d/yyyy h:mm:ss tt.</p>
<p>Example 1: CDate([StatusHireDate]) Sample input/output:</p>
<ul>
<li>INPUT (StatusHireDate): &quot;2020-03-16-07:00&quot;</li>
</ul>
<p>· OUTPUT: &quot;3/16/2020 7:00:00 AM&quot; &lt;-- Note the UTC equivalent of the above DateTime is returned</p>
<p>Example 2: CDate(&quot;2021-06-30+08:00&quot;)</p>
<p>Sample input/output:</p>
<p>· INPUT: &quot;2021-06-30+08:00&quot;</p>
<p>· OUTPUT: &quot;6/29/2021 4:00:00 PM&quot; &lt;-- Note the UTC equivalent of the above DateTime is returned</p>
<p>Example 3:</p>
<p>CDate(&quot;2009-06-15T01:45:30-07:00&quot;)</p>
<p>Sample input/output:</p>
<p>· INPUT: &quot;2009-06-15T01:45:30-07:00&quot;</p>
<p>· OUTPUT: &quot;6/15/2009 8:45:30 AM&quot; &lt;-- Note the UTC equivalent of the above DateTime is returned</p>
<h1 id="coalesce">Coalesce</h1>
<p>Function: Coalesce(source1, source2, ... , defaultValue)</p>
<p>Description: Returns the first source value that isn&#39;t NULL. If all arguments are NULL and defaultValue is present, the defaultValue is returned. If all arguments are NULL and defaultValue isn&#39;t present, Coalesce returns NULL.</p>
<p>Parameters:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source1 ... sourceN</td>
<td>Required</td>
<td>String</td>
<td>Required, variable-number of times. Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>defaultValue</td>
<td>Optional</td>
<td>String</td>
<td>Default value to be used when all source values are NULL. Can be empty string (&quot;&quot;).</td>
</tr>
</tbody>
</table>
<p>Flow mail value if not NULL, otherwise flow userPrincipalName</p>
<p>Example: You wish to flow the mail attribute if it is present. If it isn&#39;t, you wish to flow the value of userPrincipalName instead.</p>
<p>Expression: Coalesce([mail], [userPrincipalName])</p>
<p>Sample input/output:</p>
<p>. INPUT (mail): NULL</p>
<p>. INPUT (userPrincipalName): &quot;John.Doe@contoso.com&quot;</p>
<p>. OUTPUT: &quot;John.Doe@contoso.com&quot;</p>
<h1 id="converttobase64">ConvertToBase64</h1>
<p>Function: ConvertToBase64(source)</p>
<p>Description: The ConvertToBase64 function converts a string to a Unicode base64 string. Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>String to be converted to base 64</td>
</tr>
</tbody>
</table>
<p>Example: ConvertToBase64(&quot;Hello world!&quot;)</p>
<p>Returns &quot;SABIAGwAbABvACAAdwBvAHIAbABkACEA&quot;</p>
<h1 id="converttoutf8hex">ConvertToUTF8Hex</h1>
<p>Function: ConvertToUTF8Hex(source)</p>
<p>Description: The ConvertToUTF8Hex function converts a string to a UTF8 Hex encoded value.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>String to be converted to UTF8 Hex</td>
</tr>
</tbody>
</table>
<p>Example: ConvertToUTF8Hex(&quot;Hello world!&quot;)</p>
<p>Returns 48656C6C6F20776F726C6421</p>
<h1 id="count">Count</h1>
<p>Function: Count(attribute)</p>
<p>Description: The Count function returns the number of elements in a multi-valued attribute</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute</td>
<td>Required</td>
<td>attribute</td>
<td>Multi-valued attribute that will have elements counted</td>
</tr>
</tbody>
</table>
<p>CStr</p>
<p>Function: CStr(value) Description: The CStr function converts a value to a string data type.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Required</td>
<td>numeric, reference, or boolean</td>
<td>Can be a numeric value, reference attribute, or Boolean.</td>
</tr>
</tbody>
</table>
<p>Example: CStr([dn])</p>
<p>Returns &quot;cn=Joe,dc=contoso,dc=com&quot;</p>
<p>DateAdd</p>
<p>Function:
DateAdd(interval, value, dateTime)</p>
<p>Description:
Returns a date/time string representing a date to which a specified time interval has been added. The returned date is in the format: M/d/yyyy h:mm:ss tt.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>interval</td>
<td>Required</td>
<td>String</td>
<td>Interval of time you want to add. See accepted values below.</td>
</tr>
<tr>
<td>value</td>
<td>Required</td>
<td>Number</td>
<td>The number of units you want to add. Can be positive or negative.</td>
</tr>
<tr>
<td>dateTime</td>
<td>Required</td>
<td>DateTime</td>
<td>DateTime representing date to which the interval is added.</td>
</tr>
</tbody>
</table>
<p>When passing a date string as input, use CDate function to wrap the datetime string. To get system time in UTC, use the Now function.</p>
<p>The interval string must have one of the following values:</p>
<ul>
<li>yyyy Year</li>
<li>m Month</li>
<li>d Day</li>
<li>ww Week</li>
<li>h Hour</li>
<li>n Minute</li>
<li>s Second</li>
</ul>
<p>Example 1: Generate a date value based on incoming StatusHireDate from Workday
DateAdd(&quot;d&quot;, 7, CDate([StatusHireDate]))</p>
<table>
<thead>
<tr>
<th>Example</th>
<th></th>
<th>interval value</th>
<th>dateTime (value of variable StatusHireDate)</th>
<th>output</th>
</tr>
</thead>
<tbody>
<tr>
<td>Add 7 days to hire date</td>
<td>&quot;d&quot;</td>
<td>7</td>
<td>2012-03-16-07:00</td>
<td>3/23/2012</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>7:00:00 AM</td>
</tr>
<tr>
<td>Get a date ten days</td>
<td>&quot;d&quot;</td>
<td>-10</td>
<td>2012-03-16-07:00</td>
<td>3/6/2012</td>
</tr>
<tr>
<td>prior to hire date</td>
<td></td>
<td></td>
<td></td>
<td>7:00:00 AM</td>
</tr>
<tr>
<td>Add two weeks to hire</td>
<td>&quot;ʹww&quot;</td>
<td>2</td>
<td>2012-03-16-07:00</td>
<td>3/30/2012</td>
</tr>
<tr>
<td>date</td>
<td></td>
<td></td>
<td></td>
<td>7:00:00 AM</td>
</tr>
<tr>
<td>Add ten months to hire</td>
<td>&quot;m&quot;</td>
<td>10</td>
<td>2012-03-16-07:00</td>
<td>1/16/2013</td>
</tr>
<tr>
<td>date</td>
<td></td>
<td></td>
<td></td>
<td>7:00:00 AM</td>
</tr>
<tr>
<td>Add two years to hire</td>
<td>&quot;yyyy&quot;</td>
<td>2</td>
<td>2012-03-16-07:00</td>
<td>3/16/2014</td>
</tr>
<tr>
<td>date</td>
<td></td>
<td></td>
<td></td>
<td>7:00:00 AM</td>
</tr>
</tbody>
</table>
<h1 id="datediff">DateDiff</h1>
<p>Function:</p>
<p>DateDiff(interval, date1, date2)</p>
<p>Description:</p>
<p>This function uses the interval parameter to return a number that indicates the difference between the two input dates. It returns</p>
<p>· a positive number if date2 &gt; date1,</p>
<p>· a negative number if date2 &lt; date1,</p>
<p>· 0 if date2 == date1</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Optional</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>interval</td>
<td>Required</td>
<td>String</td>
<td>Interval of time to use for calculating the difference.</td>
</tr>
<tr>
<td>date1</td>
<td>Required</td>
<td>DateTime</td>
<td>DateTime representing a valid date.</td>
</tr>
<tr>
<td>date2</td>
<td>Required</td>
<td></td>
<td>DateTime DateTime representing a valid date.</td>
</tr>
</tbody>
</table>
<p>When passing a date string as input, use CDate function to wrap the datetime string. To get system time in UTC, use the Now function.</p>
<p>The interval string must have one of the following values:</p>
<p>· yyyy Year</p>
<p>· m Month</p>
<p>· d Day</p>
<p>· ww Week</p>
<p>· h Hour</p>
<p>· n Minute</p>
<p>· s Second</p>
<p>Example 1: Compare current date with hire date from Workday with different intervals DateDiff(&quot;d&quot;, Now(), CDate([StatusHireDate]))</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Example</th>
<th>interval</th>
<th>date1</th>
<th>date2</th>
<th>output</th>
</tr>
</thead>
<tbody>
<tr>
<td>Positive difference in days between two dates</td>
<td>d</td>
<td>2021-08-18+08:00</td>
<td>2021-08-31+08:00</td>
<td>13</td>
</tr>
<tr>
<td>Negative difference in days between two dates</td>
<td>d</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16-07:00</td>
<td>-3449</td>
</tr>
<tr>
<td>Difference in weeks between two dates</td>
<td>ww</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16- 07:00</td>
<td>-493</td>
</tr>
<tr>
<td>Difference in months between two dates</td>
<td>m</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16- 07:00</td>
<td>-113</td>
</tr>
<tr>
<td>Difference in years between two dates</td>
<td>yyyy</td>
<td>8/25/2021 5:41:18 PM</td>
<td>2012-03-16- 07:00</td>
<td>-9</td>
</tr>
<tr>
<td>Difference when both dates are same</td>
<td>d</td>
<td>2021-08-31+08:00</td>
<td>2021-08-31+08:00</td>
<td>0</td>
</tr>
<tr>
<td>Difference in hours between two dates</td>
<td>h</td>
<td>2021-08-24</td>
<td>2021-08-25</td>
<td>24</td>
</tr>
<tr>
<td>Difference in minutes between two dates</td>
<td>n</td>
<td>2021-08-24</td>
<td>2021-08-25</td>
<td>1440</td>
</tr>
<tr>
<td>Difference in seconds between two dates</td>
<td>s</td>
<td>2021-08-24</td>
<td>2021-08-25</td>
<td>86400</td>
</tr>
</tbody>
</table>
<p>Example 2: Combine DateDiff with IIF function to set attribute value
If an account is Active in Workday, set the accountEnabled attribute of the user to True only if hire date is within the next five days.</p>
<p>Switch([Active], , &quot;1&quot;, IIF(DateDiff(&quot;d&quot;, Now(), CDate([StatusHireDate])) &gt; 5, &quot;False&quot;, &quot;True&quot;), &quot;0&quot;, &quot;False&quot;)</p>
<h1 id="datefromnum">DateFromNum</h1>
<p>Function: DateFromNum(value)<br>Description: The DateFromNum function converts a value in AD&#39;s date format to a DateTime type.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Required</td>
<td>Date</td>
<td>AD Date to be converted to DateTime type</td>
</tr>
</tbody>
</table>
<p>Example: DateFromNum([lastLogonTimestamp])</p>
<p>DateFromNum(129699324000000000)</p>
<p>Returns a DateTime representing January 1, 2012 at 11:00PM.</p>
<h1 id="formatdatetime">FormatDateTime</h1>
<p>Function: FormatDateTime(source, dateTimeStyles, inputFormat, outputFormat)<br>Description: Takes a date string from one format and converts it into a different format. Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>dateTimeStyles</td>
<td>Optional</td>
<td>String</td>
<td>Use this parameter to specify the formatting options that customize string parsing for some date and time parsing methods. For supported values, see DateTimeStyles doc. If left empty, the default value used is</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>inputFormat</td>
<td>Required</td>
<td>String</td>
<td>Expected format of the source value. For supported formats, see .NET custom date and time format strings.</td>
</tr>
<tr>
<td>outputFormat</td>
<td>Required</td>
<td>String</td>
<td>Format of the output date.</td>
</tr>
</tbody>
</table>
<h1 id="output-date-as-a-string-in-a-certain-format">Output date as a string in a certain format</h1>
<p>Example: You want to send dates to a SaaS application like ServiceNow in a certain format. You can consider using the following expression.</p>
<p>Expression:</p>
<p>FormatDateTime([extensionAttribute1], &quot;yyyyMMddHHmmss.fZ&quot;, &quot;yyyy-MM-dd&quot;)</p>
<p>Sample input/output:</p>
<p>· INPUT (extensionAttribute1): &quot;20150123105347.1Z&quot;</p>
<p>· OUTPUT: &quot;2015-01-23&quot;</p>
<h1 id="guid">Guid</h1>
<p>Function: Guid()</p>
<p>Description: The function Guid generates a new random GUID</p>
<p>Example:</p>
<p>Guid()</p>
<p>Sample output: &quot;1088051a-cd4b-4288-84f8-e02042ca72bc&quot;</p>
<h1 id="ignoreflowlfnullorempty">IgnoreFlowlfNullOrEmpty</h1>
<p>Function: IgnoreFlowlfNullOrEmpty(expression)</p>
<p>Description: The IgnoreFlowlfNullOrEmpty function instructs the provisioning service to ignore the attribute and drop it from the flow if the enclosed function or attribute is NULL or empty.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<p>Example 1: Don&#39;t flow an attribute if it is null
IgnoreFlowIfNullOrEmpty([department])
The above expression will drop the department attribute from the provisioning flow if it is null or empty.</p>
<p>Example 2: Don&#39;t flow an attribute if the expression mapping evaluates to empty string or null
Let&#39;s say the SuccessFactors attribute prefix is mapped to the on-premises Active Directory attribute personalTitle using the following expression mapping:
IgnoreFlowIfNullOrEmpty(Switch([prefix], &quot;&quot;, &quot;3443&quot;, &quot;Dr. &quot;, &quot;3444&quot;, &quot;Prof.&quot;, &quot;3445&quot;, &quot;Prof. Dr.&quot;))
The above expression first evaluates the Switch function. If the prefix attribute doesn&#39;t have any of the values listed within the Switch function, then Switch will return an empty string and the attribute personalTitle will not be included in the provisioning flow to on-premises Active Directory.</p>
<p>IIF</p>
<p>Function: IIF(condition,valuelfTrue,valuelfFalse)
Description: The IIF function returns one of a set of possible values based on a specified condition.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>condition</td>
<td>Required</td>
<td>Variable or Expression</td>
<td>Any value or expression that can be evaluated to true or false.</td>
</tr>
<tr>
<td>valuelfTrue</td>
<td>Required</td>
<td>Variable or String</td>
<td>If the condition evaluates to true, the returned value.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>valuelfFalse</td>
<td>Required</td>
<td>Variable or String</td>
<td>If the condition evaluates to false, the returned value.</td>
</tr>
</tbody>
</table>
<p>The following comparison operators can be used in the condition:</p>
<p>· Equal to (=) and not equal to (&lt;&gt;)</p>
<p>· Greater than (&gt;) and greater than equal to (&gt;=)</p>
<p>· Less than (&lt;) and less than equal to ( &lt;= )</p>
<p>Example: Set the target attribute value to source country attribute if country=&quot;USA&quot;, else set target attribute value to source department attribute. IIF([country]=&quot;USA&quot;, [ country], [department])</p>
<h1 id="known-limitations-1">Known limitations</h1>
<p>This section includes limitations and workarounds for the IIF function. For information about troubleshooting user creation issues, see Creation fails due to null / empty values.</p>
<p>. The IIF function currently doesn&#39;t support AND and OR logical operators.</p>
<p>. To implement AND logic, use nested IIF statement chained along the trueValue path. Example: If country=&quot;USA&quot; and state=&quot;CA&quot;, return value &quot;True&quot;, else return &quot;False&quot;. IIF([country]=&quot;USA&quot;, IIF([state]=&quot;CA&quot;,&quot;True&quot;, &quot;False&quot;), &quot;False&quot;)</p>
<p>· To implement OR logic, use nested IIF statement chained along the falseValue path. Example: If country=&quot;USA&quot; or state=&quot;CA&quot;, return value &quot;True&quot;, else return &quot;False&quot;. IIF([country]=&quot;USA&quot;, &quot;True&quot;, IIF([state]=&quot;CA&quot;,&quot;True&quot;, &quot;False&quot;))</p>
<p>. If the source attribute used within the IIF function is empty or null, the condition check fails.</p>
<p>o Unsupported IIF expression examples:
o IIF ([country]=&quot;&quot;, &quot;Other&quot;, [country])
o IIF (IsNullOrEmpty([country]), &quot;Other&quot;, [country])
o IIF (IsPresent([country]), [country], &quot;Other&quot;)</p>
<p>o Recommended workaround: Use the Switch function to check for empty/null values. Example: If country attribute is empty, set value &quot;Other&quot;. If it is present, pass the country attribute value to target attribute.</p>
<p>o Switch([country], [country], &quot;&quot;, &quot;Other&quot;)</p>
<p>Function: InStr(value1, value2, start, compareType)</p>
<p>Description: The InStr function finds the first occurrence of a substring in a string </p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value1</td>
<td>Required</td>
<td>String</td>
<td>String to be searched</td>
</tr>
<tr>
<td>value2</td>
<td>Required</td>
<td>String</td>
<td>String to be found</td>
</tr>
<tr>
<td>start</td>
<td>Optional</td>
<td>Integer</td>
<td>Starting position to find the substring</td>
</tr>
<tr>
<td>compareType</td>
<td>Optional</td>
<td>Enum</td>
<td>Can be vbTextCompare or vbBinaryCompare</td>
</tr>
</tbody>
</table>
<p>Example: InStr(&quot;The quick brown fox&quot;, &quot;quick&quot;)</p>
<p>Evaluates to 5</p>
<p>InStr(&quot;repEated&quot;, &quot;e&quot;, 3, vbBinaryCompare)</p>
<p>Evaluates to 7</p>
<p>IsNull</p>
<p>Function: IsNull(Expression)</p>
<p>Description: If the expression evaluates to Null, then the IsNull function returns true. For an attribute, a Null is expressed by the absence of the attribute.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<p>Example: IsNull([displayName])</p>
<p>Returns True if the attribute isn&#39;t present.</p>
<p>IsNullorEmpty</p>
<p>Function: IsNullOrEmpty(Expression)</p>
<p>Description: If the expression is null or an empty string, then the IsNullOrEmpty function returns true. For an attribute, this would evaluate to True if the attribute is absent or is present but is an empty string. The inverse of this function is named IsPresent.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<p>Example: IsNullOrEmpty([displayName])</p>
<p>Returns True if the attribute isn&#39;t present or is an empty string.</p>
<h1 id="ispresent">IsPresent</h1>
<p>Function: IsPresent(Expression)</p>
<p>Description: If the expression evaluates to a string that isn&#39;t Null and isn&#39;t empty, then the IsPresent function returns true. The inverse of this function is named IsNullOrEmpty.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<p>Example: Switch(IsPresent([directManager]), [directManager],
IsPresent([skiplevelManager]), [skiplevelManager], IsPresent([director]), [director])</p>
<h2 id="isstring">IsString</h2>
<p>Function: IsString(Expression)</p>
<p>Description: If the expression can be evaluated to a string type, then the IsString function evaluates to True. </p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Expression</td>
<td>Required</td>
<td>Expression</td>
<td>Expression to be evaluated</td>
</tr>
</tbody>
</table>
<h1 id="item">Item</h1>
<p>Function: Item(attribute, index)</p>
<p>Description: The Item function returns one item from a multi-valued string/attribute. Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute</td>
<td>Required</td>
<td>Attribute</td>
<td>Multi-valued attribute to be searched</td>
</tr>
<tr>
<td>index</td>
<td>Required</td>
<td>Integer</td>
<td>Index to an item in the multi-valued string</td>
</tr>
</tbody>
</table>
<p>Example: Item([proxyAddresses], 1) returns the first item in the multi-valued attribute. Index 0 shouldn&#39;t be used.</p>
<h1 id="join">Join</h1>
<p>Function: Join(separator, source1, source2, ... )</p>
<p>Description: Join() is similar to Append(), except that it can combine multiple source string values into a single string, and each value will be separated by a separator string.</p>
<p>If one of the source values is a multi-value attribute, then every value in that attribute will be joined together, separated by the separator value.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>separator</td>
<td>Required</td>
<td>String</td>
<td>String used to separate source values when they are concatenated into one string. Can be &quot;&quot; if no separator is required.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source1 ... sourceN</td>
<td>Required, variable- number of times</td>
<td>String</td>
<td>String values to be joined together.</td>
</tr>
</tbody>
</table>
<h1 id="left">Left</h1>
<p>Function: Left(String, NumChars)</p>
<p>Description: The Left function returns a specified number of characters from the left of a string. If NumChars = 0, return empty string. If NumChars &lt; 0, return input string. If string is null, return empty string. If string contains fewer characters than the number specified in NumChars, a string identical to string (that is, containing all characters in parameter 1) is returned.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>Required</td>
<td></td>
<td>Attribute The string to return characters from</td>
</tr>
<tr>
<td>NumChars</td>
<td>Required</td>
<td>Integer</td>
<td>A number identifying the number of characters to return from the beginning (left) of string</td>
</tr>
</tbody>
</table>
<p>Example: Left(&quot;John Doe&quot;, 3)</p>
<p>Returns &quot;Joh&quot;.</p>
<h1 id="mid">Mid</h1>
<p>Function: Mid(source, start, length)</p>
<p>Description: Returns a substring of the source value. A substring is a string that contains only some of the characters from the source string.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>The string from which characters are extracted.</td>
</tr>
<tr>
<td>start</td>
<td>Required</td>
<td>Integer</td>
<td>The position to start the extraction. First character is 1.</td>
</tr>
<tr>
<td>length</td>
<td>Required</td>
<td>Integer</td>
<td>The number of characters to extract.</td>
</tr>
</tbody>
</table>
<p>Example: Mid(&quot;Hello, World!&quot;, 2, 5)</p>
<p>Returns &quot;ello,&quot;.</p>
<table>
<thead>
<tr>
<th>Name Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source Required</td>
<td>String</td>
<td>Usually name of the attribute.</td>
</tr>
<tr>
<td>start Required</td>
<td>Integer</td>
<td>Index in the source string where substring should start. First character in the string has an index of 1, second character has an index 2, and so on.</td>
</tr>
<tr>
<td>length Required</td>
<td>Integer</td>
<td>Length of the substring. If length ends outside the source string, function returns substring from start index until end of source string.</td>
</tr>
</tbody>
</table>
<h1 id="normalizediacritics">NormalizeDiacritics</h1>
<p>Function: NormalizeDiacritics(source)</p>
<p>Description: Requires one string argument. Returns the string, but with any diacritical characters replaced with equivalent nondiacritical characters. Typically used to convert first names and last names containing diacritical characters (accent marks) into legal values that can be used in various user identifiers such as user principal names, SAM account names, and email addresses.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually a first name or last name attribute.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Character with Diacritic</th>
<th>Normalized character</th>
<th>Character with Diacritic</th>
<th>Normalized character</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä, à, â, ã, å, á, ą, ă, ā, á, à, â, ã, ã, ä, å, a, å</td>
<td>a</td>
<td>Ä, À, Â, Ã, Å, Á, Ą, Ă, Ā, Á, À, Â, Ã, Ã, Ä, Ã, A, Å</td>
<td>A</td>
</tr>
<tr>
<td>æ, æ</td>
<td>ae</td>
<td>Æ, Ā</td>
<td>AE</td>
</tr>
<tr>
<td>ç, č, ć, č, c</td>
<td>c</td>
<td>Ç, Č, Ć, Č, C</td>
<td>C</td>
</tr>
<tr>
<td>ď, d, d</td>
<td>d</td>
<td>Ď, D, D</td>
<td>D</td>
</tr>
<tr>
<td>ë, è, é, ê, ę, ě, ė, ē, é, è, ê, ẽ, ē, e̱, ē, é</td>
<td>e</td>
<td>Ë, È, É, Ê, Ę, Ě, Ė, Ē, É, È, Ê, ẽ, Ē, Ė, Ē, É</td>
<td>E</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Character with Diacritic</th>
<th>Normalized character</th>
<th>Character with Diacritic</th>
<th>Normalized character</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğ, ğ, g</td>
<td>g</td>
<td>Ğ, Ğ, Ģ</td>
<td>G</td>
</tr>
<tr>
<td>ï, î, ì, í, ı, ī, Í, ì, î, ĩ, į</td>
<td>i</td>
<td>&lt;1- 21</td>
<td>- ❌</td>
</tr>
<tr>
<td>[&#39;, ł, I, [, ]</td>
<td>I</td>
<td>Ł, Ľ, L, GL</td>
<td>L ❌</td>
</tr>
<tr>
<td>ñ, ń, ň, n̄, ṋ</td>
<td>n</td>
<td>Ñ, Ń, Ň, N̄, Ņ</td>
<td>N ✅</td>
</tr>
<tr>
<td>ö, ò, ő, õ, ô, ó, ō, ố, ồ, ô, õ, ô, ö, ọ, õ, ỏ, o</td>
<td>O ❌</td>
<td>Ö, Ò, Ő, Õ, Ô, Ó, ô, Ô, Ò, ô, ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌ ❌  Õ, Ô, Ö, Q, õ, ỏ, 0</td>
<td>O ❌</td>
</tr>
<tr>
<td>Ø,ø, œ ✅</td>
<td>oe</td>
<td>Ø,Ø, Œ ✅</td>
<td>OE ❌</td>
</tr>
<tr>
<td>ř, r, r, r</td>
<td>r</td>
<td>Ř, Ř, R, Ř</td>
<td>R</td>
</tr>
<tr>
<td>ß</td>
<td>SS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>š, Ś, ș, ș, š, S</td>
<td>S</td>
<td>Š, Ś, Ș, Ș, Š, S</td>
<td>S</td>
</tr>
<tr>
<td>ť, ț, t, t</td>
<td>t</td>
<td>Ť, Ț, Ī, Ţ</td>
<td>T</td>
</tr>
<tr>
<td>ü, ù, û, ú, ů, ű, ū, ú, ù, û, ũ, ū, ū, ũ, u̱, u̱</td>
<td>u</td>
<td>Ü, Ù, Û, Ú, Ů, Ű, Ū, Ú, Ù, Û, Õ, U</td>
<td>Ú, Ü, Ü, Ų, U</td>
</tr>
<tr>
<td>ÿ, ý, ÿ, ý, ỳ, ỹ, y</td>
<td>y</td>
<td>Ÿ, Ý, Y, Ý, Ỳ, Ý, Y</td>
<td>Y</td>
</tr>
<tr>
<td>ź, ž, ż, ž, z</td>
<td>Z</td>
<td>Ź, Ž, Ż,Ż,Z</td>
<td>Z</td>
</tr>
</tbody>
</table>
<p>Remove diacritics from a string</p>
<p>Example: Replace characters containing accent marks with equivalent characters that don&#39;t contain accent marks.</p>
<p>Expression: NormalizeDiacritics([givenName])</p>
<p>Sample input/output:</p>
<pre><code>INPUT (givenName): &quot;Zoë&quot;

OUTPUT: &quot;Zoe&quot;
</code></pre><p>Not</p>
<p>Function: Not(source)</p>
<p>Description: Flips the boolean value of the source. If source value is True, returns False. Otherwise, returns True.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>Boolean String</td>
<td>Expected source values are &quot;True&quot; or &quot;False&quot;.</td>
</tr>
</tbody>
</table>
<h1 id="now">Now</h1>
<p>Function: Now()</p>
<p>Description: The Now function returns a string representing the current UTC DateTime in the format M/d/yyyy h:mm:ss tt.</p>
<p>Example: Now() Example value returned 7/2/2021 3:33:38 PM</p>
<h1 id="numfromdate">NumFromDate</h1>
<p>Function: NumFromDate(value)</p>
<p>Description: The NumFromDate function converts a DateTime value to Active Directory format that is required to set attributes like accountExpires. Use this function to convert DateTime values received from cloud HR apps like Workday and SuccessFactors to their equivalent AD representation.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Required</td>
<td>String</td>
<td>Date time string in ISO 8601 format. If the date variable is in</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>a different format, use FormatDateTime function to convert the</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>date to ISO 8601 format.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<ul>
<li><p>Workday example Assuming you want to map the attribute ContractEndDate from Workday, which is in the format 2020-12-31-08:00 to accountExpires field in AD, here’s how you can use this function and change the timezone offset to match your locale. NumFromDate(Join(&quot;&quot;, FormatDateTime([ContractEndDate], ,&quot;yyyy-MM-ddzzz&quot;, &quot;yyyy-MM-dd&quot;), &quot; 23:59:59-08:00&quot;))</p>
</li>
<li><p>SuccessFactors example Assuming you want to map the attribute endDate from SuccessFactors, which is in the format M/d/yyyy hh:mm:ss tt to accountExpires field in AD, here&#39;s how you can use this function and change the time zone offset to match your locale. NumFromDate(Join(&quot;&quot;, FormatDateTime([endDate], ,&quot;M/d/yyyy hh:mm:ss tt&quot;, &quot;yyyy-MM-dd&quot;), &quot; 23:59:59-08:00&quot;))</p>
</li>
</ul>
<h1 id="pcase">PCase</h1>
<p>Function: PCase(source, wordSeparators)</p>
<p>Description: The PCase function converts the first character of each word in a string to upper case, and all other characters are converted to lower case.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/Optional</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>source value to convert to proper case.</td>
</tr>
<tr>
<td>wordSeparators</td>
<td>Optional</td>
<td>String</td>
<td>Specify a set of characters that is used as word separators (example: &quot; ,-&#39;&quot;)</td>
</tr>
</tbody>
</table>
<h2 id="remarks">Remarks:</h2>
<ul>
<li>If the wordSeparators parameter isn&#39;t specified, then PCase internally invokes the .NET function ToTitleCase to convert the source string to proper case. The .NET function ToTitleCase supports a comprehensive set of the Unicode character categories as word separators.<ul>
<li>Space character ❌</li>
<li>New line character ❌</li>
<li>Control characters like CRLF ❌</li>
<li>Format control characters ❌</li>
<li>ConnectorPunctuation characters like underscore ❌</li>
<li>DashPunctuation characters like dash and hyphen (including characters such En Dash, Em Dash, double hyphen, etc.) ✅</li>
</ul>
</li>
</ul>
<p>o OpenPunctuation and ClosePunctuation characters that occur in pairs like parenthesis, curly bracket, angle bracket, etc.</p>
<p>o InitialQuotePunctuation and FinalQuotePunctuation characters like single quotes, double quotes and angular quotes.</p>
<p>o OtherPunctuation characters like exclamation mark, number sign, percent sign, ampersand, asterisk, comma, full stop, colon, semi-colon, etc.</p>
<p>o MathSymbol characters like plus sign, less-than and greater-than sign, vertical line, tilde, equals sign, etc.</p>
<p>o CurrencySymbol characters like dollar sign, cent sign, pound sign, euro sign, etc.</p>
<p>o ModifierSymbol characters like macron, accents, arrow heads, etc.</p>
<p>o OtherSymbol characters like copyright sign, degree sign, registered sign, etc.</p>
<p>If the wordSeparators parameter is specified, then PCase only uses the characters specified as word separators.</p>
<h1 id="example">Example:</h1>
<p>Let&#39;s say you&#39;re sourcing the attributes firstName and lastName from SAP SuccessFactors and in HR both these attributes are in upper-case. Using the PCase function, you can convert the name to proper case as shown below.</p>
<p>C) Expand table</p>
<table>
<thead>
<tr>
<th>Expression</th>
<th>Input</th>
<th>Output</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>PCase([firstName])</td>
<td>firstName = &quot;PABLO</td>
<td>&quot;Pablo</td>
<td>As the wordSeparators parameter isn&#39;t specified,</td>
</tr>
<tr>
<td></td>
<td>GONSALVES (SECOND)&quot;</td>
<td>Gonsalves (Second)&quot;</td>
<td>the PCase function uses the default word separators</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>character set.</td>
</tr>
<tr>
<td>PCase([lastName],&quot; &#39;-</td>
<td>lastName = &quot;PINTO-</td>
<td>&quot;Pinto-</td>
<td>The PCase function uses characters in the</td>
</tr>
<tr>
<td>&quot;)</td>
<td>DE&#39;SILVA&quot;</td>
<td>De&#39;Silva&quot;</td>
<td>wordSeparators parameter to identify words and</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>transform them to proper case.</td>
</tr>
<tr>
<td>PCase (Join(&quot; &quot;,</td>
<td>firstName = &quot;GREGORY,</td>
<td>&quot;Gregory</td>
<td>You can nest the Join function within</td>
</tr>
<tr>
<td>[firstName],</td>
<td>lastName = &quot;JAMES&quot;</td>
<td>James&quot;</td>
<td>PCase. As the wordSeparators parameter isn&#39;t</td>
</tr>
<tr>
<td>[lastName]))</td>
<td></td>
<td></td>
<td>specified, the PCase function uses the default word</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>separators character set.</td>
</tr>
</tbody>
</table>
<h1 id="randomstring">RandomString</h1>
<p>Function: RandomString(Length, MinimumNumbers, MinimumSpecialCharacters, MinimumCapital, MinimumLowerCase, CharactersToAvoid)</p>
<p>Description: The RandomString function generates a random string based on the conditions specified. Characters allowed can be identified here.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Length</td>
<td>Required</td>
<td>Number</td>
<td>Total length of the random string. This should be greater than or equal to the sum of MinimumNumbers, MinimumSpecialCharacters, and MinimumCapital. 256 characters max.</td>
</tr>
<tr>
<td>MinimumNumbers</td>
<td>Required</td>
<td>Number</td>
<td>Minimum numbers in the random string.</td>
</tr>
<tr>
<td>MinimumSpecialCharacters</td>
<td>Required</td>
<td>Number</td>
<td>Minimum number of special characters.</td>
</tr>
<tr>
<td>MinimumCapital</td>
<td>Required</td>
<td>Number</td>
<td>Minimum number of capital letters in the random string.</td>
</tr>
<tr>
<td>MinimumLowerCase</td>
<td>Required</td>
<td>Number</td>
<td>Minimum number of lower case letters in the random string.</td>
</tr>
<tr>
<td>CharactersToAvoid</td>
<td>Optional</td>
<td>String</td>
<td>Characters to be excluded when generating the random string.</td>
</tr>
</tbody>
</table>
<p>Example 1: - Generate a random string without special character restrictions: RandomString(6,3,0,0,3) Generates a random string with 6 characters. The string contains 3 numbers and 3 lower case characters (1a73qt).</p>
<p>Example 2: - Generate a random string with special character restrictions: RandomString(10, 2,2,2,1,&quot;?,&quot;) Generates a random string with 10 characters. The string contains at least 2 numbers, 2 special characters, 2 capital letters, 1 lower case letter and excludes the characters &quot;?&quot; and &quot;,&quot; (1@!2BaRg53).</p>
<p>Redact</p>
<p>Function: Redact()</p>
<p>Description: The Redact function replaces the attribute value with the string literal &quot; [Redact]&quot; in the provisioning logs.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute/value</td>
<td>Required</td>
<td>String</td>
<td>Specify the attribute or constant / string to redact from the logs.</td>
</tr>
</tbody>
</table>
<p>Example 1: Redact an attribute: Redact([userPrincipalName]) Removes the userPrincipalName from the provisioning logs.</p>
<p>Example 2: Redact a string: Redact(&quot;StringToBeRedacted&quot;) Removes a constant string from the provisioning logs.</p>
<p>Example 3: Redact a random string: Redact(RandomString(6,3,0,0,3)) Removes the random string from the provisioning logs.</p>
<h1 id="removeduplicates">RemoveDuplicates</h1>
<p>Function: RemoveDuplicates(attribute)</p>
<p>Description: The RemoveDuplicates function takes a multi-valued string and make sure each value is unique.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>attribute</td>
<td>Required</td>
<td>Multi-valued Attribute</td>
<td>Multi-valued attribute that has duplicates removed</td>
</tr>
</tbody>
</table>
<p>Example: RemoveDuplicates([proxyAddresses]) Returns a sanitized proxyAddress attribute where all duplicate values are removed.</p>
<h2 id="replace">Replace</h2>
<p>Function: Replace(source, oldValue, regexPattern, regexGroupName, replacementValue, replacementAttributeName, template)</p>
<p>Description: Replaces values within a string in a case-sensitive manner. The function behaves differently depending on the parameters provided:</p>
<p>· When oldValue and replacementValue are provided:</p>
<p>o Replaces all occurrences of oldValue in the source with replacementValue</p>
<p>· When oldValue and template are provided:</p>
<p>o Replaces all occurrences of the oldValue in the template with the source value</p>
<p>· When regexPattern and replacementValue are provided:</p>
<p>o The function applies the regexPattern to the source string and you can use the regex group names to construct the string for replacementValue</p>
<p>Note</p>
<p>To learn more about regex grouping constructs and named sub-expressions, see Grouping Constructs in Regular Expressions.</p>
<p>· When regexPattern, regexGroupName, replacementValue are provided:</p>
<p>o The function applies the regexPattern to the source string and replaces all values matching regexGroupName with replacementValue</p>
<p>· When regexPattern, regexGroupName, replacementAttributeName are provided:</p>
<p>o If source has a value, source is returned
o If source has no value, the function applies the regexPattern to the replacementAttributeName and returns the value matching regexGroupName</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>oldValue</td>
<td>Optional</td>
<td>String</td>
<td>Value to be replaced in source or template.</td>
</tr>
<tr>
<td>regexPattern</td>
<td>Optional</td>
<td>String</td>
<td>Regex pattern for the value to be replaced in source. When replacementAttributeName is used, the regexPattern is applied to extract a value from replacementAttributeName.</td>
</tr>
<tr>
<td>regexGroupName</td>
<td>Optional</td>
<td>String</td>
<td>Name of the group inside regexPattern. When named replacementAttributeName is used, we&#39;ll extract the value of the named regex group from the</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>replacementValue</td>
<td>Optional</td>
<td>String</td>
<td>New value to replace old one with.</td>
</tr>
<tr>
<td>replacementAttributeName</td>
<td>Optional</td>
<td>String</td>
<td>Name of the attribute to be used for replacement value</td>
</tr>
<tr>
<td>template</td>
<td>Optional</td>
<td>String</td>
<td>When template value is provided, we&#39;ll look for oldValue inside the template and replace it with source value.</td>
</tr>
</tbody>
</table>
<h1 id="replace-characters-using-a-regular-expression">Replace characters using a regular expression</h1>
<p>Example 1: Using oldValue and replacementValue to replace the entire source string with another string.</p>
<p>Let&#39;s say your HR system has an attribute BusinessTitle. As part of recent job title changes, your company wants to update anyone with the business title &quot;Product Developer&quot; to &quot;Software Engineer&quot;. Then in this case, you can use the following expression in your attribute mapping.</p>
<pre><code>Replace([BusinessTitle], &quot;Product Developer&quot;, , , &quot;Software Engineer&quot;, , )
</code></pre><ul>
<li>source: [BusinessTitle]</li>
<li>oldValue: &quot;Product Developer&quot;</li>
<li>replacementValue: &quot;Software Engineer&quot;</li>
<li>Expression output: Software Engineer</li>
</ul>
<p>Example 2: Using oldValue and template to insert the source string into another templatized string.</p>
<p>The parameter oldValue is a misnomer in this scenario. It&#39;s actually the value that gets replaced.</p>
<p>Let&#39;s say you want to always generate login ID in the format <username>@contoso.com. There is a source attribute called UserID and you want that value to be used for the <username> portion of the login ID. Then in this case, you can use the following expression in your attribute mapping.<p>
<pre><code>Replace([UserID], &quot;&lt;username&gt;&quot;, , , , , &quot;&lt;username&gt;@contoso.com&quot;)
</code></pre><ul>
<li><p>source: [UserID] = &quot;jsmith&quot;</p>
</li>
<li><p>oldValue: &quot;<username>&quot;<p>
</username></li>
<li>template: &quot;<username>@contoso.com&quot;</username></li>
<li>Expression output: &quot;jsmith@contoso.com&quot;</li>
</ul>
<p>Example 3: Using regexPattern and replacementValue to extract a portion of the source string and replace it with an empty string or a custom value built using regex patterns or regex group names.</p>
<p>Let&#39;s say you have a source attribute telephoneNumber that has components country code and phone number separated by a space character. For example, +91 9998887777 Then in this case, you can use the following expression in your attribute mapping to extract the 10 digit phone number.</p>
<p>Replace([telephoneNumber],, &quot;\\+( ?&lt; isdCode&gt;\\d* )( ?&lt; phoneNumber&gt;\\d{10})&quot;,, &quot;${ phoneNumber}&quot;,, )</p>
<ul>
<li>source: [telephoneNumber] = &quot;+91 9998887777&quot;</li>
<li>regexPattern: &quot;\\+( ?&lt; isdCode&gt;\\d* )( ?&lt; phoneNumber&gt;\\d{10})&quot;</li>
<li>replacementValue: &quot;${ phoneNumber}&quot;</li>
<li>Expression output: 9998887777</li>
</ul>
<p>You can also use this pattern to remove characters and collapse a string. For example, the expression below removes parenthesis, dashes and space characters in the mobile number string and returns only digits.</p>
<p>Replace([mobile],, &quot;[ ()\\s-]+&quot;,, &quot;&quot;,, )</p>
<ul>
<li>source: [mobile] = &quot;+1 (999) 888-7777&quot;</li>
<li>regexPattern: &quot;[ ()\\s-]+&quot;</li>
<li>replacementValue: &quot;&quot; (empty string)</li>
<li>Expression output: 19998887777</li>
</ul>
<p>Example 4: Using regexPattern, regexGroupName and replacementValue to extract a portion of the source string and replace it with another literal value or empty string.</p>
<p>Let&#39;s say your source system has an attribute AddressLineData with two components street number and street name. As part of a recent move, let&#39;s say the street number of the address changed, and you want to update only the street number portion of the address line. Then in this case, you can use the following expression in your attribute mapping to extract the street number.</p>
<p>Replace([AddressLineData],, &quot;(?<streetnumber>^\d*)&quot;, &quot;streetNumber&quot;, &quot;888&quot;,, )<p>
<ul>
<li>source: [AddressLineData] = &quot;545 Tremont Street&quot;</li>
</ul>
<p>· regexPattern: &quot;(?<streetnumber>^\d*)&quot;<p>
<p>· regexGroupName: &quot;streetNumber&quot;</p>
<p>· replacementValue: &quot;888&quot;</p>
<p>· Expression output: 888 Tremont Street</p>
<p>Here is another example where the domain suffix from a UPN is replaced with an empty string to generate login ID without domain suffix.</p>
<p>Replace([userPrincipalName], , &quot;(?<suffix>@(.)*)&quot;, &quot;Suffix&quot;, &quot;&quot;, , )<p>
<p>· source: [userPrincipalName] =&quot;jsmith@contoso.com&quot;</p>
<p>· regexPattern: &quot;(?<suffix>@(.)*&quot;<p>
<p>· regexGroupName: &quot;Suffix&quot;</p>
<p>· replacementValue: &quot;&quot; (empty string)</p>
<p>· Expression output: jsmith</p>
<p>Example 5: Using regexPattern, regexGroupName and replacementAttributeName to handle scenarios when the source attribute is empty or doesn&#39;t have a value.</p>
<p>Let&#39;s say your source system has an attribute telephoneNumber. If telephoneNumber is empty, you want to extract the 10 digits of the mobile number attribute. Then in this case, you can use the following expression in your attribute mapping.</p>
<p>Replace([telephoneNumber], , &quot;\+(?<isdcode>\d* )(?<phonenumber>\d{10})&quot;, &quot;phoneNumber&quot; , , [mobile], )<p>
<p>· source: [telephoneNumber] = &quot;&quot; (empty string)</p>
<p>· regexPattern: &quot;\+(?<isdcode>\d* )(?<phonenumber>\d{10})&quot;<p>
<p>· regexGroupName: &quot;phoneNumber&quot;</p>
<p>· replacementAttributeName: [mobile] = &quot;+91 8887779999&quot;</p>
<p>· Expression output: 8887779999</p>
<p>Example 6: You need to find characters that match a regular expression value and remove them.</p>
<p>Replace([mailNickname], , &quot;[a-zA-Z_]*&quot; و , , )</p>
<p>· source [mailNickname]</p>
<p>· oldValue: &quot;john_doe72&quot;</p>
<p>· replaceValue: &quot;&quot;</p>
<p>· Expression output: 72</p>
<h1 id="selectuniquevalue">SelectUniqueValue</h1>
<p>Function: SelectUniqueValue(uniqueValueRule1, uniqueValueRule2, uniqueValueRule3, ... )</p>
<p>Description: Requires a minimum of two arguments, which are unique value generation rules defined using expressions. The function evaluates each rule and then checks the value generated for uniqueness in the target app/directory. The first unique value found will be the one returned. If all of the values already exist in the target, the entry will get escrowed, and the reason gets logged in the audit logs. There is no upper bound to the number of arguments that can be provided.</p>
<ul>
<li>This function must be at the top-level and cannot be nested.</li>
<li>This function cannot be applied to attributes that have a matching precedence.</li>
<li>This function is only meant to be used for entry creations. When using it with an attribute, set the Apply Mapping property to Only during object creation.</li>
<li>This function is currently only supported for &quot;Workday to Active Directory User Provisioning&quot; and &quot;SuccessFactors to Active Directory User Provisioning&quot;. It cannot be used with other provisioning applications.</li>
<li>The LDAP search that SelectUniqueValue function performs in on-premises Active Directory doesn&#39;t escape special characters like diacritics. If you pass a string like &quot;Jéssica Smith&quot; that contains a special character, you will encounter processing errors. Nest the NormalizeDiacritics function as shown in the example below to normalize special characters.</li>
</ul>
<p>Parameters:
Expand table</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>uniqueValueRule1 ...</td>
<td>At least 2 are required,</td>
<td>String</td>
<td>List of unique value</td>
</tr>
<tr>
<td>uniqueValueRuleN</td>
<td>no upper bound</td>
<td></td>
<td>generation rules to evaluate.</td>
</tr>
</tbody>
</table>
<h2 id="generate-unique-value-for-userprincipalname-upn-attribute">Generate unique value for userPrincipalName (UPN) attribute</h2>
<p>Example: Based on the user&#39;s first name, middle name and last name, you need to generate a value for the UPN attribute and check for its uniqueness in the target AD directory before assigning the value to the UPN attribute.</p>
<p>Expression:</p>
<p>ad-attr-mapping-expr</p>
<p>SelectUniqueValue(
Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, 
[PreferredFirstName], [PreferredLastName]))), &quot;contoso.com&quot;),
Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, Mid([PreferredFirstName], 1, 1), [PreferredLastName]))), &quot;contoso.com&quot;), Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, Mid([PreferredFirstName], 1, 2), [PreferredLastName]))), &quot;contoso.com&quot;) )</p>
<h1 id="sample-inputoutput">Sample input/output:</h1>
<ul>
<li>INPUT (PreferredFirstName): &quot;John&quot;</li>
<li>INPUT (PreferredLastName): &quot;Smith&quot;</li>
<li>OUTPUT: &quot;John.Smith@contoso.com&quot; if UPN value of John.Smith@contoso.com doesn&#39;t already exist in the directory</li>
<li>OUTPUT: &quot;J.Smith@contoso.com&quot; if UPN value of John.Smith@contoso.com already exists in the directory</li>
<li>OUTPUT: &quot;Jo.Smith@contoso.com&quot; if the above two UPN values already exist in the directory</li>
</ul>
<h1 id="singleapproleassignment">SingleAppRoleAssignment</h1>
<p>Function: SingleAppRoleAssignment([appRoleAssignments])</p>
<p>Description: Returns a single appRoleAssignment from the list of all appRoleAssignments assigned to a user for a given application. This function is required to convert the appRoleAssignments object into a single role name string. The best practice is to ensure only one appRoleAssignment is assigned to one user at a time. This function isn&#39;t supported in scenarios where users have multiple app role assignments.</p>
<p>Parameters:</p>
<p>Expand table</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>[appRoleAssignments]</td>
<td>Required</td>
<td>String</td>
<td>[appRoleAssignments] object.</td>
</tr>
</tbody>
</table>
<h1 id="split">Split</h1>
<p>Function: Split(source, delimiter)</p>
<p>Description: Splits a string into a multi-valued array, using the specified delimiter character.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>source value to update.</td>
</tr>
<tr>
<td>delimiter</td>
<td>Required</td>
<td>String</td>
<td>Specifies the character that will be used to split the string (example: &quot;,&quot;)</td>
</tr>
</tbody>
</table>
<h1 id="split-a-string-into-a-multi-valued-array">Split a string into a multi-valued array</h1>
<p>Example: You need to take a comma-delimited list of strings, and split them into an array that can be plugged into a multi-value attribute like Salesforce&#39;s PermissionSets attribute. In this example, a list of permission sets has been populated in extensionAttribute5 in Microsoft Entra ID.</p>
<p>Expression: Split([extensionAttribute5], &quot;,&quot;)</p>
<p>Sample input/output:</p>
<ul>
<li>INPUT (extensionAttribute5): &quot;PermissionSetOne, PermissionSetTwo&quot;</li>
<li>OUTPUT: [&quot;PermissionSetOne&quot;, &quot;PermissionSetTwo&quot;]</li>
</ul>
<h1 id="stripspaces">StripSpaces</h1>
<p>Function: StripSpaces(source)</p>
<p>Description: Removes all space (&quot; &quot;) characters from the source string.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>source value to update.</td>
</tr>
</tbody>
</table>
<h1 id="switch">Switch</h1>
<p>Function: Switch(source, defaultValue, key1, value1, key2, value2, ... )</p>
<p>Description: When source value matches a key, returns value for that key. If source value doesn&#39;t match any keys, returns defaultValue. Key and value parameters must always come in pairs. The function always expects an even number of parameters. The function shouldn&#39;t be used for referential attributes such as manager.</p>
<h2 id="note-2">Note</h2>
<p>Switch function performs a case-sensitive string comparison of the source and key values. If you&#39;d like to perform a case-insensitive comparison, normalize the source string before comparison using a nested ToLower function and ensure that all key strings use lowercase. Example: Switch(ToLower([statusFlag]), &quot;0&quot;, &quot;true&quot;, &quot;1&quot;, &quot;false&quot;, &quot;0&quot;) . In this example, the source attribute statusFlag may have values (&quot;True&quot; / &quot;true&quot; / &quot;TRUE&quot;). However, the Switch function will always convert it to lowercase string &quot;true&quot; before comparison with key parameters.</p>
<h2 id="caution">Caution</h2>
<p>For the source parameter, do not use the nested functions IsPresent, IsNull or IsNullOrEmpty. Instead use a literal empty string as one of the key values. Example: Switch([statusFlag], &quot;Default Value&quot;, &quot;true&quot;, &quot;1&quot;, &quot;&quot;, &quot;0&quot;) . In this example, if the source attribute statusFlag is empty, the Switch function will return the value 0.</p>
<h2 id="parameters">Parameters</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Source value to update.</td>
</tr>
<tr>
<td>defaultValue</td>
<td>Optional</td>
<td>String</td>
<td>Default value to be used when source doesn&#39;t match any keys. Can be empty string (&quot;&quot;).</td>
</tr>
<tr>
<td>key</td>
<td>Required</td>
<td>String</td>
<td>Key to compare source value with.</td>
</tr>
<tr>
<td>value</td>
<td>Required</td>
<td>String</td>
<td>Replacement value for the source matching the key.</td>
</tr>
</tbody>
</table>
<h1 id="replace-a-value-based-on-predefined-set-of-options">Replace a value based on predefined set of options</h1>
<p>Example: Define the time zone of the user based on the state code stored in Microsoft Entra ID. If the state code doesn&#39;t match any of the predefined options, use default value of &quot;Australia/Sydney&quot;.</p>
<p>Expression: Switch([state], &quot;Australia/Sydney&quot;, &quot;NSW&quot;, &quot;Australia/Sydney&quot;, &quot;QLD&quot;, &quot;Australia/Brisbane&quot;, &quot;SA&quot;, &quot;Australia/Adelaide&quot;)</p>
<p>Sample input/output:</p>
<p>· INPUT (state): &quot;QLD&quot;</p>
<p>· OUTPUT: &quot;Australia/Brisbane&quot;</p>
<h1 id="tolower">ToLower</h1>
<p>Function: ToLower(source, culture)</p>
<p>Description: Takes a source string value and converts it to lower case using the culture rules that are specified. If there is no culture info specified, then it will use Invariant culture.</p>
<p>If you would like to set existing values in the target system to lower case, update the schema for your target application and set the property caseExact to &#39;true&#39; for the attribute that you&#39;re interested in.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object</td>
</tr>
<tr>
<td>culture</td>
<td>Optional</td>
<td>String</td>
<td>The format for the culture name based on RFC 4646 is languagecode2-country/regioncode2, where languagecode2 is the two-letter language code and country/regioncode2 is the two- letter subculture code. Examples include ja-JP for Japanese (Japan) and en-US for English (United States). In cases where a two-letter language code isn&#39;t available, a three-letter code derived from ISO 639-2 is used.</td>
</tr>
</tbody>
</table>
<p>Convert generated userPrincipalName (UPN) value to lower case</p>
<p>Example: You would like to generate the UPN value by concatenating the PreferredFirstName and PreferredLastName source fields and converting all characters to lower case.</p>
<p>ToLower(Join(&quot;@&quot;, NormalizeDiacritics(StripSpaces(Join(&quot;.&quot;, [PreferredFirstName], [PreferredLastName]))), &quot;contoso.com&quot;))</p>
<p>Sample input/output:</p>
<ul>
<li>INPUT (PreferredFirstName): &quot;John&quot;</li>
<li>INPUT (PreferredLastName): &quot;Smith&quot;</li>
<li>OUTPUT: &quot;john.smith@contoso.com&quot;</li>
</ul>
<p>ToUpper</p>
<p>Function: ToUpper(source, culture)</p>
<p>Description: Takes a source string value and converts it to upper case using the culture rules that are specified. If there is no culture info specified, then it will use Invariant culture.</p>
<p>If you would like to set existing values in the target system to upper case, update the schema for your target application and set the property caseExact to &#39;true&#39; for the attribute that you&#39;re interested in.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>Required</td>
<td>String</td>
<td>Usually name of the attribute from the source object.</td>
</tr>
<tr>
<td>culture</td>
<td>Optional</td>
<td>String</td>
<td>The format for the culture name based on RFC 4646 is languagecode2-country/regioncode2, where languagecode2 is the two-letter language code and country/regioncode2 is the two-letter subculture code. Examples include ja-JP for Japanese (Japan) and en-US for English (United States). In cases where a two-letter language code isn&#39;t available, a three-letter code derived from ISO 639-2 is used.</td>
</tr>
</tbody>
</table>
<p>Word</p>
<p>Function: Word(String,WordNumber,Delimiters)</p>
<p>Description: The Word function returns a word contained within a string, based on parameters describing the delimiters to use and the word number to return. Each string of characters in string separated by the one of the characters in delimiters are identified as words:</p>
<p>If number &lt; 1, returns empty string. If string is null, returns empty string. If string contains less than number words, or string doesn&#39;t contain any words identified by delimiters, an empty string is returned.</p>
<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required/ Repeating</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>Required</td>
<td>Multi-valued Attribute</td>
<td>String to return a word from.</td>
</tr>
<tr>
<td>WordNumber</td>
<td>Required</td>
<td>Integer</td>
<td>Number identifying which word number should return</td>
</tr>
<tr>
<td>delimiters</td>
<td>Required</td>
<td>String</td>
<td>A string representing the delimiter(s) that should be used to identify words</td>
</tr>
</tbody>
</table>
<p>Example: Word(&quot;The quick brown fox&quot;, 3, &quot; &quot;)</p>
<p>Returns &quot;brown&quot;.</p>
<p>Word(&quot;This, string!has&amp;many separators&quot;, 3, &quot;, ! &amp;#&quot;)</p>
<p>Returns &quot;has&quot;.</p>
<h1 id="examples">Examples</h1>
<p>This section provides more expression function usage examples.</p>
<h1 id="strip-known-domain-name">Strip known domain name</h1>
<p>Strip a known domain name from a user&#39;s email to obtain a user name. For example, if the domain is &quot;contoso.com&quot;, then you could use the following expression:</p>
<p>Expression: Replace([mail], &quot;@contoso.com&quot;, , ,&quot;&quot;, ,)</p>
<p>Sample input / output:</p>
<ul>
<li>INPUT (mail): &quot;john.doe@contoso.com&quot;</li>
<li>OUTPUT: &quot;john.doe&quot;</li>
</ul>
<h1 id="generate-user-alias-by-concatenating-parts-of-first-and-last-name">Generate user alias by concatenating parts of first and last name</h1>
<p>Generate a user alias by taking first three letters of user&#39;s first name and first five letters of user&#39;s last name.</p>
<p>Expression: Append(Mid([givenName], 1, 3), Mid([surname], 1, 5))</p>
<p>Sample input/output:</p>
<ul>
<li>INPUT (givenName): &quot;John&quot;</li>
<li>INPUT (surname): &quot;Doe&quot;</li>
<li>OUTPUT: &quot;JohDoe&quot;</li>
</ul>
<p>Add a comma between last name and first name.</p>
<p>Expression: Join(&quot;, &quot;, &quot;&quot;, [surname], [givenName])</p>
<p>Sample input/output:</p>
<ul>
<li>INPUT (givenName): &quot;John&quot;</li>
<li>INPUT (surname): &quot;Doe&quot;</li>
<li>OUTPUT: &quot;Doe, John&quot;</li>
</ul>
<p>Generate an ID for a user based on their Microsoft Entra ID object ID. Remove any letters from the ID and add 1000 at the beginning.</p>
<p>This expression allows you to generate an identifier for a user that starts with 1000 and is likely to be unique.</p>
<p>Expression: Join(&quot;&quot;, 1000, Replace(ConvertToUTF8Hex([objectld]), , &quot;[a-zA-Z_]*&quot;, , &quot;&quot;, , ))</p>
<p>Sample input/output:</p>
<ul>
<li>INPUT: &quot;d05e47b1-3909-445a-ba5e-ca60cbc0e4b4&quot;</li>
</ul>
<p>· OUTPUT: &quot;100064303565343762312333930392343435612626135652636136306362633065346234&quot;</p>
<h1 id="related-articles-1">Related Articles</h1>
<p>· Automate User Provisioning/Deprovisioning to SaaS Apps</p>
<p>· Customizing Attribute Mappings for User Provisioning</p>
<p>· Scoping Filters for User Provisioning</p>
<p>· Using SCIM to enable automatic provisioning of users and groups from Microsoft Entra ID to applications</p>
<p>· Account Provisioning Notifications</p>
<p>· List of Tutorials on How to Integrate SaaS Apps</p>
</phonenumber></isdcode></phonenumber></isdcode></suffix></suffix></streetnumber></streetnumber></username></username></sourcetenantid></serviceprincipalid></serviceprincipalid></serviceprincipalid></serviceprincipalid></jobid></userobjectid></ruleid></jobid></serv></approleid></serviceprincipalid></serviceprincipalid></approleid></appownerorganizationid></appid></targettenantid></targettenantid></sourcetenantid></sourcetenantid></targettenantid></sourcetenantid></membertenantid></membertenantidd></membertenantidd></ownertenantid></mtoidc></ownertenantid></article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Follow this project on github <a href="https://github.com/douglasware/ElumenotionSite">Elumenotion Site and Samples</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>